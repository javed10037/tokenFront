!function(a){"use strict";a.call(zmail.Core.Namespaces.create("zmail.SearchComponents"),zmail.Core.Namespaces.get)}(function(a){"use strict";var b=a("_"),c="default",d=function(a){return a},e=function(a,b){b.str?a.text(b.str):a.append(b.$el)},f={DEFAULT:"default",HEADER:"header",CUSTOM:"custom",SEPARATOR:"separator",BUBBLE:"bubble"},g={LIST_CLASS:"js-dropmenu",LIST_ITEM_CLASS:"js-dropmenuitem",LIST_WRAPPER_CLASS:"js-wrapper",ZOHO_ONE_SEARCH_CLASS:"js-zone-dropmenuitem","default":function(a,b){var c=$("<li class='"+g.LIST_ITEM_CLASS+"' data-menuid='"+b+"'  />");return e(c,a),c},header:function(a,b){var c=$("<li class='nohr dd_label'/>");return e(c,a),c},custom:function(a,b){return $(a).addClass(g.LIST_ITEM_CLASS).data("menuid",b),a},separator:function(){return $("<li class='SC_lne'/>")},zohoOneSearch:function(a,b){var c=$(document.createDocumentFragment()),d=$(["<li class='",g.LIST_ITEM_CLASS," ",g.ZOHO_ONE_SEARCH_CLASS,"' data-menuid='",b,"' >","</li>"].join(""));return e(c,{$el:$("<li class='SC_lne "+g.ZOHO_ONE_SEARCH_CLASS+"' />")}),e(d,a),e(c,{$el:d}),c},bubble:function(a,b){var c=$(["<div class='zmSearchBub zmSBC "+g.LIST_ITEM_CLASS+"' data-menuid='"+b+"'  >","</div>"].join(""));return a.selected&&c.addClass("sel"),c.text(a.name),a.iconClass&&c.prepend("<i class='"+a.iconClass+"' />"),c},bubbles:function(a,b){var c=$(["<li class='nohr'>","<div class='zmSAS' />","</li>"].join("")),d=c.find(".zmSAS");return a.bubbles.forEach(function(a,c){d.append(g.bubble(a,b+"."+c))}),c},listItems:function(a,e){var h,i,j=e.template||d,k=e.$parent||$(document.createDocumentFragment()),l=e.baseIndex||0;return a.forEach(function(a,d){a=j(a),b.isString(a)?(h=c,a={str:a}):a.str||a.templateType||a.$el?(h=a.templateType||c,a.$el="zohoOneSearch"===a.templateType?$(a):""):(a=$(a),a.hasClass(g.LIST_ITEM_CLASS)?h=f.CUSTOM:(a={$el:a},h=c)),i=g[h],k.append(i(a,l+d))}),k},list:function(a,b){var c=$(["<div class='SC_dd shw zmSearchDD'>","<div class='"+g.LIST_WRAPPER_CLASS+"'>","<ul class='"+g.LIST_CLASS+"' />","</div>","</div>"].join(""));return b=b||{},c.find("."+g.LIST_WRAPPER_CLASS).addClass(b.wrapperClass||""),b.$parent=c.find("."+g.LIST_CLASS),b.$parent.addClass(b.ulClass||""),b.baseIndex=0,g.listItems(a,b),c}};this.ListViewTemplate=g,this.LIST_ITEMS_TEMPLATE_TYPES=f}),function(a){"use strict";a.call(zmail.Core.Namespaces.create("zmail.SearchComponents"),zmail.Core.Namespaces.get)}(function(a){"use strict";var b=a("_"),c=a("$.Deferred"),d=a("zmail.Traverser"),e=a("zmail.Paginator"),f=a("zmail.SearchComponents.ListViewTemplate"),g="ZMAIL_MOUSE_DOWN_EVENT",h={TAB:9,UP_ARROW:38,DOWN_ARROW:40,ENTER:13,ESCAPE:27,SPACE:32,RIGHT_ARROW:39},i=function(a){return this instanceof i?void this.init(a):new i(a)};this.ListView=i,i.prototype={__eventFlag:!1,__active:!0,selectionClass:"sel",wrapperClass:"",ulClass:"",bindEventsForElement:!0,forElementDebounceTime:0,hideOnRemove:!1,removeOnSelect:!0,removeOnMouseDown:!0,removeOnEscape:!0,$for:void 0,$parent:$("body"),$left:void 0,$top:void 0,$right:void 0,$bottom:void 0,list:void 0,nextPageList:void 0,doPaginate:!0,paginator:void 0,pageSize:10,paginateThreshold:30,paginateScrollPercentage:80,selectionStartIndex:-1,autoComplete:!0,onKeyEvent:b.noop,__bindable:["handleClickEvent","handleKeyEvent","handleMouseDownEvent","handleInputAndChangeEvent","handlePagination","template"],bindFunctions:function(){return this.__bindable.reduce(function(a,b){return a[b]=a[b].bind(a),a},this)},init:function(a){b.extend(this,a),this.traverser=this.traverser||new d({skip:this.skip,startIndex:this.selectionStartIndex}),this.bindFunctions().bindEvents$For().setPaginator().paginate()},skip:function(a,b){var c=a&&a.templateType;return"separator"===c||"header"===c},show:function(){return this.hasElement()&&this.__active&&(this.hasPage()?(this.bindEvents().$el.show(),this.$for&&this.$for.focus(),this.onShow()):this.hide()),this},hide:function(){return this.hasElement()&&(this.traverser.resetIndex(),this.paginator.resetPage(),this.unbindEvents().$el.hide(),this.onHide()),this},reset:function(){return this.traverser.reset(),this.paginator.reset(),this},remove:function(){return this.hideOnRemove?this.hide():this.reset().unbindEvents$For().unbindEvents().removeDOM().onRemove(),this},removeDOM:function(){return this.hasElement()&&this.$el.remove(),this},paginate:function(a){var b=this;return this.__active?this.paginator.next(a).then(function(a){b.paginator.isFirstPage()?(b.list=a,b.nextPageList=void 0):(b.nextPageList=a,b.baseIndex=b.list.length,b.list=b.list.concat(a)),b.traverser.set({list:b.list}),b.render()},function(){b.hide()}):c().reject().promise()},render:function(){return this.paginator.isFirstPage()?(this.hasElement()&&this.unbindEvents().$el.remove(),this.compileTemplate().setPosition().mount().setHeight().setWidth().show().select()):this.compileTemplate().show(),this},bindMouseEvents:function(){var a=this;this.$el.find("li").off("mouseenter").on("mouseenter",function(){$(this).one("mousemove",function(){var b=$(this).prevAll().length;a.traverser.index=b,$(this).parent().children().removeClass(a.selectionClass),$(this).addClass(a.selectionClass)})}).off("mouseleave").on("mouseleave",function(){$(this).removeClass(a.selectionClass)})},compileTemplate:function(){return this.paginator.isFirstPage()?this.$el=f.list(this.list,{template:this.template,ulClass:this.ulClass,wrapperClass:this.wrapperClass}):(f.listItems(this.nextPageList,{$parent:this.getListElement(),baseIndex:this.baseIndex,template:this.template}),this.bindMouseEvents()),this},setPosition:function(){return this.$el.css(b.result(this,"position")),this},mount:function(){return this.$parent.append(this.$el),this},isZohoOneSearchContext:function(){return this.$el.find(".js-zone-dropmenuitem").eq(0)[0]},getChildHeight:function(){var a=this.getListElement().children(),b=0;return a.each(function(c,d){b+=$(d).hasClass("SC_lne")?$(a[c-1]||a[c+1]||d).outerHeight():$(d).outerHeight()}),b},getAverageChildHeight:function(){return this.getChildHeight()/this.getListElement().children().length},setHeight:function(){if(this.hasElement()){var a=this.isZohoOneSearchContext(),b=0;if(a)b=this.getChildHeight();else{var c=this.getAverageChildHeight();b=c*this.paginator.getPageSize(),this.paginator.hasMoreToFetch&&(b-=c)}var d=this.getListWrapperElement();d.css({"max-height":b})}return this},setWidth:function(){return this.hasElement()&&this.maxWidth&&this.$el.css({"max-width":this.maxWidth}),this},setPaginator:function(){return this.paginator instanceof e||(this.paginator=e({provider:this.list||[],pageSize:this.pageSize,threshold:this.paginateThreshold})),this},position:function(){var a={top:0,left:0};return this.$left?a.left=this.$left.offset().left:this.$right&&(a.left=this.$right.offset().left+this.$right.outerWidth()),this.$top?a.top=this.$top.offset().top+this.$top.outerHeight():this.$bottom&&(a.top=this.$bottom.offset().top),a},hasElement:function(){return void 0!==this.$el},isVisible:function(){return this.hasElement()&&this.$el.is(":visible")},hasPage:function(){return this.list&&this.list.length},getListWrapperElement:function(){return this.$el.find("."+f.LIST_WRAPPER_CLASS)},getListElement:function(){return this.$el.find("."+f.LIST_CLASS)},getSelectedIndex:function(){return this.traverser.index},scrollIntoView:function(a){return a&&a.scrollIntoViewIfNeeded?a.scrollIntoViewIfNeeded(!1):a&&a.scrollIntoView&&a.scrollIntoView(!1),this},selectMenuItem:function(){var a="[data-menuid="+this.selectedMenu+"]",b=this.$el.find(a);return b.addClass(this.selectionClass),this.scrollIntoView(b[0]),this},unselectMenuItem:function(){return this.$el.find("."+this.selectionClass).removeClass(this.selectionClass),this},select:function(){return this.selectedMenu=this.getSelectedIndex(),this.unselectMenuItem().selectMenuItem(),this},getSelected:function(){var a,c=this.list;if(!b.isEmpty(c)){var d=String(this.selectedMenu).split(".");1===d.length?a=c[this.selectedMenu]:2===d.length&&(a=c[d[0]].bubbles[d[1]])}return a},isSelected:function(){return this.isVisible()&&void 0!==this.getSelected()},handleSelection:b.debounce(function(){var b=this.getSelected();if(b&&b.__isZohoOneSearch){var c=a("_zm");c&&"function"==typeof c.openZohoOneSearch&&c.openZohoOneSearch()}else this.onSelect(b);return b&&b.__keepAutofill?this:(this.removeOnSelect?this.remove():this.hide(),this)},300,!0),handleClickEvent:function(b){var c=a("zmUtil");if(c&&"function"==typeof c.hideMenu&&c.hideMenu(!0),$($(b.target).closest("."+f.ZOHO_ONE_SEARCH_CLASS))[0])a("_zm").openZohoOneSearch();else{var d=$(b.target).closest("."+f.LIST_ITEM_CLASS).data("menuid");this.selectedMenu=d,this.handleSelection()}b.stopImmediatePropagation()},handleMouseDown:function(a){a.stopImmediatePropagation()},isClickedOnScrollBar:function(a){var b=this.$el,c=$(this.$el.find("ul")),d=b.offset().left,e=c.outerWidth()+d,f=b.outerWidth(!0)+d;return a>=e&&a<=f},ignoreMouseDownEvent:function(a){return!1},handleMouseDownEvent:function(a,b){this.ignoreMouseDownEvent(b)||this.isClickedOnScrollBar(b.clientX)||(this.removeOnMouseDown?this.remove():this.hide(),this.onMouseDown())},handleKeyEvent:function(a){var b=a.keyCode;if(b===h.UP_ARROW||b===h.DOWN_ARROW){var c=b===h.DOWN_ARROW?1:-1;this.traverser.traverse(c),this.select(),this.isVisible()&&(a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation())}else b===h.ENTER?(this.selectedMenu=this.getSelectedIndex(),this.handleSelection(),a.preventDefault()):b===h.TAB&&!a.shiftKey&&this.isVisible()?(this.selectedMenu=this.getSelectedIndex(),this.selectedMenu>=0&&(this.handleSelection(),a.preventDefault())):b===h.ESCAPE?(this.removeOnEscape?this.remove():this.hide(),this.onEscape()):this.onKeyEvent(a)},isActiveElement:function(){var a=document.activeElement,b=this.$for&&this.$for[0];return void 0!==a&&a===b},handleInputAndChangeEvent:function(a){if(this.bindEventsForElement&&this.isActiveElement()){var b=$(a.target),c=(b.val()||b.text()||"").trim();this.paginate(c)}},handlePagination:function(a){if(this.doPaginate){var b=this.getListWrapperElement(),c=Math.round(100*(b[0].scrollTop+b.height())/b[0].scrollHeight);this.paginator.hasMoreToFetch&&this.paginateScrollPercentage<=c?this.paginate(this.paginator.query):(a.preventDefault(),a.stopPropagation())}},bindEvents$For:function(){return this.bindEventsForElement&&this.$for&&(this.forElementDebounceTime>0&&(this.handleInputAndChangeEvent=b.debounce(this.handleInputAndChangeEvent,this.forElementDebounceTime)),this.$for.on("change input",this.handleInputAndChangeEvent)),this},unbindEvents$For:function(){return this.bindEventsForElement&&this.$for&&this.$for.off("change input",this.handleInputAndChangeEvent),this},bindEvents:function(){var a=this;return this.__eventFlag||(this.__eventFlag=!0,this.hasElement()&&(this.getListWrapperElement().on("scroll",this.handlePagination),this.$el.on("click","."+f.LIST_ITEM_CLASS,this.handleClickEvent),this.$el.on("mousedown",this.handleMouseDown),$.subscribe(g,this.handleMouseDownEvent)),a.bindMouseEvents(),this.$parent&&this.$parent.on("keydown",this.handleKeyEvent)),this},unbindEvents:function(){return this.__eventFlag&&(this.__eventFlag=!1,this.hasElement()&&(this.getListWrapperElement().off("scroll",this.handlePagination),this.$el.off("click","."+f.LIST_ITEM_CLASS,this.handleClickEvent),this.$el.off("mousedown",this.handleMouseDown),this.$el.find("li").off("mouseenter").off("mouseleave"),$.unsubscribe(g,this.handleMouseDownEvent)),this.$parent&&this.$parent.off("keydown",this.handleKeyEvent)),this},bind:function(){return this.__active||(this.__active=!0,this.bindEvents$For()),this},unbind:function(){return this.__active&&(this.__active=!1,this.hide().unbindEvents$For()),this},text:function(a){return a},dom:function(a){},template:function(a){return this.dom(a,this.paginator)||this.text(a,this.paginator)},onShow:b.noop,onHide:b.noop,onSelect:b.noop,onRemove:b.noop,onEscape:b.noop,onMouseDown:b.noop,change:function(a){return this.paginate(a)}}});