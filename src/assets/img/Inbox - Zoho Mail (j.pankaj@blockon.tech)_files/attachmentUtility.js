!function(a){"use strict";var b=zmText.get("attachmentUtility");return a.templates=a.templates||{},$.extend(a.templates,{leftHeader:function(a,b){return"<b id='"+a+"'>"+b+"</b>"},cloudAttachTemplate:['<div class="SC_Pop SC_cent SC_add wht" id="zmAddToCloudPopup">','<div class="SC_pe">','<div class="SC_PU" style="max-width:1000px;">','<div class="SC_PUcen">','<div class="SCmc SC_attachviewer">','<div class="SC_mhd">','<div class="SC_flt">','<span class="SC_mtb"><b id="zmAddToZDocs" class="sel">'+b.cloudServiceName.zDocs+'</b><b id="addToOtherCloud">'+b.cloudServiceName.otherCloud+"</b></span>","</div>","</div>",'<div class="SCmb">','<div class="SC_frt">',"<ul>","<li>",'<b><span><i class="msi-close"></i></span></b>',"</li>","</ul>","</div>",'<div class="SC_flt"></div>',"</div>",'<div class="SC_mclst" id="zmAddZDocs" style="overflow:hidden"></div>','<div class="SC_mclst" id="zmAddCloud" style="display:none;overflow:hidden"></div>',"</div>","</div>",'<div class="SC_PUbtm">','<span id="zmattViewAttach" class="sel">'+b.dialogText.add+"</span>",'<span id="zmattViewCancel" data-val="Cancel">'+b.dialogText.cancel+"</span>","</div>","</div>","</div>","</div>"].join(""),filterDropDwon:function(){var a=b.filterMenu;return['<div class="SC_srch">',"<table>","<tbody>","<tr>","<td>","<table>","<tbody>",'<tr class="sml">',"<td>"+a.group+"</td>","<td>"+a.attFrom+"</td>","<td>"+a.attType+"</td>","<td>"+a.tags+"</td>","</tr>","<tr>",'<td id="zmAttGrp"><span><input type="text" disabled=""></span></td>','<td id="zmAttEntity"><span><input type="text" disabled=""></span></td>','<td id="zmAttFilTyp"><span><input type="text" disabled=""></span></td>','<td id="zmAttLbl"><span><input type="text" disabled=""></span></td>',"<td></td>","</tr>","</tbody>","</table>","</td>","</tr>","<tr>","<td>",'<div class="SC_PUbtm SC_tranbdr">','<span id="attFilter" class="sel">'+a.filter+"</span>",'<span id="filterCncl" data-val="Cancel">'+a.cancel+"</span>","</div>","</td>","</tr>","</tbody>","</table>","</div>"].join("")},cloudFrame:'<iframe frameborder="0" id="cloudIframe" style="height:100%;width:100%"></iframe>',noAttachInfo:['<div id="noattachs" class="SC_nmsg"></div>'].join(""),thumbnailTypeCont:['<div class="zmAmht zmAv"></div>'].join(""),showAll:['<span class="SC_lnk"></span>'].join(""),divTemplate:["<div></div>"].join(""),thumbViewParentEle:['<div class="SC_tbdr SC_Aview"></div>'].join(""),favIcon:['<i class="msi-fav SC_fav" title="'+b.UserMsg.remFav+'"></i>'].join(""),unfavIcon:['<i class="msi-fav" title="'+b.UserMsg.fav+'"></i>'].join(""),tickIcon:['<i class="msi-tick"></i>'].join(""),uncheckIcon:['<i class="msi-uncheck"></i>'].join(""),zmFdrBox:function(a,c){var d=b.UserMsg;return'<div class="zmFdr"><span><i class="'+a+'" title="'+c+'"></i><i class="msi-send" title="'+d.attachToNewMail+'"></i><i class="msi-download" title="'+d.download+'"></i><i class="msi-action" title="'+d.more+'"></i></span></div>'},zmFltBox:['<div class="zmFlt"></div>'].join(""),SCIcnBox:['<div class="SC_icn"></div>'].join(""),divOuterZmL:function(a){return'<div data-atid="'+a+'" class="zmL zmAch"><div class="zmLst"></div></div>'},divOuterZmDtl:['<div class="zmDtl"></div>'].join(""),divZmDate:['<div class="zmDate"><span></span></div>'].join(""),divZmSze:['<div class="zmSze"><span class="sum"></span></div>'].join(""),divZmFrm:function(a){return a=_zm.escapeTags(a),'<div class="zmFrm"><span id="thumbView" title="'+a+'"></span><span id="listView" title="'+a+'"></span></div>'},divZmSub:['<div class="zmSub"><span class="sum"></span></div>'].join(""),divZmImg:['<div class="zmImg"></div>'].join(""),divZmLbl:['<div class="zm_lbl"></div>'].join(""),divZmFrt:['<div class="zmFrt"></div>'].join(""),labelDisplayBox:function(a,b,c){return b=_zm.escapeTags(b),"<p data-mid="+a+" title="+b+' class="zmAttLbl"><font style=background-color:'+c+"></font></p>"},filterByMsg:["<b><i>"+b.filterMenu.filterBy+"</i></b>"].join(""),attListingTemplate:['<div class="zmL SC_Pbar">','<div class="zmLst">','<div class="zmDtl">','<div class="zmSze">','<span class="sum"></span>',"</div>",'<div class="zmSub">','<span data-name="rename">'+b.UserMsg.rename+"</span>",'<span data-name="download">'+b.UserMsg.download+"</span>",'<i class="msi-action" title="'+b.UserMsg.more+'" data-name="showMore"></i>',"</div>",'<div class="zmFrm">','<span data-name="filename"></span>',"</div>",'<div class="zmImg"></div>','<div class="SC_icn">','<i class="msi-close"></i>',"</div>","</div>","</div>","</div>"].join(""),downloadText:['<span class="SC_ldot sum">'+b.UserMsg.download+"</span>"].join(""),prevTopDom:function(a){return['<div id="zmPhdAtt" class="SC_ptit">','<div class="SCmb SC_frt">',"<ul>","<li>",'<b class="SC_nrr">','<i class="msi-prev"></i>',"</b>","</li>","<li>",'<b class="SC_nlr">','<div class="SC_hd"></div>','<i class="msi-next"></i>',"</b>","</li>","</ul>","<ul>","<li>","<b>",'<i class="msi-close"></i>',"</b>","</li>","</ul>","</div>",'<div class="SC_phd">'+a+"</div>","</div>"].join("")},prevMainDom:function(a,b){return['<div class="SC_Twpr">','<div class="SC_pct zmAvi">','<div id="zmHdrAtt" class="zmPHdr">','<div class="zmPT">','<div class="zmpr">','<div class="SCmb SC_frt">',"<ul>","<li>","<b>",'<i class="msi-action"></i>','<div class="SC_hd"></div>',"</b>","</li>","</ul>","</div>",'<ul class="SC_pvul">',"<li>"+a,"<div>",'<span class="sum" >'+b+"</span>","</div>","</li>","</ul>","</div>",'<div class="zmpr zmpsrt">',"<span></span>",'<div class="zm_lbl"></div>',"</div>","</div>",'<div class="zmmre"></div>',"</div>","<div>",'<div id="zmPCAtt" class="zmPCon">','<div class="zmPCnt">',"<div>",'<div id="msprevAttSrc"  class="zmAsrc"></div>',"</div>","</div>","</div>","</div>",'<div class="zmAtg"></div>',"</div>","</div>"].join("")},loadingTemplate:function(){var a=[["DIV",{attrs:{"class":"At_load"},child:[["DIV",{attrs:{"class":"AT_lcntr Atlcr1"},child:[["DIV",{attrs:{"class":"Atcle1"}}],["DIV",{attrs:{"class":"Atcle2"}}],["DIV",{attrs:{"class":"Atcle3"}}],["DIV",{attrs:{"class":"Atcle4"}}]]}],["DIV",{attrs:{"class":"AT_lcntr Atlcr2"},child:[["DIV",{attrs:{"class":"Atcle1"}}],["DIV",{attrs:{"class":"Atcle2"}}],["DIV",{attrs:{"class":"Atcle3"}}],["DIV",{attrs:{"class":"Atcle4"}}]]}],["DIV",{attrs:{"class":"AT_lcntr Atlcr3"},child:[["DIV",{attrs:{"class":"Atcle1"}}],["DIV",{attrs:{"class":"Atcle2"}}],["DIV",{attrs:{"class":"Atcle3"}}],["DIV",{attrs:{"class":"Atcle4"}}]]}]]}]];return $(_zm.getDOM(a))},imgTemp:['<img style="display:none">'].join(""),tempLabelBox:['<div class="znNewTag SC_cs zn_cgy" onmousedown="zmUtil.stopEvents(event,true);"contentEditable="true" style="min-width:120px"></div>'].join(""),iconTemplate:function(a){return'<i class="'+a+'"></i>'},imageTemplate:function(a){return'<img src="'+a+'" >'},centerAlignBox:['<div class = "SC_Ialn">'].join(""),printTempDiv:['<div id="zmTempDiv"></div>'].join(""),printTempIframe:["<iframe>"].join(""),attachmentFrame:function(a,b,c){return'<iframe id="zmIframe" style="background:white; visibility:hidden;"frameborder="0" width='+a+" height="+b+' scrolling="auto" src="'+c+'"></iframe>'},labelEnclosure:['<div id="znAtt_lbl"><div id="attPrevTag"><i title="Tags" class="msi-label"></i></div></div>'].join(""),addTagIcon:['<i title="Add Tags" class="msi-plus"></i>'].join(""),labelNameBox:['<div class="SC_cs"></div>'].join(""),closeIcon:['<i class="msi-close">'].join(""),downloadLinkMsg:['<font style="z-index:999; position:relative" class="SC_lnk">'+b.common.downloadMsg+"</font>"].join(""),attachemntFileTypeIcon:function(a){return'<i class="'+a+' SC_vbig"></i>'},attPreviewMsg:function(a){return'<div class="txt">'+a+"</div>"},attSelectedMsgContainer:['<ul class="SC_ldot SC_itmSel"><li><strong></strong></li></ul>'].join(""),attDownloadContainer:['<ul class="SC_ldot SC_itmSel" style="display: block;"><li class="SC_thm SC_attDwnZip cursorPointer">'+b.common.downloadAll+"</li></ul>"].join(""),attAddToContainer:['<ul class="SC_ldot SC_itmSel" style="display: block;"><li class="SC_attAttachTo SC_thm cursorPointer">'+b.common.addTo+'<i class="msi-rarrow" style="vertical-align: middle;"></i></li></ul>'].join("")},!0),a}(window.zmAttachment=window.zmAttachment||{}),function(){"use strict";function a(a){this.appName=a.appName,this.$topEl=a.headerElem,this.$el=a.listElem,this.widthConst=a.thumbWidth,this.onFilterAction=a.onFilterAction,this.dType=a.dType||"t",this.viewType=a.viewType,this.groupId=a.groupId||zmail.zuid,this.entity=a.entity||"all",this.onScroll=a.onScroll,this.requireParams=a.requireParams,this.start=1,this.fileType=0,this.showNxt=void 0,this.showNxt101=0,this.showNxt102=0,this.showNxt103=0,this.showNxt104=0,this.showNxt105=0,this.isnew="y",this.attDet={},this.attArrObj={},this.selectedAttachment=[];for(var b=0,c=h.length;b<c;b++)this.attArrObj[h[b]]={showNxt:0,list:[]};this.prvFltr={lblId:" ",mthd:" "},this.fileTypeShowAll={101:{isHidden:!1,stoppedIndex:0,insertSingleAttachment:!1},102:{isHidden:!1,stoppedIndex:0,insertSingleAttachment:!1},103:{isHidden:!1,stoppedIndex:0,insertSingleAttachment:!1},104:{isHidden:!1,stoppedIndex:0,insertSingleAttachment:!1},105:{isHidden:!1,stoppedIndex:0,insertSingleAttachment:!1}},this.isDone=!0,this.initView=!1,this.thumbCount=0,this.presentView="t"+zmail.zuid+"all0 ",a.cache&&(this.cachingEnabled=a.cache,this.cache={flush:r.flush,flushExcept:r.flushExcept}),"function"==typeof a.onListingUpdate&&(this.onListingUpdate=a.onListingUpdate)}var b=zmail.Core.Namespaces.create("zmAttachUtility"),c=zmText.get("attachmentUtility"),d="zmlightboxplugin",e=c.openEntity,f=[e.email,e.note,e.task,e.event,"",e.status,"","","",e.link],g=["msi-mail","msi-notes","msi-task","msi-calendar","","msi-status","","","","msi-links"],h=["0","101","102","103","104","105"],i={all:0,m:1,n:2,t:3,c:4,p:6,l:10},j=[{htm:c.fType[101],data:{type:"attList",action:101}},{htm:c.fType[102],data:{type:"attList",action:102}},{htm:c.fType[103],data:{type:"attList",action:103}},{htm:c.fType[104],data:{type:"attList",action:104}},{htm:c.fType[105],data:{type:"attList",action:105}},{htm:c.fType[0],data:{type:"attList",action:""}}],k=[{htm:c.entityType.m,data:{type:"entList",action:"m"}},{htm:c.entityType.p,data:{type:"entList",action:"p"}},{htm:c.entityType.n,data:{type:"entList",action:"n"}},{htm:c.entityType.t,data:{type:"entList",action:"t"}},{htm:c.entityType.c,data:{type:"entList",action:"c"}},{htm:c.entityType.l,data:{type:"entList",action:"l"}},{htm:c.entityType[0],data:{type:"entList",action:"all"}}],l=[],m=[{htm:c.prevMenu.lstAttSender,data:{type:"attList",action:1}},{htm:c.prevMenu.lstAttType,data:{type:"attList",action:2}}],n={txt:!0,js:!0,java:!0,css:!0,jsp:!0,jspf:!0,c:!0,cpp:!0,html:!0,htm:!0,xml:!0,go:!0,eml:!0,sh:!0,bat:!0,log:!0,msg:!0},o={xml:!0,js:!0,css:!0},p={},q={};q.getPopupTemplate=function(){return zmAttachment.templates.cloudAttachTemplate},q.getFilterDropTemplate=function(){return zmAttachment.templates.filterDropDwon},p.isRestrictedIE=function(){return zmUtil.isIE()&&"Microsoft Internet Explorer"===window.navigator.appName},p.isDocsCompAllowed=function(){return!p.isRestrictedIE()},p.showSuccErrMsg=function(a,b){"error"===a?_zm.succErrMsg("e",b[a]):_zm.succErrMsg("s",b[a])},p.addEventsToCal=function(a){var b={groupId:a.gId,entityId:a.e,attachId:a.Id,entityType:a.et},d=c.SuccErrMsg;1===a.et&&(b.partId=a.p),a.shId&&(b.shId=a.shId),a.type?(2===a.et?b.streamsView="Notes":b.streamsView="true",b.actionType=a.type):b.accId=zmail.accId,zmAjq.XHR({u:zmail.conPath+"/OpenDocument",t:"POST",fn:function(a){p.showSuccErrMsg(a.msg,{added:d.Event_Added,exist:d.Event_Updated,error:d.Event_Error})},p:b,ep:{}})},p.parseToNumber=function(a){return window.Number(a)},p.parseToInteger=function(a,b){return b=b||10,window.parseInt(a,b)},p.uploadToCloud=function(){function a(a,b){var c,d,e=a.$el.find("#zmAddCloud"),f=zmComponent.loadingBand({container:e[0],type:"pagination"}),g=encodeURIComponent(b.fn),h=b.e+"_"+b.Id,i=location.protocol+"//"+window.location.hostname+zmail.conPath+"/jsp/cloudUploader.jsp?m="+h;i=encodeURIComponent(i),c=zmail.urls.gadURL+"/CloudUploader?sources=gdrive,dropbox,skydrive,box&fileName="+g+"&purpose=mailView&zservice=zmail",c+="&disableSync=gdrive,dropbox,skydrive,box&serURL="+i,d=$(zmAttachment.templates.cloudFrame),k=b,d.attr("src",c),d.on("load",function(){f()}),e.append(d)}function b(a,b){var d=c.SuccErrMsg;a.result="dropbox"===b.source?"success":a.result,p.showSuccErrMsg(a.result,{success:d.Docs_Uploaded,error:d.Docs_Error})}function d(a,b){var c,d,e=a.$el.find("#zmAddZDocs");"undefined"!=typeof G_ADDDOCS_OBJ&&(G_ADDDOCS_OBJ.folderid=-1,G_ADDDOCS_OBJ.workspaceid=-1),c=zmComponent.loadingBand({container:e[0],type:"pagination"}),d={servicename:"zmail",filename:b.fn,docsURL:"//"+zmail.urls.docsURL,containerDiv:"zmAddZDocs",isNewUI:!0,handbckobj:{attObj:b},callback:c},ADDDOCDIALOG.showAddDocDialog(d)}function e(a){var b=a.handbckobj&&a.handbckobj.attObj||{},d=b.sid||b.gId||zmail.zuid,e={method:"addtoZohoDocs",groupId:d,entityId:b.e,attachId:b.Id,entityType:b.et},f=c.SuccErrMsg;1===b.et&&(e.partId=b.p),b.shId&&(e.shId=b.shId),b.type?(2===b.et?e.streamsView="Notes":e.streamsView="true",e.actionType=b.type):e.accId=zmail.accId,a.issharedws&&(e.issharedws=a.issharedws),a.workspaceid&&p.parseToNumber(a.workspaceid)!==-1&&(e.wsId=a.workspaceid),e.fileName=a.fname,e.foldId=a.folderid,zmAjq.XHR({u:zmail.conPath+"/postAttach.do",t:"POST",fn:function(a){p.showSuccErrMsg(a[0].response,{success:f.Docs_Uploaded,error:f.Docs_Error})},p:e,ep:{}})}function f(a,b){var f=zmail.isRebranded?c.cloudServiceName.docs:c.cloudServiceName.zDocs;return{id:"zDocs",text:f,tabName:"zDocs",selected:a,onClk:function(a){d(a,b)},listingArea:{id:"zmAddZDocs",classes:"SC_mclst",styles:{overflow:"hidden"},parEle:$('<div class="SCmc SC_attachviewer"></div>')},buttons:[{text:c.dialogText.add,onClk:function(){p.uploadToCloud.addToCloudClose(),e(ADDDOCDIALOG.addToZDocsNewUI())}}]}}function g(b,d){var e=p.isDocsCompAllowed()?c.cloudServiceName.otherCloud:c.cloudServiceName.cloud;return{id:"oCloud",text:e,tabName:"oCloud",selected:b,onClk:function(b){a(b,d)},listingArea:{id:"zmAddCloud",classes:"SC_mclst",styles:{overflow:"hidden"},parEle:$('<div class="SCmc SC_attachviewer"></div>')},hideButtons:!0}}function h(a,b,c){return"zDocs"===a?f.call(this,b,c):"oCloud"===a?g.call(this,b,c):void 0}function i(a){var b={},c=[],d=!1;if(b.id="zmAddToCloudPopup",b.tabs=[],zmUtil.isAddToCloudAllowed()){p.isDocsCompAllowed()&&c.push("zDocs"),zmail.isBaihui||"false"===zmail.isCloudServiceEnabled||c.push("oCloud");for(var e=0,f=c.length;e<f;e++)d=0===e,b.tabs.push(h.call(this,c[e],d,a));b.onClose=function(){l=!1},b.dialogDidMount=function(a){var b=a.$el.find("."+a.contentClass);a.$el.find("."+a.contentClass).css({overflow:"hidden",width:""}),a.$el.find(".SCmc.SC_attachviewer").css({"max-height":b.css("max-height"),"max-width":b.css("max-width")})},b.classes="SC_add",j=zmsDialog.createTabPopupDialog(b)}else l=!1}var j,k,l=!1;return{initAddToCloud:function(a){l||(l=!0,i(a))},addToCloudClose:function(){j.close(),l=!1},cloudUpload:function(a,c,d,e){p.uploadToCloud.addToCloudClose();var f,g=k,h=g.sid||g.gId||zmail.zuid,i={groupId:h,entityId:g.e,entityType:g.et,attachId:g.Id};1===g.et&&(i.partId=g.p),g.shId&&(i.shId=g.shId),g.type?(2===g.et?i.streamsView="Notes":i.streamsView="true",i.actionType=g.type):i.accId=zmail.accId,i.folderPath=a,i.source=d,i.fileName=c,e&&(i.dbAccID=e),f={source:d},zmAjq.XHR({u:zmail.conPath+"/UploadToCloud",t:"POST",fn:b,p:i,ep:f})}}}(),p.openResult=function(a,b){zmUtil.prevCache(b.id,{mdata:a}),zmList.getMailData({msgId:b.id,type:"lt",opentype:2,src:"external"})},p.openMail=function(a){if(void 0!==a.sid&&a.sid!==p.parseToNumber(zmail.zuid)||a.gId!==zmail.zuid){var b=a.sid||a.gId,c=a.sid?"viewSelfData":"viewGroupEntity";zmUtil.loadStreamsInTab({pid:a.e,gid:b,etype:String(a.et),actionType:c})}else{var d={entityId:a.e,entityType:a.et,method:"openEntity"},e={id:a.e,F:a.dn};d.groupId=a.gId,zmAjq.XHR({u:zmail.conPath+"/postAttach.do",t:"POST",fn:p.openResult,p:d,ep:e})}},p.sendMail=function(a){zmUtil.openComposeWithAtt([a])},p.openPost=function(a){var b=a.sid?a.sid:a.gId,c=a.gId!==zmail.zuid||a.sid?"viewGroupEntity":"viewSelfData",d={pid:a.e,gid:b,etype:a.et,actionType:c,fixedComment:!0};a.cId&&(d.commentId=a.cId),zmUtil.loadStreamsInTab(d)},p.printImageAtt=function(a){var b,c,e,f,g;if(!$("#"+d).length){var h=window.open(zmUtil.getTheSrc("FileDownload",a),"_blank");return h.opener=null,void(h.onload=function(){h.focus(),h.print()})}if(b=p.loadingIndicatorTemplate(),c=zmAttachment.templates,e=$(c.printTempDiv),g=$(c.printTempIframe),101===a.ft)f=$("#"+d).find(".ZAt_opt"),f.find("#attMsi-print").addClass("SC_vh"),e.css({left:"96.4%",top:"1px"}).append(b),f.append(e);else if(101!==a.ft){var i=$("#"+d).find("iframe")[0];return void i.contentWindow.print()}zmail.prevAttachment={},a.src=zmUtil.getTheSrc("FileDownload",a),(window.ActiveXObject||"ActiveXObject"in window)&&(a.src+="&t="+Date.now()),zmail.prevAttachment.attObj=a,g.attr("src",zmail.conPath+"/print.do?isImg="+!0),$("body").append(g),g.on("load",function(){window.setTimeout(function(){g.remove()},2e3)})},p.showLabelPopup=function(a,b,c,d){var e,f=b.l,g={};return f&&"$6"===f[0]&&f.splice(0,1),g.parentDOM=a,g.displayAs="popup",g.accType="default",g.labelState={labelList:f},g.onCreate=function(a,b){zmlab.isValidName(a,"","default")&&zmlab.labelCreate(a,"default",{reqDoneClbk:function(a,b){a&&(g.onStateChange(b,!0,function(){}),e.hide())},color:b})},g.onHide=function(){"function"==typeof d&&d(a,b)},c&&(g.direction=c),g.onStateChange=function(c,d){p.lblPopupAction(d?"addLabel":"deleteLabel",b,a,c)},g.divId="zmlightbox_dropDown",e=zmUtil.createFLComp("label",g),e.show(),{remove:function(){e.hide(),$("#zmlightbox_dropDown").remove()}}},p.lblPopupAction=function(a,b,c,d){"addLabel"===a?p.addLabelApi(c,b,d):p.removeLabelApi({el:c,id:b,lblId:d},p.removeLabelApiResult)},p.addLabelApi=function(a,b,c){var d,e=$(a).data().uid||c;if(e){var f=p.addLabelApiResult,g={method:"applyLabel",groupId:b.gId,entityId:b.e,attachId:b.Id,entityType:b.et,labelId:e,m:"a",fileType:b.ft,uuid:b.u};1===b.et&&(g.partId=b.p,g.accountId=zmail.accId),b.sid&&(g.sid=b.sid),d={attObj:b,labId:e},zmAjq.XHR({u:zmail.conPath+"/postAttach.do",t:"POST",fn:f,p:g,ep:d})}else p.removeLabelEnclosure()},p.addLabelApiResult=function(a,b){var c,e=zmUtil.getTagList("default")[b.labId],f=b.attObj,g=f.e,h=f.Id+g,i=b.labId;if($.publish("attachment/addLabel",b),e&&e.id){if($("#"+d).length){var j=$("#"+d).find(".ZAt_opt"),k=j.find("#sshwLeftIcons > div"),l=p.constLabelDiv(e,f);l.css("color","white"),l.css("background-color","black"),k.append(l)}c=$("div[data-atid='"+h+"']"),c.find(".zm_lbl").append(zmAttachment.templates.labelDisplayBox(i,e.dispName,e.color)),c.addClass("SC_hlbl"),p.removeLabelEnclosure()}},p.constLabelDiv=function(a,b){var c=zmAttachment.templates,d=$(c.labelNameBox),e=$(c.closeIcon);return d.text(a.dispName).attr("id",a.id),b&&e.click(function(a){zmUtil.stopEvents(a,!0),p.removeLabelApi({el:this,id:b},p.removeLabelApiResult)}),d.append(e),d},p.labelEnclosure=function(){return $(zmAttachment.templates.labelEnclosure)},p.removeLabelEnclosure=function(){if($("#"+d).length)p.removeLabelEnclosureSShow();else if(window.zmsuite){var a=zmsuite.getCenter()[1].$el,b=a.find("#znAtt_lbl").find("#attPrevTag");b.find(".znNewTag").remove(),p.isLabelAssignedForAttach()||b.parent().remove()}},p.removeLabelEnclosureSShow=function(){var a=$("#"+d).find("#sshwLeftIcons > div");a.find(".znNewTag").remove()},p.isLabelAssignedForAttach=function(){if(window.zmsuite){var a=zmsuite.getCenter()[1].$el,b=a.find("#znAtt_lbl").find("#attPrevTag");return b.find("div.SC_cs").length>0}},p.removeLabelApi=function(a,b){var c,d=a.el.parentNode,e=d&&d.id?d.id:a.lblId;if(e){var f=a.id,g={method:"applyLabel",groupId:f.gId,entityId:f.e,attachId:f.Id,entityType:f.et,labelId:e,m:"d",uuid:f.u,fileType:f.ft};1===f.et&&(g.partId=f.p,g.accountId=zmail.accId),f.sid&&(g.sid=f.sid),c={attObj:f,ele:d,labId:e},zmAjq.XHR({u:zmail.conPath+"/postAttach.do",t:"POST",fn:b,p:g,ep:c})}},p.removeLabelApiResult=function(a,b){var c=b.attObj,e=c.Id+c.e,f=b.labId;$.publish("attachment/removeLabel",b);var g=$("div[data-atid='"+e+"']"),h=g.find(".zm_lbl");h.find("p[data-mid='"+f+"']").remove(),h.find("p").length||g.removeClass("SC_hlbl"),$("#"+d).length&&$("#"+d).find("#"+f).remove(),p.removeLabelEnclosure()},p.labelAutoFill=function(a,b){var c,d,e=zmUtil.getTagList("default"),f=[],g=p.getLabelArr(b.l);for(var h in e)g.indexOf(h)===-1&&f.push({id:h,name:e[h].dispName});c=function(){$("#zm_afill").remove(),p.addLabelApi(a,b)},$(a).attr("contentEditable",!0).focus(),d={contentArray:f,compare:["name"],LType:"2",OType:"2",callback:c,text:!0},zmAutoFill.setAutofill(d,a),$(a).on("keydown",function(a){27===a.keyCode&&(p.removeLabelEnclosure(),$("#zm_afill").remove())})},p.newLabelDiv=function(){return $(zmAttachment.templates.tempLabelBox)},p.addLabel=function(a){var b=$("#"+d).find(".msi-label");p.showLabelPopup(b,a,"",function(){b.removeClass("SC_thm")}),$("#zmlightbox_dropDown").css("zIndex",999)},p.searchAttachment=function(a,b,c){var d="";"sender"===a?d=b.dn:"filetype"===a&&(d=zmUtil.fileTyp(b.fn)[2]),zmUtil.listAttachmentInAttSearchView({type:a,srchStr:d})},p.menuItemClick=function(a){var b,c,d=!1;if(void 0!==a&&a.constructor===Object){switch(b=a.attObj,c=a.action,d=!1,c){case"download":zmUtil.downloadAttachment(b);break;case"lstSender":p.searchAttachment("sender",b,3);break;case"lstType":p.searchAttachment("filetype",b,4);break;case"sMail":p.sendMail(b);break;case"attachToPost":zmUtil.loadNewPostDialog("",[b]);break;case"attachToNote":zmUtil.loadNotes("popup",{attEntObj:[b]});break;case"Open linked email":p.openMail(b);break;case"Open linked note":zmUtil.isNoteReactUser()?zmUtil.loadNotes("openNote",b):p.openPost(b);break;case"Open linked status":p.openPost(b);break;case"Open linked task":p.openPost(b);break;case"Open linked event":p.openPost(b);break;case"Open linked link":p.openPost(b);break;case"remFav":p.attFav(b,!1);break;case"fav":p.attFav(b,!0);break;case"hideAtt":p.hideAtt(b,p.hideResult);break;case"unhideAtt":p.restoreToAttachmentView(b);break;case"addLab":p.addLabel(b);break;case"addToDocs":zmUtil.cloudUploader(b);break;case"addEvent":zmUtil.addEventsToCal(b);break;case"dwn":zmUtil.downloadAttachment(b);break;case"addTag":d=!0;break;case"printImg":p.printImageAtt(b)}if(zmUtil.hideMenu(),d){var e=a.ele,f=e.parents(".zmL.zmAch");f.addClass("sel"),p.showLabelPopup(e,b,"",function(){f.removeClass("sel")})}}},p.attFav=function(a,b){if(a){var c={attObj:a,flag:b},d=p.favResult;p.favAttach(c,d)}},p.favAttach=function(a,b){var c=a.attObj,d={method:"markFavourite",groupId:c.gId,entityId:c.e,attachId:c.Id,entityType:c.et,flag:a.flag,fileType:c.ft,uuid:c.u},e={flag:a.flag,attObj:c};1===c.et&&(d.accountId=zmail.accId),c.sid&&(d.sid=c.sid),zmAjq.XHR({u:zmail.conPath+"/postAttach.do",t:"POST",fn:b,p:d,ep:e})},p.favResult=function(a,b){if(a&&"success"===a[0].response){var d,e,f=b.attObj,g=b.flag,h=f.Id+f.e,i=$("div[data-atid='"+h+"'].zmAch"),j=$(".ZAt_opt").find(".msi-fav"),k=i.length,l=c.prevMenu;if(g){for(d=0;d<k;d++)e=$(i[d]),e.find("i.msi-fav").addClass("SC_fav"),e.find("i.msi-fav").attr("title",l.remFav);j.addClass("SC_fav"),j.attr("title",l.remFav)}else{for(d=0;d<k;d++)e=$(i[d]),e.find("i.msi-fav").removeClass("SC_fav"),e.find("i.msi-fav").attr("title",l.fav);j.removeClass("SC_fav"),j.attr("title",l.fav)}$.publish("attachment/modifyFavLbl",[h,g])}},p.hideAtt=function(a,b){Dialog["new"]({title:c.common.confirmHideAtt,buttons:[{name:zmText.get("dialog","ok"),callback:function(c){var d={method:"deleteFromAttachmentView",entityId:a.e,attachId:a.Id,filename:a.fn,entityType:a.et,uuid:a.u,fileType:a.ft};c.remove(),1===a.et&&(d.partId=a.p),a.sid?(d.groupId=a.sid,d.streamsView=!0):d.groupId=zmail.zuid,zmAjq.XHR({u:zmail.conPath+"/postAttach.do",t:"POST",fn:b,p:d,ep:{attObj:a}})}},{name:zmText.get("dialog","cancel"),isCancel:!0,callback:function(a){a.remove()}}],defaultCloseIcon:!1})},p.hideResult=function(a,b){if(a&&a[0]&&"success"===a[0].response){for(var c=b.attObj.Id+b.attObj.e,d=zmsuite.getCenter()[0].$el,e=$("div[data-atid='"+c+"'].zmAch"),f=$("dl[data-atid='"+c+"'].zmAch"),g=e.length,h=d.find("div[data-atid='"+c+"'].zmAch").parent(),i=0;i<g;i++)$(e[i]).remove();f.remove(),p.listview.previewCard.closePrevCard.call(this),$.publish("attachment/hideAttachment",[d,c,h])}},p.restoreToAttachmentView=function(a){var b={method:"restoreToAttachmentView",entityId:a.e,attachId:a.Id,entityType:a.et};a.sid&&(b.streamsView=!0),b.groupId=a.sid||zmail.zuid,zmAjq.XHR({u:zmail.conPath+"/postAttach.do",t:"POST",fn:function(a,b){Array.isArray(a)&&a[0]&&"success"===a[0].response?b&&b.attObj&&b.attObj.l&&(b.attObj.l.splice(b.attObj.l.indexOf("$HIDDEN"),1),zmUtil.succErrMsg("s",c.SuccErrMsg.unhideSuccess)):zmUtil.succErrMsg("e",c.SuccErrMsg.unhideFailure)},p:b,ep:{attObj:a}})},p.getGroups=function(){var a,b=zmCont.getGroupOrder(),d=zmCont.getGroup(),e=[],f=c.menuText.me;if(e.push({id:zmail.zuid,name:f,display_text:f,tooltip:f}),b)for(var g=0,h=b.length;g<h;g++)a=_zm.escapeTags(d[b[g]].name),e.push({id:b[g],name:a,display_text:a,tooltip:a});return e},p.getLabels=function(){var a,b=zmUtil.getTagList("default"),d=[],e=c.menuText.favourites,f=c.menuText.none;d.push({id:"f",name:e,display_text:e,tooltip:e});for(var g in b)a=_zm.escapeTags(b[g].dispName),d.push({id:g,name:a,display_text:a,tooltip:a});return d.push({id:"all",name:f,display_text:f,tooltip:f}),d},p.noAttach=function(a,b){var c;a.removeClass("SC_tmbvw"),c=$(zmAttachment.templates.noAttachInfo),c.text(b),a.html(c[0])},p.previewNotAvlbl=function(a,b,d,e,f){var g=zmAttachment.templates,h=(f?f:c.common.previewNotAvlbl)+" - "+g.downloadLinkMsg,i=$(g.attachemntFileTypeIcon(a)+g.attPreviewMsg(h)).data({aIndex:b});d.find(".At_load").remove(),i.find("font").on("click",function(){zmUtil.downloadAttachment(e)}),d.prepend(i)},p.attDropDown=function(a,b,c){var d,e,f=$(b),g={};switch(a&&(a=a.replace(/[0-9]/g,"")),d={id:a,par:f,align:"pright",parWidth:!0},d.divId="zm_dropDown",a){case"tfil":f.find("b").addClass("SC_ddn"),d.list=j,d.divId="zmAtt_dropDown",d.align="pleft",d.clk=function(a){c?c(a,f):p.dropDownClick(a,f)};break;case"ent":d.list=k,d.divId="zmAtt_dropDown",d.align="pleft",d.clk=function(a){c?c(a,f):p.dropDownClick(a,f)};break;case"grp":g={},g.parentDOM=b,g.displayAs="dropdown",g.dataCallback=function(){return zmAttachUtility.getGroups()},g.onSelect=function(a){e.hide(),c?c(a,f):p.showGroupAtt(a,f)},e=zmUtil.createFLComp("",g),e.show();break;case"lbl":g={},g.parentDOM=b,g.displayAs="dropdown",g.accType="default",g.dataCallback=function(){return zmAttachUtility.getLabels()},g.onSelect=function(a){e.hide(),c?c(a,f):p.showLabelAtt(a,f)},e=zmUtil.createFLComp("",g),e.show();break;case"zm_AttView":f.find("b").addClass("SC_ddn"),d.list=l,d.clk=function(a){p.menuItemClick(a)}}zmDrop.consDropDown(d)},p.dropDownClick=function(a,b){var c=a.type;switch(c){case"attList":p.showByType(a.action,b);break;case"entList":p.showEntLst(a.action,b);break;case"attGroup":p.showGroupAtt(a.action,b);break;case"lblList":p.showLabelAtt(a.action,b)}p.hideMenu()},p.hideMenu=function(){$("#zmAtt_dropDown").remove()},p.showEntLst=function(a,b){b.val(p.entDrpTxtChange(a)),b.data({dataIndex:a})},p.showByType=function(a,b){""===a&&(a=0),b.val(c.fType[a]),b.data({dataIndex:a})},p.showGroupAtt=function(a,b){b.val(a===zmail.zuid?c.menuText.me:_zm.escapeTags(zmCont.getGroup()[a].name)),b.data({dataIndex:a})},p.showLabelAtt=function(a,b){"f"===a?b.val(c.menuText.favourites):"all"===a?b.val(c.menuText.none):b.val(_zm.escapeTags(zmUtil.getTagList("default")[a].dispName)),b.data({dataIndex:a})},p.entDrpTxtChange=function(a){var b=c.entityType,d=a?b[a]||b[0]:b[0];return d},p.emailSplit=function(a){if("string"!=typeof a)return[];var b=[],c=a.indexOf("<"),d=a.indexOf(">"),e="",f=a;return c!==-1&&d!==-1&&(e=a.substring(0,c),f=a.substring(c+1,d)),b.push(e),b.push(f),b},p.getLabelArr=function(a){var b=a.slice(0);return b&&"$6"===b[0]&&b.splice(0,1),b},p.getAttachObject=function(a,b,c){var d=c.attArrObj[b].list,e=d.slice(0);return e.splice(0,a),p.createAttObjectArr(e,c)},p.createAttObjectArr=function(a,b){for(var c,d=[],e=a.length,f=0;f<e;f++)c=b.attDet[a[f]],d.push(c);return d},p.thumbNailContainer=function(a,b,d){var e=zmAttachment.templates,f=$(e.thumbnailTypeCont),g=$(e.showAll);return f.attr("id",b+a),g.text(" - "+c.menuText.showAll),f.append($(e.divTemplate).text(c.fType[a]).append(g)),0!==d&&f.find(".SC_lnk").hide(),f},p.chkAttResp=function(a){var b=!1;if(a)for(var c=h.length,d=0;d<c;d++)if(a[h[d]]){b=!0;break}return b},p.consList=function(a,b,c,d){var e,h,i,j,k,l,m,n,o,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E=a.Id+a.e,F=a.fn,G=zmAttachment.templates;if(a.tnsize="37",e=zmPreviewTemplate.attPrevInr(a),h=a.fs>0?zmUtil.sizeConv(a.fs):"&nbsp;",i=parseInt(a.et)-1,j=i?g[i]:g[0],k=i?f[i]:f[0],l=a.l,s=p.emailSplit(a.dn),m=l&&"$6"===l[0]?G.favIcon:G.unfavIcon,u=$(G.zmFdrBox(j,k)),o=$(G.zmFltBox),q=$(G.SCIcnBox),"attComp"===c?(m=G.tickIcon,q.append(m)):"attView"===c||"attSrcView"===c||"attListing"===c?(o.append(G.uncheckIcon),o.append(m)):o.append(m),n=$(G.divOuterZmL(E)),r=$(G.divOuterZmDtl),t=$(G.divZmDate),t.find("span").text(a.rt),v=$(G.divZmSze),v.find("span").text(h),w=$(G.divZmFrm(a.fn)),F=zmUtil.getSubString(17,F),x=w.find("#thumbView"),x.text(F),y=w.find("#listView"),y.text(zmUtil.getSubString(40,a.fn)),z=$(G.divZmSub),z.find("span").text(s[1]),A=$(G.divZmImg).append(e),"t"===b?y.hide():(x.hide(),n.addClass("SC_mlst")),B=$(G.divZmLbl),C=p.getLabelArr(a.l),C.length&&"attComp"!==c){n.addClass("SC_hlbl");for(var H=C.length,I=0;I<H;I++){var J=C[I],K=zmUtil.getTagList("default")[J];K&&B.append(G.labelDisplayBox(J,K.dispName,K.color))}}return r.append(t,A,v,u,w,z,q,B),D=$(G.divZmFrt),n.find(".zmLst").append(o,r,D),zmail.isBlurThumb&&a.thn&&p.replaceBlurImage(n,a),n},p.replaceBlurImage=function(a,b){var c=a.find(".zmImg"),d=$("<img style='display:none;'>"),e=c.find("img").css("min-width","100%");d.attr("src",zmUtil.getTheSrc("FileDownload",b,"thb")),d.on("load",function(){d.show(),e.remove()}),d.on("error",function(){d.remove()}),c.append(d)},p.onSelectAttachment=function(a,b,c){b.addClass("SC_check"),this.selectedAttachment.push(c),$.publish("attachmentView/attachmentSelected",this.appName)},p.onUnselectAttachment=function(a,b,c){var d;b.removeClass("SC_check"),d=this.selectedAttachment.indexOf(_.findWhere(this.selectedAttachment,{uniqueId:c})),d>=0&&(this.selectedAttachment.splice(d,1),$.publish("attachmentView/attachmentUnselected",this.appName))},p.createShareDropDownMenu=function(a){var b=$(a.ele),d=c.prevMenu,e={},f=[];b=b.hasClass("msi-rarrow")?b:b.find(".msi-rarrow"),f.push({htm:d.attachToPost,data:{action:"attachToPost"}}),f.push({htm:d.sMail,data:{action:"attachToMail"}}),f.push({htm:d.attachToNote,data:{action:"attachToNote"}}),e={par:b,list:f,clk:function(b,c){"function"==typeof a.clk&&a.clk(b,c),zmUtil.hideMenu()},showArrow:!0,direction:"left"},a.divId&&(e.divId=a.divId),zmsuite.showMenu(e)},p.bindAttachListEvents=function(a,b){var d,e,f,g,h,i=$(a.target||a.srcElement);if(d=i.attr("class")||i.parent().attr("class")||"",e=zmList.getParent(i[0],"SC_mclst"),f=$(b).attr("data-atId"),g=this.attDet[f],d.indexOf("msi-mail")!==-1)p.openMail(g);else if(d.indexOf("msi-fav")!==-1)h=!i.hasClass("SC_fav"),p.attFav(g,h);else if(d.indexOf("msi-download")!==-1)zmUtil.downloadAttachment(g);else if(d.indexOf("msi-send")!==-1)p.sendMail(g);else if(d.indexOf("msi-addcloud")!==-1)zmUtil.cloudUploader(g);else if(d.indexOf("msi-notes")!==-1)p.openPost(g);else if(d.indexOf("msi-status")!==-1||d.indexOf("msi-task")!==-1)p.openPost(g);else if(d.indexOf("msi-links")!==-1||d.indexOf("msi-calendar")!==-1)p.openPost(g);else if(d.indexOf("msi-hideattach")!==-1)p.hideAtt(g,p.hideResult);else if(d.indexOf("msi-uncheck")!==-1)i.closest(".zmL.zmAch").hasClass("SC_check")?p.onUnselectAttachment.call(this,i,$(b),f):p.onSelectAttachment.call(this,i,$(b),g);else if(d.indexOf("zmAttLbl")!==-1)p.showLabelPopup(i.parent(),g);else if(d.indexOf("msi-action")!==-1){
zmUtil.hideMenu();var j,k=c.prevMenu,l=[],m=95;l.push({htm:k.attachToPost,data:{action:"attachToPost",attObj:g,ele:i}}),l.push({htm:k.attachToNote,data:{action:"attachToNote",attObj:g,ele:i}}),zmUtil.isAddToCloudAllowed()&&l.push({htm:k.addToDocs,data:{action:"addToDocs",attObj:g,ele:i}}),"ics"===zmUtil.fileTyp(g.fn)[2]&&l.push({htm:k.addEvent,data:{action:"addEvent",attObj:g,ele:i}}),l.push({htm:k.addLabel,data:{action:"addTag",attObj:g,ele:i}}),Array.isArray(g.l)&&g.l.indexOf("$HIDDEN")>=0&&zmail.showFeature?l.push({htm:k.unhideAtt,data:{action:"unhideAtt",attObj:g,ele:i}}):g.gId===zmail.zuid&&l.push({htm:k.hideAtt,data:{action:"hideAtt",attObj:g,ele:i}}),g.ft&&103!==g.ft&&"FileDownload"===zmUtil.isPreviewAvailable(g.fn).apiName&&l.push({htm:k.printImg,data:{action:"printImg",attObj:g,ele:i}}),i.parents(".zmL.zmAch").addClass("sel"),j=$("body").height()-i.offset().top>=m?"up":"bottom";var n={par:i,showArrow:!0,list:l,direction:j,onHide:function(){i.parents(".zmL.zmAch").removeClass("sel")},clk:function(a,b){p.menuItemClick(a,b)}};zmsuite.showMenu(n)}else if(e){var o,q,r,s,t,u={};if(q="attSrcView"===this.appName&&(void 0===this.dType||"l"===this.dType)||"attView"===this.appName&&"l"===this.dType||"attListing"===this.appName&&"list"===this.viewType)p.listview.previewCard.openPreviewCard.call(this,b),p.listview.previewCard.keyBindingForPreviwCard.call(this);else{for(s="attSrcView"===this.appName?0:"l"===this.dType?0:g.ft,o=this.attArrObj[s].list,r=o.length,u.startIndex=o.indexOf(f),u.attObjList=[],t=0;t<r;t++)u.attObjList.push(this.attDet[o[t]]);u.targetEle=i.parents(".zmL.zmAch").find(".zmImg"),zmAttachUtility.initSlideshow(u)}}},p.listOptions=function(a){var b,d,e,g,h,i=a.target||a.srcElement,j=$(i).closest(".zmL").attr("data-atid"),k=c.prevMenu,l=[];b=this.attachUtil?this.attachUtil.attDet[j]:this.attDet[j],l.push({htm:k.downLoad,data:{action:"dwn",attObj:b}}),l.push({sep:!0}),1===b.et&&(l.push({htm:k.lstAttSender,data:{action:"lstSender",attObj:b}}),l.push({htm:k.lstAttType,data:{action:"lstType",attObj:b}}),l.push({sep:!0})),e=b.et-1,g=e?f[e]:f[0],h=b.l,l.push({htm:g,data:{action:g,attObj:b}}),l.push({sep:!0}),l.push({htm:k.sMail,data:{action:"sMail",attObj:b}}),l.push({htm:k.attachToPost,data:{action:"attachToPost",attObj:b}}),l.push({htm:k.attachToNote,data:{action:"attachToNote",attObj:b}}),l.push({sep:!0}),"$6"===h[0]?l.push({htm:k.remFav,data:{action:"remFav",attObj:b}}):l.push({htm:k.fav,data:{action:"fav",attObj:b}}),zmUtil.isAddToCloudAllowed()&&(l.push({sep:!0}),l.push({htm:k.addToDocs,data:{action:"addToDocs",attObj:b}})),"ics"===zmUtil.fileTyp(b.fn)[2]&&(l.push({sep:!0}),l.push({htm:k.addEvent,data:{action:"addEvent",attObj:b}})),h.indexOf("$HIDDEN")>=0&&zmail.showFeature?(l.push({sep:!0}),l.push({htm:k.unhideAtt,data:{action:"unhideAtt",attObj:b}})):b.gId===zmail.zuid&&(l.push({sep:!0}),l.push({htm:k.hideAtt,data:{action:"hideAtt",attObj:b}})),d={clk:function(a,b){p.menuItemClick(b,a)},conArr:l},zmsuite.showContextMenu(a,d),zmUtil.stopEvents(a)},p.loadingIndicator=function(a,b){var c=zmsuite.getCenter()[1].$el.find("#msprevAttSrc");c.find(".At_load").remove(),c.prepend(b),c.prepend(a)},p.loadingIndicatorTemplate=function(){return zmAttachment.templates.loadingTemplate()},p.removeLabelRef=function(a,b){var c,d,e,f;void 0!==b&&b.constructor===Object&&(c=b.attObj,void 0!==c&&c.constructor===Object&&(d=c.Id+c.e,this.attDet&&this.attDet[d]&&(e=this.attDet[d].l,f=e.indexOf(b.labId),f>=0&&e.splice(f,1))))},p.addLabelRef=function(a,b){var c,d,e,f;void 0!==b&&b.constructor===Object&&(c=b.attObj,void 0!==c&&c.constructor===Object&&(d=c.Id+c.e,this.attDet&&this.attDet[d]&&(e=this.attDet[d].l,f=e.indexOf(b.labId),f<0&&this.attDet[d].l.push(b.labId))))},p.modifyFavLblRef=function(a,b,c){var d,e,f;this.attDet&&this.attDet[b]&&(e=this.attDet[b],f=e.l,c?f.unshift("$6"):(d=f.indexOf("$6"),f.splice(d,1)))},p.ajaxReq={ajaxCallHelper:function(a,b){var c=zmComponent.loadingBand({container:b.loadingContainer,type:b.loadingType}),d=a.ep;return d.removeLoadingBand=c,{extraParam:d}},getGroupAttachments:function(a,b,c){var d,e=a.paramInfo;d="object"==typeof c?p.ajaxReq.ajaxCallHelper(a,c):{extraParam:a.ep},e.mode=e.mode||"lst",zmAjq.XHR({u:zmail.conPath+"/attach.do",t:"POST",fn:b,p:e,ep:d.extraParam})},getGroupLblAttachments:function(a,b,c){var d,e=a.paramInfo;d="object"==typeof c?p.ajaxReq.ajaxCallHelper(a,c):{extraParam:a.ep},zmAjq.XHR({u:zmail.conPath+"/postAttach.do",t:"POST",fn:b,p:e,ep:d.extraParam})}},p.listview={},p.listview.previewCard=function(){var a=function(a,b,c){return zmAttachment.templates.attachmentFrame(c,b,a)},b=function(a){a.load(function(){var b=zmsuite.getCenter()[1].$el;b.find("#msprevAttSrc").find(".At_load").remove(),a.css("visibility","visible")})},d=function(){var a,b=zmsuite.getCenter()[1].$el,c=b.height()-117+"px";return a=b.hasClass("shw")?b.width()-65+"px":b.width()+40+"px",{height:c,width:a}},e=function(a){var b=zmUtil.getTheSrc("FileDownload",a),c=$(zmAttachment.templates.imgTemp),d=zmsuite.getCenter()[1].$el.find("#msprevAttSrc");c.attr({src:b}).on("load",function(){d.find(".At_load").remove(),c.css({display:"block","max-width":"100%","max-height":"100%"})}).on("error",function(){var b=$(zmAttachment.templates.centerAlignBox);d.append(b),d.find(".At_load").remove(),c.remove(),p.previewNotAvlbl("msi-attothers",!1,b,a)}),p.loadingIndicator(p.loadingIndicatorTemplate(),c),d.append(c)},g=function(c){var e=zmUtil.getTheSrc("OpenDocument",c),f=d(),g=$(a(e,f.height,f.width));p.loadingIndicator(p.loadingIndicatorTemplate(),g),b(g)},h=function(c,e){var f,g,h,i=!1,j=!0,k=d(),l=zmsuite.getCenter()[1].$el;(window.ActiveXObject||"ActiveXObject"in window)&&(i=!0,o[e[2]]&&(g=$(zmAttachment.templates.centerAlignBox),j=!1,p.previewNotAvlbl(e[1],!1,g,c))),j&&("eml"===e[2]||"msg"===e[2]?(l.find("#msprevAttSrc").append(p.loadingIndicatorTemplate()),zmAttach.util.constMailFromEml(c,function(a){l.find("#zmHdrAtt").next().html(a)})):(h=zmUtil.getTheSrc("FileDownload",c),f=$(a(h,k.height,k.width)),p.loadingIndicator(p.loadingIndicatorTemplate(),f),i&&"msi-attpdf"===e[1]?window.setTimeout(function(){l.find("#msprevAttSrc").find(".At_load").remove(),f.css("visibility","visible")},2e3):b(f)))},i=function(a){var b=zmUtil.getTheSrc("FileDownload",a),c=zmsuite.getCenter()[1].$el.find("#msprevAttSrc"),d={filename:a.fn,source:b,$parent:c,height:c.height(),width:c.width(),swfPath:zmail.swfPath};zmAppLoader.load("slideshowComp").done(function(){zmAttachment.slideshow.player.create(d)})},j=function(a,b){var c=$(zmAttachment.templates.centerAlignBox);zmsuite.getCenter()[1].$el.find("#msprevAttSrc").append(c),p.previewNotAvlbl(a[1],!1,c,b)},k=function(a){var b=zmUtil.fileTyp(a.fn);101===a.ft?e(a):"msi-attdoc"!==b[1]&&"msi-attppt"!==b[1]&&"msi-attsheet"!==b[1]||n[b[2]]?"msi-attpdf"===b[1]||"msi-attdoc"===b[1]&&n[b[2]]||"msi-attothers"===b[1]&&n[b[2]]?h(a,b):"msi-attaudio"===b[1]||"msi-attvideo"===b[1]?i(a):j(b,a):g(a)},m=function(a){function b(){var a=this;c.length&&void 0!==c.attr("data-atid")?e.find("b.SC_nrr:first").unbind("click").bind("click",function(){p.listview.previewCard.openPreviewCard.call(a,c,"prev")}):e.find("b.SC_nrr:first").unbind("click").addClass("SC_opy3"),d.length&&void 0!==d.attr("data-atid")?e.find("b.SC_nlr:first").unbind("click").bind("click",function(){p.listview.previewCard.openPreviewCard.call(a,d,"next")}):e.find("b.SC_nlr:first").unbind("click").addClass("SC_opy3")}var c=a.prev(),d=a.next(),e=zmsuite.getCenter()[1].$el;b.call(this)},q=function(a){var b,d,e,g,h=zmsuite.getCenter()[1].$el.attr("data-atId"),i=c.prevMenu;l=[],b=this.attDet[h],l.push({htm:i.downLoad,data:{action:"download",attObj:b}}),l.push({sep:!0}),1===b.et&&(l.push({htm:i.lstAttSender,data:{action:"lstSender",attObj:b}}),l.push({htm:i.lstAttType,data:{action:"lstType",attObj:b}}),l.push({sep:!0})),d=b.et-1,e=d?f[d]:f[0],l.push({htm:e,data:{action:e,attObj:b}}),l.push({sep:!0}),l.push({htm:i.sMail,data:{action:"sMail",attObj:b}}),l.push({htm:i.attachToPost,data:{action:"attachToPost",attObj:b}}),l.push({htm:i.attachToNote,data:{action:"attachToNote",attObj:b}}),l.push({sep:!0}),g=b.l,"$6"===g[0]?l.push({htm:i.remFav,data:{action:"remFav",attObj:b}}):l.push({htm:i.fav,data:{action:"fav",attObj:b}}),zmUtil.isAddToCloudAllowed()&&(l.push({sep:!0}),l.push({htm:i.addToDocs,data:{action:"addToDocs",attObj:b}})),"ics"===zmUtil.fileTyp(b.fn)[2]&&(l.push({sep:!0}),l.push({htm:i.addEvent,data:{action:"addEvent",attObj:b}})),101===b.ft&&(l.push({sep:!0}),l.push({htm:i.printImg,data:{action:"printImg",attObj:b}})),g.indexOf("$HIDDEN")>=0&&zmail.showFeature?(l.push({sep:!0}),l.push({htm:i.unhideAtt,data:{action:"unhideAtt",attObj:b}})):b.gId===zmail.zuid&&(l.push({sep:!0}),l.push({htm:i.hideAtt,data:{action:"hidAtt",attObj:b}})),p.attDropDown("zm_AttView",a)},r=function(a){var b,c,d,e,f,g=this.attDet[a],h=g.dn&&""!==g.dn?g.dn:zmail.aInfo[zmail.accId].mailId,i=p.emailSplit(h),j=""!==i[1]?i[1]:"&nbsp;",k=""!==i[0]?i[0]:j,l=zmConUtil.bubbleUtil({attr:{"data-eid":j},name:k}),m=g.fs||g.size,n=g.fn,o=zmAttachment.templates,r=this;m=m>0?"("+zmUtil.sizeConv(m)+")":"&nbsp;",n=_zm.escapeTags(zmUtil.getSubString(40,n)),b=document.createDocumentFragment(),c=$(o.prevTopDom(n)),c.find(".SC_phd").attr("title",_zm.escapeTags(g.fn)),c.find(".msi-close").closest("b").off("click").on("click",function(){p.listview.previewCard.closePrevCard.call(r)}),b.appendChild(c[0]),d=$(o.prevMainDom(l,g.rt||" ")),e=p.getLabelArr(g.l),f=e.length;for(var s=0;s<f;s++){var t=e[s],u=zmUtil.getTagList("default")[t];u&&d.find(".zm_lbl").append(o.labelDisplayBox(t,u.dispName,u.color))}return d.find(".SCmb.SC_frt ul li").off("click").on("click",function(){q.call(r,this)}),d.off("click").on(".zmAttLbl","click",function(){p.showLabelPopup($(this),g)}),b.appendChild(d[0]),b};return{keyBindingForPreviwCard:function(){this.prev_shortcut_scope=zmComponent.keybindings.getScope();var a={allowDefaultScope:!1,shortcuts:[{uid:"next",keyStr:"downArrow",actions:[function(){zmsuite.getCenter()[1].$el.find("b.SC_nlr:first").trigger("click")}]},{uid:"previous",keyStr:"upArrow",actions:[function(){zmsuite.getCenter()[1].$el.find("b.SC_nrr:first").trigger("click")}]}],scope:this.appName+"attPreviewCard"};zmComponent.keybindings.registerAll(a),zmComponent.keybindings.setScope(this.appName+"attPreviewCard")},openPreviewCard:function(a,b){var d,e,f=$(a),g=f.attr("data-atId"),h=zmsuite.getCenter()[1].$el,i=zmsuite.getCenter()[0].getNodes()[2].$el,j=h.attr("data-atId"),l=c.contactCard,n=[{htm:l.addToContact,id:"zms_add",clk:zmConUtil.handleAddToContact},{htm:l.sendMail,clk:zmConUtil.loadCompose},{htm:l.chatWith,clk:zmConUtil.createChat,show:"chat",value:!0},{htm:l.listEmails,clk:zmConUtil.listMails}];if(g!==j){h.attr("data-atId",g).html(r.call(this,g)),d=this.attDet[g],i.find("div.zmAch").removeClass("zmSLst"),h.removeClass("SC_w100").show(),f.addClass("zmSLst"),m.call(this,f),e=d.dn&&""!==d.dn?d.dn:zmail.aInfo[zmail.accId].mailId;var o=p.emailSplit(e)[1];if(zmail.ContactBook.Utils.isEmailID(o))zmail.ContactBook.get({eid:p.emailSplit(e)[1]}).done(function(a){var b=a[0];if(b){var c=b.avatar();h.find("#zmHdrAtt").find(".SC_pvul li").prepend(c),zmail.wmsAPI.showPresence(p.emailSplit(e)[1],$(c))}});else{var q=zmail.ContactBook.Templates.avatar({initials:zmail.ContactBook.Utils.initials(o)})[0];h.find("#zmHdrAtt").find(".SC_pvul li").prepend(q),zmail.wmsAPI.showPresence(p.emailSplit(e)[1],$(q))}if(h.find("#zmHdrAtt").find(".SC_cs").click(function(a){zmConUtil.showContactCard({dom:this,items:n,event:a,source:"slideshow"})}),h.addClass("shw SC_scroll"),zmsuite.getCenter()[0].$el.addClass("SC_sw"),k(d),b){var s=i.find("[data-atId='"+j+"']");zmUtil.initScroll(i,f,s,b,!0)}}},closePrevCard:function(){var a=zmsuite.getCenter()[1].$el,b=zmsuite.getCenter()[0].getNodes()[2].$el;a.attr("data-atId",""),b.find("div.zmAch").removeClass("zmSLst"),zmsuite.getCenter()[1].close(),a.find("#msprevAttSrc").empty(),zmComponent.keybindings.dropScope(this.appName+"attPreviewCard"),this.prev_shortcut_scope&&zmComponent.keybindings.setScope(this.prev_shortcut_scope)}}}();var r=function(){var a={},b=function(b){a[b]||(a[b]={})},c=function(b){a[b]&&delete a[b]},d=function(b){return!!a[b]},e=function(b,c){if(a[b])return c?a[b][c]:a[b]},f=function(b,c,d){a[b]&&(a[b][c]=d)},g=function(b,c){var d,e=a[b];if(c=c||[],"object"==typeof e)for(d in e)c.indexOf(d)<0&&delete e[d]},h=function(b,c){a[b]&&(c&&a[b][c]?delete a[b][c]:g(b))},i=function(a,b){r.isRegisterd(this.appName)&&!b.fromCache&&f(this.appName,b.pView,{resp:a,eprm:b})},j=function(){var a,b=this;a=function(a,c){i.call(b,a,c)}," "!==this.prvFltr.lblId?this.getLblAttachments({loadingType:"loading",lstngObj:this.prvFltr,evType:!1,st:1,fType:this.fileType,forCaching:!0,callback:a}):this.getGroupAttachments("loading",!1,{callback:a})},k=function(){var a=e(this.appName,this.presentView);return"object"==typeof a&&a.resp&&j.call(this),a};return{register:b,deregister:c,isRegisterd:d,getStoreData:k,storeData:i,flush:h,flushExcept:g}}();a.prototype={initAttachViewComp:function(){var a,b=this;this.onScroll||this.$el.bind("scroll",function(){b.fillAttsOnScroll()}),this.cachingEnabled?r.isRegisterd(this.appName)?(a=r.getStoreData.call(this),"object"==typeof a&&a.resp?this.attLst(a.resp,{pView:this.presentView,thisRef:this,fromCache:!0}):this.getGroupAttachments()):(r.register(this.appName),this.getGroupAttachments()):this.getGroupAttachments()},fillAttsOnScroll:function(){var a=this.$el,b=a[0];Math.floor(b.scrollHeight-a.scrollTop())<=Math.floor(a.height())&&("t"!==this.dType||this.fileType)&&this.getAttachemntOnScroll()},getAttachemntOnScroll:function(){this.isDone||(this.isnew="n","l"===this.dType?this.start=this.showNxt:"t"===this.dType&&(this.start=this["showNxt"+this.fileType]),this.start&&(" "===this.prvFltr.lblId?this.getGroupAttachments("pagination","scrollEv"):this.getLblAttachments({loadingType:"pagination",lstngObj:this.prvFltr,evType:"scrollEv"})))},onListingClick:function(a,b){p.bindAttachListEvents.call(this,a,b)},restoreOptions:function(a){var b=this.prvFltr,d=a.find("#zmAttGrp input"),e=a.find("#zmAttLbl input"),f=a.find("#zmAttEntity input"),g=a.find("#zmAttFilTyp input");"f"===b.lblId?e.val(c.menuText.favourites).data({dataIndex:b.lblId}):" "===b.lblId?e.val(c.menuText.none).data({dataIndex:b.lblId}):e.val(zmUtil.getTagList("default")[b.lblId].dispName).data({dataIndex:b.lblId}),d.val(this.groupId===zmail.zuid?c.menuText.me:zmCont.getGroup()[this.groupId].name).data({dataIndex:this.groupId}),f.val(p.entDrpTxtChange(this.entity)).data({dataIndex:this.entity}),g.val(c.fType[this.fileType]).data({dataIndex:this.fileType})},attLView:function(a,b){var c,d,e=document.createDocumentFragment();this.attachCache(a,b);for(var f in a){c=a[f];for(var g in c)d=c[g],d.Id?e.appendChild(p.consList(d,this.dType,this.appName,this.viewType)[0]):void 0!==d.showNextPage&&(this.showNxt=d.showNextPage);return e}},attachCache:function(a,b){if(b){var c,d=h.length;for(c=0;c<d;c++)this.attArrObj[h[c]]={showNxt:0,list:[]}}for(var e in a){var f=e,g=a[e];for(var i in g){var j=g[i],k=j.Id+j.e;k&&(j.gId=this.groupId,j.uniqueId=k,j.sid?this.groupId!==zmail.zuid?j.type="viewGroupEntity":j.type="viewSelfData":this.groupId!==zmail.zuid&&(j.type="viewGroupData"),void 0===j.fn&&(j.fn=" "),this.attDet[k]=j,this.attArrObj[f].list.push(k))}}},attTView:function(a,b,c){var d,e,f,g,h=this.$el,i="msAttHdr";c&&"boolean"!=typeof c&&h.find("#msAttHdr"+this.fileType).find(".SC_lnk").trigger("click"),b?(e=$(zmAttachment.templates.thumbViewParentEle),h.html(e)):e=h.find(".SC_tbdr"),this.attachCache(a,b);for(var j in a)f=void 0,b&&p.parseToNumber(j)&&a[j]&&(f=p.thumbNailContainer(j,i,this.fileType),e.append(f)),p.parseToNumber(j)&&a[j]&&(d=a[j],f||(f=h.find("#msAttHdr"+j)),f.length&&(g=this.fileTypeShowAll,g[j].insertSingleAttachment&&f.find("#tempLoadContainer").remove(),this.constThumbList(d,f,j)));this.fileType&&1===p.parseToNumber(this.start)&&(h.find("#msAttHdr"+this.fileType).find(".SC_nobdr").remove(),h.find("#msAttHdr"+this.fileType).removeClass("zmAmht")),this.findScroll()},constThumbList:function(a,b,c,d){var e,f,g,h,i,j=a.length,k=!1,l=!1,m=0,n=1,o=this;d=d||!1,h=this.fileTypeShowAll,f=this.$el,g=this.widthConst,h[c].isHidden=!1,i=f[0].scrollWidth,f.is(":hidden")&&("attComp"===this.appName?i=f.closest(".SC_PUcen")[0].scrollWidth:(f=zmsuite.getCenter()[0].getNodes()[2].$el,i=f[0].scrollWidth));for(var q=0;q<j;q++){var r,s=a[q];if(s.Id)if(r=p.consList(s,this.dType,this.appName,this.viewType)[0],b.append(r),1!==p.parseToNumber(this.start)||d||0!==this.fileType){if(!d&&q===j-2&&a[j-1].showNextPage){var t,u,v=b.children().length;t=this.thumbCount,u=(v-1)%t,e=v-u+1,k=!0,l=!0;for(var w=0;w<u;w++)b.children(":last").remove()}}else{if(m+=g,(m>i||h[c].insertSingleAttachment)&&2===n){b.children(":last").remove(),e=q,k=!0,this["showNxt"+c]=a[a.length-1].showNextPage,void 0!==h[c].insertSingleAttachment&&(h[c].insertSingleAttachment=!1),this.thumbCount=q/2;break}(m>i||h[c].insertSingleAttachment)&&(n=2,m=g)}else this["showNxt"+c]=s.showNextPage,s.showNextPage&&!k&&(k=!0)}k?("y"===this.isnew||l?h[c].stoppedIndex=0:h[c].stoppedIndex-=1,h[c].isHidden=!0,h[c].stoppedIndex+=e,b.find(".SC_lnk").off("click").on("click",function(){o.showAllThb(h[c].stoppedIndex,"t",a[a.length-1].showNextPage,this.entity,c,"n",l,b)})):b.find(".SC_lnk").hide()},showAllThb:function(a,b,c,d,e,f,g,h){var i,j,k,l;if(g)j=p.getAttachObject(a,e,this),this.constThumbList(j,h,e,!0);else{i=this.$el.find("#msAttHdr"+e),i.find(".SC_nobdr").remove(),i.find(".SC_lnk").hide();for(var m=101;m<=105;m++)m!==p.parseToNumber(e)&&this.$el.find("#msAttHdr"+m).remove();i.removeClass("zmAmht"),j=p.getAttachObject(a,e,this),this.constThumbList(j,h,e,!0),c&&1!==p.parseToNumber(c)?(k=this.prvFltr," "===k.lblId?this.getAttLst({groupId:this.groupId,dType:b,st:c,eType:d,fType:e,prvFltr:k,isNew:f,lstngObj:!1,flag:!0}):(l=k,this.getAttLst({groupId:this.groupId,dType:b,st:c,eType:d,fType:e,prvFltr:k,isNew:f,lstngObj:l,flag:!0}))):(this.fileType=e,this.showHideDefaultview())}},attLst:function(a,b){var d,e,f,g=b.thisRef,h=g.$el,i=g.presentView,j=g.dType;if("function"==typeof b.removeLoadingBand&&b.removeLoadingBand(),b.pView!==i)return void h.children().show();if(d=p.chkAttResp(a))e="y"===g.isnew,e&&g.cachingEnabled&&r.storeData.call(g,a,b),"l"===j?("attView"===g.appName||"attComp"===g.appName||"list"===g.viewType?h.removeClass("SC_tmbvw"):h.addClass("SC_tmbvw"),f=g.attLView(a,e),1===g.start?(h.html(f),h.scrollTop(0)):h.find(".zmAch:last").after(f),g.findScroll(h)):(h.addClass("SC_tmbvw"),g.initView=!0,g.attTView(a,e,b.evT));else{if(1===g.start){var k=g.initView||"attView"!==g.appName?c.common.noAttFound:c.common.noAttFoundAll;p.noAttach(h,k)}"t"===g.dType?g["showNxt"+this.fileType]=0:"l"===g.dType&&(g.showNxt=0)}h.children().show(),g.isDone=!1,g.showHideDefaultview(),"function"==typeof g.onListingUpdate&&g.onListingUpdate(b.fromCache),zmail.showFeature&&1===g.start&&"attListing"===g.appName&&0===h.find(".zmScrollTrail").length&&zmComponent.customScrollBar(h[0],"dom")},findScroll:function(){if(!this.onScroll){var a,b,c=this.$el;a="t"===this.dType?this["showNxt"+this.fileType]:this.showNxt,a&&c[0].scrollHeight<=c[0].clientHeight&&(this.start=a,this.isnew="n",b=this.prvFltr," "===b.lblId?this.getGroupAttachments("pagination","scrollEv"):this.getLblAttachments({loadingType:"pagination",lstngObj:b,evType:"scrollEv"}))}},getAttLst:function(a){var b=a.lstngObj,c=a.prvFltr,d=a.dType,e=a.groupId,f=a.eType,g=a.fType;if(this.groupId!==e||this.dType!==d||this.fileType!==g||this.entity!==f||b&&c.lblId!==b.lblId){if("object"==typeof b?(c.lblId=b.lblId,c.mthd=b.mthd):(c.lblId=" ",c.mthd=" "),this.presentView=d+e+f+g+c.lblId,this.groupId=e,this.dType=d,a.st?this.start=a.st:this.start=1,f&&""!==f?this.entity=f:this.entity="all",g?this.fileType=g:this.fileType=0,a.isNew?this.isnew=a.isNew:this.isnew="n","y"===this.isnew&&this.cachingEnabled){var h=r.getStoreData.call(this);if("object"==typeof h&&h.resp)return void this.attLst(h.resp,{pView:this.presentView,thisRef:this,fromCache:!0})}"attView"===this.appName&&(p.listview.previewCard.closePrevCard.call(this),zmsAtt.resetSelectionViewAndData())," "!==c.lblId?this.getLblAttachments({loadingType:"loading",lstngObj:b,evType:a.flag}):this.getGroupAttachments("loading",a.flag)}},getLblAttachments:function(a){var b,c,d=this.$el,e=a.container||d[0],f=a.st||this.start,g=a.lstngObj,h=a.loadingType,j={method:g.mthd,dType:this.dType,from:f,range:25,groupId:this.groupId};return this.isDone=!0,b=this.attLst,"all"!==this.entity&&(j.entityType=i[this.entity]),c=a.fType||this.fileType,0!==c&&(j.fileType=c),"labelListing"===g.mthd&&(j.label=g.lblId),1===p.parseToNumber(f)&&(this.attDet=[],d.children().hide()),"streams"!==this.appName&&"attComp"!==this.appName||(h="pagination"),a.forCaching?void p.ajaxReq.getGroupLblAttachments({paramInfo:j,ep:{evT:a.evType,pView:this.presentView,thisRef:this}},a.callback):void p.ajaxReq.getGroupLblAttachments({paramInfo:j,ep:{evT:a.evType,pView:this.presentView,thisRef:this}},b,{loadingContainer:e,loadingType:h})},getGroupAttachments:function(a,b,c){var d,e,f=this.$el,g={};return this.isDone=!0,d=this.presentView,e=this.attLst,this.requireParams&&this.requireParams.constructor===Object?$.extend(!0,g,this.requireParams):(g.type=this.dType,g.frm=this.start,g.entity=this.entity,g.ftype=this.fileType,g.groupId=this.groupId),g.frm=this.start,"streams"!==this.appName&&"attComp"!==this.appName||(a="pagination"),"object"==typeof c?void p.ajaxReq.getGroupAttachments({paramInfo:g,ep:{evT:b,pView:d,thisRef:this}},c.callback):(1===p.parseToNumber(this.start)&&(this.attDet=[],f.children().hide()),void p.ajaxReq.getGroupAttachments({paramInfo:g,ep:{evT:b,pView:d,thisRef:this}},e,{loadingContainer:f[0],loadingType:a}))},showHideDefaultview:function(){if("function"==typeof this.onFilterAction)return void this.onFilterAction();var a=this.$topEl,b=a.find("#zmMyAttachments"),d=this.prvFltr.lblId;if(this.groupId===zmail.zuid&&"all"===this.entity&&0===this.fileType&&" "===d)a.find("#zmDfltAttView").hide(),b.html(c.common.me),a.find(".SC_frt").find("li").find("b").eq(0).removeClass("SC_sel");else{a.find("#zmDfltAttView").show();var e,f=c.menuText.notags,g=zmail.zuid===this.groupId?c.menuText.me:zmCont.getGroup()[this.groupId].name;e="f"===d?c.menuText.favourites:" "===d?f:zmUtil.getTagList("default")[d].dispName,b.html(zmAttachment.templates.filterByMsg+": "+_zm.escapeTags(g)+" - "+zmAttachUtility.entDrpTxtChange(this.entity)+" - "+c.fType[this.fileType]+" - "+_zm.escapeTags(e)+"  "),a.find(".SC_frt").find("li").find("b").eq(0).addClass("SC_sel")}}};var s=function(){var a,b=0,e=[],h=0,i={},j={},k=function(a){zmAttachment.slideshow.closeSlideshow(),a&&$.publish("zm/closeAllOpenDialog")},l=function(a){return"number"!=typeof a&&(a=p.parseToNumber(a)),1===a?"msi-mail":2===a?"msi-notes":3===a?"msi-task":4===a?"msi-calendar":6===a?"msi-status":void 0},q=function(a){return"msi-attimg"===a[1]||"msi-attpdf"===a[1]||"msi-attdoc"===a[1]&&n[a[2]]||"msi-attothers"===a[1]&&n[a[2]]},r=function(a,b){if(b.hasClass("SC_thm"))b.removeClass("SC_thm"),$("#zmlightbox_dropDown").remove();else{var e=b,f=c.prevMenu,g={},h=[],i=!0,j="";a&&a.fn&&(j=zmUtil.fileTyp(a.fn)[2]||""),h.push({htm:zmText.applyArgs(f.saveasfile,{filetype:j.toUpperCase()}),data:{action:"saveaseml"}}),h.push({htm:zmText.applyArgs(f.saveasfile,{filetype:"HTML"}),data:{action:"saveashtml"}}),g={par:b,list:h,onHide:function(){b.removeClass("SC_thm")},clk:function(b,c){"saveaseml"===b.action?zmUtil.downloadAttachment(a):zmAttach.util.save($("#"+d+" .SC_pEml").html(),"html",a.fn),zmUtil.hideMenu()},showArrow:i},g.divId="zmlightbox_dropDown",e.addClass("SC_thm"),zmsuite.showMenu(g),$("#zmlightbox_dropDown").css("zIndex",1e6)}},s=function(a,b,c){switch(a){case"msi-mail":k(!0),p.openMail(b);break;case"msi-notes":k(),zmUtil.isNoteReactUser()?zmUtil.loadNotes("openNote",b):p.openPost(b);break;case"msi-task":k(),p.openPost(b);break;case"msi-calendar":k(),p.openPost(b);break;case"msi-status":k(),p.openPost(b);break;case"msi-attsearch":var d,e=c;e.hasClass("SC_thm")?(e.removeClass("SC_thm"),$("#zmlightbox_dropDown").remove()):(e.addClass("SC_thm"),d={id:"zm_lstSrc",par:e,align:"pright"},d.divId="zmlightbox_dropDown",e.find("b").addClass("SC_ddn"),d.list=m,d.align="mright",d.showArrow=!0,d.direction="bottom",d.clk=function(a){var c=a.action;1===c?p.searchAttachment("sender",b):2===c&&p.searchAttachment("filetype",b),zmUtil.hideMenu(),k(!0)},zmDrop.consDropDown(d),$("#zmlightbox_dropDown").css("zIndex",1e6));break;case"msi-send":k(!0),p.sendMail(b);break;case"msi-share":var f=$(c);f.hasClass("SC_thm")?(f.removeClass("SC_thm"),$("#zmlightbox_dropDown").remove()):(p.createShareDropDownMenu({ele:f,clk:function(a){"attachToPost"===a.action?zmUtil.loadNewPostDialog("",[b]):"attachToMail"===a.action?zmUtil.openComposeWithAtt([b]):zmUtil.loadNotes("popup",{attEntObj:[b]}),k(!0)},divId:"zmlightbox_dropDown"}),$("#zmlightbox_dropDown").css("zIndex",1e6));break;case"msi-fav":p.attFav(b,c);break;case"addLabel":$(c).hasClass("SC_thm")?($(c).removeClass("SC_thm"),$("#zmlightbox_dropDown").remove()):(p.addLabel(b,"slideShow"),$(c).addClass("SC_thm"));break;case"removeLabel":p.removeLabelApi(b,p.removeLabelApiResult);break;case"msi-print":p.printImageAtt(b);break;case"msi-unhide":p.restoreToAttachmentView(b);break;case"msi-download":var g=zmUtil.fileTyp(b.fn);"eml"===g[2]||"msg"===g[2]?r(b,$(c)):zmUtil.downloadAttachment(b)}},t=function(a){var b=l(a.et),d=zmUtil.fileTyp(a.fn),e={};return(!i.hideIcons||i.hideIcons.indexOf(b)<0)&&(e.entity={"class":b,title:f[g.indexOf(b)],events:[{name:"click",listener:function(a,c){s(b,c)}}],before:".msi-send"}),(!i.hideIcons||i.hideIcons.indexOf("msi-print")<0)&&q(d)&&(e.print={"class":"msi-print",id:"attMsi-print",title:c.prevMenu.printImg,events:[{name:"click",listener:function(a,b){s("msi-print",b)}}],after:".msi-download"}),"msi-mail"===b&&(!i.hideIcons||i.hideIcons.indexOf("msi-attsearch")<0)&&(e.search={"class":"msi-attsearch",title:c.prevMenu.search,events:[{name:"click",listener:function(a,b){var c=$(a.target||a.srcElem);s("msi-attsearch",b,c)}}],before:".msi-mail"}),e},u=function(a){return $.extend(!0,{},a,i.addIcons)},v=function(){return{text:c.UserMsg.download,listener:function(a,b){zmUtil.downloadAttachment(b)}}},w=function(){var a={},b=".msi-download";return zmUtil.isAddToCloudAllowed()&&(a.addToCloud={"class":"msi-addcloud",title:c.UserMsg.addToCloud,events:[{name:"click",listener:function(a,b){k(!0),zmUtil.cloudUploader(b)}}]},b=".msi-addcloud"),a.download={"class":"msi-download",title:c.UserMsg.download,events:[{name:"click",listener:function(a,b){s("msi-download",b,a.target)}}]},a.share={"class":"msi-share",title:c.UserMsg.share,events:[{name:"click",listener:function(a,b){s("msi-share",b,a.target||a.srcElement)}}],before:b},a},x=function(a){var b,c=zmUtil.fileTyp(a.fn);if(!("msi-attdoc"!==c[1]&&"msi-attppt"!==c[1]&&"msi-attsheet"!==c[1]||n[c[2]]))return zmUtil.getTheSrc("OpenDocument",a);if("msi-attpdf"===c[1]||"msi-attdoc"===c[1]&&n[c[2]]||"msi-attothers"===c[1]&&n[c[2]]||"msi-atthtml"===c[1]&&n[c[2]]){if(b=!0,(window.ActiveXObject||"ActiveXObject"in window)&&o[c[2]]&&(b=!1),b)return zmUtil.getTheSrc("FileDownload",a)}else{if("msi-attaudio"===c[1]||"msi-attvideo"===c[1])return zmUtil.getTheSrc("FileDownload",a);if("msi-attimg"===c[1])return zmUtil.getTheSrc("FileDownload",a)}return""},y=function(a,b){if(a.find("#sshwLeftIcons div.SC_cs").remove(),b.l){var c=p.getLabelArr(b.l);if(c.length){var d,e=c.length;d=a.find("#sshwLeftIcons > div");for(var f=0;f<e;f++){var g,h=c[f],i=zmUtil.getTagList("default")[h];i&&(g=p.constLabelDiv(i,b),g.css("color","white"),g.css("background-color","black"),d.append(g))}}}},z=function(){a=zmComponent.keybindings.getScope();var b={allowDefaultScope:!1,shortcuts:[{uid:"close",keyStr:"esc",actions:[function(){}]}],scope:"slideshowwrapper"};zmComponent.keybindings.registerAll(b),zmComponent.keybindings.setScope("slideshowwrapper")},A=function(a,b,c){j[b]&&j[b].l.indexOf(c)<0&&j[b].l.push(c)},B=function(a,b,c){if(j[b]){var d=j[b].l,e=d.indexOf(c);e>=0&&d.splice(e,1)}},C=function(a,b,c){if(j[b]){var d=j[b],e=d.l,f=e.indexOf("$6");c?f<0&&e.unshift("$6"):f>=0&&e.splice(f,1)}},D=function(a){k(!0)},E=function(){$.unsubscribe("attachment/addLabel",A),$.unsubscribe("attachment/removeLabel",B),$.unsubscribe("attachment/modifyFavLbl",C),$.unsubscribe("attachment/closeSlideshow",k),$.unsubscribe("mailsuite/hashurl/updated",D)},F=function(){zmComponent.keybindings.dropScope("slideshowwrapper"),zmComponent.keybindings.setScope(a),E(),"function"==typeof i.onCancel&&i.onCancel()},G=function(){$.subscribe("attachment/addLabel",A),$.subscribe("attachment/removeLabel",B),$.subscribe("attachment/modifyFavLbl",C),$.subscribe("attachment/closeSlideshow",k),$.subscribe("mailsuite/hashurl/updated",D)},H=function(a){return!!a&&!!a.attObjList},I=function(a){var b=$('<div class="SC_pEml">');return zmAttachment.slideshow.showLoading(),zmAttach.util.constMailFromEml(a.handBackObj,function(a){var c=b.closest(".ZC_Pop");b.closest(".SC_oh").addClass("SC_emlCont"),b.css({maxHeight:c.height()-5,maxWidth:c.width()-5}),zmAttachment.slideshow.removeLoading(),b.append(a)}),b},J=function(a){b=a.startIndex||0,e=a.attObjList,h=e.length,i=a,j={}},K=function(){var a,f,g={},k={},l=!1;z(),g.attachmentObjectList=[],g.swfPath=zmail.swfPath,g.setIndex=b,g._i18NText={common:c.common,prevMenu:c.prevMenu,loupe:c.slideshow.loupe,tooltip:c.slideshow.tooltip},g.onCancel=F,i.hideAllOptions||(g.rightIconList=w(),(!i.hideIcons||i.hideIcons.indexOf(".msi-fav")<0)&&(g.leftIconList={fav:{"class":"msi-fav",title:c.UserMsg.fav,events:[{name:"click",listener:function(a,b){var c=!0,d=$(a.target||a.srcElement);d.hasClass("SC_fav")&&(c=!1,b.l&&b.l.length&&"$6"===b.l[0]&&b.l.splice(0,1)),s("msi-fav",b,c)}}]},tag:{"class":"msi-label",title:c.UserMsg.addLabel,events:[{name:"click",listener:function(a,b){var c=a.target||a.srcElement;s("addLabel",b,c)}}]}})),i.targetEle&&(g.targetEle=i.targetEle,g.onCloseAnimation=!0);for(var m=0;m<h;m++)k={},a=e[m],k.isImage=101===a.ft,k.filename=a.fn||"",k.source=a.src||x(a),k.thumbnail=a.thn,k.handBackObj=a,j[a.Id+a.e]=a,f=zmUtil.fileTyp(k.filename)[2],i.hideAllOptions||(k.iconList=t(a),k.action=v()),i.ignoreEMLParsing||"eml"!==f&&"msg"!==f||(k.source=void 0,k.handleFilePreview=I),(a.callee_type||a.showInFrame)&&(g.ignoreThumb=!0,k.showInFrame=a.showInFrame),i.ignoreThumb&&(g.ignoreThumb=i.ignoreThumb),a.hideFileName&&(l=!0),a.hideShareOption&&(k.hideShareOption=a.hideShareOption),a.tweetText&&(k.tweetText=a.tweetText,k.featureURL=window.location.protocol+"//zoho.to/newzmail"),i.addIcons instanceof Object&&(k.iconList=u(k.iconList)),g.attachmentObjectList.push(k);g.afterPreviewInit=function(a,b){if(b.l=j[b.Id+b.e].l,(window.ActiveXObject||"ActiveXObject"in window)&&"msi-attpdf"===zmUtil.fileTyp(b.fn)[1]&&window.setTimeout(function(){a.find(".At_load").remove(),a.find("iframe").css("visibility","visible")},2e3),zmUtil.isZohoAccount(zmail.accId)&&!i.hideAllOptions&&(!i.hideIcons||i.hideIcons.indexOf("msi-fav")<0)){var d=a.find(".msi-fav"),e=b.l;e&&e.length&&"$6"===e[0]?d.addClass("SC_fav").attr("title",c.UserMsg.remFav):d.removeClass("SC_fav").attr("title",c.UserMsg.fav),y(a,b)}},(i.hideFileName||l)&&(g.hideFileName=!0),i.onLoad&&(g.onLoad=i.onLoad),g.iconClasses={closeClass:"msi-close",prevClass:"msi-atprev",nextClass:"msi-atnext",moreClass:"msi-thumbnail",zoominClass:"msi-zoomin",zoomoutClass:"msi-zoomout",printClass:"msi-print",addToCloudClass:"msi-addcloud",downloadClass:"msi-download",zoomPlusClass:"msi-plus",zoomMinusClass:"msi-minus"},g.loupe=!0,g.iconClasses.loupeClass="msi-magnify",g.afterInit=function(a){a.removeClass("ZC_lightbox SC_lightbox")},g.shortCuts=[{keyStr:"ctrl+p",action:function(a){if(a&&a.fn&&a.e){var b=zmUtil.fileTyp(a.fn);q(b)&&s("msi-print",a)}},preventDefault:!0},{keyStr:"cmd+p",action:function(a){if(a&&a.fn&&a.e){var b=zmUtil.fileTyp(a.fn);q(b)&&s("msi-print",a);
}},preventDefault:!0}],g.onMouseDown=function(a){var b=$(a.target||a.srcElement);$("#zmlightbox_dropDown").remove(),b.hasClass("SC_thm")||($("#"+d+" .SC_thm").removeClass("SC_thm"),zmAttachment.slideshow.getLoupeStatus()&&$("#"+d+" .msi-magnify").addClass("SC_thm"))},zmAppLoader.load("slideshowComp").done(function(){zmAttachment.slideshow.initSlideShow(g)})},L=function(a){H(a)?(J(a),K(),G()):zmUtil.debugLog("Slideshow: Invalid config")};return{init:L,action:s}}(),t=function(){function a(a){this.attachUtil=null,this.config=a}var b=function(a,b){this.attachUtil.$el.off(a).on(a,b.bind(this))};a.prototype.initComponent=function(){var a=this;this.attachUtil=new zmAttachUtility.AttachmentListing(this.config),this.config.listElem.undelegate("click").delegate(".zmAch","click",function(b){a.attachUtil.onListingClick(b,this)}),b.call(this,"contextmenu",function(a){p.listOptions.call(this,a)}),this.attachUtil.dType="l",this.attachUtil.initAttachViewComp()},a.prototype.init=function(a){this.reset(a),this.attachUtil.getGroupAttachments()},a.prototype.onScroll=function(){this.attachUtil.onScroll&&this.attachUtil.getAttachemntOnScroll()},a.prototype.reset=function(a){a&&(a.headerElem&&(a.listElem||(a.headerElem.append('<div class="SC_tmbvw"></div>'),a.listElem=a.headerElem.find(".SC_tmbvw")),this.attachUtil.$topEl=a.headerElem,this.attachUtil.$el=a.listElem,b.call(this,"contextmenu",function(a){p.listOptions.call(this,a)})),a.groupId&&(this.attachUtil.groupId=a.groupId),a.onScroll&&(this.attachUtil.onScroll=a.onScroll),a.viewType&&(this.attachUtil.viewType=a.viewType),a.entity&&(this.attachUtil.entity=a.entity),a.fileType&&(this.attachUtil.fileType=a.fileType),this.attachUtil.start=1)},a.prototype.isNewRequest=function(){return 1===this.attachUtil.start},a.prototype.toggleView=function(){"list"===this.attachUtil.viewType?(this.attachUtil.viewType="thumb",this.attachUtil.$el.addClass("SC_tmbvw")):(this.attachUtil.viewType="list",this.attachUtil.$el.removeClass("SC_tmbvw"))};var c=function(b){var c;return b.listElem||(b.headerElem.append('<div class="SC_tmbvw"></div>'),b.listElem=b.headerElem.find(".SC_tmbvw")),b.thumbWidth||(b.thumbWidth=191),b.viewType||(b.viewType="thumb"),c=new a(b),c.initComponent(),c};return{init:c}}();b.enTypeTitle=f,b.enTypeClsArr=g,b.attType=h,b.AttachmentListing=a,b.AttLstArr=j,b.AttEntLst=k,b.getGroups=p.getGroups,b.getLabels=p.getLabels,b.attDropDown=p.attDropDown,b.createShareDropDownMenu=p.createShareDropDownMenu,b.entDrpTxtChange=p.entDrpTxtChange,b.noAttach=p.noAttach,b.consList=p.consList,b.thumbNailContainer=p.thumbNailContainer,b.getGroupAttachments=p.ajaxReq.getGroupAttachments,b.getGroupLblAttachments=p.ajaxReq.getGroupLblAttachments,b.addEventsToCal=p.addEventsToCal,b.addToCloud=p.uploadToCloud.initAddToCloud,b.addToCloudClose=p.uploadToCloud.addToCloudClose,b.cloudUpload=p.uploadToCloud.cloudUpload,b.getFilterDropTemplate=q.getFilterDropTemplate,b.initSlideshow=s.init,b.initAttachListing=t.init,b.bindAttachListEvents=p.bindAttachListEvents,b.closePrevCard=p.listview.previewCard.closePrevCard,b.createAttContextMenu=p.listOptions,b.removeLabelRef=p.removeLabelRef,b.addLabelRef=p.addLabelRef,b.modifyFavLblRef=p.modifyFavLblRef,b.isRestrictedIE=p.isRestrictedIE,b.isDocsCompAllowed=p.isDocsCompAllowed,b.parseToNumber=p.parseToNumber,b.parseToInteger=p.parseToInteger,b.showLabelPopup=p.showLabelPopup}(),function(){"use strict";function a(a){this.configuration=a,this.workspaceConfig=$.extend(!0,{},f.workspaceConfig),this.attachListingConfig=$.extend(!0,{},f.attachListingConfig),this.attListComp=null,this.workspaceConfig.onDelete=d.workspace.onDelete.bind(this),d.initialise.call(this),this.render()}var b=zmail.Core.Namespaces.create("zmAttachUtility"),c=zmText.get("attachmentUtility"),d={},e=null,f={workspaceConfig:{appname:"Attachment Listing",appId:"attachList",headerText:void 0,headerHTML:void 0,data:{CNodes:"3"},appIcon:"msi-attsearch",searchPlaceHolder:c.prevMenu.search,faqKey:"attachment",hashKey:"",hashChangeHandler:function(a){var b=this;zmUtil.debugLog("Attachment Listing Component URL Changed",a,b)}},attachListingConfig:{appName:"attListing",viewType:"thumb",onFilterAction:function(){return!0}}};a.prototype.render=function(){var a=this;d.createAttachmentListingInsance(this.attachListingConfig).then(function(b){a.attListComp=b,e||(e=zmUtil.setDragAndDrop(b.attachUtil.$el,{getAttachments:function(){return a.attListComp.attachUtil},onDragEnd:function(){d.resetSelectionViewAndData.call(a)}}))})},a.prototype.rerender=function(a){var b,c,e;this.isWorkspaceAvailable()&&(a&&a.constructor===Object&&($.extend(!0,this.configuration,a),b=a.attachListingConfig,b&&b.constructor===Object&&$.extend(!0,this.attachListingConfig,b),c=a.workspaceConfig,c&&c.constructor===Object&&($.extend(!0,this.workspaceConfig,a.workspaceConfig),e=d.workspace.update,c.headerText&&e.title.call(this,c.headerText),c.headerHTML&&e.headerHTML.call(this,c.headerHTML),c.appname&&e.tooltip.call(this,c.appname))),this.attachListingConfig.listElem.html(""),this.showWorkSpace(),d.resetSelectionViewAndData.call(this),this.render())},a.prototype.isWorkspaceAvailable=function(){return zmsuite.isWorkspaceAvailable(this.workspaceConfig.appId)},a.prototype.showWorkSpace=function(){d.workspace.show.call(this)},a.prototype.getWorkspacekey=function(){return this.workspaceConfig.workspaceKey},a.prototype.changeView=function(a){this.attListComp.attachUtil.viewType!==a&&this.attListComp.toggleView()},d.createAttachmentListingInsance=function(a){var b=$.Deferred();return zmUtil.initAttachListing(a,function(a){b.resolve(a)}),b},d.isAttachmentListingInstance=function(){return this.constructor===a},d.initialise=function(){d.isAttachmentListingInstance.call(this)&&($.extend(!0,this.workspaceConfig,this.configuration.workspaceConfig),$.extend(!0,this.attachListingConfig,this.configuration.attachListingConfig),zmsuite.isWorkspaceAvailable(this.workspaceConfig.appId)?d.workspace.show.call(this):d.workspace.create.call(this),this.attachListingConfig.headerElem=zmsuite.getCenter(this.workspaceConfig.appId)[0].$el,this.attachListingConfig.listElem=zmsuite.getCenter(this.workspaceConfig.appId)[0].getNodes()[2].$el)},d.onAttachmentSelect=function(a,b){var d,e=this.attListComp.attachUtil;if(b===e.appName){d=zmsuite.getCenter(this.workspaceConfig.appId)[0].getNodes(),e.selectedAttachment[1]||(d[1].$el.find(".SC_flt .SC_mtb").removeClass("zm_sinTit").addClass("zm_aniTit"),d[0].$el.find(".SC_flt").removeClass("zm_aniHide").addClass("zm_aniSel"));var f=1===e.selectedAttachment.length?c.common.oneattselected:c.common.noofattselected;d[0].$el.find(".SC_flt .SC_ldot.SC_itmSel").find("strong").text(e.selectedAttachment.length+" "+f)}},d.onAttachmentUnselect=function(a,b){var d,e=this.attListComp.attachUtil;if(b===e.appName)if(d=zmsuite.getCenter(this.workspaceConfig.appId)[0].getNodes(),e.selectedAttachment[0]){var f=1===e.selectedAttachment.length?c.common.oneattselected:c.common.noofattselected;d[0].$el.find(".SC_flt .SC_ldot.SC_itmSel").find("strong").text(e.selectedAttachment.length+" "+f)}else d[1].$el.find(".SC_flt .SC_mtb").addClass("zm_sinTit").removeClass("zm_aniTit"),d[0].$el.find(".SC_flt").removeClass("zm_aniSel").addClass("zm_aniHide")},d.resetSelectionViewAndData=function(){var a=this.attListComp.attachUtil,b=zmsuite.getCenter(this.workspaceConfig.appId)[0].getNodes(),c=b[2].$el.find(".SC_check");c.removeClass("SC_check"),b[1].$el.find(".SC_flt .SC_mtb").addClass("zm_sinTit").removeClass("zm_aniTit"),b[0].$el.find(".SC_flt").removeClass("zm_aniSel").addClass("zm_aniHide"),a.selectedAttachment=[]},d.shareOptionHandler=function(a){var b=this.attListComp.attachUtil;"attachToPost"===a.action?zmUtil.loadNewPostDialog("",b.selectedAttachment):"attachToMail"===a.action?zmUtil.openComposeWithAtt(b.selectedAttachment):zmUtil.loadNotes("popup",{attEntObj:b.selectedAttachment}),d.resetSelectionViewAndData.call(this)},d.subscribeToEvents=function(){$.subscribe("attachmentView/attachmentSelected",d.onAttachmentSelect.bind(this)),$.subscribe("attachmentView/attachmentUnselected",d.onAttachmentUnselect.bind(this))},d.unsubscribeToEvents=function(){$.unsubscribe("attachmentView/attachmentSelected",d.onAttachmentSelect.bind(this)),$.unsubscribe("attachmentView/attachmentUnselected",d.onAttachmentUnselect.bind(this))},d.workspace={getLeftHeaderHtml:function(){var a=this.workspaceConfig;return zmAttachment.templates.leftHeader(a.appId,a.headerText||a.headerHTML)},show:function(){zmsuite.showWorkSpace(this.workspaceConfig.appId)},render:function(){zmsuite.renderWorkSpace()},afterRender:function(){var a=zmsuite.getCenter(this.workspaceConfig.appId)[0],b=a.getNodes()[0].$el.find(".SC_flt"),c=a.$el;c.addClass("SC_attachviewer"),c.find(".SC_frt").find("li[data-event='thumb']").find("b").addClass("SC_sel"),a.getNodes()[1].$el.find(".SC_flt .SC_mtb").removeClass("SC_Tcen").addClass("zm_sinTit"),b.find("ul:first").addClass("SC_ldot"),b.addClass("zm_aniHide").prepend(zmAttachment.templates.attAddToContainer).prepend(zmAttachment.templates.attDownloadContainer).prepend(zmAttachment.templates.attSelectedMsgContainer)},set:function(){zmsuite.setWorkSpace(this.workspaceConfig)},get:{center:function(){return zmsuite.getCenter(this.workspaceConfig.appId)[0]},listing:function(){return zmsuite.getCenter(this.workspaceConfig.appId)[0].getNodes()[2].$el}},update:{title:function(a){"string"==typeof a&&zmsuite.getCenter(this.workspaceConfig.appId)[0].getNodes()[1].$el.find(".SC_mtb").text(a)},headerHTML:function(a){"string"==typeof a&&zmsuite.getCenter(this.workspaceConfig.appId)[0].getNodes()[1].$el.find(".SC_mtb").html(a)},tooltip:function(a){var b;"string"==typeof a&&(b=zmTab.getTabObject(this.workspaceConfig.appId),b.appname=a,zmTab.updateTabLst(b))}},create:function(){var a,b,f,g,h,i={},j=this;d.workspace.set.call(this),a=zmsuite.getCenter(),b=a[0].getNodes(),f=a[1].getNodes(),g=zmsuite.getCenter()[0].$el,i={list:{left:[],right:[{actionArr:[{iconList:["msi-thumbview"],data:"thumb",tooltip:c.common.thumbView},{iconList:["msi-listview"],data:"list",tooltip:c.common.listView},{iconList:["msi-close"],data:"close",tooltip:c.common.close}]}]},clk:function(a,b,c){"close"===c?(e=null,zmsuite.closeWorkspace(j.workspaceConfig.appId)):"thumb"!==c&&"list"!==c||(g.find(".SC_frt").find("li").find("b").removeClass("SC_sel"),$(a.target).closest("b").addClass("SC_sel"),j.changeView(c))}},h={list:{left:{leftHTML:d.workspace.getLeftHeaderHtml.call(this),centerAlign:!0}}};var k;b[0].push(i.list),b[0].setListener("click",i.clk),b[1].push(h.list),b[1].setListener("click",h.clk),b[2].setListener("contextmenu",function(a){zmAttachUtility.createAttContextMenu.call(k,a)}),f[0].setListener("click",zmAttachUtility.closePrevCard.bind(k)),d.workspace.render(),d.workspace.show.call(this),d.workspace.afterRender.call(this);var l=b[0].$el,m=$(l).find(".SC_attDwnZip");$(m).click(function(){var a=j.attListComp.attachUtil.selectedAttachment;zmUtil.downloadSelected(a),setTimeout(function(){d.resetSelectionViewAndData.call(j)},1e3)});var n=$(l).find(".SC_attAttachTo");$(n).click(function(){zmAttachUtility.createShareDropDownMenu({ele:n,clk:d.shareOptionHandler.bind(j)})})},onDelete:function(){return e=null,"function"==typeof this.workspaceConfig.onClose&&this.workspaceConfig.onClose(),d.unsubscribeToEvents.call(this),!0}};var g=function(b){var c=new a(b);return d.subscribeToEvents.call(c),c};b.listingComp={init:g}}(),function(){"use strict";var a=zmail.Core.Namespaces.create("zmAttachUtility");a.attachConstants={AUTHENTICATION_FAILED:10014}}();