!function(a){"use strict";a.call(zmail.Core.Namespaces.create("zmail.Search.Constants"))}(function(){"use strict";this.EVENTS={SEARCH_INIT:"SEARCH_INIT",SEARCH_TAB_CLOSED:"SEARCH_TAB_CLOSED",SEARCH_PAGINATION:"SEARCH_PAGINATION",SEARCH_FILTER_ADD:"SEARCH_FILTER_ADD",SEARCH_FILTER_REMOVE:"SEARCH_FILTER_REMOVE",SEARCH_ACTIVE_FRAMEWORK_INSTANCE:"SEARCH_ACTIVE_FRAMEWORK_INSTANCE",VIEW_CHANGE_FILTER_ADD:"VIEW_CHANGE_FILTER_ADD",VIEW_CHANGE_FILTER_REMOVE:"VIEW_CHANGE_FILTER_REMOVE"},this.KEY_CODES={BACKSPACE:8,SPACE:32,TAB:9,ENTER:13,DOWN_ARROW:40,LEFT_ARROW:37,RIGHT_ARROW:39}}),function(a){"use strict";a.call(zmail.Core.Namespaces.create("zmail.Search.Utils.CommonUtil"),zmail.Core.Namespaces.get)}(function(a){"use strict";var b=a("_");this.escapeRegExp=function(a){return a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},this.isStartsWith=function(){var a=function(a,b,c){return a=(a||"").toLowerCase(),c?a.indexOf(b)>=0:0===a.indexOf(b)};return function(c,d,e,f){return d=(d||"").toLowerCase(),b.isString(c)?a(c,d,f):(e=e||Object.keys(c),b(e).any(function(e){var g=c[e];return b.isString(g)?a(g,d,f):b.isArray(g)?b(g).any(function(b){return a(b,d,f)}):void 0}))}}(),this.getUniqueId=function(){var a=1;return function(){return++a,a}}(),this.selectEndOfNode=function(a,b){var c,d;document.createRange?(c=document.createRange(),c.selectNodeContents(a),c.collapse(b),d=window.getSelection(),d.removeAllRanges(),d.addRange(c)):document.selection&&(c=document.body.createTextRange(),c.moveToElementText(a),c.collapse(b),c.select())},this.selectAllText=function(a){var b;if(document.body.createTextRange)b=document.body.createTextRange(),b.moveToElementText(a),b.select();else if(window.getSelection){var c=window.getSelection();b=document.createRange(),b.selectNodeContents(a),c.removeAllRanges(),c.addRange(b)}},this.getCaretPosition=function(a){var b,c,d=$(a);if("selectionStart"in a)return{position:parseInt(a.selectionStart),length:a.value.length};if(document.selection){c=document.selection.createRange();var e=c.text.length;return c.moveStart("character",-d.val().length),b=c.text.length-e,{position:b,length:b+e}}if("undefined"!=typeof window.getSelection){c=window.getSelection().getRangeAt(0);var f=c.startContainer&&c.startContainer.textContent,g=a.textContent;if(f===g){var h=c.startOffset;return c.startContainer.tagName&&(h=g.length),{position:h,length:g.length}}}}}),function(a){"use strict";a.call(zmail.Core.Namespaces.create("zmail.Search.Utils.InstanceCreator"),zmail.Core.Namespaces.get)}(function(a){"use strict";var b=a("_"),c=function(a){return a.className||a.prototype&&a.prototype.className};this.newInstance=function(a,d){var e;return b.isFunction(a)?e=new a(d):(e=Object.create(a),b.isFunction(e.init)&&e.init(d)),c(e)||(e.className=c(a)),e}}),function(a){"use strict";a.call(zmail.Core.Namespaces.create("zmail.Search.Utils.TypeCreator"),zmail.Core.Namespaces.get)}(function(a){"use strict";var b=a("zmail.Search.Utils.InstanceCreator");this.newType=function(a,c){return c=c||{},c.__isClass=!0,b.newInstance(a,c)}}),function(a){"use strict";a.call(zmail.Core.Namespaces.create("zmail.Search.Utils.DateUtil"))}(function(){"use strict";var a=this.constants={},b=a.minutes={min:1,mins:1,minute:1,minutes:1},c=a.hours={hrs:1,hour:1,hours:1},d=a.years={yrs:1,year:1,years:1},e=a.weeks={week:1,weeks:1},f=a.days={sunday:0,sun:0,monday:1,mon:1,tuesday:2,tue:2,wednesday:3,wed:3,thursday:4,thu:4,friday:5,fri:5,saturday:6,sat:6},g=a.months={january:0,jan:0,february:1,feb:1,march:2,mar:2,april:3,apr:3,may:4,june:5,jun:5,july:6,jul:6,august:7,aug:7,september:8,sep:8,october:9,oct:9,november:10,nov:10,december:11,dec:11},h=function(){return new Date},i=function(a){return a=a||h(),a.setHours(0,0,0,0),a.setHours(23,59,59,0),a},j=function(a,b){return b=b||h().getFullYear(),new Date(b,a+1,0).getDate()};this.minuteAgo=function(a){a=void 0!==a?a:-1;var b=h();return b.setMinutes(b.getMinutes()+a),b},this.hourAgo=function(a,b){return a=void 0!==a?a:-1,b=b||h(),b.setHours(b.getHours()+a),b},this.dayAgo=function(a,b){return a=void 0!==a?a:-1,b=b||i(),b.setDate(b.getDate()+a),b},this.monthAgo=function(a,b){return a=void 0!==a?a:-1,b=b||i(),b.setMonth(b.getMonth()+a),b},this.yearAgo=function(a,b){return a=void 0!==a?a:-1,b=b||i(),b.setFullYear(b.getFullYear()+a),b},this.today=function(){return i()},this.lastDay=function(a){a=a.toLowerCase();var b=h(),c=f[a]-b.getDay();return this.dayAgo(c,b),c>=0&&this.dayAgo(-7,b),i(b)},this.lastWeek=function(){return this.lastDay("sat")},this.lastMonth=function(a){a=a.toLowerCase();var b=h(),c=g[a]-b.getMonth();this.monthAgo(c,b),c>=0&&this.yearAgo(-1,b);var d=j(b.getMonth())-b.getDate();return this.dayAgo(d,b),i(b)},this.last=function(a,h,j){return a in b?this.minuteAgo(h,j):a in c?this.hourAgo(h,j):a in f?this.lastDay(a):a in g?this.lastMonth(a):a in d?this.yearAgo(h,j):a in e?this.lastWeek():i(j)},this.getDateByMonth=function(a,b,c){var d=i();if(a in g){b||(b=d.getFullYear());var e=j(g[a],b);(!c||c<0||c>e)&&(c=e),d=new Date(b,g[a],c)}return{moment:d,str:[a,b,c].join(" ")}}}),function(a){"use strict";a.call(zmail.Core.Namespaces.create("zmail.Search.Integrators"),zmail.Core.Namespaces.get)}(function(a){"use strict";var b=a("_"),c=a("$.publish"),d=a("zmail.Search.Constants.EVENTS"),e=a("zmsuite"),f=a("zmComponent.loadingBand"),g={getUniqueAppId:function(){var a="zm_srch",b=0;return function(){return b+=1,a+b}}()},h=function(a){this.init(a)};h.prototype={defaults:function(){return{tooltip:"Search",tabInfo:{appname:"Search",appId:g.getUniqueAppId(),data:{CNodes:"3"},appIcon:"msi-search",hashKey:"Search",hashChangeHandler:function(b){a("zmUtil.debugLog")("New-Search hashUrl changed",b)},onDelete:function(){return!0}},__paginationBinded:!1,paginateScrollPercentage:60}},overRideDefaultConfig:function(a){return a},getDefaultConfig:function(){var a=this;return this.overRideDefaultConfig({listingAction:{obj:{left:[],right:[{actionArr:[{iconList:["msi-close"],tooltip:"Close"}]}]},eventListeners:[{event:"click",callback:function(b,c){"msi-close"===c&&a.closeWorkspace()}}]},listingHeader:{obj:{left:[],right:[]},eventListeners:[]},previewHeader:{obj:{rIcons:[[{tooltip:"Close Search",iconClass:"msi-close",data:"close"}]]},eventListeners:[{event:"click",callback:function(b){"close"===b&&a.closePreview()}}]}})},init:function(a){b.extend(this,this.defaults(),a);var e=this.tabInfo.onDelete,f=this;return this.tabInfo.onDelete=function(){if(b.isFunction(e)&&e())return f.onDelete(),f.removeLoadingBand(),f.unbindFrameWorkEvents(),f.onWorkSpaceDestruction(),c(d.SEARCH_TAB_CLOSED),!0},this.handlePagination=this.handlePagination.bind(this),this.afterInit(),this},afterInit:b.noop,onDelete:b.noop,onWorkSpaceConstruction:b.noop,onWorkSpaceDestruction:b.noop,initializeFrameWorkNodes:function(a){this.listing=a[0];var b=this.listing.getNodes();this.listingAction=b[0],this.listingHeader=b[1],this.listingCenter=b[2],this.preview=a[1];var c=this.preview.getNodes();return this.previewHeader=c[0],this.previewContent=c[1],this},handlePagination:function(){var a=this.getListingCenterDOM(),b=Math.round(100*(a[0].scrollTop+a.height())/a[0].scrollHeight);b>=this.paginateScrollPercentage&&c(d.SEARCH_PAGINATION)},bindPagination:function(){if(!this.__paginationBinded){this.__paginationBinded=!0;var a=this.getListingCenterDOM();a.on("scroll",this.handlePagination)}return this},unbindPagination:function(){if(this.__paginationBinded){this.__paginationBinded=!1;var a=this.getListingCenterDOM();a.off("scroll",this.handlePagination)}return this},bindFrameWorkEvents:function(a){var c,d,e=function(a){b.isFunction(c.setListener)&&c.setListener(a.event,a.callback)};for(var f in a)c=this[f]||{},d=a[f]||{},b.isFunction(c.push)&&d.obj&&c.push(d.obj),(d.eventListeners||[]).forEach(e);return this.bindPagination(),this},unbindFrameWorkEvents:function(){this.unbindPagination()},constructWorkSpace:function(){return e.setWorkSpace(this.tabInfo),this.initializeFrameWorkNodes(e.getCenter()),this.bindFrameWorkEvents(this.getDefaultConfig()),e.renderWorkSpace(),this.onWorkSpaceConstruction(),this},showWorkSpace:function(){return e.isWorkspaceAvailable(this.tabInfo.appId)||this.constructWorkSpace(),e.showWorkSpace(this.tabInfo.appId),this},closeWorkspace:function(){return e.isWorkspaceAvailable(this.tabInfo.appId)&&e.closeWorkspace(this.tabInfo.appId),this},addLoadingBand:function(a){var b=this.getListingCenterDOM();return b&&void 0===this.loadingBandRemover&&a&&(this.loadingBandRemover=f({container:b[0],notToSetInnerHTML:!0,addAtFirst:!a,type:a?"pagination":"listing"})),this},removeLoadingBand:function(){return this.loadingBandRemover&&(this.loadingBandRemover(),this.loadingBandRemover=void 0),this},isPreviewVisible:function(){return this.preview.$el.hasClass("shw")},getPreviewDOM:function(){return this.preview&&this.preview.$el},getPreviewContentDOM:function(){return this.previewContent&&this.previewContent.$el},getListingCenterDOM:function(){return this.listingCenter&&this.listingCenter.$el},getAppId:function(){return this.tabInfo.appId},showPreview:function(){return this.preview.show(),this},closePreview:function(){return this.preview.close(),this}},this.Framework=h}),function(a){"use strict";a.call(zmail.Core.Namespaces.create("zmail.Search.Mixins"),zmail.Core.Namespaces.get)}(function(a){"use strict";var b=a("_");this.FilterViewMixin={viewClassName:"Filter",viewClass:void 0,spellcheck:!1,setOnAutofillVisible:!1,nullableOnly:!1,removable:!0,filterValues:!0,filterProps:[],autofillSelectionIndex:-1,autofillForElementDebounceTime:0,cssSelectionClass:"sel",cssCompletedStateClass:"zmSBC",cssInCompletedStateClass:"zmSBC",cssInValidStateClass:"zmSBErr",cssAutofillUlClass:"",cssAutofillWrapperClass:"",autofillPageSize:10,autofillOnlyAfter:[],autofillOnlyAfterOperator:"all",autofillNotAfter:[],autofillNotAfterOperator:"any",removeDependentFilters:[],dependedOn:[],deferRemovingOnMultipleInstance:!0,autoComplete:!0,getName:function(){return b.isString(this.name)?this.name:""},getValue:function(){return b.isString(this.value)?this.value:""},autofillDOM:function(a){},autofillText:function(a){return a},onAutofillSelection:function(a,b){this.set(a,{autofillSelection:!0}),b.setValueBasedOnModel().selectEndOfText()}}}),function(a){"use strict";a.call(zmail.Core.Namespaces.create("zmail.Search.Mixins"),zmail.Core.Namespaces.get)}(function(a){"use strict";var b=a("_");this.ValidatorMixin={multipleInstance:!0,restrictedToValues:!1,regexp:void 0,nullable:!1,validateOnSet:!1,validate:function(a){if(!a&&(this.nullableOnly||this.nullable))return!0;if(this.restrictedToValues){var c=this.getValues();if(b.isArray(c))return b(c).contains(a)}else if(this.regexp instanceof RegExp)return this.regex.test(a);return Boolean(a)}}}),function(a){"use strict";a.call(zmail.Core.Namespaces.create("zmail.Search.Models.Filters"),zmail.Core.Namespaces.get)}(function(a){"use strict";var b=a("_"),c=a("Backbone"),d=a("zmail.Search.Constants.EVENTS"),e=this.FilterCollection=function(){return this instanceof e?void this.init():new e};e.prototype={defaults:function(){return{map:{},list:[],classNameList:{}}},init:function(){b.extend(this,this.defaults(),c.Events),this.removeInstance=this.removeInstance.bind(this),this.notifyChange=this.notifyChange.bind(this)},getList:function(a){if(!a)return this.list||[];b.isArray(a)||(a=[a]);var c=this.classNameList;return a.reduce(function(a,b){return a.concat(c[b]||[])},[])},getLength:function(){return this.list.length},add:function(c,e){return void 0===c?this:(b.isArray(c)||(c=[c]),e=e||{},c.reduce(function(c,d){var f=c.classNameList[d.className]||[];return c.classNameList[d.className]=f,f.push(d.id),c.list.push(d.id),c.map[d.id]=d,d.on("change",c.notifyChange),d.on("remove",c.removeInstance),d.on("remove",function(){var e=a("zmail.Search.SearchWatcher").getCurrentContext(),f=d.removeDependentFilters;!b.isEmpty(f)&&b.isArray(f)&&(d.deferRemovingOnMultipleInstance&&c.has(d.className)||(e&&(f=f.filter(function(a){var d=e.getFilterClass(a);return!(d&&!b.isEmpty(d.dependedOn))||b(d.dependedOn).all(function(a){return!c.has(a)})})),b.isEmpty(f)||c.remove(f)))}),c.trigger("add",d,e),c},this),this.trigger(d.VIEW_CHANGE_FILTER_ADD,c,e),e.silent||this.trigger(d.SEARCH_FILTER_ADD,c,e),this)},removeInstance:function(a,c){var e,f=this.classNameList[a.className];return c=c||{},b.isEmpty(f)||(e=f.indexOf(a.id),e!==-1&&f.splice(e,1)),b.isEmpty(this.list)||(e=this.list.indexOf(a.id),e!==-1&&this.list.splice(e,1)),delete this.map[a.id],this.trigger("remove",a,this),this.trigger(d.VIEW_CHANGE_FILTER_REMOVE,this,c),c.silent||this.trigger(d.SEARCH_FILTER_REMOVE,this,c),this},remove:function(a,b){var c=this.getList(a).slice();return b=b||{},c.reduce(function(a,b){var c=a.map[b];return c&&c.remove({silent:!0}),a},this),c&&c.length&&(this.trigger(d.VIEW_CHANGE_FILTER_REMOVE,this,b),b.silent||this.trigger(d.SEARCH_FILTER_REMOVE,this,b)),this},isEmpty:function(){return 0===this.getLength()},has:function(a){return!b.isEmpty(this.classNameList[a])},get:function(a){var b=this;return this.getList(a).reduce(function(a,c){return a.push(b.map[c]),a},[])},toJSON:function(a){return this.get(a).reduce(function(a,b){return b.isValid()&&a.push(b.toJSON()),a},[])},hash:function(){return this.toJSON().map(function(a){return[a.className,a.name,a.value].join(":")}).join("::")},isHashChanged:function(a){var b=this.hash();return void 0!==b&&b!==a},notifyChange:function(a,b,c){this.trigger("change",a,b,c)}};var f=a("zmail.Search");f.Environment=new e}),function(a){"use strict";a.call(zmail.Core.Namespaces.create("zmail.Search.Models.Filters"),zmail.Core.Namespaces.get)}(function(a){"use strict";var b=a("_"),c=a("Backbone"),d=a("$.when"),e=a("$.Deferred"),f=a("zmail.Search.Utils.CommonUtil"),g=a("zmail.Search.Mixins.ValidatorMixin"),h=a("zmail.Search.Mixins.FilterViewMixin"),i=function(a){return this instanceof i?(b.extend(this,this.defaults()),this.extendMixins(),void this.init(a)):new i(a)};i.prototype={className:"BaseFilter",name:void 0,description:"",valueType:void 0,validateValueTpe:!1,notifyingInterval:800,delayNotifyingChange:!0,notifyImmediatelyOnAutoFillSelection:!0,defaults:function(){return{value:void 0,defaultValue:void 0,previousValue:void 0,values:void 0,mixins:[g,h]}},overrideDefaults:function(){return this.restrictedToValues&&this.autofillSelectionIndex===-1&&(this.autofillSelectionIndex=0),this},extendMixins:function(){var a=this.mixins||[];return delete this.mixins,a.reduce(function(a,c){return b.extend(a,c),a},this)},init:function(a){a=a||{};var d=a.__isClass;return delete a.__isClass,b.extend(this,a),this.extendMixins(),d||(b.extend(this,c.Events),this.id=f.getUniqueId(),this.notifyChangeImmediately=this.notifyChangeImmediately.bind(this),this.overrideDefaults().afterInit()),this},afterInit:function(){},onSet:function(){},parse:function(a){return a},set:function(a,b){if(void 0===a||a===this.value)return this;if(!this.validateOnSet||this.validate(a)){if(this.previousValue=this.value,this.value=this.parse(a),b=b||{},!b.silent){var c=this.notifyImmediatelyOnAutoFillSelection&&b.autofillSelection;this.notifyChange(c)}this.onSet(a,b)}return this},isValid:function(){return this.validate(this.value)},equals:function(a){return void 0!==a&&this.className===a.className&&this.toString()===a.toString()},filter:function(a,b){var c=this.filterProps||[];return a=a||[],a.filter(function(a){return f.isStartsWith(a,b,c)})},getDefaultValue:function(){return b.isFunction(this.defaultValue)?this.defaultValue():this.defaultValue},getValues:function(a,c){a=a||"";var f=b.isFunction(this.values)?this.values(a,c):this.values;if(a&&this.filterValues){var g=e(),h=this;return d(f).then(function(b){g.resolve(h.filter(b,a))}),g.promise()}return f},toJSON:function(){return{name:this.getName(),value:this.getValue(),className:this.className,actualValue:this.value,obj:this.value}},toString:function(){var a=this.toJSON();return[a.className,a.name,a.value].join(":")},remove:function(a){this.trigger("remove",this,a),this.off("")},notifyChangeImmediately:function(){clearTimeout(this._timeoutId),this._timeoutId=void 0,this.trigger("change",this.value,this.previousValue,this)},notifyChange:function(a){this.delayNotifyingChange&&!a?(clearTimeout(this._timeoutId),this._timeoutId=setTimeout(this.notifyChangeImmediately,this.notifyingInterval)):this.notifyChangeImmediately()}},this.BaseFilter=i}),function(a){"use strict";a.call(zmail.Core.Namespaces.create("zmail.Search.Models.Contexts"),zmail.Core.Namespaces.get)}(function(a){"use strict";var b=a("_"),c=a("$.Deferred"),d=a("Backbone"),e=a("zmail.Maps.Map"),f=a("zmail.Search.Utils.CommonUtil"),g=a("zmail.Search.Utils.InstanceCreator"),h=a("zmail.Search.Environment"),i=a("zmail.Search.Integrators.Framework"),j=a("zmail.ValueTypeInferrer.TYPE_NAMES"),k=a("zmail.Search.Constants.EVENTS"),l=a("$.publish"),m=function(a){return a.map(function(a){return[a.name,a.value].join(":")}).join("::")},n=function(a){return this instanceof n?(b.extend(this,this.defaults()),void this.init(a)):new n(a)};n.prototype={onReset:b.noop,beforeSearch:b.noop,beforePaginate:b.noop,afterSearch:b.noop,afterPaginate:b.noop,onAdd:b.noop,onChange:b.noop,onRemove:b.noop,onAccountSwitch:b.noop,defaults:function(){return{dependencyPromise:$.Deferred(),contextName:void 0,contextIcon:void 0,defaultFilterClass:void 0,filterClass:[],prioritizedFilterClass:[],names:[],classNames:[],classes:[],classMap:{},classNameMap:{},valueTypeMap:new e,history:[],url:void 0,requestMethod:"post",tabRegexp:void 0,placeholder:"",pageNo:0,pageSize:20,paginationRequestSent:!1,queryHash:void 0,searchOnFilterAdd:!0,searchOnFilterRemove:!0,searchOnFilterChange:!0,showLoadingBandOnRequest:!0}},init:function(a){return b.extend(this,a),this.afterRequest=this.afterRequest.bind(this),this.registerFilterClasses(this.filterClass).afterInit(),this},addHistory:function(a){var b=m(a),c={};if(this.history.forEach(function(a,b){c[m(a)]=b}),b in c){var d=c[b];this.history.splice(d,1)}return this.history.unshift(a),this},isDependencyLoaded:function(){return"resolved"===this.dependencyPromise.state()},registerFilterClasses:function(a){return a=a||[],a.reduce(function(a,b){var c=g.newInstance(b).toJSON();return a.names.push(c.name),a.classNames.push(c.className),a.classNameMap[c.name.toLowerCase()]=c.className,a.classMap[c.name.toLowerCase()]=b,a.classMap[c.name]=b,a.classMap[c.className.toLowerCase()]=b,a.classMap[c.className]=b,a.classes.push(b),b.valueType&&a.valueTypeMap.add(b.valueType,b),a},this)},getFilterValues:function(a){var b=this;return j.reduce(function(c,d){var e=a[d];return e?c.concat(b.valueTypeMap.get(d).reduce(function(a,b){return b.validateValueTpe&&!b.validate(e)||a.push({className:b.name,value:e}),a},[])):c},[])},serializedFilterJSON:function(a,c){b.isString(a)&&(a={className:a});var d,e=a.className||a.name,f=this.classMap[e],g="";return f&&(a.value?d=f.autofillText(a.value,c):c&&b.isEmpty(c.query)&&(d=f.getDefaultValue(),d=d&&f.autofillText(d,c)),g=f.description),{name:e,value:d,description:g}},getDescription:function(a){if(b.isString(a)){var c=this.classMap[a.toLowerCase()]||{};return c.description}},afterInit:function(){},getFilterClassNames:function(){return this.classNames},getFilterClass:function(a){return a=a.toLowerCase(),this.classMap[a]},getFilterNamesBasedOnValue:function(a){a=a||{};var b=a.value,c=a.unique||{};return b?this.applyRules(this.classes.reduce(function(a,d){return d.nullableOnly||d.name in c||!d.validate(b)||(c[d.name]=!0,a.push(d.name)),a},[])):[]},getFilterNames:function(a){a=(a||"").toLowerCase();var b;return a&&(b=new RegExp("\\s+"+f.escapeRegExp(a),"i")),this.names.filter(function(c){return c=c.toLowerCase(),0===c.indexOf(a)||b&&c.match(b)})},applyRules:function(a){a=a||[];var c=this;return a.filter(function(a){var d=a;b.isString(a)||(d=a.name||a.className),d=d.toLowerCase();var e=c.getFilterClass(d);if(!e)return!1;if(e.multipleInstance===!1&&h.has(e.className))return!1;var f=!0;return b.isEmpty(e.autofillNotAfter)||(f=!b(e.autofillNotAfter)[e.autofillNotAfterOperator](function(a){if(h.has(a.className)){if("value"in a&&!b.isEmpty(a.value)){var c=h.get(a.className)[0];return b.isArray(a.value)?b(a.value).contains(c.value):c.value===a.value}return!0}})),f&&!b.isEmpty(e.autofillOnlyAfter)&&(f=b(e.autofillOnlyAfter)[[e.autofillOnlyAfterOperator]](function(a){if(h.has(a.className)){if("value"in a&&!b.isEmpty(a.value)){var c=h.get(a.className)[0];return b.isArray(a.value)?b(a.value).contains(c.value):c.value===a.value}return!0}})),f})},createFilter:function(a,c){b.isObject(a)&&(c=a,a=c.className||c.name,delete c.className,delete c.name,delete c.description),a=(a||"").toLowerCase();var d=this.classMap[a]||this.defaultFilterClass;return g.newInstance(d,c)},getUrl:function(){return b.isFunction(this.url)?this.url():this.url},ajax:function(a){return d.ajax({type:this.requestMethod,url:this.getUrl(),data:a})},beforeRequest:function(a){if(a.paginate?this.beforePaginate():this.beforeSearch(),this.showLoadingBandOnRequest){var b=this.getFrameworkInstance();l(k.SEARCH_ACTIVE_FRAMEWORK_INSTANCE,b),b.showWorkSpace().addLoadingBand(a.paginate)}},afterRequest:function(a,b){a.paginate?this.afterPaginate(a,b):this.afterSearch(a,b)},isHashChanged:function(a){return!b.isEmpty(a)&&a!==this.queryHash},hash:function(a){if(b.isEmpty(a)||b.isString(a))return a;if(b.isObject(a)){var c=b(a).keys().sort();return c.reduce(function(b,c){return b.push([c,JSON.stringify(a[c])].join(":")),b},[]).join("::")}},sendRequest:function(a){a=a||{};var b=c(),d=this.searchQuery(a),e=this.hash(d),f=this;return d&&(a.forceSearch||a.paginate||this.isHashChanged(e))?(a.paginate||(this.paginationRequestSent=!1),this.queryHash=e,a.envHash=h.hash(),this.beforeRequest(a),this.ajax(d).always(function(a){f.getFrameworkInstance().removeLoadingBand()}).then(function(c){h.isHashChanged(a.envHash)?b.reject():(f.afterRequest(a,c),b.resolve(c))},b.reject),b.promise()):b.reject().promise()},search:function(a){var b=this;return this.sendRequest(a).then(function(c){b.addHistory(a.data),a.response=c,b.mountView(a)},function(){h.isEmpty()&&b.closeWorkspace()})},paginate:function(a){if(!this.paginationRequestSent&&this.hasPagination()){this.pageNo+=1,a.paginate=!0,a.pageNo=this.pageNo,a.pageSize=this.pageSize;var b=this;return b.paginationRequestSent=!0,this.search(a).always(function(){b.paginationRequestSent=!1})}return $.Deferred().reject().promise()},mountView:function(a){var b=this.getFrameworkInstance(),c=this;this.dependencyPromise.done(function(){b.showWorkSpace();var d=b.getListingCenterDOM();a.paginate||(c.resetPage(),d.empty());var e=c.getView(a);d.append(e)})},searchQuery:function(a){return a.data},parseHistory:function(a){return a},getView:function(){},hasPagination:function(){},getFrameworkInstance:function(){return void 0===this.frameworkInstance&&(this.frameworkInstance=new i),this.frameworkInstance},active:function(){this.dependencyPromise.resolve()},inactive:function(){this.reset()},resetPage:function(){this.pageNo=0},closeWorkspace:function(){return this.frameworkInstance&&this.frameworkInstance.closeWorkspace(),this},reset:function(){this.resetPage(),this.paginationRequestSent=!1,this.queryHash=void 0,this.onReset()}},this.SearchContext=n}),function(a){"use strict";a.call(zmail.Core.Namespaces.create("zmail.Search.Models.Filters"),zmail.Core.Namespaces.get)}(function(a){"use strict";var b=a("_"),c=a("zmTab"),d=a("zmail.Search"),e=a("zmail.Search.Utils.InstanceCreator"),f=a("zmail.Traverser"),g=["mail","streams","calendar","task","notes","attachment","bookmarks","contacts","quick access","search across zoho"],h=this.ContextFilter=e.newInstance(this.BaseFilter,{className:"ContextFilter",name:"in",delayNotifyingChange:!1,validateOnSet:!0,autoComplete:!1,reOrderContexts:function(){var a=[],c=this.values;g.forEach(function(d){var e=b(c).find(function(a){return a=a.contextID||a.contextName,a.toLowerCase()===d});e&&a.push(e)}),this.values=a,this.traverser.set({list:this.values})},setValueBasedOnTab:function(){var a=this.values[0],d=c.currentTab,e=b(this.values).find(function(a){return a.tabRegexp instanceof RegExp&&a.tabRegexp.test(d)});e||(e=this.value||a),this.set(e)},getContextNames:function(){return b(this.values).map(function(a){return a.contextName})},getContextIDs:function(){return b(this.values).map(function(a){return a.contextID})},getContextOf:function(a){return b(this.values).map(function(b){return b.contextID===a})[0]},afterInit:function(){this.traverser=new f({list:this.values,startIndex:0}),this.setValueBasedOnTab()},onSet:function(a){this.traverser.setIndexOf(a)},select:function(a){var b=this.traverser.traverse(a).value();return this.set(b),this},removable:!1,values:[],autofillSelectionIndex:0,restrictedToValues:!0,filterProps:["contextName"],cssAutofillWrapperClass:"appSwitchDD",autofillDOM:function(a){var b=$(document.createDocumentFragment());return b.__isZohoOneSearch=a.__isZohoOneSearch,b.__specialIconClass=a.__specialIconClass,b.templateType=b.__isZohoOneSearch?"zohoOneSearch":"",b.prepend("<i class='"+a.contextIcon+"' />"),a.__specialIconClass&&b.append('<i class="'+a.__specialIconClass+' SC_frt" />'),b.append(document.createTextNode(a.contextName)),b},autofillText:function(a){return a=a||{},a.contextName||""},getValue:function(){var a=this.value||{};return a.contextName||""}});d.registerContext=function(b,c){if(h.values.push(b),h.reOrderContexts(),c=c||{},!c.silent){var d=a("zmail.Search.Environment"),e=a("zmail.Search.ViewInstance.SearchBox");d&&d.isEmpty()&&e&&e.isEmpty()&&h.setValueBasedOnTab()}},d.getContext=function(a){return h.get(a)},d.setContext=function(a){h.set(a)}}),function(a){"use strict";a.call(zmail.Core.Namespaces.create("zmail.Search.ModeKeeper"),zmail.Core.Namespaces.get)}(function(a){"use strict";var b,c,d=a("_"),e=a("Backbone.Events"),f=this.MODES={SEARCH:"SEARCH",COMMANDS:"COMMANDS",COMMAND_EXECUTION:"COMMAND_EXECUTION"},g=this;d.extend(g,e),this.previousMode=void 0,Object.defineProperty(this,"mode",{get:function(){return c},set:function(a){a in f&&a!==c&&(b=g.previousMode=c,c=a,g.trigger("change",a,b))},enumerable:!1,configurable:!1})}),function(a){"use strict";a.call(zmail.Core.Namespaces.create("zmail.Search.Templates"))}(function(){"use strict";var a=this;this.historyItem=function(a){var b=a.value?": ":"",c=a.nameClass?a.nameClass:"greyText",d=$(["<span>","<span class='"+c+"' >"+a.name+b+"</span>","</span>"].join(""));if(a.value){var e=a.valueClass?a.valueClass:"",f=$("<span class='"+e+"' />");f.text(a.value),d.append(f)}return d},this.history=function(b){var c=$("<div/>"),d=b.length-1;return b.forEach(function(b,e){c.append(a.historyItem(b)),e!==d&&c.append($("<span class='greyText'>, </span>"))}),c}}),function(a){"use strict";a.call(zmail.Core.Namespaces.create("zmail.Search.Templates"))}(function(){"use strict";this.listItem=function(a){var b=a.value?": ":"",c=a.nameClass?a.nameClass:"",d=$(["<div>","<span class='"+c+"' >"+a.name+b+"</span>","</div>"].join(""));if(a.value){var e=a.valueClass?a.valueClass:"",f=$("<span class='"+e+"'/>");f.text(a.value),d.append(f)}return d}}),function(a){"use strict";a.call(zmail.Core.Namespaces.create("zmail.Search.Templates"))}(function(){"use strict";this.filter=function(a){var b=$(["<div class='zmSearchBub'>","<span class='js-fname' tabindex='0' />","<span class='js-fvalue' contenteditable='true'/>","<i class='msi-close' />","</div>"].join("")),c=b.find(".js-fname");c.text(a.name||"");var d=b.find(".js-fvalue");return d.text(a.value||""),{$el:b,$name:c,$value:d,$close:b.find(".msi-close")}}}),function(a){"use strict";a.call(zmail.Core.Namespaces.create("zmail.Search.Templates"))}(function(){"use strict";this.searchBoxContainer=function(){var a=$(["<div class='zmSearch' style='width:500px;' tabindex='0' data-disableShortcuts='true'  >","<div class='js-filters zmSBWrapper'>","<input type='text'   class='zmSearchTB js-searchbox' />","</div>","<i class='msi-close zmSClear' />","<span class='js-loading loadRound' style='display: none;' />","</div>"].join(""));return{$el:a,$filters:a.find(".js-filters"),$searchbox:a.find(".js-searchbox"),$close:a.find(".msi-close"),$loading:a.find(".js-loading")}}}),function(a){"use strict";a.call(zmail.Core.Namespaces.create("zmail.Search.Views"),zmail.Core.Namespaces.get)}(function(a){"use strict";var b=a("_"),c=a("zmail.Paginator"),d=a("zmail.Search.Utils.CommonUtil"),e=a("zmail.Search.Templates"),f=a("zmail.SearchComponents.ListView"),g=a("zmail.Search.Constants.KEY_CODES"),h=/msie|trident|edge/i.test(navigator.userAgent),i={66:1,73:1,85:1},j=this.Filter=function(a){return this instanceof j?void this.init(a):new j(a)};j.prototype={afterInit:b.noop,onShow:b.noop,onHide:b.noop,onSelect:b.noop,onUnselect:b.noop,onAutofillSelection:b.noop,onShowingAutofill:b.noop,beforeRemove:b.noop,onRemove:b.noop,onViewChange:b.noop,onEnter:b.noop,onNameSelect:b.noop,next:b.noop,previous:b.noop,__userInput:!1,__updateTimeoutId:void 0,paginateAutofill:!0,nameAutofill:!1,__bindable:["handleKeyEvent","handleInputAndChangeEvent","handleClickEvent","handleDoubleClickEvent","handleClickEventOnCloseIcon","handleClickEventOnName","handleFocus","triggerChangeEvent","handlePasteEvent","addStateClass","setValueBasedOnModel","removeUI"],bindFunctions:function(){return this.__bindable.reduce(function(a,b){return a[b]=a[b].bind(a),a},this)},init:function(a){a=a||{};var c=a.__isClass;return delete a.__isClass,b.extend(this,a),c||this.bindFunctions().compileTemplate().mount(a.$before).bindNameAutofill().bindAutofill().bindEvents().addStateClass().afterInit(),this},compileTemplate:function(){return this.$els=e.filter(this.filter.toJSON()),this.filter.nullableOnly&&this.$els.$el.addClass("zmSBoB"),!this.filter.spellcheck&&this.$els.$value&&this.$els.$value.attr("spellcheck",!1),this},mount:function(a){return(a||this.$parent)&&this.$els&&(a||(a=this.$parent.find("input")),a.before(this.$els.$el)),this},isVisible:function(){return this.$els.$el.is(":visible")},isAutoFillVisible:function(){if(this.autofill)return this.autofill.isVisible()},isAutoFillSelected:function(){if(this.autofill)return this.autofill.isSelected()},getCaretPosition:function(){return d.getCaretPosition(this.$els.$value[0])},getWidth:function(){return this.isVisible()?this.$els.$el.outerWidth(!0):0},getTop:function(){return this.isVisible()?this.$els.$el.offset().top:0},focusElement:function(){return this.$els.$value&&this.$els.$value[0]},getViewElement:function(){return this.$els.$el},getValue:function(){return this.$els.$value?this.$els.$value.text().trim():""},setValue:function(a){return this.$els.$value&&this.$els.$value.text(a),this},setValueBasedOnModel:function(){return this.setValue(this.filter.getValue())},listenForUser:function(){return clearTimeout(this.__updateTimeoutId),this.__updateTimeoutId=void 0,this},updateModel:function(){var a=this;return this.listenForUser().__updateTimeoutId=setTimeout(function(){a.__userInput&&(a.__userInput=!1,a.filter.set(a.getValue()))},300),this},selectAllText:function(){return this.$els.$value&&d.selectAllText(this.$els.$value[0]),this},selectEndOfText:function(){return this.$els.$value&&d.selectEndOfNode(this.$els.$value[0]),this},show:function(){return this.$els.$el.show(),this.onShow(),this},hide:function(){return this.$els.$el.hide(),this.autofill&&this.autofill.hide(),this._autofill&&this._autofill.hide(),this.onHide(),this},addStateClass:function(){var a=this.filter,b=this.$els.$el;return b.removeClass([a.cssCompletedStateClass,a.cssInCompletedStateClass,a.cssInValidStateClass].join(" ")),void 0!==a.value&&a.value?a.isValid()?b.addClass(a.cssCompletedStateClass):b.addClass([a.cssInCompletedStateClass,a.cssInValidStateClass].join(" ")):a.nullableOnly?b.addClass(a.cssCompletedStateClass):b.addClass(a.cssInCompletedStateClass),this},isValid:function(){return this.filter.isValid()},select:function(){this.$els.$el.addClass(this.filter.cssSelectionClass);var a=this.getValue();return a||this.setValue(""),this._autofill&&this._autofill.reset().hide(),this.autofill&&(!b.isString(this.filter.value)&&this.isValid()&&(a=""),
this.autofill.change(a)),this.$els.$value&&this.$els.$value.focus(),this.onSelect(this),this},unselect:function(){return this.$els.$el.removeClass(this.filter.cssSelectionClass),this.autofill&&this.autofill.reset().hide(),this._autofill&&this._autofill.reset().hide(),this.onUnselect(this),this},handleNavigation:function(a,b){var c=this.getCaretPosition();a===-1&&c&&0===c.position?(b.preventDefault(),this.previous()):1===a&&c&&c.position===c.length&&(b.preventDefault(),this.next())},handleFocus:function(){if(h){var a=this.$els.$value;a.data("before",a.html())}},triggerChangeEvent:function(){if(h){var a=this.$els.$value;a.data("before")!==a.html()&&(a.data("before",a.html()),a.trigger("change"))}},preventFormatting:function(a){var b=a.keyCode;b in i&&(a.ctrlKey||a.metaKey)&&a.preventDefault()},handleKeyEvent:function(a){this.preventFormatting(a);var b=a.keyCode;if(b===g.ENTER)this.autofill&&this.autofill.isSelected()||(a.stopPropagation(),this.onEnter()),a.preventDefault();else if(b===g.DOWN_ARROW)this.autofill.isVisible()||this.autofill.change(this.getValue());else if(b===g.BACKSPACE){var c=$.trim(this.getValue());c||(this.remove(),a.preventDefault()),a.stopPropagation(),a.stopImmediatePropagation()}else b===g.RIGHT_ARROW?this.handleNavigation(1,a):b===g.LEFT_ARROW&&this.handleNavigation(-1,a);this.filter.nullableOnly&&a.preventDefault()},handleClickEvent:function(b){var c=a("zmUtil");c&&"function"==typeof c.hideMenu&&c.hideMenu(!0),this.select(),this.filter.nullableOnly?(this.selectAllText(),b.preventDefault()):this.selectEndOfText(),b.stopPropagation(),b.stopImmediatePropagation()},handleClickEventOnCloseIcon:function(a){this.remove({mouse:!0})},handleClickEventOnName:function(b){var c=a("zmail.Search.SearchWatcher"),d=c.getCurrentContext(),e={value:this.filter.value,unique:{}},f=[];e.unique[this.filter.name]=!0,f=d.getFilterNamesBasedOnValue(e),f.length&&(this.handleClickEvent(b),this.autofill&&this.autofill.reset().hide(),this._autofill&&(this.$els.$name.focus(),this._autofill.change()))},handleDoubleClickEvent:function(){this.selectAllText()},handleInputAndChangeEvent:function(a){return this.filter.nullableOnly?(a.preventDefault(),!1):(this.__userInput=!0,this.filter.setOnAutofillVisible||!this.autofill.isVisible()?this.updateModel():this.listenForUser(),void this.onViewChange())},parsePasteContent:function(a){return b.isString(a)?a.replace(/\n/g," "):a},handlePasteEvent:function(a){var b,c=a.originalEvent||a;c.clipboardData?(b=c.clipboardData.getData("text/plain"),document.execCommand("insertText",!1,this.parsePasteContent(b)),a.preventDefault()):window.clipboardData&&(b=window.clipboardData.getData("Text"),b=this.parsePasteContent(b),document.selection.createRange().pasteHTML(b),a.preventDefault())},resetAutofill:function(){return this.autofill&&this.autofill.reset(),this._autofill&&this._autofill.reset(),this},bindAutofill:function(){var a=this.filter,b=this.$els,d=this;return a.nullableOnly||(this.autofill=new f({doPaginate:this.paginateAutofill,$for:b.$value,$parent:this.$autofillParent,$top:this.$autofillParent,text:a.autofillText.bind(a),dom:a.autofillDOM.bind(a),forElementDebounceTime:a.autofillForElementDebounceTime,selectionStartIndex:a.autofillSelectionIndex,hideOnRemove:!a.removable,removeOnSelect:!1,removeOnEscape:!1,removeOnMouseDown:!1,autoComplete:this.filter.autoComplete,paginator:new c({pageSize:a.autofillPageSize,provider:function(b){return a.getValues(b.query,b)}}),onSelect:function(b){d.__userInput=!1,a.onAutofillSelection(b,d),d.onViewChange(),d.onAutofillSelection(b,d)},onShow:function(){d.listenForUser(),d.onShowingAutofill()},onHide:function(){d.__userInput&&d.updateModel()},ulClass:a.cssAutofillUlClass,wrapperClass:a.cssAutofillWrapperClass}).hide()),this},bindNameAutofill:function(){var b=this;return!this.filter.nullableOnly&&this.nameAutofill&&(this._autofill=new f({$parent:this.$autofillParent,$top:this.$autofillParent,hideOnRemove:!0,onHide:function(){b.resetAutofill()},onSelect:function(a){b.resetAutofill(),b.onNameSelect(a,b)},paginator:new c({pageSize:15,provider:function(){var c=a("zmail.Search.SearchWatcher"),d=c.getCurrentContext();if(d){var e={value:b.filter.value,unique:{}};return e.unique[b.filter.name]=!0,d.getFilterNamesBasedOnValue(e)}return[]}})}).hide()),this},bindEvents:function(){return this.filter.on("change",this.addStateClass).on("remove",this.removeUI),this.$els.$el.on("mousedown",this.handleClickEvent).on("dblclick",this.handleDoubleClickEvent),!this.filter.nullableOnly&&this.nameAutofill&&this.$els.$name.on("mousedown",this.handleClickEventOnName),this.$els.$value&&(this.$els.$value.on("keydown",this.handleKeyEvent).on("paste",this.handlePasteEvent).on("change input",this.handleInputAndChangeEvent),h&&this.$els.$value.on("focus",this.handleFocus).on("keyup paste input",this.triggerChangeEvent)),this.$els.$close&&this.$els.$close.on("mousedown",this.handleClickEventOnCloseIcon),this},unbindEvents:function(){return this.filter.off("change",this.addStateClass).off("remove",this.removeUI),this.$els.$el.off("mousedown",this.handleClickEvent).off("dblclick",this.handleDoubleClickEvent),!this.filter.nullableOnly&&this.nameAutofill&&this.$els.$name.off("mousedown",this.handleClickEventOnName),this.$els.$value&&(this.$els.$value.off("keydown",this.handleKeyEvent).off("paste",this.handlePasteEvent).off("change input",this.handleInputAndChangeEvent),h&&this.$els.$value.off("focus",this.handleFocus).off("keyup paste input",this.triggerChangeEvent)),this.$els.$close&&this.$els.$close.off("mousedown",this.handleClickEventOnCloseIcon),this},removeUI:function(){return this.unbindEvents(),this.autofill&&this.autofill.remove(),this._autofill&&this._autofill.remove(),this.$els.$el.remove(),this.onRemove(),this},remove:function(a){return this.filter.removable?(this.beforeRemove(a),this.removeUI().filter.remove(a)):this.hide(),this}}}),function(a){"use strict";a.call(zmail.Core.Namespaces.create("zmail.Search.Views"),zmail.Core.Namespaces.get)}(function(a){"use strict";var b=a("zmail.Search.Utils.TypeCreator");this.StringFilter=b.newType(this.Filter,{updateModel:function(){return this.filter.set(this.getValue(),{silent:!0}),this.addStateClass(),this}})}),function(a){"use strict";a.call(zmail.Core.Namespaces.create("zmail.Search.Views"),zmail.Core.Namespaces.get)}(function(a){"use strict";var b=a("zmail.Search.Utils.TypeCreator");this.DateFilter=b.newType(this.Filter,{afterInit:function(){this.bindDatePicker()},bindDatePicker:function(){var b=a("ZEVENTS"),c=this;this.picker=b(this.$els.$value[0]).picker("date",{dform:zmail.userDateFormat,wkst:0,mode:"popup",minhgt:251}).on("dateclick",function(){c.filter.set(this.getDate()),c.setValue(c.filter.getValue()).selectEndOfText().addStateClass().onViewChange(),c.onAutofillSelection()});var d=this.$els.$value[0];return d.value="",this.picker._refer=d,this.picker.bind(),this},showPicker:function(){this.picker||this.bindDatePicker(),this.$els.$value.trigger("mousedown")},hidePicker:function(){return this.picker&&(a("ZEVENTS").remove(this.picker),this.picker=void 0),this}})}),function(a){"use strict";a.call(zmail.Core.Namespaces.create("zmail.Search.Views"),zmail.Core.Namespaces.get)}(function(a){"use strict";var b=a("_"),c=a("zmail.Traverser"),d=a("zmail.Search.Constants.EVENTS"),e=a("zmail.Search.Utils.InstanceCreator"),f=function(a){return this instanceof f?void this.init(a):new f(a)};f.prototype={isCollection:!0,onSelect:b.noop,onUnselect:b.noop,onAdd:b.noop,onRemove:b.noop,beforeRemove:b.noop,onViewChange:b.noop,onAutofillSelection:b.noop,onEnter:b.noop,onNameClick:b.noop,onNameSelect:b.noop,defaults:function(){return{list:[],map:{},traverser:new c}},__bindable:["add","remove","handleViewSelection"],bindFunctions:function(){return this.__bindable.reduce(function(a,b){return a[b]=a[b].bind(a),a},this)},init:function(a){return b.extend(this,this.defaults(),a),this.traverser.set({list:this.list}),this.bindFunctions().bindEvents()},bindEvents:function(){this.model.on("add",this.add).on(d.VIEW_CHANGE_FILTER_ADD,this.onAdd).on("remove",this.remove).on(d.VIEW_CHANGE_FILTER_REMOVE,this.onRemove)},unbindEvents:function(){this.model.off("add",this.add).off(d.SEARCH_FILTER_ADD,this.onAdd).off("remove",this.remove).off(d.SEARCH_FILTER_REMOVE,this.onRemove)},getIndexOf:function(a){return this.list.indexOf(a)},getViewElement:function(a){if(void 0!==a&&a<this.getLength()){var b=this.list[a];if(b)return b.getViewElement()}},getViewInstance:function(b,c){var d=b.viewClass;if(!d){var f=b.viewClassName;d=a(f)||a("zmail.Search.Views."+f)||a("zmail.Search.Views.Filter")}return c=c||{},e.newInstance(d,{nameAutofill:!0,filter:b,$parent:this.$parent,$before:this.getViewElement(c.position),$autofillParent:this.$autofillParent,onEnter:this.onEnter,onSelect:this.handleViewSelection,onViewChange:this.onViewChange,onAutofillSelection:this.onAutofillSelection,beforeRemove:this.beforeRemove,previous:this.previous,next:this.next,onNameSelect:this.onNameSelect})},getView:function(a){return this.map[a]},getSelectedView:function(){return this.traverser.value()},add:function(a,c){return b.isArray(a)||(a=[a]),a.reduce(function(a,b){var d=a.getViewInstance(b,c);return d.selectEndOfText(),a.traverser.add(d),a.map[b.id]=d,a},this)},remove:function(a){return b.isArray(a)||(a=[a]),a.reduce(function(a,b){var c=a.map[b.id];return c&&(delete a.map[b.id],a.traverser.remove(c)),a},this)},getWidth:function(){var a,b=this.list||[];return b.reduce(function(b,c){var d=c.getWidth();if(d>0){var e=c.getTop();e!==a?b=d:b+=d,a=e}return b},0)},getLength:function(){return this.list.length},isEmpty:function(){return 0===this.getLength()},isSelected:function(){return this.traverser.index!==-1},isVisible:function(){return!this.isEmpty()},isAutoFillVisible:function(){var a=this.getSelectedView();return a&&a.isAutoFillVisible()},isAutoFillSelected:function(){var a=this.getSelectedView();return a&&a.isAutoFillSelected()},handleViewSelection:function(a){var b=this.traverser.value();b!==a&&(this.traverser.setIndexOf(a),b&&b.unselect()),this.onSelect(this)},unselectView:function(){var a=this.traverser.value();return a&&a.unselect(),this},selectView:function(a){return a=this.map[a]||a,a&&a.select(),this},unselect:function(){return this.unselectView().traverser.resetIndex(),this.onUnselect(this),this},focusElement:function(){var a=this.traverser.value();return a&&a.focusElement()},select:function(a){return this.unselectView(),this.selectView(this.traverser.traverse(a).value()),this.onSelect(this),this},selectAllText:function(){var a=this.traverser.value();return a&&a.selectAllText&&a.selectAllText(),this},selectEndOfText:function(){var a=this.traverser.value();return a&&a.selectEndOfText(),this},selectPrevious:function(){return this.select(-1)},selectNext:function(a){return this.select(1)},selectFirst:function(){return this.selectView(this.traverser.first().value())},isFirstSelected:function(){return this.traverser.value()===this.list[0]},selectLast:function(){return this.selectView(this.traverser.last().value())},isLastSelected:function(){return this.traverser.value()===this.list[this.list.length-1]}},this.FilterCollection=f}),function(a){"use strict";a.call(zmail.Core.Namespaces.create("zmail.Search.Views"),zmail.Core.Namespaces.get)}(function(a){"use strict";var b=a("_"),c=a("zmail.Search.Utils.CommonUtil"),d=a("zmail.Search.ModeKeeper"),e=a("zmail.Search.Constants.KEY_CODES"),f="default",g=this.SearchBox=function(a){return this instanceof g?void this.init(a):new g(a)};g.prototype={defaults:function(){return{modeHandlers:{},stringHandlers:{}}},minWidth:50,maxWidth:500,placeholder:b.noop,onSelect:b.noop,onUnselect:b.noop,onBackspace:b.noop,autoSize:b.noop,next:b.noop,previous:b.noop,onChange:b.noop,__bindable:["handleKeyDownEvent","handleClickEvent","handleKeyUpEvent","handleInputChangeEvent","ignoreMouseDownEvent","handleModeChange","autoSize"],bindFunctions:function(){return this.__bindable.reduce(function(a,b){return a[b]=a[b].bind(a),a},this)},init:function(a){return b.extend(this,this.defaults(),a),Object.defineProperty(this,"autofill",{get:function(){var a=this.modeHandlers[d.mode]||{};return b.isFunction(a.autofill)&&a.autofill()}}),this.bindFunctions().bindEvents().bindAutofill().setPlaceholder()},parser:function(a,b){return!1},delegate:function(a,c){var d=this.stringHandlers[a];return!(!d||b.result(d,"isSafe")!==!0)&&(d.action(c,this),!0)},registerStringHandler:function(a,b){return this.stringHandlers[a]=b,this},registerModeHandler:function(a,b){return this.modeHandlers[a]=b,this},getWidth:function(){return 10},setWidth:function(a){return this.$el.css("width",a+"px"),this},resize:function(a){var b=a%this.maxWidth,c=this.maxWidth-b;return c<=this.minWidth&&(c=this.maxWidth),this.setWidth(c)},isActiveElement:function(){var a=document.activeElement;return void 0!==a&&a===this.$el[0]},setPlaceholder:function(a){if(void 0===a){var c=this.modeHandlers[d.mode]||{},e=b.result(c,"placeholder");void 0!==e&&this.$el.attr("placeholder",e)}else this.$el.attr("placeholder",a);return this},getText:function(){return this.$el.val()},isEmpty:function(){return b.isEmpty(this.getText())},setText:function(a){return this.$el.val(a),this},clearText:function(){return this.setText("")},focusElement:function(){return this.$el&&this.$el[0]},focus:function(){this.$el.focus(),this.onSelect(this)},blur:function(){this.$el.blur(),this.onUnselect(this)},select:function(){return this.$el&&(this.autofill&&this.autofill.change(this.$el.val()),this.focus()),this},selectAllText:function(){return this},selectEndOfText:function(){return this},unselect:function(){return this.autofill&&(this.resetAutofill(),this.autofill.hide()),this.blur(),this},stopEvent:function(a){return a.stopPropagation(),a.stopImmediatePropagation(),this},preventEvent:function(a){return a.preventDefault(),this},handleModeChange:function(){return this.clearText().setPlaceholder().unbindPreviousAutofill().bindAutofill().resetAutofill()},handleInputChangeEvent:function(a){this.isActiveElement()&&this.parser(this.getText())&&this.stopEvent(a),this.onChange()},ignoreMouseDownEvent:function(a){return a.target===this.$el[0]},handleClickEvent:function(b){var c=a("zmUtil");c&&"function"==typeof c.hideMenu&&c.hideMenu(!0),this.select(),b.preventDefault(),b.stopPropagation(),b.stopImmediatePropagation()},getCaretPosition:function(){return c.getCaretPosition(this.$el[0])},handleKeyDownEvent:function(a){var b,c=a.keyCode,d=this.$el.val()||"";c!==e.BACKSPACE||d?c!==e.DOWN_ARROW||this.isAutoFillVisible()?c===e.ENTER?(d=d.trim(),this.isAutoFillVisible()||(this.delegate(f,{value:d}),this.preventEvent(a).stopEvent(a))):c===e.RIGHT_ARROW?(b=this.getCaretPosition(),b&&b.position===b.length&&(a.preventDefault(),this.next())):c===e.LEFT_ARROW&&(b=this.getCaretPosition(),b&&0===b.position&&(a.preventDefault(),this.previous())):(this.autofill.change(this.$el.val()),this.stopEvent(a)):(this.onBackspace(),this.preventEvent(a).stopEvent(a))},handleKeyUpEvent:function(a){var b=$.trim(this.$el.val());b!==f&&this.delegate(b,b)&&this.preventEvent(a).stopEvent(a)},isAutoFillVisible:function(){return this.autofill&&this.autofill.isVisible()},isAutoFillSelected:function(){return this.autofill&&this.autofill.isSelected()},hideAutofill:function(){return this.isAutoFillVisible()&&this.autofill.hide(),this},resetAutofill:function(){return this.autofill&&this.autofill.reset(),this},bindAutofill:function(){var a=this.modeHandlers[d.mode];return a&&a.autofill().bind(),this},unbindAutofill:function(){var a=this.modeHandlers[d.mode];return a&&a.autofill().unbind(),this},unbindPreviousAutofill:function(){var a=this.modeHandlers[d.previousMode];return a&&a.autofill().unbind(),this},bindEvents:function(){return this.$el&&(this.$el.on("keydown",this.handleKeyDownEvent).on("keyup",this.handleKeyUpEvent).on("mousedown",this.handleClickEvent).on("change input",this.handleInputChangeEvent).on("blur",this.handleBlur),d.on("change",this.handleModeChange)),this},unbindEvents:function(){return this.$el&&(this.$el.off("keydown",this.handleKeyDownEvent).off("keyup",this.handleKeyUpEvent).off("mousedown",this.handleClickEvent).off("change input",this.handleInputChangeEvent).off("blur",this.handleBlur),d.off("change",this.handleModeChange)),this}}}),function(a){"use strict";a.call(zmail.Core.Namespaces.create("zmail.Search.Views"),zmail.Core.Namespaces.get)}(function(a){"use strict";var b=a("_"),c=a("zmail.Search.Templates"),d=a("zmail.Traverser"),e=a("zmail.Search.Constants.KEY_CODES"),f="ZMAIL_MOUSE_DOWN_EVENT",g=function(a){return this instanceof g?void this.init(a):new g(a)};g.prototype={defaults:function(){return{$parent:$("#ztb-container"),list:[],traverser:new d}},__bindable:["handleMouseDownEvent","handleKeyEvent","handleViewSelection","handleExpandCollapse"],handleCloseIconClickEvent:b.noop,onMouseDown:b.noop,expandSearch:function(){this.$els.$el.addClass("zmSFocus")},collapseSearch:function(){this.$els.$el.removeClass("zmSFocus")},focusElement:function(){return this.$els.$el[0]},handleExpandCollapse:function(a,b,c){if(c)this.expandSearch();else{c=this.traverser.value();var d=this.focusElement(),e=c&&c.focusElement(),f=b&&b.target;f=f||document.activeElement,void 0===f||f!==e&&f!==d?(this.collapseSearch(),this.unselect()):this.expandSearch()}},bindFunctions:function(){return this.__bindable.reduce(function(a,b){return a[b]=a[b].bind(a),a},this)},init:function(a){return b.extend(this,this.defaults(),a),this.traverser.set({list:this.list}),this.bindFunctions().compileTemplate().mount().bindEvents().hideCloseIcon()},add:function(a){return a.onSelect=this.handleViewSelection,this.traverser.add(a),this},compileTemplate:function(){return this.$els=c.searchBoxContainer(),this},mount:function(){return $("#zm_centerHolder").after(this.$els.$el),this},getWidth:function(){var a=this.list||[];return a.reduce(function(a,b){return a+=b.getWidth()},0)},getSelectedView:function(){var a=this.traverser.value();return a&&a.isCollection?a.getSelectedView():a},isAutoFillVisible:function(){var a=this.getSelectedView();return a&&a.isAutoFillVisible()},isAutoFillSelected:function(){var a=this.getSelectedView();return a&&a.isAutoFillSelected()},hasChildren:function(){return this.traverser.list.length>0},selectView:function(a,b){return!(!a||!a.select||void 0!==a.isVisible&&!a.isVisible())&&(a.select(b),1!==b&&a.selectEndOfText(),!0)},unselect:function(){var a=this.traverser.value();return a&&a.unselect(),this},select:function(a){var b=this.traverser.value();if(b&&b.isCollection&&(a===-1&&!b.isFirstSelected()||1===a&&!b.isLastSelected()))return this.selectView(b,a),this;b&&b.unselect();var c=this.traverser.traverse(a).value();return this.hasChildren()&&!this.selectView(c,a)&&this.select(a),this},selectAllText:function(){var a=this.traverser.value();return a&&a.selectAllText&&a.selectAllText(),this},handleKeyEvent:function(a){var b=a.keyCode;b!==e.TAB||this.isAutoFillSelected()||(this.select(a.shiftKey?-1:1),a.preventDefault())},handleMouseDownEvent:function(a){this.onMouseDown(),a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation()},showCloseIcon:function(){return this.$els.$loading.is(":visible")||this.$els.$close.show(),this},hideCloseIcon:function(){return this.$els.$close.hide(),this},hideLoading:function(){return this.$els.$loading.hide(),this},showLoading:function(){return this.$els.$loading.show(),this.hideCloseIcon()},handleViewSelection:function(a){var b=this.traverser.value();b!==a&&(this.traverser.setIndexOf(a),b&&b.unselect()),this.handleExpandCollapse(void 0,void 0,a)},bindEvents:function(){return this.$els.$el.on("keydown",this.handleKeyEvent).on("mousedown",this.handleMouseDownEvent).on("focus blur",this.handleExpandCollapse),this.$els.$close.on("click",this.handleCloseIconClickEvent),$.subscribe(f,this.handleExpandCollapse),this},unbindEvents:function(){return this.$els.$el.off("keydown",this.handleKeyEvent).off("mousedown",this.handleMouseDownEvent).off("focus blur",this.handleExpandCollapse),this.$els.$close.off("click",this.handleCloseIconClickEvent),$.unsubscribe(f,this.handleExpandCollapse),this}},this.SearchBoxContainer=g}),function(a){"use strict";a.call(zmail.Core.Namespaces.create("zmail.Search"),zmail.Core.Namespaces.get)}(function(a){"use strict";var b=a("_"),c=a("$.when"),d=a("zmail.Search.Models.Filters.ContextFilter"),e=a("zmail.Search.Environment"),f=a("zmail.Search.Constants.EVENTS"),g=a("$.subscribe"),h=a("$.unsubscribe"),i=!1;this.SearchWatcher={userChangedContext:function(){return i=!0,this},history:[],server:[],frameworks:[],__bindable:["handleContextChange","handleTabClose","handleTabSwitch","handleActiveFrameworkInstance","handleAccountSwitch","handlePagination"],bindFunctions:function(){return this.__bindable.reduce(function(a,b){return a[b]=a[b].bind(a),a},this)},init:function(){this.bindFunctions().beginWatch()},addToHistory:function(a){return this.getCurrentContext().history.unshift(a),this},removeFromHistory:function(a){return this.getCurrentContext().history.splice(a,1),this},addToServer:function(a){return this.server.push(a),this},removeFromServer:function(a){return this.server.splice(a,1),this},getCurrentContext:function(){return d.value},getPreviousContext:function(){return d.previousValue},getUsableFilters:function(){var a=this.getCurrentContext(),b=e.toJSON();return b.reduce(function(b,c){var d=a.getFilterClass(c.name);return d&&d.validate(c.value)&&b.push(a.createFilter({name:c.name,value:c.value})),b},[])},handleContextChange:function(){var b=this.getPreviousContext(),c=this.getUsableFilters();b&&(e.remove(),b.reset(),b.inactive());var d=this.getCurrentContext();if(d){d.active();var f=d.getFrameworkInstance();f&&this.frameworks.push(f),c.length&&(e.add(c),setTimeout(function(){var b=a("zmail.Search.ViewInstance.SearchBox");b.resetAutofill().hideAutofill()},20))}},handleActiveFrameworkInstance:function(a,b){var c=this.frameworks,d=c.slice();d.forEach(function(a){if(a!==b){a.closeWorkspace();var d=c.indexOf(a);c.splice(d,1)}})},handleTabSwitch:function(){e.isEmpty()&&!i&&d.setValueBasedOnTab(),i=!1},handleAccountSwitch:function(a,b){var c=this.getCurrentContext();c&&b&&c.onAccountSwitch(b.accountID)},search:function(b){if(b=b||{},b.data=e.toJSON(),b.data.length){var d=this.getCurrentContext();if(b.paginate)return void d.paginate(b);var f=a("zmail.Search.ViewInstance.SearchBoxContainer");f.showLoading(),c(d.search(b)).always(function(){f.hideLoading();var b=a("zmail.Search.ViewInstance.SearchBox");e.isEmpty()&&b.isEmpty()?f.hideCloseIcon():f.showCloseIcon()})}},forceSearch:b.debounce(function(){this.search({forceSearch:!0})},2e3,!0),handlePagination:function(){this.search({paginate:!0})},handleTabClose:function(){var a=this.getCurrentContext();a&&a.reset()},beginWatch:function(){var a=this;d.on("change",this.handleContextChange),g("/apps/tabSwitched",this.handleTabSwitch),g("/mail/accountSwitch",this.handleAccountSwitch),g(f.SEARCH_ACTIVE_FRAMEWORK_INSTANCE,this.handleActiveFrameworkInstance),e.on(f.SEARCH_FILTER_ADD,function(b){var c=a.getCurrentContext();c&&(c.onAdd(b),c.searchOnFilterAdd&&a.search())}),e.on(f.SEARCH_FILTER_REMOVE,b.debounce(function(b){var c=a.getCurrentContext();c&&(c.onRemove(b),c.searchOnFilterRemove&&!e.isEmpty()&&a.search(),e.isEmpty()&&c.reset())},2e3,!0)),e.on("change",function(b,c,d){var e=a.getCurrentContext();e&&(e.onChange(d),e.searchOnFilterChange&&a.search())}),g(f.SEARCH_PAGINATION,this.handlePagination),g(f.SEARCH_TAB_CLOSED,this.handleTabClose)},unbindEvents:function(){d.off("change",this.handleContextChange),e.off(f.SEARCH_FILTER_ADD).off(f.SEARCH_FILTER_REMOVE).off("change"),h(f.SEARCH_TAB_CLOSED,this.handleTabClose),h(f.SEARCH_PAGINATION,this.handlePagination),h("/apps/tabSwitched",this.handleTabSwitch),h("/mail/accountSwitch",this.handleAccountSwitch),h(f.SEARCH_ACTIVE_FRAMEWORK_INSTANCE,this.handleActiveFrameworkInstance)}}}),function(a){"use strict";a.call(zmail.Core.Namespaces.create("zmail.Search.Models.Filters"),zmail.Core.Namespaces.get)}(function(a){"use strict";var b=a("_"),c=a("zmail.Search.Utils.TypeCreator"),d=a("zmail.ValueTypeInferrer.TYPES");this.StringFilter=c.newType(this.BaseFilter,{name:"string",className:"StringFilter",viewClassName:"StringFilter",valueType:d.String.name,validate:function(a){return b.isString(a)},getValue:function(){return this.value},autofillText:function(a){if(b.isString(a))return a}})}),function(a){"use strict";a.call(zmail.Core.Namespaces.create("zmail.Search.Models.Filters"),zmail.Core.Namespaces.get)}(function(a){"use strict";var b=a("_"),c=a("zmail.Search.Utils.TypeCreator"),d=a("zmail.ContactBook"),e=a("zmail.ValueTypeInferrer.TYPES"),f=this.StringFilter;this.ContactFilter=c.newType(f,{name:"contact",className:"ContactFilter",valueType:e.Contact.name,filterValues:!1,values:function(a,c){return b.isEmpty(a)?d.getMostUsedContacts():d.get({includeEmailedGroups:!0,str:a})},validate:function(a){return d.isContact(a)||d.isGroup(a)||f.validate(a)},getValue:function(){var a=this.value||"";return b.isString(a)?a:d.isContact(a)?a.get("eid")||a.name:d.isGroup(a)?a.get("eid")||a.get("name"):d.isCategory(a)?a.get("cname"):void 0},autofillText:function(a,c){if(b.isString(a))return a;if(d.isContact(a)){var e=c&&c.query;return a.getMatchingName(e)||a.name}return d.isGroup(a)?a.get("eid")||a.get("name"):d.isCategory(a)?a.get("cname"):void 0},autofillDOM:function(a,b){return a.view(b&&b.query)}})}),function(a){"use strict";a.call(zmail.Core.Namespaces.create("zmail.Search.Models.Filters"),zmail.Core.Namespaces.get)}(function(a){"use strict";var b=a("zmail.Search.Utils.TypeCreator"),c=a("zmail.ValueTypeInferrer.TYPES"),d=b.newType(this.BaseFilter,{name:"date",spellcheck:!1,className:"DateFilter",description:"a date",viewClassName:"DateFilter",value:void 0,multipleInstance:!0,validateOnSet:!0,validate:function(a){if(a)return a instanceof Date||a.__date},getValue:function(){return this.value instanceof Date?this.value.getDateBy(zmail.userDateFormat):this.value&&this.value.__date?this.value.display:void 0},toJSON:function(){var a=this.value;return a&&a.__date&&(a=c.Date.toDate(a)),{name:this.getName(),value:this.getValue(),className:this.className,actualValue:a,obj:a}}});this.DateFilter=d}),function(a){"use strict";a.call(zmail.Core.Namespaces.create("zmail.Search.Models.Filters"),zmail.Core.Namespaces.get)}(function(a){"use strict";var b=a("zmail.Search.Utils.TypeCreator"),c=a("zmail.ValueTypeInferrer.TYPES"),d=c.Date,e=this.DateFilter;this.FromDateFilter=b.newType(e,{name:"from date",className:"FromDateFilter",description:"from this date",multipleInstance:!1,valueType:c.Date.name,validate:function(b){if(e.validate(b)){var c=a("zmail.Search.Environment");if(c.has("ToDateFilter")){var f=c.get("ToDateFilter")[0].toJSON().actualValue;return!!e.validate(f)&&d.toDate(b).getTime()<f.getTime()}return!0}return!1},autofillText:function(a){return a.display}})}),function(a){"use strict";a.call(zmail.Core.Namespaces.create("zmail.Search.Models.Filters"),zmail.Core.Namespaces.get)}(function(a){"use strict";var b=a("zmail.Search.Utils.TypeCreator"),c=a("zmail.ValueTypeInferrer.TYPES"),d=c.Date,e=this.DateFilter;this.ToDateFilter=b.newType(this.DateFilter,{name:"till date",className:"ToDateFilter",description:"till this date",multipleInstance:!1,valueType:c.Date.name,validate:function(b){if(e.validate(b)){var c=a("zmail.Search.Environment");if(c.has("FromDateFilter")){var f=c.get("FromDateFilter")[0].toJSON().actualValue;return!!e.validate(f)&&d.toDate(b).getTime()>f.getTime()}return!0}return!1},autofillText:function(a){return a.display}})}),function(a){"use strict";a.call(zmail.Core.Namespaces.create("zmail.Search.Views"),zmail.Core.Namespaces.get)}(function(a){"use strict";var b=a("_");this.registerSearchModeHandler=b.once(function(){var c=a("zmail.Paginator"),d=a("zmail.Commander"),e=a("zmail.ValueTypeInferrer"),f=a("zmail.Search.Templates"),g=a("zmail.SearchComponents.ListView"),h=a("zmail.Search"),i=a("zmail.Search.SearchWatcher"),j=a("zmail.Search.ModeKeeper"),k=a("zmail.Search.Environment"),l=a("zmail.Search.ViewInstance.SearchBox"),m=a("zmail.Search.ViewInstance.SearchBoxContainer"),n=a("zmail.Search.ViewInstance.ContextFilterView"),o=a("zmail.Search.ViewInstance.FilterCollectionView"),p=function(){var a=i.getCurrentContext();if(a){var c=a.prioritizedFilterClass;return c=b.isEmpty(c)?a.filterClass.slice(0,3):c,c.map(function(a){return{name:a.name,value:a.getDefaultValue()}})}return[]},q=function(){var a=i.getCurrentContext();if(a){var b=(a.history||[]).slice(0,10);return b.map(function(a){return{type:"history",value:a}})}return[]},r=function(){var a=[],b=p();b.length&&(a.push({templateType:"separator"}),a=a.concat(b));var c=q();return c.length>0&&(a.push({templateType:"separator"}),a.push({templateType:"header",str:"History"}),a=a.concat(c)),a},s=function(a){var b=i.getCurrentContext(),c=[],f=[],g=[],h=[];if(b){var j=a.query;c=b.applyRules(b.getFilterNames(j)),j=j.trim();var l=e.infer(j);return f=b.applyRules(b.getFilterValues(l)),k.isEmpty()&&(h=d.getCommandsBasedOnTypes(l),h=h.concat(d.get(j).slice(0,5)),h.length&&(h.unshift({templateType:"header",str:"Quick Access"}),(c.length||f.length)&&h.unshift({templateType:"separator"}),c=c.slice(0,5),f=f.slice(0,15))),c.length&&f.length&&f.unshift({templateType:"separator"}),g=g.concat(c,f,h)}return[]};l.registerModeHandler(j.MODES.SEARCH,{_autofill:void 0,action:function(a){if(a=a||{value:l.getText()},"history"===a.type)i.getCurrentContext().reset(),h.newSearch(a.value.map(function(a){return{className:a.className,value:a.actualValue}})),b.defer(function(){l.focus()});else{if(d.isSerializedCommand(a))return d.execute(a.command,a.value),void l.clearText().autoSize();if(b.isString(a)||a.value||a.name||a.className){var c=i.getCurrentContext().createFilter(a);k.add(c),n.setValueBasedOnModel(),b.defer(function(){c.nullableOnly||a.value?l.focus():o.selectView(c.id)})}else a&&(a.value||a.name||a.className)||i.forceSearch()}l.setPlaceholder().clearText().autoSize()},placeholder:function(){var a=i.getCurrentContext()||{};return b.result(a,"placeholder")},autofill:function(){return this._autofill||(this._autofill=new g({forElementDebounceTime:0,$for:l.$el,$parent:m.$els.$el,$top:m.$els.$el,hideOnRemove:!0,onSelect:function(a){l.delegate("default",a)},ignoreMouseDownEvent:l.ignoreMouseDownEvent,paginator:new c({pageSize:15,provider:function(a){return a.query||!k.isEmpty()?s(a):r(a)}}),dom:function(a,b){if(a.templateType)return a;if(d.isSerializedCommand(a))return f.listItem({name:a.description,value:a.displayValue});if("history"===a.type){var c=a.value.slice();return c.unshift({name:"in",value:i.getCurrentContext().contextName}),f.history(c)}var e=i.getCurrentContext().serializedFilterJSON(a,b);return e?(e.value?e.nameClass="greyText":(e.value=e.description,e.valueClass="greyText"),f.listItem(e)):void 0}}).unbind()),this._autofill}})})}),function(a){"use strict";a.call(zmail.Core.Namespaces.create("zmail.Search.Views"),zmail.Core.Namespaces.get)}(function(a){"use strict";var b=a("_");this.registerCommandModeHandler=b.once(function(){var b=a("zmail.Paginator"),c=a("zmail.Commander"),d=a("zmail.Commander.Views"),e=a("zmail.SearchComponents.ListView"),f=a("zmail.Search.ModeKeeper"),g=a("zmail.Search.ViewInstance.SearchBox"),h=a("zmail.Search.ViewInstance.SearchBoxContainer"),i=a("zmail.ValueTypeInferrer"),j=a("zmail.Search.Templates");g.registerModeHandler(f.MODES.COMMANDS,{_autofill:void 0,action:function(a){a.__command&&(c.execute(a.command,a.value),d.reset())},placeholder:function(){return""},autofill:function(){return this._autofill||(this._autofill=new e({forElementDebounceTime:0,$for:g.$el,$parent:h.$els.$el,$top:h.$els.$el,hideOnRemove:!0,selectionStartIndex:0,onSelect:function(a){g.delegate("default",a)},text:function(a,b){return a.description},paginator:new b({pageSize:10,provider:function(a){var b=i.infer(a.query),d=c.getCommandsBasedOnTypes(b);return d.concat(c.get(a.query||""))}}),dom:function(a){if(c.isSerializedCommand(a))return j.listItem({
name:a.description,value:a.displayValue})}}).unbind()),this._autofill}})})}),function(a){"use strict";a.call(zmail.Core.Namespaces.create("zmail.Search.Views"),zmail.Core.Namespaces.get)}(function(a){"use strict";var b=a("_"),c=a("zmail.Search.Constants.EVENTS"),d=a("$.subscribe"),e=a("$.publish"),f=a("zmail.Commander.Views"),g=a("zmail.Search"),h=a("zmail.Search.ModeKeeper"),i=a("zmail.Search.Environment"),j=a("zmail.Search.SearchWatcher"),k=a("zmail.Search.ModeKeeper.MODES"),l=a("zmail.Search.Models.Filters.ContextFilter"),m=zmail.Core.Namespaces.create("zmail.Search.ViewInstance"),n=/zm-settings|settings/i,o=this;g.addToSearch=function(c,d){b.isArray(c)||(c=[c]),d=d||{};var e=l.value;h.mode=k.SEARCH,j.getCurrentContext().reset(),d.newSearch&&g.Environment.remove(),g.Environment.add(c.reduce(function(a,b){return a.push(e.createFilter(b)),a},[]),d),a("zmail.Search.ViewInstance.SearchBox").focus()},g.newSearch=function(b,c){c=c||{},c.newSearch=!0,g.addToSearch(b,c),setTimeout(function(){a("zmail.Search.ViewInstance.SearchBoxContainer").unselect().collapseSearch()})},g.focusSearchBox=function(){h.mode=h.MODES.SEARCH,a("zmail.Search.ViewInstance.SearchBox").select()},g.focusCommandBox=function(){h.mode=h.MODES.COMMANDS,a("zmail.Search.ViewInstance.SearchBox").select()},this.ConstructSearchView=b.once(function(){var g,p,q,r;p=m.SearchBoxContainer=new o.SearchBoxContainer({handleCloseIconClickEvent:function(){i.remove(),g.clearText().resetAutofill().select(),p.hideCloseIcon()},onMouseDown:function(){g.select()}}),g=m.SearchBox=new o.SearchBox({$el:p.$els.$searchbox,$leftParent:p.$els.$searchbox,$topParent:p.$els.$el,maxWidth:p.$els.$el.width()-50,next:function(){p.select(1)},previous:function(){p.select(-1)},parser:function(a){},autoSize:function(){return this.resize(p.getWidth())},onBackspace:function(){i.isEmpty()||p.select(-1).selectAllText()},onChange:function(){this.isEmpty()&&i.isEmpty()?p.hideCloseIcon():p.showCloseIcon()}}),f.init(),q=m.ContextFilterView=new o.Filter({$autofillParent:p.$els.$el,filter:l,$parent:p.$els.$filters,onShow:g.autoSize,paginateAutofill:!1,handleNavigation:function(a){p.select(a)},onAutofillSelection:function(){b.defer(function(){g.select()})},onShowingAutofill:function(){if(this.autofill){var a=this.autofill.traverser;a.setIndexOf(j.getCurrentContext())}},select:function(){return this.$els.$el.addClass(this.filter.cssSelectionClass),this.$els.$value&&this.$els.$value.focus(),this.autofill.change(""),this.onSelect(this),this},setValue:function(a){return this.$els.$name&&a&&this.$els.$name.text(a),this},isAutoFillSelected:function(){return!1},compileTemplate:function(){var a=this.filter.toJSON(),b=$(["<span class='zmSearchAppSwitch' tabindex='0' data-disableShortcuts='true' >","<i class='msi-search' />","<span class='js-fname'  />","<i class='msi-barrow' />","</span>"].join("")),c=b.find(".js-fname");return c.text(a.value||""),this.$els={$el:b,$name:c,$value:b},this}}).setValueBasedOnModel(),r=m.FilterCollectionView=new o.FilterCollection({model:i,$parent:p.$els.$filters,$autofillParent:p.$els.$el,onViewChange:g.autoSize,next:function(){p.select(1)},previous:function(){p.select(-1)},onEnter:function(){g.setPlaceholder().resetAutofill().focus(),j.forceSearch()},onAutofillSelection:function(){g.setPlaceholder().resetAutofill().focus()},onAdd:function(){q.setValueBasedOnModel(),p.showCloseIcon(),g.autoSize().resetAutofill()},onRemove:function(a,b){g.setPlaceholder().autoSize().resetAutofill(),r.isEmpty()&&(g.select(),p.hideLoading(),g.isEmpty()&&p.hideCloseIcon(),j.userChangedContext().getCurrentContext().closeWorkspace())},beforeRemove:function(a){a=a||{},a.mouse?g.focus():p.select(-1).selectAllText()},onNameSelect:function(a,c){var d=j.getCurrentContext(),e=d.createFilter({name:a,value:c.filter.value}),f=r.getIndexOf(c);c.remove({silent:!0}),i.add(e,{position:f}),b.defer(function(){var a=r.getView(e.id);a.selectAllText().select()})}}),p.add(q).add(r).add(g),l.on("change",function(a){a.__isCommand?h.mode=k.COMMANDS:h.mode=k.SEARCH,q.setValueBasedOnModel(),g.setPlaceholder().resetAutofill().autoSize()}),g.registerStringHandler("default",{isSafe:!0,action:function(a){var c=g.modeHandlers[h.mode];c&&b.isFunction(c.action)&&c.action(a)}}),o.registerSearchModeHandler(),o.registerCommandModeHandler();var s=function(a){n.test(a)&&i.isEmpty()?h.mode=h.MODES.COMMANDS:h.mode=h.MODES.SEARCH};d("/apps/tabSwitched",function(){s(a("zmTab.currentTab"))}),d("mailsuite/appOpened",function(a,b){s(b)}),h.mode=k.SEARCH,g.handleModeChange(),e(c.SEARCH_INIT)})}),function(a){"use strict";a.call(zmail.Core.Namespaces.create("zmail.Search"),zmail.Core.Namespaces.get)}(function(a){"use strict";var b=a("_");this.init=b.once(function(){$("#zm-search").remove(),a("zmail.Search.SearchWatcher").init(),a("zmail.Search.Views").ConstructSearchView()})});