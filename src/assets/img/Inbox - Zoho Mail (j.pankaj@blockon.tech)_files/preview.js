window.zmPreviewTemplate=function(){"use strict";var a,b={},c="",d=zmText.get("preview"),e=function(){a=zmUtil.isChildWindow()?zmWindow:zmPrev},f=function(a){1===a?(zmPreviewTemplate.currentWorkSpace=1,b=$.parseJSON($("#zmWindowWrapper").attr("data-detail")),c="W"):(b=0===zmTab.currentTab.indexOf("zm_srch")?zmSearchUtil.getSearchViewDetails():zmsuite.getCenterOuter().$el.data("data-detail"),0===a?b&&"search"===b.view?(c="S",zmPreviewTemplate.currentWorkSpace=zmail.mailOpt.isPopup):(b=zmInit.getListingDetObj(),c="P",zmPreviewTemplate.currentWorkSpace=0):2===a?(c="T",zmPreviewTemplate.currentWorkSpace=2):3===a&&(c="N"))},g=function(a){var b=!1,c=zmConUtil.parseContacts(a);return 1===c.length&&c[0].invalid!==!0&&(a=a.toLowerCase(),a.indexOf("undisclosed-recipients")!==-1&&(b=!0)),b},h=function(a,b){b=b||{};var c,d,e,f,g,h,i,j=[],k=$("<div>"),l=" ";a=a||"";var m=zmConUtil.splitncheck(a,"object")||[];for(c in m)d=m[c],g=d.eid||"",g=g.trim(),i=$("<span>"),i.addClass("zm_eadd"),g&&(b.hideEmail&&i.attr("title",g),e=(d.fn||"").trim(),e=zmUtil.replaceHTMLEntities(e),e=e||g,f=(d.nn||"").trim(),f=zmUtil.replaceHTMLEntities(f),e===f&&(f=""),f=f?l+"("+f+")":"",e+=f,b.hideEmail||(e='"'+e+'"'),i.attr("data-eid",g),g="<"+g+">",h=e,b.hideEmail||(h+=l+g),i.text(h.trim()),k.html("").append(i),j.push(k.html()));return j.join(", ")},i=function(a,b){var c=b.find(".SC_pct").length;(c>1||b.find(".SCS-post").length)&&(b.find(".SC_pct").removeClass("SC_Tfcs"),$(a).closest(".SC_pct").addClass("SC_Tfcs"),zmUtil.isChildWindow()&&zmWindow.updateHeaderIcons())},j=function(a){var b,c,e,f=$(a).closest(".zmPCon"),g="";b=f[0].id,b&&(e=b.substring(3),b=e.substring(1),c=zmContentCache.isCached(b)?zmContentCache.get(b):"",c&&c.SHRINKED&&c.BLCKCON&&c.CONTENT.length<c.BLCKCON.length&&(g=$("#vfc"+e).parent())),$(a).next().is(":visible")?($(a).next().hide(),$(a).attr("data-tooltip",d.contentOptions.showquote),g&&g.hide()):($(a).next().show(),$(a).attr("data-tooltip",d.contentOptions.hidequote),g&&g.show()),zmUtil.applyLBDots(g)},k=function(b){var c=$(b),d=c.parents(".SC_Twpr").find(".SC_pct");d.length>1&&(d.removeClass("SC_Tfcs"),c.parents(".SC_pct").addClass("SC_Tfcs")),c.is(".zm_fgG,.zm_fgB,.zm_fgR")?a.flagMail(c,"0"):a.flagMail(c,"2")},l=function(a){if(zmail.folTree[0][a])return zmail.folTree[0][a].FN;var b,c=zmail.folTree[1];for(var d in c)if(b=c[d].CH,b[a])return b[a].FN;return""},m=function(a){var b;return b='<span class="SC_ldot zm_folname js-fnHolder">'+a+"</span>"},n=function(a,b){var c="";return a=parseInt(a),c=1===a?"<div class='zm_icn zmflg zm_fgB'></div>":2===a?"<div class='zm_icn zmflg zm_fgR'></div>":3===a?"<div class='zm_icn zmflg zm_fgG'></div>":"s"===b?"":"<div class='zm_icn zmflg'></div>"},o=function(){var a=zmAdHocSettings.getMailViewSettings();return a.headerState},p=function(){var a=zmAdHocSettings.getMailViewSettings();a.headerState="c"===a.headerState?"e":"c",zmAdHocSettings.setMailViewSettings(a)},q=function(a,b,c){var d,e,f=$(a),g=f.attr("data-mid");b&&_zm.stopEvents(b);var h=c||o();if(f.hasClass("zm_tm")&&(h="c"),"e"===h){e="msi-zmPle";var i=zmContentCache.get(g);if(zmContentCache.isCached(g)&&i)if(f.length){var j=f.closest(".SC_Twpr");d=!j.length||i.streams||zmUtil.isZohoAccount(zmail.accId)?i.RDT:i.SENTTIME||""}else d=i.RDT;f.addClass("zms")}else"c"===h&&(e="msi-zmPme",zmail.mailObj[g]&&(d=zmail.mailObj[g].DT),f.removeClass("zms"));f.find(".msi-zmPme, .msi-zmPle").attr("class",e),d&&f.find(".sum").html(d)},r=function(a){var b,c="",e=[],f={reply:d.contextmenu.reply,replyall:d.contextmenu.replyall,fwdi:d.contextmenu.forward,eanew:d.contextmenu.editasnew,outbox:d.contextmenu.edit},g=["reply","replyall","fwdi","eanew"],h=["outbox"];return b=zmail.mailObj[a].FD===zmail.folId.oId?h:g,b.forEach(function(a){e.push('<span data-type="'+a+'">'+f[a]+"</span>")}),e=e.join(""),c=['<div class="zm_ry"'+(zmUtil.hasInlineDraft(a)?' style="display: none"':"")+">",e,"</div>"].join("")},s=function(a){var c,e,f,i,j=a.elemId,k=a.msgId,o="",p="",r=[],s=a.showLimitedData;if(a.elemObj&&$(a.elemObj.prevElem).find("#zmHdr"+j).length&&!$(a.elemObj.prevElem).find("#zmC"+j).length||"print"!==a.rFrom&&!a.elemObj&&$("#zmHdr"+j).length&&!$("#zmC"+j).length){var t="",u="",v="";return c=a.elemObj?$(a.elemObj.prevElem).find("#zmHdr"+j):$("#zmHdr"+j),c.removeClass("zm_tm"),zmail.mailObj[k].S||c.find(".zmPT").addClass("zm_urd"),c.find(".sum").html(zmail.mailObj[a.msgId].DT),""!==a.isReadable&&void 0!==a.isReadable&&c.find(".sum").after("<span class='SC_ldot'>"+a.isReadable+"</span>"),e="<span>",a.to&&!g(a.to)&&r.push(h(a.to,{hideEmail:!0})),a.cc&&r.push(h(a.cc,{hideEmail:!0})),a.bcc&&r.push(h(a.bcc,{hideEmail:!0})),e+=r.join(", "),e+="</span>",c.find(".zmpr").eq(1).find("font:first").after(e),a.to&&!g(a.to)&&(c.find("#zmTO"+a.elemId).remove(),t='<div id="zmTO'+a.elemId+'" class="zmpdtl"><div><div class="zmpr"><span><em>'+d.contentOptions.to+"</em> "+h(a.to)+"</span></div></div></div>"),a.cc&&(u='<div id="zmCC'+a.elemId+'" class="zmpdtl"><div><div class="zmpr"><span><em>'+d.contentOptions.cc+"</em> "+h(a.cc)+"</span></div></div></div>"),a.bcc&&(v='<div id="zmBCC'+a.elemId+'" class="zmpdtl"><div><div class="zmpr"><span><em>'+d.contentOptions.bcc+"</em> "+h(a.bcc)+"</span></div></div></div>"),a.to||a.cc||a.bcc||c.find("#zmTO"+a.elemId).length||(t='<div id="zmTO'+a.elemId+'" class="zmpdtl"><div><div class="zmpr"><span><em>'+d.contentOptions.to+"</em></span></div></div></div>"),f=zmPreviewTemplate._rPath(a,"via"),i=zmPreviewTemplate._rPath(a),$("#zmLBL"+a.elemId).length?$("#zmLBL"+a.elemId).before(t+u+v):c.find(".zmPT").append(t+u+v),i._str&&c.find(".zmPT")&&(c.find(".zmPT").find('div[data-zmvia="less"]').append(f._str),c.find(".zmPT").append(i._str)),q(c),c[0].outerHTML}var w,x,y="",z=zmail.mailObj[a.msgId].FD||"",A=!0,B="zmPHdr",C={},D=a.isSharedDraft||!1,E=a.isDraftEditable||!1,F="";zmail.mailObj[a.msgId].streams&&(F="default"),a.sm||(a.sm=""),a.thd&&(B+=" zm_tm",z===zmail.folId.sId&&zmail.mailObj[k]&&zmail.mailObj[k].TH&&(B+=" zmsnt")),o+='<div id="zmHdr'+a.elemId+'" class="'+B+'" data-elmId="'+a.elemId+'" data-mid="'+a.msgId+'">',o+=s||0!==zmail.mailObj[a.msgId].S||zmail.mailObj[a.msgId].FD===zmail.folId.oId?'<div class="zmPT">':'<div class="zmPT zm_urd">',o+='<div class="zmpr"><div class="SCmb"><div class="SC_frt">',(3===a.opentype||D&&!E)&&(A=!1);var G=!1;if(zmUtil.isChildWindow()){if(zmail.mailObj&&zmail.mailObj[k]&&zmail.mailObj[k].RMOBJ&&!$.isEmptyObject(zmail.mailObj[k].RMOBJ)){var H=zmail.mailObj[k].RMOBJ.WT;1!==H&&2!==H&&3!==H||(G=!0)}zmail.folId.dId!==zmail.mailObj[k].FD&&zmail.folId.spId!==zmail.mailObj[k].FD&&zmail.folId.tId!==zmail.mailObj[k].FD&&zmail.folId.teId!==zmail.mailObj[k].FD||(G=!1)}else G=zmList.isRMOBJ(k);if(zmUtil.isZohoAccount(zmail.accId)||(G=!1),G?(o+='<ul id="zmprv_header_'+a.msgId+'_remind" title=',o+=d.contextmenu.reminder+'><li><b><i class="msi-mailReminder ',o+='SC_thm" data-detail="prvHdr"></i></b></li></ul>'):(o+='<ul id="zmprv_header_'+a.msgId+'_remind" title=',o+=d.contextmenu.reminder+' class="SC_dyn"><li><b><i class=',o+='"msi-mailReminder SC_thm" data-detail="prvHdr"></i></b></li></ul>'),!s&&A)if(zmail.mailObj[a.msgId].FD===zmail.folId.oId)o+=['<ul class="SC_ldot"><li><b>','<i class="msi-edit" data-detail="prvHdr"></i>',"</b></li></ul>"].join("");else if(zmail.mailObj[a.msgId].FD===zmail.folId.dId)o+=['<ul class="SC_ldot"><li><b>','<div class="SC_hd"></div>','<span><i class="msi-edit" data-detail="prvHdr"></i><i class="msi-barrow"></i></span>',"</b></li></ul>"].join("");else if(E)o+=['<ul class="SC_ldot"><li><b>','<i class="msi-edit" data-detail="prvHdr"></i></b></li></ul>'].join("");else{var I=zmUtil.isSharedFolder(z,"R")?"":['<ul class="SC_ldot"><li title="'+d.contextmenu.reply+'"><b>','<div class="SC_hd"></div>','<span><i data-detail="prvHdr" class="msi-reply"></i></span>',"</b></li>",'<li title="'+d.contextmenu.replyall+'"><b>','<div class="SC_hd"></div>','<span><i data-detail="prvHdr" class="msi-replyall"></i></span>',"</b></li>",'<li title="'+d.contextmenu.forward+'"><b>','<div class="SC_hd"></div>','<span><i data-detail="prvHdr" class="msi-forward"></i></span>',"</b></li></ul>"].join(""),J=['<ul><li class="SC_lbr" title="'+d.iconTooltip.moreact+'"><b>','<div class="SC_hd"></div>','<span><i data-detail="prvHdr" class="msi-barrow"></i></span>',"</b></li></ul>"].join("");o+=I+J}o+="</div></div>",o+='<ul class="SC_pvul"><li><img src=""></img>';var K=a.frm,L=zmail.mailObj[a.msgId].SN||a.sender;try{zmail.mailObj[a.msgId].F===zmail.aInfo[zmail.accId].mailId&&(L="Me")}catch(M){}C["data-eid"]=K,w={attr:C,name:L,img:!1,eid:K};var N=zmail.mailObj[a.msgId].PR;if(1===N||2===N?o+="<i class='msi-priority SC_red'></i>":4!==N&&5!==N||(o+="<i class='msi-priority SC_blue'></i>"),x=zmConUtil.bubbleUtil(w),o+=x,f=zmPreviewTemplate._rPath(a,"less",K),f._str&&(o+=f._str),o+='<span class="SC_lnk SC_ldot zm_unsub" style="display:none;">'+d.newsletter.unsubscribe+"</span>",zmUtil.isZohoAccount(zmail.accId)&&zmail.isSmartFilterEnabled&&zmail.mailObj[k].SFT&&!zmUtil.isSharedFolder(zmail.mailObj[k].FD)&&(!zmUtil.isChildWindow()||zmUtil.isChildWindow()&&opener)&&(o+='<span class="SC_lnk SC_ldot zm_exclude" title="'+d.smartfilter.exclude_tip+'">'+d.contentOptions.exclude+"</span>"),o+="<div>",1===a.hasAtt&&(o+='<i class="msi-attachicon"></i>'),s||zmail.mailObj[a.msgId].FD===zmail.folId.spId||zmail.mailObj[a.msgId].FD===zmail.folId.oId||zmail.mailObj[a.msgId].FD===zmail.folId.dId||(!zmail.mailObj[a.msgId].streams||zmail.mailObj[a.msgId].groupId!==zmail.zuid||"0"===zmail.mailObj[a.msgId].NFG)&&zmail.mailObj[a.msgId].streams||(o+=n(a.flag)),zmail.mailObj[a.msgId].DT||(zmail.mailObj[a.msgId].DT=a.date),o+='<span class="sum">'+zmail.mailObj[a.msgId].DT+"</span>",!a.label&&zmail.mailObj[a.msgId].TAG&&(a.label=zmail.mailObj[a.msgId].TAG),a.label&&a.label.length?zmail.mailObj[a.msgId].FD!==zmail.folId.spId&&zmail.mailObj[a.msgId].FD!==zmail.folId.dId&&(y=zmsTemplates.constructTagListHTML(a.label,!1,"",F),y+='<i class="msi-plus zmst_lbl"></i>'):y='<i class="msi-label"></i>',s||(o+='<div class="SC_ldot zm_lbl">'+y+"</div>"),zmail.mailObj[a.msgId].streams&&!zmUtil.isChildWindow()){var O;O=zmail.mailObj[a.msgId].isFav?'<i class="msi-fav SC_fav"></i>':'<i class="msi-fav"></i>',o+='<div class="SC_ldot">'+O+"</div>"}if(""!==a.isReadable&&void 0!==a.isReadable&&(o+='<span class="SC_ldot">'+a.isReadable+"</span>"),s||(p=l(z),p&&zmail.mailObj[a.msgId].AR&&(p+=" ("+d.contentOptions.archived+")"),0!==a.opentype||b&&"search"===b.view?o+=m(p):!b||b.fId&&1!==zmail.mailObj[a.msgId].TH||(o+=m(p))),o+="</div></li></ul>",o+='<i class="msi-zmPme"></i>',o+='<i style="display:none;" class="msi-share js-shareicon"></i>',o+="</div>",e="<font>"+a.sm+"</font>",a.thd||(e+="<span>",a.to&&!g(a.to)&&r.push(h(a.to,{hideEmail:!0})),a.cc&&r.push(h(a.cc,{hideEmail:!0})),a.bcc&&r.push(h(a.bcc,{hideEmail:!0})),e+=r.join(", "),e+="</span>"),o+='<div class="zmpr zmpsrt">',o+=e+"</div>",a.to&&!g(a.to)&&(o+='<div id="zmTO'+a.elemId+'" class="zmpdtl"><div><div class="zmpr"><span><em>'+d.contentOptions.to+"</em> "+h(a.to)+"</span></div></div></div>"),a.cc&&(o+='<div id="zmCC'+a.elemId+'" class="zmpdtl"><div><div class="zmpr"><span><em>'+d.contentOptions.cc+"</em> "+h(a.cc)+"</span></div></div></div>"),a.bcc&&(o+='<div id="zmBCC'+a.elemId+'" class="zmpdtl"><div><div class="zmpr"><span><em>'+d.contentOptions.bcc+"</em> "+h(a.bcc)+"</span></div></div></div>"),a.to||a.cc||a.bcc||(o+='<div id="zmTO'+a.elemId+'" class="zmpdtl"><div><div class="zmpr"><span><em>'+d.contentOptions.to+"</em></span></div></div></div>"),a.label&&a.label.length?zmail.mailObj[a.msgId].FD!==zmail.folId.spId&&zmail.mailObj[a.msgId].FD!==zmail.folId.dId&&(o+=['<div id="zmLBL'+a.elemId+'" class="zmpdtl"><div>','<div class="zmpr"><span><em>'+d.contentOptions.tags+'</em><div class="zm_lbl">',zmsTemplates.constructTagListHTML(a.label,!0,"",F),"</div></span></div></div></div>"].join("")):o+=['<div id="zmLBL'+a.elemId+'" class="zmpdtl"><div>','<div class="zmpr"><span><em>'+d.contentOptions.tags+'</em><div class="zm_lbl">','<i class="msi-label"></i></div></span></div></div></div>'].join(""),i=zmPreviewTemplate._rPath(a),o+=i._str,o+="</div>",o+='<div class="zmmre">',!s&&a.showIndex&&zmail.mailObj[k].TH&&zmail.listObj[zmail.mailObj[k].T]){var P,Q;zmUtil.isChildWindow()?(Q=zmail.listObj[zmail.mailObj[k].T].MO,P=Q.length):(Q=zmList.getListForAllMailsView(b,zmail.mailObj[k].T,!0),P=Q.length);var R=Q.indexOf(k);R!==-1&&(R+=1,o+='<span id="zm_readtitle">'+d.contentOptions.readingindex+"<em>"+R+"</em>/<em>"+P+"</em></span>")}o+="</div></div>";var S=$(o);return q(S),S[0].outerHTML},t=function(a,c){var e,f="",g=!1;"plainContent"===c.type&&(g=!0);var h=c.msgId||a.msgId||"",i=zmail.mailObj[h],j=""!==a.SENDER?a.SENDER:a.FROM,k=i&&i.AT||c.att||0,l=i&&i.TAG||c.tg||null,m=i&&i.NFG||c.flg||null,n=i&&i.SM||c.sm||"",o=a.TO||"",p=a.CC||"",q=a.BCC||"",t=a.RDT||"",u=a.READSTATUS||"",v=a.CONTENT?a.CONTENT:"",w=c.opentype,x=a.DATECONTENT||"",y="";zmail.showFeature&&(y=a.readTime?a.readTime:zmUtil.textReadTime(v),a.readTime=y),zmail.isInternalOrgUser&&!zmUtil.isChildWindow()&&x&&(v=dateParser.focusOnDate(v,x)||v);var z=$("<div>").html(v),A=z.find("#zmail_block");o=o.replace(/&lt;/gi,"<"),o=o.replace(/&gt;/gi,">"),p=p.replace(/&lt;/gi,"<"),p=p.replace(/&gt;/gi,">"),q=q.replace(/&lt;/gi,"<"),q=q.replace(/&gt;/gi,">"),a.BLCKCON&&(A.length?(A.addClass("zm_icn zm_sqt SC_ttip"),A.after("<div style='display:none'>"+a.BLCKCON+"</div>"),v=z[0].innerHTML):v+=z.text().trim().length?"<div class='zm_icn zm_sqt SC_ttip' data-tooltip='"+d.contentOptions.showquote+"'></div><div style='display:none'>"+a.BLCKCON+"</div>":"<div>"+a.BLCKCON+"</div>"),0===w?e=b&&"search"===b.view?"S"+h:"P"+h:2===w?e="T"+h:1===w?e="W"+h:3===w&&(e="N"+h),f+=zmail.mailObj[h]&&zmail.mailObj[h].TH?!b||b.fId!==zmail.mailObj[h].FD&&""!==b.fId?'<div class="SC_pct SC_Tfcs SC_Tfdr">':'<div class="SC_pct SC_Tfcs">':'<div class="SC_pct">';var B={msgId:h,frm:a.FROM,sender:j,hasAtt:k,to:o,cc:p,bcc:q,label:l,flag:m,date:t,sm:n,elemId:e,opentype:c.opentype,src:c.src,readsts:u,isSharedDraft:c.isDraftMail,isDraftEditable:c.isDraftEditable,isReadable:y,showIndex:c.showIndex,rFrom:c.rFrom,showLimitedData:g};B.rPath=a.RETURNPATH,B.delegate=a.DELEGATE,f+=s(B),f+='<div id="zmCon'+e+'">';var C=g?"":'<div class="zmRdrIco"><i class="msi-readerView SC_thm" title ="'+d.contentOptions.reader+'"></i></div>';if(f+=C,f+='<div id="zmC'+e+'" class="zmPCon">',a.EXTIMG&&"none"!==a.EXTIMG.link){var D=zmText.applyArgs(d.contentOptions.alwaysshow,{emailid:zmail.mailObj[h].F}),E=zmText.applyArgs(d.contentOptions.hideimage,{emailid:zmail.mailObj[h].F});f+=['<div class="SC_simg" id="ImgDis'+e+'">','<a style="display:none;" href="javascript:void(0)" data-mode="temporary">',d.contentOptions.display,"</a>",'<a style="display:none;" href="javascript:void(0)" data-mode="whitelist">',D,"</a>",'<a style="display:none;" href="javascript:void(0)" data-mode="blacklist">',E,"</a>",'<span style="display:none;" data-mode="message">',d.contentOptions.imagehidden," </span></div>"].join("")}f+='<div class="zmPCnt"><table cellpadding="0" cellspacing="0" border="0"><tr><td>'+v+"</td></tr></table></div>",a.SHRINKED&&!g&&(f+=a.BLCKCON&&a.CONTENT.length<a.BLCKCON.length?'<div class="SC_simg" id = "clippedMsg" style="display:none;"><font id="vfc'+e+'">'+d.contentOptions.viewfullcontent+"</font><span>[ "+d.contentOptions.truncated+" ]</span></div>":'<div class="SC_simg" id = "clippedMsg"><font id="vfc'+e+'">'+d.contentOptions.viewfullcontent+"</font><span>[ "+d.contentOptions.truncated+" ]</span></div>"),f+="</div>";var F=zmail.mailObj[h]&&zmail.mailObj[h].FD;return 3===w||c.isDraftMail||g||zmUtil.isSharedFolder(F,"R")||(f+=r(h)),f+="</div>"},u=function(a,b){if(a){zmail.mailObj[a].TAG=zmail.mailObj[a].TAG||[];var c,e=zmail.mailObj[a].TAG,f="";zmail.mailObj[a].streams&&(f="default");var g=zmsTemplates.constructTagListHTML(e,!0,"",f),h=zmsTemplates.constructTagListHTML(e,!1,"",f),i=h;g.length||(g='<i class="msi-label"></i>'),b&&b.length&&(c=b[0].id,c.indexOf("t")||(c=c.substring(1)));var j=["","t","zmHdrP","zmHdrT","zmHdrW","zmHdrS","zmHdrN"];for(var k in j){var l;l="1"===k&&c?$("[id="+j[k]+c+"]"):$("[id="+j[k]+a+"]");for(var m=0;m<l.length;m++){var n,o=l.eq(m),p=o.find(".zm_lbl");switch(p.remove(),j[k]){case"":o.find(".SC_icn").after("<div class='zm_lbl'></div>");break;case"t":o.find(".SC_icn").after("<div class='zm_lbl'></div>"),c&&zmail.mailObj[c]&&(zmail.mailObj[c].TTAGS=zmail.mailObj[c].TTAGS||[],e=zmail.mailObj[c].TTAGS||e,i=zmsTemplates.constructTagListHTML(e,!1,4,f));break;case"zmHdrP":n="zmLBLP"+a;break;case"zmHdrT":n="zmLBLT"+a;break;case"zmHdrW":n="zmLBLW"+a;break;case"zmHdrS":n="zmLBLS"+a;break;case"zmHdrN":n="zmLBLN"+a}if(n){i=e.length?h+'<i class="msi-plus zmst_lbl"></i>':'<i class="msi-label zmst_lbl"></i>',$("#"+n).remove();var q='<div id="'+n+'" class="zmpdtl"><div><div class="zmpr"><span><em>'+d.contentOptions.tags+"</em></span></div></div></div>";o.find(".zmvia").length?$(q).insertBefore(o.find(".zmvia").eq(0)):o.find(".zmPT").append(q),$("#"+n).find("span").append("<div class='zm_lbl'></div>"),o.find(".zmpr").eq(0).find(".sum").after("<div class='SC_ldot zm_lbl'></div>")}p=o.find(".zm_lbl"),p.length&&(2===p.length?(p.eq(0).html(i),p.eq(1).html(g)):1===p.length?p.html(i):p.html(g))}"t"===j[k]&&(e=zmail.mailObj[a].TAG,i=zmsTemplates.constructTagListHTML(e,!1,"",f))}}},v=function(a){if(zmail.mailObj[a]&&zmail.mailObj[a].FD===zmail.folId.sId){var b,c=["","t","zmHdrP","zmHdrT","zmHdrW","zmHdrS"];c.forEach(function(c){b=$(String("[id="+c)+a+"]"),b.each(function(a,b){$(b).removeClass("zmsnt"),$(b).hasClass("zm_tm")&&$(b).addClass("zmsnt")})})}},w=function(a,b){var c,d=[],e=[];"t"===a.charAt(0)?(a=a.substring(1),e.push(a)):d.push(a);var f="";zmail.mailObj[a]&&zmail.mailObj[a].streams&&(f="default");var g=zmUtil.getTagList(f),h={};h.parentDOM=$(b),h.displayAs="popup",h.accType=f,h.labelState={mailList:[{id:a,ttag:Boolean(e.length)}]},h.onStateChange=function(a,b){zmUtil.isChildWindow()?zmWindow.applyActions("label","click",{msgId:d,thd:e,lA:b?"add":"delete",lId:a,accType:f,disp:g[a].dispName}):zmmailAct.applyActions("label","click",{msgId:d,thd:e,lA:b?"add":"delete",lId:a,accType:f,disp:g[a].dispName})},zmUtil.isChildWindow()||(h.onCreate=function(a,b){zmlab.isValidName(a,"",f)&&zmlab.labelCreate(a,f,{reqDoneClbk:function(a,b){a&&(h.onStateChange(b,!0,function(){}),c.hide())},color:b})}),c=zmUtil.createFLComp("label",h),c.show()},x=function(a){var b=zmail.mailObj[a],c=zmail.mailObj[a].FD;if(!b)return!1;var d={accId:zmail.accId,msgId:a,folId:c,split:!0,summary:!0,vfc:!0};return 0===zmail.mailObj[a].S&&(d.markread=!0),zmail.mailObj[a].AR&&(d.archiveStatus=!0),c&&zmUtil.isSharedFolder(c)&&(d.shId=zmUtil.getShareId(c),d.isSh=!0,d.shareId=d.shId,d.groupId=zmail.shrTree[0][c].OZUID),b.streams&&(d.accId=zmail.mailObj[a].accId,delete d.folId,d.actionType=zmail.mailObj[a].actionType,d.streamsView="true",d.groupId=zmail.mailObj[a].groupId,d.entityId=a,d.entityType=zmail.mailObj[a].entityType),d},y=function(a){if(a.readTime)return!1;var b=zmUtil.textReadTime(a.CONTENT);return a.readTime=b,!0},z=function(a,b){var c=a&&zmContentCache.get(a);c&&zmAppLoader.load("zmReader").done(function(){var d=function(){var c={},d=function(){var d;c.currMsgId=a,b=b?$(b).closest(".SC_Twpr"):zmsuite.getCenter()[1].$el.find(".SC_Twpr"),b.length&&b.find(".SC_pct").length>1?(d=zmail.mailObj[a].T,c.mList=d&&zmail.listObj[d]&&zmail.listObj[d].MO||[a]):c.mList=[a],c.index=c.mList.indexOf(c.currMsgId)};return d(),{hasNext:function(){return c.index<c.mList.length-1},hasPrev:function(){return c.index>0},fetchMail:function(a,b){var d,e={},f={};if("prev"===a)c.index-=1,c.index=Math.max(c.index,0),d=c.mList[c.index];else{if("next"!==a)return;c.index+=1,c.index=Math.min(c.index,c.mList.length-1),d=c.mList[c.index]}if(c.currMsgId=d,zmContentCache.isCached(d))e=zmContentCache.get(d),0===zmail.mailObj[d].S&&zmmailAct.applyActions("read","click",{msgId:[d],thd:[]}),y(e),f.title=e.SUBJECT,f.content=e.CONTENT,f.readTime=e.readTime,b.resolve(f);else{var g=x(d),h=function(a){if(y(a),"success"===a.READSTATUS){var c=zmUtil.isChildWindow()?zmWindow.rapplyActions:zmmailAct.rapplyAction;c({result:"success"},{mailId:[d],thd:[],action:"read"})}f.title=a.SUBJECT,f.content=a.CONTENT,f.readTime=a.readTime,b.resolve(f)};zmUtil.isChildWindow()?zmWindow.sendMailDataReq(g,{},h):zmList.sendMailDataReq(g,{},h)}},isConversation:function(){return 1!==c.mList.length}}}();y(c),zmReader.load({title:zmail.mailObj[a].SB,content:c&&c.CONTENT,handler:d,readTime:c&&c.readTime})})},A=function(b,e,f){var g,h=b.target||b.srcElement,l="",m="",n="";if(h=$(h),l=$(h).closest(".SC_pct").children(":first").attr("data-mid"),m=$(h).closest(".SC_pct").children(":first").attr("data-elmId")||(zmPreviewTemplate.getPrefixOnCurrentab()||c)+l,g=$(h).attr("class")||"",g.indexOf("zmflg")!==-1?g="zmflg":g.indexOf("zm_unsub")!==-1?g="zm_unsub":g.indexOf("msi-fav")!==-1?g="msi-fav":g.indexOf("zm_exclude")!==-1&&(g="zm_exclude"),g||!h.parent().hasClass("SC_cs")||h.closest(".SC_pct").hasClass("SC_Drft")||(h=h.parent(),g=h.attr("class")),h.closest(".zm_lbl").length&&(g="zm_lbl"),"IMG"===h[0].tagName){var o=[/(?:https?:\/\/)?[^.\s]+\.youtube\.[^.\/]+\/[^\s]*watch\?[^\s]*v=([^\s&#\/]+)(?:&t=([^\s&#]+))*[^\s]*/g,/(?:https?:\/\/)?[^.\s]+\.youtube\.[^.\/]+\/v\/([^\s&#\/]+)(?:&t=([^\s&#]+))*[^\s]*/g,/(?:https?:\/\/)?youtu\.be\/([^\s&#\/]+)(?:&t=([^\s&#]+))*[^\s]*/g];if("A"===h.parent()[0].tagName){var r,s,t,u,v,x=o.length,y=h.parent()[0].href,A="",B="//www.youtube.com/embed/{{videoID}}{{extraParams}}",C=/(?:([0-9]*)h)*(?:([0-9]*)m)*(?:([0-9]*)s)*/gi;for(r=0;r<x;r++)if(s=o[r],null!==(t=s.exec(y))&&t[1]){u=t[1],v=t[2]||"",g="youtubeurl";break}if(u){if(A=B.replace(/\{\{videoID\}\}/,u),v){C=B.timeParseRegex,C.lastIndex=0;var D=C.exec(v);D[1]=parseInt(D[1])||0,D[2]=parseInt(D[2])||0,D[3]=parseInt(D[3])||0;var E=3600*D[1]+60*D[2]+D[3];A=A.replace(/\{\{extraParams\}\}/,"?start="+E)}else A=A.replace(/\{\{extraParams\}\}/,"");n=A}}else g="slidez"}switch(g||"prvHdr"!==h.find("i").attr("data-detail")||(h=h.find("i"),g=h.attr("class")),g=g.replace("SC_ldot","").trim(),g=g.replace("SC_thm","").trim(),"2"===zmail.collabVersion&&(g=g.replace("msi-share","").replace("shd","").trim()),g){case"msi-readerView":z(l,h);break;case"msi-zmPme":case"msi-zmPle":p(),q($("#zmHdr"+m),b);break;case"msi-reply":case"msi-replyall":case"msi-forward":var F={"msi-reply":"reply","msi-replyall":"replyall","msi-forward":"forward"};"prvHdr"===h.attr("data-detail")&&(i(h,e),a.bindAction({action:F[g]},h,{containerDOM:$(h).closest(".SC_pct").parent()})),_zm.stopEvents(b);break;case"msi-mailReminder":zmWatch.showWatch({msgId:l,elem:h,openWatch:"preview_header",loadType:"popup"}),_zm.stopEvents(b);break;case"msi-download":a.show("zm_dldLst",h);break;case"msi-barrow":i(h,e),h.parents("ul").attr("cmprid")?a.show("zm_prvRepLst",h):"prvHdr"===h.attr("data-detail")?a.show("zm_preaLst",h):h.prev().hasClass("msi-edit")?a.show("zm_preaLst",h):h.prev().hasClass("msi-download")&&a.show("zm_dldLst",h);break;case"msi-attachicon":a.posAView(m),_zm.stopEvents(b);break;case"zm_icn zm_sqt SC_ttip":j(h);break;case"zmflg":if(zmUtil.isReadOnlyMail(l))return void _zm.stopEvents(b);k(h),_zm.stopEvents(b);break;case"msi-edit":zmUtil.isChildWindow()||"prvHdr"!==h.attr("data-detail")||zmUtil.invokeComposer({mode:"outbox",msgId:l});break;case"SC_cs":case"zm_eadd":var G=[{htm:d.contactbubble.addcontact,id:"zms_add",clk:zmConUtil.handleAddToContact}];zmUtil.isChildWindow()||(G=G.concat([{htm:d.contactbubble.sendmail,clk:zmConUtil.loadCompose},{htm:d.contactbubble.chat,clk:zmConUtil.createChat,show:"chat",value:!0},{htm:d.contactbubble.listmails,clk:zmConUtil.listMails},{htm:d.contactbubble.listattachments,clk:zmConUtil.listAttachment}]));var H={dom:h,items:G,event:b,source:"mail"};H.displayName="SC_cs"===g&&zmail.mailObj[l]&&zmUtil.decodeHTMLEntities(zmail.mailObj[l].SN)||void 0,zmUtil.isChildWindow()&&(H.source="popmail"),zmConUtil.showContactCard(H);break;case"youtubeurl":var I=[],J={ft:103,fn:"file.mp4",src:n,showInFrame:!0,hideFileName:!0,hideShareOption:!0};I.push(J),zmUtil.initAttSlideShow(I,0,!0),_zm.stopEvents(b);break;case"slidez":zmPreviewTemplate.slideZImages(h);break;case"zm_lbl":if(zmail.mailObj[l]&&zmail.mailObj[l].streams)$(h).addClass("zmst_lbl"),zmStreamsApp.util.bindEntityElements({entityId:l,entityElem:h,entityType:1});else{var K=zmail.mailObj[l]&&zmail.mailObj[l].FD;if(zmUtil.isSharedFolder(K))return;var L=h.closest(".zm_lbl");w(l,L)}break;case"msi-fav":zmStreamsApp.util.bindEntityElements({entityId:l,entityElem:h,entityType:1,data:zmail.mailObj[l]});break;case"zm_draft":var M=h.closest(".SC_pct").children().eq(1);zmPreviewTemplate.loadInlineCompose(l,M);break;case"SC_plnk":var N=h.attr("data-detail");"downloadall"===N&&a.bindAction({action:N,msgId:l},h);break;case"js-shareicon":case"js-shareicon sld":if("2"===zmail.collabVersion){var O=$(h).parents(".zmPHdr").parents(".SC_pct").parent()[0];$.publish("/mail/preview/updateshare",{mailID:l,containerDOM:$(O)[0],elm:h[0]})}break;case"zm_unsub":zmPreviewTemplate.processUnsubscription(l,e);break;case"zm_exclude":var P,Q;if(zmail.mailObj[l]){P=zmail.mailObj[l].F||"",Q=zmail.mailObj[l].SFT;var R={5:d.smartfilter.notification,6:d.smartfilter.newsletter,7:d.smartfilter.group};if(P&&Q){var S=zmText.applyArgs(d.smartfilter.confirm_msg,{email_address:P,smart_filter_name:R[Q]});zmsDialog.confirm(S,{onOk:function(){zmPreviewTemplate.classifySmartFilter(l,Q,!1,$(h).closest(".SC_pct"))}})}}break;case"zm_inLnk":var T=zmContentCache.isCached(l)&&zmContentCache.get(l),U=h.attr("data-value");if(!T||!U)return;U=U.replace(/ /,"T");var V={par:h,title:T.SUBJECT,desc:"",ts:U};dateParser.loadQuickAdder(V);break;default:var W,X;if(zmUtil.isChildWindow()||(X=zmTab.currentTab.indexOf("zm_srch")!==-1?zmSearchUtil.getSearchViewDetails():zmsuite.getCenterOuter().$el.data("data-detail")),X&&"search"===X.view&&zmSearchUtil.isWorkspaceAvailable()&&(W="zm_srch1"),h.attr("id")&&h.attr("id").indexOf("vfc")!==-1){i(h,e);var Y={msgId:l,type:"lt",opentype:void 0!==f?f:zmPreviewTemplate.currentWorkSpace,vfc:!0};zmUtil.isChildWindow()?zmWindow.getMail(Y):(Y.tabId=W,zmList.getMailData(Y)),h.parent().hide()}else{var Z=h.closest(".zmPHdr");if(!Z.length)return;if(!Z.hasClass("zm_tm")&&Z.hasClass("zms")){var _=Z.children(".zmPT:first").children(".zmpr:first")[0];if(h[0]!==_&&!$.contains(_,h[0]||"zmmre"===g))return}var aa=zmail.mailObj[l].FD===zmail.folId.dId;if(Z.length&&(!aa&&e.find(".SC_pct").length>1&&(i(h,e),Z.toggleClass("zm_tm"),Z.removeClass("zmsnt"),zmail.mailObj[l].FD===zmail.folId.sId&&Z.hasClass("zm_tm")&&Z.addClass("zmsnt")),a.toggleMailContentViewMode(Z,f,W),!Z.hasClass("zm_tm")))if(zmUtil.isChildWindow())zmUtil.setPreviewScroll(Z.closest(".SC_pct"),e);else{var ba=Z.closest(".SC_pct");zmUtil.setPreviewScroll(ba,ba.parent())}}}},B=function(a,b){var c,e=a.target||a.srcElement,f="",g=zmUtil.getCmpViewType();c=$(e).attr("data-type"),f=$(e).closest(".SC_pct").find(".zmPHdr").attr("data-mid"),i(e,b),g.mode=c,g.msgId=f;var h=zmail.mailObj[f];switch(h&&h.streams&&(g.groupId=h.groupId,g.streamsView=!0),c){case"outbox":zmUtil.invokeComposer(g);break;case"eanew":zmUtil.invokeComposer(g);break;case"reply":case"replyall":case"fwdi":"2"===zmail.collabVersion&&"fwdi"===c&&$.publish("/mail/forwardmail",{mailID:f,workspaceID:zmTab.currentTab,containerDOM:$(e).closest(".SC_pct").parent(),mode:"forward"}),zmUtil.isInlineCompose()&&zmail.mailObj[f]&&zmail.mailObj[f].DMID&&zmComp.getCmpObjId(f).cmpId?(e=b.find("#zmCon"+g.viewType+zmail.mailObj[f].DMID),i(e,b)):zmUtil.getMailContent(f).done(function(a){g.prevElem=$(e).closest(".SC_Twpr"),zmContentCache.isCached(f)&&(g.draftCont=a),zmUtil.invokeComposer(g)}).fail(function(){_zm.succErrMsg(d.inlinecompose.error)})}},C=function(a){a=$(a);var b=a.hasClass("SCS_postMail")||a.parent(".SCS_postMail").length>0||"zmncenter"===zmTab.currentTab,c="zmStreamsApp"===zmTab.currentTab,d=zmsuite.getCenter()[0].$el.hasClass("zms_streams"),e=0!==a.find(".SCS_cmnt").length;return b||c||d||e},D=function(a,b,c,d){try{var e,f,g,h,i=[],j=[];d||(d=$(c).closest(".SC_pct"),b=b||d.find(".zmPHdr").attr("data-mid"));var k={id:"externalLink",url:"externalURL"},l={id:"extBackImgId",url:"extBackImgURL"},m={id:"extListBackImgId",url:"extListBackImgURL"},n=zmContentCache.get(b);if(e=zmContentCache.isCached(b)&&n.EXTIMG,!e)return;var o,p=$("<div/>");p.html(n.CONTENT),n.BLCKCON&&(o=$("<div/>"),o.html(n.BLCKCON));var q=function(a,b){for(i=e[a.url],j=e[a.id],f=i.length,h=0;h<f;h++)g=i[h].replace(/&amp;/gi,"&"),"extbg"===b?(d.find("#"+j[h]).css("background-image","url("+g+")"),p.find("#"+j[h]).css("background-image","url("+g+")"),o&&o.find("#"+j[h]).css("background-image","url("+g+")")):"ext"===b?(d.find("#"+j[h]).attr("src",g),p.find("#"+j[h]).attr("src",g),o&&o.find("#"+j[h]).attr("src",g)):"listBG"===b&&(d.find("#"+j[h])[0].style.listStyleImage="url("+g+")",p.find("#"+j[h])[0].style.listStyleImage="url("+g+")",o&&(o.find("#"+j[h])[0].style.listStyleImage="url("+g+")"))};e.externalURL&&e.externalURL.length&&q(k,"ext"),e.extBackImgURL&&e.extBackImgURL.length&&q(l,"extbg"),e.extListBackImgURL&&e.extListBackImgURL.length&&q(m,"listBG"),c&&$(c.parentElement).hide(),n.EXTIMG.link="none",n.CONTENT=p.html(),o&&(n.BLCKCON=o.html())}catch(r){zmUtil.debugLog(r)}},E=function(){var a,b,d,e,f,g,h,i=zmUtil.getSelectedMails(),j=c+a;if(i[0][0]?a=i[0][0]:i[1][0]&&(a=i[1][0]),a){for(b=$("#zmC"+j+" img"),d=b.length,e=0;e<d;e++)f=b[e].src,g=f.substring(0,7),h=/(http|https):\//i,h.test(g)&&(b[e].src="");$("#ImgDis"+j).hide()}},F=function(a,b){var c=b.msgId;if(zmContentCache.isCached(c)){var d=zmContentCache.get(c);d.CONTENT=a.mdata.CONTENT,d.EXTIMG=a.mdata.EXTIMG,d.BLCKCON=a.mdata.BLCKCON}},G=function(){var a,b=zmUtil.getSelectedMails();if(b[0][0]?a=b[0][0]:b[1][0]&&(a=b[1][0]),a){var c={accId:zmail.accId,msgId:a,folId:zmail.mailObj[a].FD,split:!1};zmContentCache.fetch({u:zmail.conPath+"/md.do",t:"POST",fn:F,p:c,ep:{msgId:a,forceFetch:!0}})}},H=function(a,b){if("success"===a.result){var c=b.action;"add"===c?(D("add"),G("add")):"del"===c&&(E(),G("del"))}},I=function(a,b){var c={},d={};d={action:a,accId:zmail.accId,value:b},c.action=a,c.value=b,zmAjq.XHR({u:zmail.conPath+"/editShowImages.do",t:"POST",fn:H,p:d,csr:"s",ep:c})},J=function(a,b){var c={t:"POST",u:zmail.conPath+"/readreceipt.do",p:{mode:b,msgId:a,accId:zmail.accId,folType:"p"}};zmAjq.XHR(c),void 0===zmail.mailObj[a].RR?zmail.mailObj[a].NS2=0:zmail.mailObj[a].RR=0},K=function(a,b){var c="";return c+=b?'<div class="SC_pct">':'<div class="SC_pct SC_Tfdr">',c+=zmPreviewTemplate.getTemplate("header",a),c+="</div>"},L=function(){$.subscribe("/mail/draftsaved",function(a,b){b=b||{};var c=b.draftId,d=b.msgId;if(c&&d){var e="[id$="+d+"New]",f=$(e);f.each(function(a,b){b=$(b),b.attr("data-mid",c);var e=b.attr("id");b.attr("id",e.replace(d+"New",c))})}})},M=function(a){if(a=a||{},"2"===zmail.collabVersion&&a.containerDOM&&a.mailID&&a.hasOwnProperty("state")){var b=a.containerDOM,c=a.mailID,d=a.state,e=a.tooltip||"",f=$(b).find("[data-mid="+c+"]").find(".js-shareicon");switch(f.attr("title",e),d){case 1:f.addClass("shd").show();break;case 0:f.removeClass("shd").show().data("shared",!1);break;case-1:f.removeClass("shd").hide();break;default:f.hide()}}},N=function(){"2"===zmail.collabVersion&&$.subscribe("/mail/collab/updateshareicon",function(a,b){b=b||{},M(b)})},O=function(a){var b;return zmail.listObj[a]&&(b=zmail.listObj[a].MO.length),b},P={currentWorkSpace:"",showOrgList:[],getTemplate:function(a,b){var c=void 0!==b.opentype?b.opentype:b.prms.opentype;b.prms&&"plainContent"===b.prms.type||(f(c),e());var d="";switch(a){case"content":d=t(b.data,b.prms);break;case"header":d=s(b)}return d},attPrevInr:function(a){var b,c=zmUtil.fileTyp(a.fn);return b=a.thn?"<img src='"+a.thn+"'>":"<i class='"+c[1]+"'></i>"},getSubjectToPreview:function(a){var b=d.common.noSubject;return zmail.showFeature?a:(a&&(b=_zm.unescapeTags(a),b.length>1e3?(b=b.substring(0,1e3)+"...",
b=_zm.escapeTags(b)):b=a),b)},bindPreviewEvents:function(b,c){var d;zmUtil.addSelectMenu({applyDOM:[b.find(".zmPCon")[0]]}),$(b).find(".zmflg").each(function(){$(this).unbind("contextmenu").contextmenu(function(b){a.consFlagContextMenu(b,this)})}),3!==c?(d=$(b).find(".SC_Twpr"),$(b).find(".SC_Twpr").scroll(function(){zmUtil.hideMenu()}),$(b).keydown(function(a){38!==a.keycode&&40!==a.keycode||zmUtil.hideMenu()})):d=$(b).find(".SCS_postMail"),d.off("click.mailView").on("click.mailView","div.SC_pct",function(a){zmAttach.util.removeMAct(),A(a,b,c);var d=a.target||a.srcElement;if($(d).hasClass("zm_ry")||$(d).parent().hasClass("zm_ry")){var e=$(d).closest(".SC_pct").find(".zmPHdr").attr("data-mid");if(zmPreviewTemplate.isTruncatedMail(e)){var f={mId:e,toHideVfcMsg:!0};zmPreviewTemplate.FCLoader(f,function(){B(a,b)})}else B(a,b)}!zmUtil.isChildWindow()&&zmList.listingFocused&&0===zmPreviewTemplate.currentWorkSpace&&(zmList.listingFocused=!1,$(d).hasClass("zm_icn")&&$(d).hasClass("zm_sqt")&&(zmList.listingFocused=!0))}),3===c&&$(b).find(".SC_ptit .msi-more").off("click").on("click",function(){var a={msgId:$(b).attr("msgId"),gid:$(b).attr("groupId"),opentype:2,isMail:!0,pid:$(b).attr("pid"),thId:$(b).attr("thId"),invokedFrom:"notification-popout",actionType:$(b).attr("actionType"),etype:"1"};if($.publish("zmstreamsapp/closeDialog",{}),!zmsuite.isMaxLimitReached()){var c=$(this).data("shared");if(c){var d;a.isSharedMail=!0,a.groupId!==zmail.zuid&&(d={viewDetails:{view:"zmncenter"}},a.tabId="zmncenter"),zmList.getMailData(a,d)}else zmStreamsApp.events.openPostInTab(a)}zmUtil.hideMenu()})},showImageDisplayElem:function(a,b,d){d=d||{};var e,f,g=(d.prefix||c)+a;if(e=zmContentCache.get(a).EXTIMG?zmContentCache.get(a).EXTIMG.link:"",e&&"none"!==e){var h={MESSAGE:3,SHOW_NOW:0,WHITELIST:1,BLACKLIST:2},j=b&&b.find("#ImgDis"+g)||$("#ImgDis"+g);f=j.children(),"display"===e?(f.eq(h.MESSAGE).show(),f.eq(h.SHOW_NOW).show()):"both"===e?(f.eq(h.MESSAGE).show(),f.eq(h.SHOW_NOW).show(),f.eq(h.WHITELIST).show()):"remove"===e&&f.eq(h.BLACKLIST).show(),f.eq(h.SHOW_NOW).unbind("click").click(function(){i(this,b),D("",a,this)}),f.eq(h.BLACKLIST).unbind("click").click(function(){i(this,b),I("del",zmail.mailObj[a].F)}),f.eq(h.WHITELIST).unbind("click").click(function(){i(this,b),I("add",zmail.mailObj[a].F)}),zmUtil.applyLBDots($("#ImgDis"+g)),d.isvfc&&"none"===d.imgStatus?f.eq(h.SHOW_NOW).click():d.isvfc&&"display"===d.imgStatus&&j.show(),d={}}},saveHTMLFile:function(a){var b,c="",d=zmail.mailObj[a.mId]||"",e={};zmUtil.isSharedFolder(d.FD)&&(b=zmUtil.getShareId(d.FD)),c=zmail.conPath+"/FileDownload?mode=msg",e={fName:"msg"+a.mId,entityId:a.mId,entityType:1},d.streams?(e.groupId=d.groupId,e.streamsView=!0,e.actionType="viewGroupEntity"):e.accId=zmail.accId,b&&c.length&&(e.shId=b),zmAjq.formSubmit(e,c)},showOrgMsg:function(a){var b,c="",d=a.mId,e=zmail.mailObj[d],f="h";b="/showOriginal.do",c=zmail.conPath+b+"?m="+d+"&sc="+f,e?(e.FD&&zmUtil.isSharedFolder(e.FD)&&(c+="&shId="+zmUtil.getShareId(e.FD)),c+=e.streams?"&accId="+e.accId+"&groupId="+e.groupId+"&streamsView=true&actionType=viewGroupMailEntity&entityType=1&entityId="+d:"&accId="+zmail.accId):c+="&accId="+zmail.accId,zmUtil.openWindow(c,"60","60")},garbMsg:function(a){var b="",c=a.mId,d=zmail.mailObj[c];b=zmail.conPath+"/gmsg.do?m="+c,d&&(d.FD&&zmUtil.isSharedFolder(d.FD)&&(b+="&shId="+zmUtil.getShareId(d.FD)),b+=d.streams?"&accId="+d.accId+"&groupId="+d.groupId+"&streamsView=true&actionType=viewGroupMailEntity&entityType=1&entityId="+c:"&accId="+zmail.accId);var e=window.open(b,"_blank");e.focus()},printMsg:function(a){var b=function(a){var b=zmContentCache.isCached(a)&&zmContentCache.get(a).EXTIMG;return!b||"none"===b.link},c=function(){var b=Dialog["new"]({title:d.print.warningTitle,ignoreMouseDown:!1,$content:"<span>"+d.print.warningMsg+"</span>",buttons:[{name:d.common.ok,callback:function(){b.remove(),mailPrinter.print(a)}},{name:d.common.cancel,callback:function(){b.remove()}}]})};zmAppLoader.load("mailPrinter").done(function(){b(a.mId)?mailPrinter.print(a):c(a)})},showProfilePhoto:function(a,b,c){try{var d=function(a,b){var c,d=zmail.aInfo[zmUtil.getZohoAccId()];return c=d.mailId===a?d.disName:b},e=c||zmContentCache.isCached(a.msgId)&&zmContentCache.get(a.msgId)||"";if("lt"===a.type&&!zmail.mailObj[a.msgId].T||"th"===a.type){var f=e.FROM||zmail.mailObj[a.msgId].F,g=e.SENDER||zmail.mailObj[a.msgId].SN,h=$(b).find(".zmPHdr");$(h).length||(h=$(b)),g||(g=f),"Me"===g&&(g=d(f,g)),zmail.ContactBook.get({str:f}).done(function(a){var c,d=a[0];c=d?d.avatar():zmail.ContactBook.Templates.avatar({isValidPhoto:!1,photo:void 0,initials:zmail.ContactBook.Utils.initials(f),avatarBgColor:zmail.ContactBook.Utils.colorClasses()}),$(h).find(".SC_pvul li img").remove(),$(h).find(".SC_pvul li").prepend(c),zmail.wmsAPI.showPresence(f,$(b).find(".SC_pvul .SC_avtr"))})}else zmail.mailObj[a.msgId].T&&$(b).find(".zmPHdr").each(function(){var a=$(this).attr("data-mid"),b=$(this).find(".SC_pvul li"),c=$(this).find(".SC_pvul img"),e=zmail.mailObj[a].F,f=zmail.mailObj[a].SN;f||(f=e),"Me"===f&&(f=d(e,f)),c.length&&e&&zmail.ContactBook.get({eid:e}).done(function(a){var c,d=a[0];c=d?d.avatar():zmail.ContactBook.Templates.avatar({isValidPhoto:!1,photo:void 0,initials:zmail.ContactBook.Utils.initials(e),avatarBgColor:zmail.ContactBook.Utils.colorClasses()}),$(b).find("div img").length||($(b).find("img").remove(),$(b).prepend(c),zmail.wmsAPI.showPresence(e,$(b).find(".SC_avtr")))})})}catch(i){zmUtil.debugLog(i)}},processReadReceipt:function(a){var b=d.common.readreceiptmsg,c=zmail.mailObj[a];if(!c||!c.streams){var e=0;c&&(void 0!==c.RR?e=c.RR:3===c.NS2&&(e=1));var f=zmail.mailOpt?zmail.mailOpt.askReceipt:1;if(1===e){if(c.FD===zmail.folId.spId)return;1===f?zmsDialog.confirm(b,{onOk:function(){J(a,"yes")},onCancel:function(){J(a,"no")}}):0===f?J(a,"yes"):J(a,"no")}}},showFullContent:function(a,b){var e,f,g,h=a.mdata.CONTENT?a.mdata.CONTENT:"",i=!1,k=b.prefix||c,l=b.msgId,m=$("#zmCon"+k+l);f=m.closest(".SC_Twpr"),g=f.scrollTop(),e=m.find(".zm_icn.zm_sqt.SC_ttip"),e.next().is(":visible")&&(i=!0),a.mdata.BLCKCON&&(h+="lt"===b.type&&zmail.mailObj[l].TC>=0||"content"===b.type?["<div class='zm_icn zm_sqt SC_ttip' data-tooltip='",d.contentOptions.showquote,"'></div>","<div style='display:none'>"+a.mdata.BLCKCON+"</div>"].join(""):a.mdata.BLCKCON),h&&m.find(".zmPCnt").html(h),e=m.find(".zm_icn.zm_sqt.SC_ttip"),e.length&&i&&j(e),f.scrollTop(g)},addMailsInView:function(a){var b,c,d,e,f,g,h=a.list||[],i=a.opentype,j=h.length,k=0,l="",m="",n="",o="";if(0!==j){for(a.contElem?(b=a.contElem,o=a.elemPrefix,d=a.viewDetails,i=a.opentype):0===i?(d=zmInit.getListingDetObj(),n="zm_Container",o="P",b=zmsuite.getCenter(n)[1].getNodes()[1].$el):2===i&&(n="zm_tabt"+zmail.mailObj[h[0]].T,d=zmsuite.getCenterOuter(n).$el.data("data-detail"),o="T",b=zmsuite.getCenter(n)[1].getNodes()[1].$el),g=b.find("div.SC_pct").length,k=0;k<j;k++)c=zmail.mailObj[h[k]],f={msgId:c.M,thd:!0,opentype:i,frm:c.F,sender:c.SN,hasAtt:c.AT,sm:c.SM,label:c.TAG,flag:c.NFG,date:c.DT,elemId:o+c.M,hdrId:"zmHdr"},!c.streams&&zmUtil.getMLConversionValue()&&(f.showIndex=!0),zmUtil.isChildWindow()||(e=c.FD===d.fId||!zmail.folCount[d.fId]),m=K(f,e),l=zmail.convSortOrder?m.concat(l):l.concat(m);for(l.length&&(1===zmail.convSortOrder||"showmore"===a.mode?$(l).insertAfter(b.find("div.SC_pct:last")):b.prepend($(l)),b.parent().addClass("tmail"),a.setscroll&&(1===zmail.convSortOrder?zmUtil.setPreviewScroll(b.find("div.SC_pct").eq(g),b):zmUtil.setPreviewScroll(b.find("div.SC_pct:first"),b))),k=0;k<j;k++)zmPreviewTemplate.showProfilePhoto({msgId:h[k],type:"th"},$("#zmHdr"+o+h[k]))}},discardMsgPreview:function(a){a&&(zmUtil.isChildWindow()?$("#zmHdrW"+a).parent().remove():($("#zmHdrP"+a).parent().remove(),$("#zmHdrT"+a).parent().remove(),$("#zmHdrS"+a).parent().remove()))},showNotifBand:function(a){var b=a.targetElem,c=a.thdId,e=[],f=a.opentype;0===f?e=zmPreviewTemplate.getMissingMailList(c,"P"):2===f&&(e=zmPreviewTemplate.getMissingMailList(c,"T")),zmPreviewTemplate.removeNotifBand(b);var g=_zm.getDOM(["DIV",{attrs:{"class":"SC_new_activity",style:"opacity:1;",id:"zms_newmail"},child:[["text"," "+d.common.notificationmsg+" "]]}]);$(b).append(g),$(g).off("click").on("click",function(c){zmPreviewTemplate.removeNotifBand(b),$.publish("/mail/updatemailview",[{list:e,opentype:a.opentype,setscroll:!0}]),_zm.stopEvents(c)})},removeNotifBand:function(a){$(a).find(".SC_new_activity").remove()},refreshLabelsForMail:u,updateMailHeaderView:v,toggleHeaderState:p,applyHeaderState:q,getRecipientCount:function(a){if(zmContentCache.isCached(a)){var b=zmContentCache.get(a),c=zmConUtil.splitncheck(b.TO||"","object").length;return c+=zmConUtil.splitncheck(b.CC||"","object").length,c+=zmConUtil.splitncheck(b.BCC||"","object").length}throw new Error(d.common.error)},alignMailTopToPreview:function(a){if(zmUtil.isMailOpenInPreview(a,zmTab.currentTab)){var b;"zm_Container"===zmTab.currentTab?b=$("#zmHdrP"+a):0===zmTab.currentTab.indexOf("zm_srch")&&(b=$("#zmHdrS"+a));var c=b.parent()[0],d=$(c).parent(".SC_Twpr")[0];d.scrollTop=c.offsetTop,$(c).removeClass("js-scrolltop")}},setPreviewHeaderHeight:function(a){if(a.prevElem){var b=$(a.prevElem).find(".SC_ptit"),c=$(a.prevElem).find(".SC_Twpr"),d=b[0].clientHeight;d&&c.css({top:d+"px"})}},addDraftsToView:function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o=0,p=0;if(!(b.length&&b.find(".SC_Drft").length>0)){zmail.listObj[a]&&(d=zmail.listObj[a].MO||[],o=d.length);var q=0;d=d||[],d.forEach(function(a,b){e=zmail.mailObj[a]||{},e.DMID&&q++}),0!==q&&(e=void 0,zmUtil.requireComposeModule().done(function(){for(p=0;p<o;p++)e=zmail.mailObj[d[p]],k="",e&&e.DMID&&(j=c+e.DMID,g=e.M,f=b.find("#zmHdr"+c+g).closest(".SC_pct"),"undefined"!=typeof zmComp&&(l=zmComp.getCmpObjId(g),k=l.cmpId,m=l.composerType||"inline"),k?(n=b.find("#zmCon"+c+e.DMID),n.length||(h=zmUtil.getCmpContainerTemplate(j,e.DMID),$(h).insertAfter(f),n=b.find("#zmCon"+j)),zmPreviewTemplate.showDraftedBand({draftId:e.DMID,msgId:g,composeId:k,elemPrefix:c,prevDOM:n,composerType:m})):(h=zmUtil.getCmpContainerTemplate(j,e.DMID),f.length&&($(h).insertAfter(f),i={mode:"draft",msgId:g,draftId:e.DMID,prevElem:b,draftCont:zmContentCache.get(e.DMID),loadType:"drafted",disableScrollIntoView:q>1},zmUtil.invokeComposer(i)))),zmUtil.setInlineCmpScope(!0)}))}},showDraftedBand:function(a){var b,c,e,f,g,h,i,j,k,l,m="inline";b=a.draftId,c=a.msgId,e=a.composeId,f=a.elemPrefix,k=a.prevDOM,g=k.closest(".SC_Twpr"),m=a.composerType;var n;j=g.find("#zmHdr"+f+c).closest(".SC_pct"),"tab"===m?(l=d.inlinecompose.editdraftintab,n=d.inlinecompose.editingmsg):(l=d.inlinecompose.edithere,n=d.inlinecompose.hasdraft),k.length||(k=g.find(".SC_Drft").find("[data-mid='"+c+"']")),!k.length&&j.length&&b&&(h=["DIV",{attrs:{"class":"SC_pct SC_Drft"},child:[["DIV",{attrs:{id:"zmHdr"+f+b,"class":"zmPHdr","data-mid":b}}],["DIV",{attrs:{id:"zmCon"+f+b},child:[["DIV",{attrs:{"class":"SC_simg"},child:[["FONT",{attrs:{"composer-type":m,"data-cmpid":e,"class":"zm_draft"},child:[["text",l]]}],["SPAN",{child:[["text",n]]}]]}]]}]]}],i=_zm.getDOM(h),$(i).insertAfter(j));var o,p=$("[data-mid="+b+"]").parents(".SC_pct.SC_Drft"),q=p.find("[id^=zmCon]"),r=["DIV",{attrs:{"class":"SC_simg"},child:[["FONT",{attrs:{"composer-type":m,"data-cmpid":e,"class":"zm_draft"},child:[["text",l]]}],["SPAN",{child:[["text",n]]}]]}];q.each(function(b,c){c=$(c),o=_zm.getDOM(r),c.find(".zm_cmp").length&&"replace_draft"!==a.actionType||c.html(o)}),k.length&&(o=_zm.getDOM(r),k.find(".zm_cmp").length&&"replace_draft"!==a.actionType||k.html(o)),zmUtil.applyLBDots($(document.body).find(".zm_draft").parent(".SC_simg"))},loadInlineCompose:function(a,b,c){if(a){var d,e,f,g,h={};if(zmail.mailObj[a]&&zmail.mailObj[a].FD===zmail.folId.dId?d=zmail.mailObj[a].PA:(d=a,a=zmail.mailObj[a].DMID),h=zmComp.getCmpObjId(d),e=h.cmpId,g=h.composerType||"inline",f={mode:"draft",msgId:d,draftId:a,prevElem:b.closest(".SC_Twpr"),draftCont:zmContentCache.get(a),loadType:"drafted",reopen:!0,cmpId:e},c&&(f.loadMode=c),"tab"!==g)if(b.find(".zm_draft").length)b.html("");else if(b.find(".zm_cmp").length){var i=b.find(".zm_cmp").offset().top;f.prevElem.scrollTop(i)}zmUtil.invokeComposer(f),zmUtil.setInlineCmpScope(!0)}},setSlideShow:function(a,b,c){for(var d,e,f=a.length,g=[],h="",i=0;i<f;i++)d=a[i],h=d.e,e=zmail.mailObj[h],d.gId=e&&e.streams?e.groupId:zmail.zuid,g.push(d);zmUtil.cacheImageForPreview(a)},getAddToMenu:function(b){var c=function(){var a=zmail.smartFilterStatus;return!!(zmail.isSmartFilterEnabled&&a&&a.Group|a.NewsLetter|a.Notification)},e=[],f={};f.align="pleft",f.clk=function(c,d){c.msgId=b,a.bindAction(c,d)},f.divId="zm_dropaddto";var g=zmUtil.isSharedFolder(zmail.mailObj[b].FD);return zmail.mailObj[b]&&zmail.mailObj[b].FD!==zmail.folId.sId&&zmail.mailObj[b].FD!==zmail.folId.spId&&(e=[{htm:d.contextmenu.filters,data:{action:"addfilter",msgId:b}}]),!zmUtil.isZohoAccount(zmail.accId)||zmUtil.isChildWindow()||g||e.push({htm:d.contextmenu.tasks,data:{action:"addtotasks"}}),zmUtil.isZohoAccount(zmail.accId)&&zmUtil.isNoteReactUser()&&!zmUtil.isChildWindow()&&!g&&e.push({htm:d.contextmenu.notes,data:{action:"addtonotes"}}),zmUtil.isZohoAccount(zmail.accId)&&!g&&zmAdHocSettings.getProjectInteg().enabled!==!1&&e.push({htm:d.contextmenu.projects,data:{action:"addtoprojects"}}),zmUtil.isZohoAccount(zmail.accId)&&c()&&zmail.mailObj[b]&&zmail.mailObj[b].FD!==zmail.folId.sId&&zmail.mailObj[b].FD!==zmail.folId.spId&&!g&&(e=e.concat({htm:"<i class='msi-larrow'></i>"+d.contentOptions.include,data:{action:"smartfiltermenu",msgId:b,menuDirection:"left"},child:function(){return zmPreviewTemplate.getSmartFilterMenu(b)}})),f.list=e,f},getSmartFilterMenu:function(b){var c=[],e={};e.align="pleft",e.clk=function(c,d){c.msgId=b,a.bindAction(c,d)},e.divId="zm_dropsmartfilter";var f,g,h,i=zmail.smartFilterStatus;g=[function(){return!!i.Notification&&(f={htm:d.smartfilter.notification,data:{action:"addsmartfilter",filtervalue:5,msgId:b}})},function(){return!!i.NewsLetter&&(f={htm:d.smartfilter.newsletter,data:{action:"addsmartfilter",filtervalue:6,msgId:b}})},function(){return!!i.Group&&(f={htm:d.smartfilter.group,data:{action:"addsmartfilter",filtervalue:7,msgId:b}})}];var j;for(h in g)j=g[h](),j&&c.push(j);return e.list=c,e},createNewFilter:function(a){var b,c=a.msgId,d="",e="",f="",g="",h=[],i={};if(c&&(b=zmContentCache.isCached(c)?zmContentCache.get(c):zmail.mailObj[c])){e=b.SUBJECT||b.SB||"",g=b.FROM||b.F||"",f=b.TO||b.TOADDR||"",d=g.substring(0,g.indexOf("@")),f?b.CC&&"NOT PROVIDED"!==b.CC.toUpperCase()&&(f=f+","+b.CC):b.CC&&"NOT PROVIDED"!==b.CC.toUpperCase()&&(f=b.CC),f?(f=f.replace(/&lt;/gi,"<"),f=f.replace(/&gt;/gi,">"),f=f.replace(/&quot;/gi,'"'),h=f.split(",")):h="";var j=h.length,k=0,l=[],m="",n={};for(l.push({rhs:e,operator:"contains",lhs:"subject"}),l.push({rhs:g,operator:"contains",lhs:"sender"}),k=0;k<j;k++)m=h[k],m.indexOf("<")!==-1&&(m=m.substring(m.lastIndexOf("<")+1,m.lastIndexOf(">"))),m=m.trim(),h[k]=m,n={rhs:m,operator:"contains",lhs:"to/cc"},l.push(n);i.criterias=l,i.name=d,i.matchingCondition="or",i.actionSrc=a.actionSrc,$.publish("FILTER_SUGGESTION",i)}},editFilter:function(){},loadPrevMail:function(){var a,c,d,e,f=zmTab.currentTab,g=zmPrev.prevDetails(),h=[],i=zmUtil.getMLConversionValue(),j=zmUtil.getSelectedMails(),k=j[0][0]||j[1][0];if(g.msgId||k){var l,m,n,o,p,q,r={};if(k=g.msgId,c=g.type,a=0,"zm_Container"===f&&"zmStreamTree"!==zmail.mailLeft.selLayerId)zmList.listingFocused=!0,r=zmInit.getListingDetObj(),r.fId===zmail.folId.spId&&2===i?i=1:r.fId!==zmail.folId.sId&&r.fId!==zmail.folId.tId||(i=0),"lt"===c?(q=0!==i&&zmail.mailObj[k]&&zmail.mailObj[k].TH?"t"+k:k,d=zmUtil.getFolId(),h=zmail.listObj[d].MO||[],l=h.indexOf(k),m=zmCenterListing.mailObjectAPI.getViewObject(k),m&&(n=m.$element,n.length||(m=zmList.getElemObj(f),n=m.find("#"+q))),n.length?(o=n.prev(),o.is(":visible")||(o=o.prev()),o.hasClass("zmTV")?(p=o.find(".zmL:last"),e=p.attr("id"),c="th"):o.hasClass("zmL")&&(e=o.attr("id"),c="lt")):e=h[l-1]):"th"===c&&(d=zmail.mailObj[k]?zmail.mailObj[k].T:"",d&&zmail.listObj[d]&&(h=zmList.getViewBasedMsgList(d,r)),l=h.indexOf(k),0===l?(m=zmCenterListing.mailObjectAPI.getViewParentOf("c"+k),m&&(n=m.$element,n.length||(m=zmList.getElemObj(f),n=m.find("#"+k).closest(".zmTV").prev())),n.length&&(o=n.prev(),o.is(":visible")||(o=o.prev()),o.hasClass("zmTV")?(p=o.find(".zmL:last"),e=p.attr("id"),c="th",q=k):o.hasClass("zmL")&&(e=o.attr("id"),q=e,c="lt"))):(q=k,e=h[l-1])),e&&zmPrev.updateListOnNavigation(k,b);else if("zm_srch1"===f)zmList.listingFocused=!0,b=zmSearchUtil.getSearchViewDetails(),h=zmSearchUtil.getSearchList()||[],l=h.indexOf(k),e=h[l-1],q=k;else if(!f.indexOf("zm_tab")){b=zmsuite.getCenterOuter().$el.data("data-detail"),g=zmsuite.getCenterOuter().$el.data("row-detail");var s=g.msgId;s.indexOf("t")||(s=s.substring(1)),c=g.type,d=zmUtil.getFolId(b),b.fId===zmail.folId.spId&&2===i?i=1:b.fId!==zmail.folId.sId&&b.fId!==zmail.folId.tId&&"search"!==b.view||(i=0),0!==i&&zmail.mailObj[k]&&zmail.mailObj[k].TH?(q="t"+zmail.mailObj[k].T,s=zmList.getDupThdRowId(k,d)):q=k,k.indexOf("t")||(k=k.substring(1)),"search"===d?h=zmSearchUtil.getSearchList():zmail.listObj[d]&&(h=zmail.listObj[d].MO||[]),l=h.indexOf(s);var t=zmUtil.getFolId();if(l===-1&&d===t){for(var u=zmsuite.getCenterOuter().$el.data("data-maillist"),v=u.indexOf(s),w=u[v-1];w&&h.indexOf(w)===-1;)v-=1,w=u[v-1];l=h.indexOf(w)+1}e=h[l-1],a=2,e&&zmPrev.updateListOnNavigation(s,b)}e?$.when(zmPrev.cmpClose()).then(function(d){d&&(zmList.getMailData({msgId:e,type:c,opentype:a,from:q}),"zm_Container"!==f&&"zm_srch1"!==f||!zmsuite.isWorkspaceAvailable(f)||("unread"!==b.view?zmUtil.initScroll(zmsuite.getCenter(f)[0].getNodes()[2].$el,e,q,"prev"):zmList.setScrollUnreadView(zmsuite.getCenter(f)[0].getNodes()[2].$el,e)),zmContentCache.remove(k))}):zmUtil.disableNavigation(f,"prev")}else{if(a=0,c="lt","zm_Container"===f&&"zmStreamTree"!==zmail.mailLeft.selLayerId){if(d=zmUtil.getFolId(),e=zmail.listObj[d].MO[0],!e)return}else{if("zm_srch1"!==f)return;if(e=zmSearchUtil.getSearchList()[0],!e)return}e&&zmList.getMailData({msgId:e,type:c,opentype:a})}},loadNextMail:function(){var a,b,c,d,e=zmTab.currentTab,f=zmPrev.prevDetails(),g=[],h=zmUtil.getMLConversionValue(),i=zmUtil.getSelectedMails(),j=i[0][0]||i[1][0];if(f.msgId||j){var k,l,m,n,o,p,q={};if(j||(j=f.msgId),b=f.type,a=0,"zm_Container"===e&&"zmStreamTree"!==zmail.mailLeft.selLayerId){if(zmList.listingFocused=!0,q=zmInit.getListingDetObj(),q.fId===zmail.folId.spId&&2===h?h=1:q.fId!==zmail.folId.sId&&q.fId!==zmail.folId.tId||(h=0),"lt"===b)if(p=0!==h&&zmail.mailObj[j]&&zmail.mailObj[j].TH?"t"+j:j,c=zmUtil.getFolId(),g=zmail.listObj[c].MO||[],k=g.indexOf(j),k===-1&&zmail.mailObj[j]&&zmail.mailObj[j].TH&&(j=f.msgId,p=p.indexOf("t")?j:"t"+j),k=g.indexOf(j),m=[],l=zmCenterListing.mailObjectAPI.getViewObject(j),l&&(m=l.$element||[],m.length||(l=zmList.getElemObj(e),m=l.find("#"+p))),m.length){if(n=m.next(),n.is(":visible")||(n=n.next()),n.hasClass("zmTV"))o=n.find(".zmL").eq(1),d=o.attr("id"),b="th",p=j;else if(n.hasClass("zmL")){var r=n.next();r.hasClass("zmTV")&&r.is(":visible")?(d=r.find(".zmL:first").attr("id"),b="th"):(d=n.attr("id"),b="lt")}}else d=g[k+1];else if("th"===b)if(c=zmail.mailObj[j]?zmail.mailObj[j].T:"",c&&zmail.listObj[c]&&(g=zmList.getViewBasedMsgList(c,q)),k=g.indexOf(j),p=j,k===g.length-1){var s;l=zmCenterListing.mailObjectAPI.getViewParentOf("c"+j),l&&(m=l.$element,m.length||(l=zmList.getElemObj(e),m=l.find("#"+j).closest(".zmTV").prev()),s=m.next().next()),s.length&&(d=s.attr("id"),zmail.mailObj[d]&&zmail.mailObj[d].TH?(n=s.next(),n.hasClass("zmTV")&&n.is(":visible")||(n=n.prev()),n.hasClass("zmTV")?(o=n.find(".zmL:first"),d=o.attr("id"),b="th"):n.hasClass("zmL")&&(d=n.attr("id"),b="lt")):b="lt")}else d=g[k+1];d&&zmPrev.updateListOnNavigation(j,q)}else if("zm_srch1"===e)zmList.listingFocused=!0,q=zmSearchUtil.getSearchViewDetails(),g=zmSearchUtil.getSearchList()||[],k=g.indexOf(j),d=g[k+1],p=j;else if(!e.indexOf("zm_tab")){q=zmsuite.getCenterOuter().$el.data("data-detail"),f=zmsuite.getCenterOuter().$el.data("row-detail");var t=f.msgId;t.indexOf("t")||(t=t.substring(1)),b=f.type,c=zmUtil.getFolId(q),q.fId===zmail.folId.spId&&2===h?h=1:q.fId!==zmail.folId.sId&&q.fId!==zmail.folId.tId&&"search"!==q.view||(h=0),0!==h&&zmail.mailObj[j]&&zmail.mailObj[j].TH?(p="t"+zmail.mailObj[j].T,t=zmList.getDupThdRowId(j,c)):p=j,j.indexOf("t")||(j=j.substring(1)),"search"===c?g=zmSearchUtil.getSearchList():zmail.listObj[c]&&(g=zmail.listObj[c].MO||[]),k=g.indexOf(t);var u=zmUtil.getFolId();if(k===-1&&c===u){for(var v=zmsuite.getCenterOuter().$el.data("data-maillist"),w=v.indexOf(t),x=v[w+1];x&&g.indexOf(x)===-1;)w+=1,x=v[w+1];k=g.indexOf(x)-1}d=g[k+1],a=2,d&&zmPrev.updateListOnNavigation(t,q)}d?($.when(zmPrev.cmpClose()).then(function(c){c&&(zmList.getMailData({msgId:d,type:b,opentype:a,from:p}),"zm_Container"!==e&&"zm_srch1"!==e||!zmsuite.isWorkspaceAvailable(e)||("unread"!==q.view?zmUtil.initScroll(zmsuite.getCenter(e)[0].getNodes()[2].$el,d,p,"next"):zmList.setScrollUnreadView(zmsuite.getCenter(e)[0].getNodes()[2].$el,d)))}),zmContentCache.remove(j)):zmUtil.disableNavigation(e,"next")}else{if(a=0,b="lt","zm_Container"===e&&"zmStreamTree"!==zmail.mailLeft.selLayerId){if(c=zmUtil.getFolId(),d=zmail.listObj[c].MO[0],!d)return}else{if("zm_srch1"!==e)return;if(d=zmSearchUtil.getSearchList()[0],!d)return}d&&zmList.getMailData({msgId:d,type:b,opentype:a})}},showUnsubscribe:function(a,b){if(zmContentCache.isCached(a)){var c=zmContentCache.get(a);c.USOBJ&&!$.isEmptyObject(c.USOBJ)&&($(b).find("[data-mid='"+a+"'] .zm_unsub").show(),c.USOBJ.USA===!0&&$(b).find("[data-mid='"+a+"'] .zm_unsub").text(d.newsletter.unsubscribed).removeClass("SC_lnk"))}},processUnsubscription:function(a,b){var c=function(c,e){"success"===c.status?(b&&$(b).length&&($(b).find("[data-mid='"+a+"'] .zm_unsub").text(d.newsletter.unsubscribed).removeClass("SC_lnk"),zmUtil.isChildWindow()||zmPreviewTemplate.updateUnsubscribeStatus(a)),zmContentCache.isCached(e.msgId)&&(zmContentCache.get(e.msgId).USOBJ.USA=!0),_zm.succErrMsg("s",d.newsletter.unsub_success)):_zm.succErrMsg("e",d.newsletter.unsub_failure)},e=function(b,d,e){e=e||c,zmContentCache.get(a).USOBJ.USA||zmAjq.XHR({u:zmail.conPath+"/unsubscribe.do",t:"POST",fn:e,p:b,ep:d,csr:"s"})},f=function(){var b,c,f=zmContentCache.get(a).USOBJ;b={accId:zmail.accId,mode:"add",msgId:a},c={msgId:a},f.USL?b.link=f.USL:f.USM&&(b.send=!0,b.mailto=f.USM,b.from=zmail.aInfo[zmail.accId].mailId,f.USS&&(b.subject=f.USS),f.USC&&(b.content=f.USC)),zmsDialog.confirm(d.newsletter.confirm_link,{onOk:function(){zmsDialog.remove(),e(b,c)}})},g=function(){if(!$("#unsubscribepopup").length){var b=["DIV",{attrs:{id:"unsubscribepopup",style:""},child:[["H4",{child:[["text",d.newsletter.confirm_mail],["DIV",{attrs:{"class":"mail_opt"},child:[["I",{attrs:{"class":"msi-option",value:"true"}}],["SPAN",{child:[["text",d.newsletter.confirm_mail_unsubscribe]]}]]}],["DIV",{attrs:{"class":"mail_opt"},child:[["I",{attrs:{"class":"msi-unoption",value:"false"}}],["SPAN",{child:[["text",d.newsletter.confirm_mail_markspam]]}]]}]]}]]}],c=_zm.getDOM(b);$("body").append(c);var f=$("div.mail_opt",c),g=$("i",f);f.on("click",function(){g.removeClass().addClass("msi-unoption"),$(this).closest("div").find("i").removeClass().addClass("msi-option")});var h=function(){var b,c,d,g=zmContentCache.get(a).USOBJ;b={accId:zmail.accId,mode:"add",msgId:a},c={msgId:a},g.USM&&(d=$("i.msi-option",f).attr("value"),b.mailto=g.USM,b.from=zmail.aInfo[zmail.accId].mailId,g.USS&&(b.subject=g.USS),g.USC&&(b.content=g.USC),"true"===d&&(b.send=!0),zmsDialog.remove(),e(b,c))},i={title:d.newsletter.unsubscribe,style:{width:"500px"},buttons:[{txt:d.common.ok,selected:!0,callback:h},{isCancel:!0,txt:d.common.cancel,callback:function(){zmsDialog.remove(),$("#unsubscribepopup").remove()}}],drag:!0,mask:!0,hideclose:!1,pos:"center"};zmsDialog.create("unsubscribepopup",i)}},h=function(a){"success"===a.status&&(a.valid?f():g())};if(zmContentCache.isCached(a)){var i,j=zmContentCache.get(a),k={},l={},m={};if(i=j.USOBJ,!i||i.USA===!0)return;i.USL?(m.link=i.USL,l={msgId:a,selector:b},h({status:"success",valid:!0},l)):i.USM&&(k={accId:zmail.accId,mode:"check",msgId:a},l={msgId:a,selector:b},e(k,l,h))}},updateUnsubscribeStatus:function(a){if(a){var b,c,e,f=zmTab.tabArr;for(b=0;b<f.length;b++)e=f[b].appId,zmsuite.isWorkspaceAvailable(e)&&zmsuite.getCenter(e)[1]&&(c=zmsuite.getCenter(e)[1].getNodes()[1].$el,c.find("[data-mid='"+a+"'] .zm_unsub").text(d.newsletter.unsubscribed))}},updateRSVPSchema:function(a,b){var c=zmail.mailObj[a];if(c&&(!c||c.SCOBJ)){var e=c.SCOBJ[0];if(c&&e&&"RSVPACTION"===e.SCATYPE&&("RSVPACTION"!==e.SCATYPE||!e.ASTATUS||e.RSVPSTUS!==b)){var f=["yes","no","disable:0","disable:1"];if(e.SHOWMB&&f.push("maybe","disable:2"),f.indexOf(b)!==-1){var g={msgId:a,accountId:zmail.accId,actName:e.SCATYPE,updCal:!1},h=$.extend({},g);switch(b){case"yes":case"disable:1":g.rsvpStatus=d.calendar.yes.toLowerCase(),h.rsvpStatus=d.calendar.yes;break;case"no":case"disable:2":g.rsvpStatus=d.calendar.no.toLowerCase(),h.rsvpStatus=d.calendar.no;break;case"maybe":case"disable:3":g.rsvpStatus=d.calendar.maybe.toLowerCase(),h.rsvpStatus=d.calendar.maybe}if(g.rsvpStatus!==e.RSVPSTUS){var i=function(b,c){if("SUCCESS"===b.ASTATUS){e.ASTATUS=!0,e.RSVPSTUS=c.rsvpStatus.toLowerCase();var d={msgId:a,actName:"RSVPACTION",suppress:!0,rsvpStatus:c.rsvpStatus};zmUtil.isChildWindow()&&window.opener?window.opener.$.publish("/mail/updateSchema",d):$.publish("/mail/updateSchema",d)}},j=function(a){zmUtil.debugLog("Error while updating RSVP schema"+a.msg)},k={u:zmail.conPath+"/executeActSchema.do",t:"POST",fn:i,onerror:j,p:g,ep:h};zmAjq.XHR(k)}}}}},showInvitation:function(a,b,e){if(a&&zmContentCache.isCached(a)&&zmContentCache.get(a).CALOBJ){var f,g,h=zmContentCache.get(a),i=h.CALOBJ,j=i.mtd,k="",l="",m=i.GroupId,n=[],o=e&&e.prefix,p=i.attendee?i.attendee.length:0;l=h.TO||"",l=zmConUtil.splitncheck(l,"object"),i.desc&&(i.desc=i.desc.replace(/\\n/g,"\n").replace(/\\t/g,"\t").replace(/\\r/g,"\r").replace(/\\b/g,"\b").replace(/\\v/g,"\x0B").replace(/\\f/g,"\f"));var q=function(a){var b="",c=[];if(b=a[0].eid,a.length>1){for(var d in zmail.aInfo)c.push(zmail.aInfo[d].mailId);for(var e=0;e<a.length;e++)if(c.indexOf(a[e].eid)!==-1){b=a[e].eid;break}}return b};for(l=l.length?q(l):"",g=0;g<p;g++)n.push(i.attendee[g].emailId);var r=function(){var a,b=zmail.defaultPhoto;a=h.FROM;var c=null;return c=zmail.ContactBook.get({promise:!1,eid:a,type:["personal","org"]})[0],c&&(b=c.photo(!1)),b},s=function(a){var b={};if(a){var c=a.split(",");if(c.length>0){var d=c[0];if(d){var e=d.split(" ");3===e.length&&(b.day=e[0],b.month=e[1],b.date=e[2])}}}return b},t=s(i.time),u=r(),v={eventAttendees:function(){var a,b=[];for(a=0;a<p;a++)b.push(["B",{child:[["text",i.attendee[a].emailId]]}]),a<p-1&&b.push(["text",", "]);var c=["P",{child:b}];return c},eventStatus:function(a){var b=[],c=[],e=!1;return"yes"===a?(e=!0,b.push(["LI",{attrs:{"class":"sel","data-type":"evntSts1"},child:[["text",d.calendar.yes]]}],["LI",{attrs:{"data-type":"evntSts3"},child:[["text",d.calendar.maybe]]}],["LI",{attrs:{"data-type":"evntSts2"},child:[["text",d.calendar.no]]}])):"no"===a?(e=!0,b.push(["LI",{attrs:{"data-type":"evntSts1"},child:[["text",d.calendar.yes]]}],["LI",{attrs:{"data-type":"evntSts3"},child:[["text",d.calendar.maybe]]}],["LI",{attrs:{"class":"sel","data-type":"evntSts2"},child:[["text",d.calendar.no]]}])):"maybe"===a?(e=!0,b.push(["LI",{attrs:{"data-type":"evntSts1"},child:[["text",d.calendar.yes]]}],["LI",{attrs:{"class":"sel","data-type":"evntSts3"},child:[["text",d.calendar.maybe]]}],["LI",{attrs:{"data-type":"evntSts2"},child:[["text",d.calendar.no]]}])):"nostatus"===a&&(e=!0,b.push(["LI",{attrs:{"data-type":"evntSts1"},child:[["text",d.calendar.yes]]}],["LI",{attrs:{"data-type":"evntSts3"},child:[["text",d.calendar.maybe]]}],["LI",{attrs:{"data-type":"evntSts2"},child:[["text",d.calendar.no]]}])),e&&(c=["UL",{attrs:{"data-type":"event_status","class":"zmEventAction"},child:b}]),c},eventCreatedAndAdded:function(a){var b,c={};return c=["DIV",{attrs:{"class":"zmEventInfo zmEvInv"},child:[["DIV",{attrs:{"class":"zmEventWra"},child:[["DIV",{attrs:{"class":"zmEventDate"},child:[["text",t.month],["SPAN",{child:[["text",t.date]]}],["text",t.day]]}],["DIV",{attrs:{"class":"zmEventIC"},child:[["STRONG",{child:[["text",p]]}],["text"," "+d.calendar.invited]]}],["DIV",{attrs:{"class":"zmEventData"},child:[["DIV",{attrs:{"class":"zmEventOr"},child:[["DIV",{attrs:{"class":"zmImg"},child:[["IMG",{attrs:{src:u}}]]}],["STRONG",{child:[["text",h.SENDER]]}],["B",{child:[["text",h.FROM]]}],["text",d.calendar.invitesyou]]}],["H3",{child:[["text",i.title]]}],["P",{child:[["text",i.time]]}],v.eventAttendees(),v.eventStatus(a),["B",{attrs:{"data-type":"viewEvent"},child:[["text",d.calendar.viewevent]]}]]}]]}]]}],b=_zm.getDOM(c)},inviteAccepted:function(){var a,b={};return b=["DIV",{attrs:{"class":"zmEventInfo zmEvAcc"},child:[["DIV",{attrs:{"class":"zmEventStatus"},child:[["text",zmText.applyArgs(d.calendar.acceptedmsg,{sendername:h.SENDER})]]}],["DIV",{attrs:{"class":"zmEventWra"},child:[["DIV",{attrs:{"class":"zmEventDate"},child:[["text",t.month],["SPAN",{child:[["text",t.date]]}],["text",t.day]]}],["DIV",{attrs:{"class":"zmEventData"},child:[["DIV",{attrs:{"class":"zmEventOr"},child:[["DIV",{attrs:{"class":"zmImg"},child:[["IMG",{attrs:{src:u}}]]}],["STRONG",{child:[["text",h.SENDER]]}],["B",{child:[["text",h.FROM]]}]]}],["H3",{child:[["text",i.title]]}],["P",{child:[["text",i.time]]}]]}]]}]]}],a=_zm.getDOM(b)},inviteDeclined:function(){var a,b={};return b=["DIV",{attrs:{"class":"zmEventInfo zmEvDec"},child:[["DIV",{attrs:{"class":"zmEventStatus"},child:[["text",zmText.applyArgs(d.calendar.declinedmsg,{sendername:h.SENDER})]]}],["DIV",{attrs:{"class":"zmEventWra"},child:[["DIV",{attrs:{"class":"zmEventDate"},child:[["text",t.month],["SPAN",{child:[["text",t.date]]}],["text",t.day]]}],["DIV",{attrs:{"class":"zmEventData"},child:[["DIV",{attrs:{"class":"zmEventOr"},child:[["DIV",{attrs:{"class":"zmImg"},child:[["IMG",{attrs:{src:u}}]]}],["STRONG",{child:[["text",h.SENDER]]}],["B",{child:[["text",h.FROM]]}]]}],["H3",{child:[["text",i.title]]}],["P",{child:[["text",i.time]]}]]}]]}]]}],a=_zm.getDOM(b)},inviteTentativelyAccepted:function(){var a,b={};return b=["DIV",{attrs:{"class":"zmEventInfo zmEvMay"},child:[["DIV",{attrs:{"class":"zmEventStatus"},child:[["text",zmText.applyArgs(d.calendar.tentativemsg,{sendername:h.SENDER})]]}],["DIV",{attrs:{"class":"zmEventWra"},child:[["DIV",{attrs:{"class":"zmEventDate"},child:[["text",t.month],["SPAN",{child:[["text",t.date]]}],["text",t.day]]}],["DIV",{attrs:{"class":"zmEventData"},child:[["DIV",{attrs:{"class":"zmEventOr"},child:[["DIV",{attrs:{"class":"zmImg"},child:[["IMG",{attrs:{src:u}}]]}],["STRONG",{child:[["text",h.SENDER]]}],["B",{child:[["text",h.FROM]]}]]}],["H3",{child:[["text",i.title]]}],["P",{child:[["text",i.time]]}]]}]]}]]}],a=_zm.getDOM(b)},eventCreatedAndNotAdded:function(){var a,b={};return b=["DIV",{attrs:{"class":"zmEventInfo zmEvInv"},child:[["DIV",{attrs:{"class":"zmEventWra"},child:[["DIV",{attrs:{"class":"zmEventDate"},child:[["text",t.month],["SPAN",{child:[["text",t.date]]}],["text",t.day]]}],["DIV",{attrs:{"class":"zmEventIC"},child:[["STRONG",{child:[["text",p]]}],["text"," "+d.calendar.invited]]}],["DIV",{attrs:{"class":"zmEventData"},child:[["DIV",{attrs:{"class":"zmEventOr"},child:[["DIV",{attrs:{"class":"zmImg"},child:[["IMG",{attrs:{src:u}}]]}],["STRONG",{child:[["text",h.SENDER]]}],["B",{child:[["text",h.FROM]]}],["text",d.calendar.invitesyou]]}],["H3",{child:[["text",i.title]]}],["P",{child:[["text",i.time]]}],v.eventAttendees(),["P",{child:[["text",i.desc]]}],["B",{attrs:{"data-type":"viewEvent",style:"display:none"},child:[["text",d.calendar.viewevent]]}],["P",{child:[["B",{attrs:{"data-type":"addToCal"},child:[["text",d.calendar.addtocal]]}]]}]]}]]}]]}],a=_zm.getDOM(b);
},eventCancelled:function(){var a,b={};return b=["DIV",{attrs:{"class":"zmEventInfo zmEvCan"},child:[["DIV",{attrs:{"class":"zmEventWra"},child:[["DIV",{attrs:{"class":"zmEventDate"},child:[["text",t.month],["SPAN",{child:[["text",t.date]]}],["text",t.day]]}],["DIV",{attrs:{"class":"zmEventData"},child:[["DIV",{attrs:{"class":"zmEventOr"},child:[["DIV",{attrs:{"class":"zmImg"},child:[["IMG",{attrs:{src:u}}]]}],["STRONG",{child:[["text",h.SENDER]]}],["B",{child:[["text",h.FROM]]}]]}],["H3",{child:[["text",i.title]]}],["P",{child:[["text",i.time]]}]]}]]}],["DIV",{attrs:{"class":"zmEventTag"},child:[["SPAN",{child:[["text",d.calendar.cancelled]]}]]}]]}],a=_zm.getDOM(b)},eventAddedExpired:function(a){var b,c={};return c=["DIV",{attrs:{"class":"zmEventInfo zmEvExp"},child:[["DIV",{attrs:{"class":"zmEventWra"},child:[["DIV",{attrs:{"class":"zmEventDate"},child:[["text",t.month],["SPAN",{child:[["text",t.date]]}],["text",t.day]]}],["DIV",{attrs:{"class":"zmEventIC"},child:[["STRONG",{child:[["text",p]]}],["text"," "+d.calendar.invited]]}],["DIV",{attrs:{"class":"zmEventData"},child:[["DIV",{attrs:{"class":"zmEventOr"},child:[["DIV",{attrs:{"class":"zmImg"},child:[["IMG",{attrs:{src:u}}]]}],["STRONG",{child:[["text",h.SENDER]]}],["B",{child:[["text",h.FROM]]}],["text",d.calendar.invitesyou]]}],["H3",{child:[["text",i.title]]}],["P",{child:[["text",i.time]]}],v.eventAttendees(),v.eventStatus(a),["B",{attrs:{"data-type":"viewEvent"},child:[["text",d.calendar.viewevent]]}],["P",{child:[["B",{attrs:{"data-type":"deleteEvent"},child:[["text",d.calendar.deleteevent]]}]]}]]}]]}],["DIV",{attrs:{"class":"zmEventTag"},child:[["SPAN",{child:[["text",d.calendar.expired]]}]]}]]}],b=_zm.getDOM(c)},eventNotAddedExpired:function(){var a,b={};return b=["DIV",{attrs:{"class":"zmEventInfo zmEvExp"},child:[["DIV",{attrs:{"class":"zmEventWra"},child:[["DIV",{attrs:{"class":"zmEventDate"},child:[["text",t.month],["SPAN",{child:[["text",t.date]]}],["text",t.day]]}],["DIV",{attrs:{"class":"zmEventIC"},child:[["STRONG",{child:[["text",p]]}],["text"," "+d.calendar.invited]]}],["DIV",{attrs:{"class":"zmEventData"},child:[["DIV",{attrs:{"class":"zmEventOr"},child:[["DIV",{attrs:{"class":"zmImg"},child:[["IMG",{attrs:{src:u}}]]}],["STRONG",{child:[["text",h.SENDER]]}],["B",{child:[["text",h.FROM]]}],["text",d.calendar.invitesyou]]}],["H3",{child:[["text",i.title]]}],["P",{child:[["text",i.time]]}],v.eventAttendees()]}]]}],["DIV",{attrs:{"class":"zmEventTag"},child:[["SPAN",{child:[["text",d.calendar.expired]]}]]}]]}],a=_zm.getDOM(b)},eventInfo:function(){var a,b={};return b=["DIV",{attrs:{"class":"zmEventInfo zmEvInv"},child:[["DIV",{attrs:{"class":"zmEventWra"},child:[["DIV",{attrs:{"class":"zmEventDate"},child:[["text",t.month],["SPAN",{child:[["text",t.date]]}],["text",t.day]]}],["DIV",{attrs:{"class":"zmEventIC"},child:[["STRONG",{child:[["text",p]]}],["text"," "+d.calendar.invited]]}],["DIV",{attrs:{"class":"zmEventData"},child:[["DIV",{attrs:{"class":"zmEventOr"},child:[["DIV",{attrs:{"class":"zmImg"},child:[["IMG",{attrs:{src:u}}]]}],["STRONG",{child:[["text",h.SENDER]]}],["B",{child:[["text",h.FROM]]}]]}],["H3",{child:[["text",i.title]]}],["P",{child:[["text",i.time]]}],v.eventAttendees()]}]]}]]}],a=_zm.getDOM(b)},eventsNotImported:function(){var a,b={};return b=["DIV",{attrs:{"class":"zmEventInfo zmEvInv"},child:[["DIV",{attrs:{"class":"zmEventWra"},child:[["DIV",{attrs:{"class":"zmEventDate"},child:[["text",t.month],["SPAN",{child:[["text",t.date]]}],["text",t.day]]}],["DIV",{attrs:{"class":"zmEventIC"},child:[["STRONG",{child:[["text",p]]}],["text"," "+d.calendar.invited]]}],["DIV",{attrs:{"class":"zmEventData"},child:[["DIV",{attrs:{"class":"zmEventOr"},child:[["DIV",{attrs:{"class":"zmImg"},child:[["IMG",{attrs:{src:u}}]]}],["STRONG",{child:[["text",h.SENDER]]}],["B",{child:[["text",h.FROM]]}],["text",d.calendar.invitesyou]]}],["H3",{child:[["text",i.title]]}],["P",{child:[["text",i.time]]}],v.eventAttendees(),["P",{child:[["B",{attrs:{"data-type":"addToCal"},child:[["text",d.calendar.addtocal]]}]]}]]}]]}]]}],a=_zm.getDOM(b)}},w={getAttendeeStatus:function(){var a=$.Deferred(),b=function(b){return a.resolve(),b},c=function(b){return a.resolve(),b},d={toMailId:l,jsoparam:JSON.stringify(i)},e={url:zmail.conPath+"/zcal/api/private/json/getAttendeeStatus",type:"POST",success:b,error:c,data:d};return $.ajax(e)},showEventStatus:function(){switch(k){case"nostatus":case"yes":case"no":case"maybe":f=v.eventCreatedAndAdded(k);break;case"disable":f=v.eventNotAddedExpired();break;case"disable:0":f=v.eventAddedExpired("nostatus");break;case"disable:1":f=v.eventAddedExpired("yes");break;case"disable:2":f=v.eventAddedExpired("no");break;case"disable:3":f=v.eventAddedExpired("maybe");break;case"No Change":"CANCEL"===j?f=v.eventCancelled():"REPLY"===j?"accepted"===i.status?f=v.inviteAccepted():"declined"===i.status?f=v.inviteDeclined():"tentatively accepted"===i.status&&(f=v.inviteTentativelyAccepted()):"ADD"!==j&&"COUNTER"!==j&&"REFRESH"!==j&&"DECLINECOUNTER"!==j||(f=v.eventInfo());break;case"Add Event":f=v.eventsNotImported();break;case"Update Event":f=v.eventInfo();break;default:f=v.eventCreatedAndNotAdded()}o=o||c;var d=e&&"print"===e.from?$(b):$(b).find("#zmCon"+o+a);if(!d.find("div.zmEventInfo").length){var g=d.find("div.zmPCnt td:first div");g.length>0?g.eq(0).prepend(f):d.find("div.zmPCnt td:first").prepend(f)}},parseStatusResponse:function(a){var b="";if("REQUEST"===j)if(a=$.parseJSON(a),a.time&&(i.time=a.time,t=s(i.time)),void 0!==a.isEventAvailable&&a.isEventAvailable)if(void 0!==a.isExpired&&a.isExpired){if(void 0!==a.status)return"disable:"+a.status;if("zcrm"===i.service)return"disable"}else void 0!==a.status&&(a=String(a.status));else{if(void 0!==a.isExpired&&a.isExpired)return"disable";if(m&&n.indexOf(zmail.aInfo[zmail.accId].mailId)===-1)return"Update Event"}else if("CANCEL"===j||"PUBLISH"===j)return a;if(a.length<=3)switch(a){case"0":b="nostatus";break;case"1":b="yes";break;case"2":b="no";break;case"3":b="maybe";break;case"4":b="disable";break;default:b=""}else b="";return b},updateStatus:function(b,c){if(b){var e={jsoparam:JSON.stringify(i),toMailId:l,status:b},f=function(){c&&($(c).closest(".zmEventAction").children().removeClass("sel"),$(c).addClass("sel"))},g=function(c){c instanceof Object||(c=c.trim(),"Status Updated"===c?(k=b,zmUtil.succErrMsg("s",d.calendar.statusupdated),f(),zmPreviewTemplate.updateRSVPSchema(a,b)):"Status Update Failed"===c?zmUtil.succErrMsg("e",d.calendar.statusfailed):"Event Expired"===c?zmUtil.succErrMsg("e",d.calendar.expired):"Event Not present in calendar"===c&&zmUtil.succErrMsg("e",d.calendar.noevent))},h=function(a){a&&(a instanceof Object?zmUtil.succErrMsg("e",a.statusText):zmUtil.succErrMsg("e",d.calendar.statusfailed))},j={url:zmail.conPath+"/zcal/api/private/json/StatusUpdate",type:"POST",success:g,error:h,data:e};$.ajax(j)}},acceptInvitation:function(a){"yes"!==k&&w.updateStatus("yes",a)},declineInvitation:function(a){"no"!==k&&w.updateStatus("no",a)},tentativeAcceptance:function(a){"maybe"!==k&&w.updateStatus("maybe",a)},viewEventInCalendar:function(){var a=$.extend({},i);delete a.desc;var b="//"+zmail.urls.calURL+"/mailapiact.do?mode=viewmaileve&jsoparam="+encodeURIComponent(JSON.stringify(a)),c=window.open(b,"_blank");c.focus()},addEventToCalendar:function(b){var c=function(){if(b){var a=$(b).closest(".zmEventData");a.find("[data-type='addToCal']").remove()}},e=function(){if(b){var a=$(b).closest(".zmEventData");a.find("[data-type='viewEvent']").show()}},f=function(a){if(a){try{$.parseJSON(a),a=$.parseJSON(a)}catch(b){}a instanceof Object?(a=a.response?a.response:a,a.error&&a.error.message?zmUtil.succErrMsg("e",a.error.message):zmUtil.succErrMsg("e",d.attachmentmenu.eventerror)):(a=a.trim(),"Added Successfully"===a?(zmUtil.succErrMsg("s",d.attachmentmenu.eventadded),e(),c()):"Event Updated Successfully"===a&&(zmUtil.succErrMsg("s",d.attachmentmenu.eventupdated),e(),c()))}},g=function(a){a&&(a instanceof Object?zmUtil.succErrMsg("e",a.statusText):zmUtil.succErrMsg("e",d.attachmentmenu.eventerror))},h={url:zmail.conPath+"/zcal/mailapiact.do?mode=addmaileve",type:"POST",success:f,error:g,data:{msgId:a,accId:zmail.accId,jsoparam:JSON.stringify(i)}};$.ajax(h)},deleteEventFromCalendar:function(a){var b={jsoparam:JSON.stringify(i)},c=function(){if(a){var b=$(a).closest(".zmEventData");b.find(".zmEventAction").remove(),b.find("[data-type='viewEvent']").remove(),b.find("[data-type='deleteEvent']").remove()}},e=function(a){var b;void 0!==a.response&&a.response.result&&(b=a.response.result.eKey,c(),"0"!==b?zmUtil.succErrMsg("s",d.calendar.eventdeleted):"0"===b&&zmUtil.succErrMsg("s",d.calendar.deletedalready))},f=function(a){a&&(a instanceof Object?zmUtil.succErrMsg("e",a.statusText):zmUtil.succErrMsg("e",d.calendar.deletionfailed))},g={url:zmail.conPath+"/zcal/mailapiact.do?mode=deletemaileve",type:"POST",success:e,error:f,data:b};$.ajax(g)},bindEvents:function(){var a=$(f);a.off("click").on("click",function(a){var b,c=a.srcElement||a.target;switch(b=$(c).attr("data-type")||""){case"evntSts1":$(c).closest(".zmEventAction").children().removeClass("sel"),$(c).addClass("sel"),w.acceptInvitation(c);break;case"evntSts2":$(c).closest(".zmEventAction").children().removeClass("sel"),$(c).addClass("sel"),w.declineInvitation(c);break;case"evntSts3":$(c).closest(".zmEventAction").children().removeClass("sel"),$(c).addClass("sel"),w.tentativeAcceptance(c);break;case"viewEvent":w.viewEventInCalendar(c);break;case"addToCal":w.addEventToCalendar(c);break;case"deleteEvent":w.deleteEventFromCalendar(c)}})}};"PUBLISH"===j||"REQUEST"===j||"CANCEL"===j?$.when(w.getAttendeeStatus()).then(function(b){k=w.parseStatusResponse(b),k=k.trim(),w.showEventStatus(),e&&"print"!==e.from||w.bindEvents(),zmPreviewTemplate.updateRSVPSchema(a,k)}):"REPLY"!==j&&"COUNTER"!==j&&"ADD"!==j&&"REFRESH"!==j&&"DECLINECOUNTER"!==j||(k="No Change",w.showEventStatus(),e&&"print"!==e.from||w.bindEvents())}},addShowMoreMailsLink:function(a,b){if(a.contElem.length){var c='<div class="SC_simg"><font class="zm_shwconv">'+d.contentOptions.showmore+"</font></div>";$(c).insertAfter(a.contElem.find("div.SC_pct:last")),a.contElem.find(".zm_shwconv").off("click").on("click",function(){$(this).parent().remove(),zmPreviewTemplate.fetchMoreMails(a.contElem.parent(),b)})}},fetchMoreMails:function(a,b){var d,e=$(a).find("div.SC_pct:first").parent(),f=e.data("msg_params"),g={accId:zmail.accId,summary:!0},h=f.msgId;if(h.indexOf("t")!==-1&&(h=h.substring(1)),d=zmail.mailObj[h]?zmail.mailObj[h].T:""){var i=!1;zmUtil.isChildWindow()&&(i=!0),g.thId=d,f.shId&&zmUtil.getFolderIdwithShId(f.shId)&&(g.shId=f.shId),f.streamsShowMail&&(g.accId=zmail.mailObj[h].accId||zmail.accId,g.streamsView=!0),f.entityType&&(g.entityType=f.entityType),f.actionType&&(g.actionType=f.actionType),f.groupId&&(g.groupId=f.groupId),f.entityId&&(g.entityId=d);var j=function(a,b){var d,g=b.thId,h=zmail.listObj[g].MO;if(a.tdata=a.tdata||[],d=i?zmWindow.addinList(g,a.tdata):zmCache.dolistObj(g,a.tdata),b.streamsView){var j,k,l=d.MO,m=l.length;for(j=0;j<m;j++)k=l[j],k&&zmail.mailObj[k]&&(zmail.mailObj[k].accId=b.accId,zmail.mailObj[k].actionType=b.actionType,zmail.mailObj[k].entityType=b.entityType,zmail.mailObj[k].groupId=b.groupId,zmail.mailObj[k].S=1,zmail.mailObj[k].streams=!0)}zmail.listObj[g].showNextPage=0;var n=0,o=d.MO.length;for(n=0;n<o;n++)h.indexOf(d.MO[n])===-1&&h.push(d.MO[n]);void 0!==d.showNextPage&&(zmail.listObj[g].showNextPage=d.showNextPage),zmUtil.isInlineCompose()&&zmUtil.mapDraftId(g);var p=zmPreviewTemplate.getMissingMailList(g,c);zmPreviewTemplate.addMailsInView({list:p,contElem:e,elemPrefix:c,viewDetails:f.elemObj.viewDetails,opentype:f.opentype,mode:"showmore"}),1===zmail.listObj[g].showNextPage&&zmPreviewTemplate.addShowMoreMailsLink({contElem:e})},k=O(d);k&&(g.thdindex=k);var l=$.extend({},g);l.from="tIcon",l.opentype=b,l.contElem=e,i?(l.fetchMoreMails=!0,zmWindow.sendMailDataReq(g,l,j)):zmList.sendMailDataReq(g,l,j)}},getMissingMailList:function(a,b){var c,d,e=[],f=zmail.listObj[a].MO.slice(),g=f.length;for(c="zmHdr"+b,1===zmail.convSortOrder&&f.reverse(),d=0;d<g;d++)zmUtil.isInlineCompose()&&zmail.mailObj[f[d]]&&(zmail.mailObj[f[d]].FD===zmail.folId.dId||zmail.mailObj[f[d]].FD===zmail.folId.tId)||$("#"+c+f[d]).length||e.push(f[d]);return e},_rPath:function(a,b){var c,e={},f="",g="",h="",i="",j="",k="",l=a.delegate,m=[],n=[],o="",p="",q="";if(a.frm&&(o=a.frm),a.rPath){var r=a.rPath;for(r=r.replace(/</gi,""),r=r.replace(/>/gi,""),n=r.split(","),n=_.uniq(n),c=0;c<=n.length;c++)g=n[c],g&&(h=g.indexOf("@"),h!==-1&&(p+="<b>"+g.substr(h+1)+"</b>"),g.indexOf("zmgrbounces")===-1&&g.toLowerCase()!==o.toLowerCase()||(n.splice(c,1),c--))}if(n.length){for(c=0;c<=n.length;c++)g=n[c],g&&(h=g.indexOf("@"),h!==-1&&m.push(g.substr(h+1)));var s=o;if(s){s=s.replace(/</gi,""),s=s.replace(/>/gi,"");var t=s.indexOf("@");t!==-1&&(s=s.substr(t+1))}p=m.join(","),q=n.join(","),q=q.replace(/</gi,""),q=q.replace(/>/gi,""),j="redtxt",i="Sent by",k="via",1===m.length&&s===m[0]&&(j="ylwtxt"),l&&(j="bluetxt",i="Sent by",k="delegate")}if("less"===b){var u=$("<div/>");u.attr("data-zmvia","less"),u.attr("title",o),u.attr("class","SC_cs"),u.attr("data-eid",o);var v=$("<span/>");if(v.text(zmUtil.replaceHTMLEntities(o)),u.append(v),n.length){var w=$("<span/>");w.attr("class",j),w.text(d.contentOptions.via),u.append(w);var x=$("<span/>");x.text(p),u.append(x)}if(f=u[0].outerHTML,"delegate"===k){var y=$("<div/>");y.attr("class","SC_cs"),y.attr("data-eid",o);var z=$("<span/>");if(z.text(o),y.append(z),n.length){var A=$("<span/>");A.attr("class",j),A.text(d.contentOptions.delegateVia),y.append(A);var B=$("<span/>");B.text(p),y.append(B)}f=y[0].outerHTML}}else"via"===b?f='<span class="'+j+'">via</span><span>'+p+"</span>":n.length&&(f='<div id="zmRPATH'+a.elemId+'" class="zmpdtl zmvia">',f+='<div><div class="zmpr">',f+="delegate"===k?'<span><em class="'+j+'" title="'+i+'">'+i+"</em><span>"+q+"</span></span>":'<span><em class="'+j+'" title="'+i+'">'+i+"</em><span>"+q+"</span></span>",f+="</div></div></div>");return e._viaType=k,e._str=f,e},classifySmartFilter:function(a,b,c,e){if(a&&b&&void 0!==c){var f;f=zmUtil.isChildWindow()?opener.zmail.Settings:zmail.Settings,f.Apps.Filter.categoriseMail({msgId:a,filType:b,include:c}).done(function(){c?(zmail.mailObj[a].SFT=b,_zm.succErrMsg("s",d.smartfilter.include)):(zmail.mailObj[a].SFT=0,e.find(".zm_exclude").remove(),_zm.succErrMsg("s",d.smartfilter.exclude))})}},showNotes:function(a){var b,c=a.msgId,d=a.mailContElem;if(c&&(zmail.mailObj[c]&&zmail.mailObj[c].MA?b=zmail.mailObj[c].MA:zmContentCache.isCached(c)&&(b=zmContentCache.get(c).MA)),b&&zmUtil.isZohoAccount(zmail.accId)&&zmUtil.isNoteReactUser()){var e={};if((64|b)!==b)return;var f;d.length&&(f=d.find(".zm_mail_note"),f.length||(f=$(_zm.getDOM(["DIV",{attrs:{"class":"zm_mail_note"}}])),f.insertAfter(d.find(".zmPCon")),a.vfc||a.streamsShowMail||(e={mailId:c,mountingElem:f,preCallback:function(){},postCallback:function(){},listParam:{showHeader:!0}},zmList.notesAssociates(c,e))))}},showTasks:function(a){var b,c=a.msgId,d=a.mailContElem;if(c&&(zmail.mailObj[c]&&zmail.mailObj[c].MA?b=zmail.mailObj[c].MA:zmContentCache.isCached(c)&&(b=zmContentCache.get(c).MA)),b&&zmUtil.isZohoAccount(zmail.accId)){var e={};if((32|b)!==b)return;var f;d.length&&(f=d.find(".zm_mail_task"),f.length||(f=$(_zm.getDOM(["DIV",{attrs:{"class":"zm_mail_task"}}])),f.insertAfter(d.find(".zmPCon")))),a.vfc||a.streamsShowMail||(e={mailId:c,mountingElem:f,preCallBk:function(){},postCallBk:function(){zmUtil.requireTaskModule().done(function(){zmtCom.unsubscribeTaskListeners(),zmtCom.subscribeDeleteListener(c,f)})},listParam:{showHeader:!0}},zmList.taskAssociates(c,e))}},showProjectsEntities:function(a){var b,c=a.msgId,e=a.mailContElem||$("#zmCon"+zmPreviewTemplate.getPrefixOnCurrentab()+c);if(c&&(zmail.mailObj[c]&&zmail.mailObj[c].MA?b=zmail.mailObj[c].MA:zmContentCache.isCached(c)&&(b=zmContentCache.get(c).MA)),b){if((4|b)!==b)return;var f;if(e.length){f=e.find(".zm_mail_projects"),f.length?f.find(".multiAppInfo").empty():(f=$(_zm.getDOM(["DIV",{attrs:{"class":"zm_mail_projects multiAppData"},child:[["DIV",{attrs:{"class":"multiAppInfo"}}]]}])),f.insertAfter(e.find(".zmPCon")));var g=f.find(".multiAppInfo"),h=$(_zm.getDOM(["DIV",{attrs:{"class":"multiAppHead"},child:[["SPAN",{child:[["text",zmText.applyArgs(d.common.zohoProj,{companyName:zmail.globalI18N.companyName})]]}]]}]));g.append(h),zmUtil.loadProjects(function(){zmail.projectsInteg.util.listProjectsEntities(c,g)})}}},unsubscribeNotesTasks:function(a){if($(a).length){var b=$(a).find(".zm_mail_note");b.each(function(a,b){ReactDOM.unmountComponentAtNode(b)})}},updateNoteComponent:function(a){if(a&&zmail.mailObj[a]){var b=["zmConP","zmConT","zmConW","zmConS"];for(var c in b){var d;d=$("[id="+b[c]+a+"]");for(var e=0;e<d.length;e++){var f=d.eq(e);zmPreviewTemplate.showNotes({msgId:a,mailContElem:f})}}}},updateTaskComponent:function(a){if(a&&zmail.mailObj[a]){var b=["zmConP","zmConT","zmConW","zmConS"];for(var c in b){var d;d=$("[id="+b[c]+a+"]");for(var e=0;e<d.length;e++){var f=d.eq(e);zmPreviewTemplate.showTasks({msgId:a,mailContElem:f})}}}},postSaveDraftAction:function(a,b,c){$.isEmptyObject(c)||$.publish("/mail/draftsaved",c),zmail.mailObj[b.M]&&(b.TC=zmail.mailObj[b.M].TC,b.PA=zmail.mailObj[b.M].PA),zmail.mailObj[b.M]=b,zmail.mailObj[b.M].PA||(zmail.mailObj[b.M].PA=a),$.publish("/maction/newm",[[b]])},slideZImages:function(a){if(a.length&&a[0].src){var b,c,d,e=[],f=0;c=a.closest(".zmPCnt"),b=c.find("img"),b.each(function(b,c){c.src&&(e.push({ft:101,fn:"image.png",src:c.src}),c.src===a[0].src&&(f=e.length-1))}),d={startIndex:f,attObjList:e,hideAllOptions:!0,ignoreThumb:!0},zmUtil.initAttSlideShow(d)}},isTruncatedMail:function(a){return zmContentCache.isCached(a)&&zmContentCache.get(a).SHRINKED},getPrefixOnCurrentab:function(){var a;if(zmUtil.isChildWindow())return a="W";var b=zmTab.currentTab;return"zm_Container"===b||"zmncenter"===b||"zmStreamsApp"===b?a="P":"zm_srch1"===b?a="S":b.indexOf("zm_tab")||(a="T"),a},FCLoader:function(a,b){var c=$.Deferred(),d={msgId:a.mId,type:"lt",opentype:zmPreviewTemplate.currentWorkSpace,vfc:!0,tabId:void 0};$.when(c).done(function(a){b(a)}),zmUtil.isChildWindow()?zmWindow.getMail(d,c):zmList.getMailData(d,void 0,c),a.toHideVfcMsg&&$("#zmCon"+zmPreviewTemplate.getPrefixOnCurrentab()+a.mId+" #clippedMsg").hide()},shortCutHandler:function(a,b){if("openReader"===a){if(!zmPrev.prevDetails().msgId)return;z(b.mId)}else"printMail"===a&&zmPreviewTemplate.printMsg({mId:b.mId})},isMailOpenedViaStreams:C,addFocusOnclick:i,constructContent:t,loadImages:D};return L(),N(),P}();