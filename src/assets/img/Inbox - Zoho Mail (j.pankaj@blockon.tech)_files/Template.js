define([],function(a){"use strict";var b,c,d=a("zmComponent"),e=a("zmText"),f=e.get("Template").template,g={};g.available=!1;var h,i,j,k="",l=['<div id = "zmabk" ref = "createTemplate"><div class="SC_PUtt SC_PUtIco"><div class="SC_frt"><div class="SCmb"><ul><li ref = "close"><b><div class="SC_hd"></div><span class="SC_ttip ttr"><i class="msi-close"></i></span></b></li></ul></div></div><h3>'+f.createTemplate+'</h3></div><div class="SC_floatLabel"><input type="text" ref="Subject"><label>'+f.title+'</label></div><div class="zmCE" id="templateEditor" ref = "editor"style="border: 1px solid rgb(238, 238, 238); margin-bottom: 20px;"></div><div class="SC_temCat SC_dib" ref = "SelectCategory"><span ref = "categName"class="SC_lnk">Select Category</span><i class="msi-barrow"></i></div></div>'].join(""),m=function(){zmsDialog.remove(),$("#zmabk").remove(),k="",g.available=!1};h=function(){var a=function(a,b){zmUtil.succErrMsg("s",f.success),zmUtil.postMailActionsOnSend({action:"stemplate",msgId:a.msgId,draftObj:"",draftDataObj:"",draftId:"",schedule:"",mode:"template",cmpType:""});var c=Object.keys(b).length;if(c>1){var d={};d.isSystem=null,d.labelId=a.categoryId,d.color=null,d.displayName=b.displayName,d.display_text=b.display_text,d.name=b.name,d.newColor=null,d.sequence=null,d.zuid=b.zuid,zmail.templateCategory.push(d)}},d=c.getContent(c),e=zmail.accId,g={accId:e,originalMode:"template",from:zmail.cmpdata.DEFFRM_ADDR,to:"",cc:"",bcc:"",sendImm:!1,content:d,subject:b.Subject.value,priority:"Medium",smType:2,replyTo:"",charSet:"UTF-8"},h={};0!==k.trim().length?(g.category=k,h.accId=e,h.displayName=k,h.display_text=k,h.name=k,h.zuid=zmail.zuid):j&&(g.categoryId=j),zmAjq.XHR({u:zmail.conPath+"/send.do",t:"POST",fn:a,p:g,ep:h,csr:"s"}),m()};var n=function(a){var c=function(a,c){k=c,$(b.categName).text(k),$(i).remove()},d=function(a){j=a.labelId,$(b.categName).text(a.displayName),$(i).remove()},e=[];zmail.templateCategory.forEach(function(a){a.display_text=a.displayName,a.name=a.displayName,a.color=a.newColor,e.push(a)});var f={addNew:c,data:e,display:"display_text",onSelect:d,showCreate:!0,showTooltip:!0};i=zmComponent.folderLabel(f);var g=function(){$(i).remove(),$(document.body).off("click",g)};$(document.body).on("click",g),$(i).addClass("shw"),$("body").append(i);var h=a.target.closest(".SC_temCat");i.style.position="absolute",i.style.top=h.getBoundingClientRect().top-h.getBoundingClientRect().height+"px",i.style.left=h.getBoundingClientRect().left+"px",a.preventDefault(),a.stopPropagation()},o=function(){var a=e.get("editorInteg"),b=[[["bold",a.tooltip.bold,"zei-bold"],["italic",a.tooltip.italic,"zei-italic"],["underline",a.tooltip.underline,"zei-underline"],["strikethrough",a.tooltip.strikethrough,"zei-strike"]],[["fontfamily",a.tooltip.font,"zei-fontfamily"]],[["fontsize",a.tooltip.fontSize,"zei-arrow"]],[["forecolor",a.tooltip.fontColor,"zei-textclr"],["backcolor",a.tooltip.backgroundColor,"zei-bgclr"]],[["image",a.tooltip.insertImage,"zei-image"],["link",a.tooltip.insertLink,"zei-link"],["insertHTML",a.tooltip.insertHTML,"zei-html"],["edithtml",a.tooltip.editHtml,"zei-editHtml"]],[["alignoptions",a.tooltip.alignOptions,"zei-textleft"],["listoptions",a.tooltip.listOptions,"zei-unorder"],["indentoptions",a.tooltip.indentOptions,"zei-outdent"],["directionoptions",a.tooltip.directionOptions,"zei-rtl"]],[["quote",a.tooltip.insertQuote,"zei-quote"],["removeformat",a.tooltip.removeFormatting,"zei-removeformat"]],[["tableGrid",a.tooltip.table,"zei-table"],["inserthorizontalrule",a.tooltip.insertHR,"zei-line"]],[["smiley",a.tooltip.insertSmiley,"zei-smiley"]],[["spellcheck",a.tooltip.spellcheck,"zei-spellCheck"]]];return b},p=function(){return g.available},q=function(){if(p())return!1;var a={title:"",buttons:[{txt:f.save,callback:function(){h()}},{txt:f.cancel,isCancel:!0,callback:function(){m()}}],mask:!0,pos:"left"};g.available=!0,b=_zm.getDOMReferenceMap(l,!0),$(b.close).on("click",m),$("body").append(b.createTemplate),zmsDialog.create("zmabk",a),$("#zmsdialog_zmabk")[0].style.width="500px";var d=$(b.editor)[0].getAttribute("id"),e=.5*parseInt($("#zmsdialogcont_zmabk")[0].style.maxHeight),i=$(".SC_PUbtm")[0].offsetHeight,j=e-i,k={id:d,toolbarOrder:o(),editorheight:j};c=ZE.create(k),$(b.SelectCategory).on("click",n)};return d.createTemplate=q,d});