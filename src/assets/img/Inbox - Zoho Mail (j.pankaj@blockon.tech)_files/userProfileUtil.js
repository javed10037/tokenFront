define([],function(a){"use strict";var b=a("zmail.Core.Namespaces"),c=b.create("zmail.userProfile"),d=function(a){var b=zmail.userProfile.core(a);return b};return c.init=d,c.init}),define([],function(a){"use strict";var b=a("zmail.Core.Namespaces"),c=a("zmAjq"),d=b.get("zmail.userProfile"),e=$.Deferred(),f=$.Deferred(),g=$.Deferred(),h=function(a){e.resolve({curUsage:a.curUsage,docUsage:a.docsUsage,allotedUsage:a.allotedSpace})},i=function(a){g.resolve({curUsage:a.curUsage,docUsage:a.docsUsage,allotedUsage:a.allotedSpace})},j=function(a){f.resolve({info:a.info,links:a.links})},k=function(){var a={};return a.mode="getUserProfile",c.XHR({u:"/biz/bizApi.do",t:"post",p:a,fn:j,csr:"s"}),f},l=function(){var a={};return a.mode="userUsageStatsVO",c.XHR({u:"/zm/userSettings.do",t:"POST",fn:h,p:a,csr:"s"}),e.promise()},m=function(){return c.XHR({u:"/zm/userStatus.do",t:"POST",fn:i,p:{mode:"refreshstorage"}}),g.promise()},n=function(){return $.when(k()).done(function(a){})},o=function(){return n()};return d.getProfileInfo=o,d.refreshStorage=m,d.getStorage=l,d.usageData=l,d.getProfileInfo}),define([],function(a){"use strict";var b,c,d,e=a("zmText"),f=a("zmail.Core.Namespaces"),g=a("_zm"),h=f.get("zmail.userProfile"),i=e.get("userProfileUtil").userProfile,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=!0,r=function(a){return parseInt(a)/Math.pow(1024,3)},s=function(a){return parseInt(a)/Math.pow(1024,2)},t=function(a,b){return a/b*100},u=function(){$(b).on("click",d),$(b).addClass("zmStorageRefresh")},v=function(){setTimeout(function(){q=!0,u()},1e5)};d=function(){$(b).addClass("rotate"),h.refreshStorage().done(function(a){q=!1,$(b).removeClass("zmStorageRefresh rotate"),a.curUsage>0&&(j=s(a.curUsage)),a.allotedUsage>0&&(k=s(a.allotedUsage)),a.docsUsage>=0?n=s(a.docsUsage):a.docUsage<0?n=0:"undefined"==typeof a.docUsage&&(n=void 0),0!==j&&0!==k&&(l=Math.round(t(j,k))),"undefined"==typeof n?m=0:0!==n&&0!==k&&(m=Math.round(t(n,k))),p=l+m,o="undefined"==typeof a.docUsage?j.toFixed(2):(j+n).toFixed(2),c=o+" GB "+i.of+" "+k+" GB "+i.used,$("#storageUsed").text(c);var d={};d.mailStorage=l,d.docStorage=m,d.percentageVal=l+m,h.storageUpdate(d)}),$(b).off("click"),v()};var w=function(e){var f,v,w,x=e,y=x.usage,z=location.protocol+"//"+zmail.zohoUrl+"/mail/",A="ios-android-apps.html",B="admin-mobile-app.html",C="streams-app.html",D="inbox-insight-app.html";y.curUsage>0&&(j=r(y.curUsage)),y.allotedUsage>0&&(k=r(y.allotedUsage)),y.docsUsage>=0?n=s(y.docsUsage):y.docsUsage<0?n=0:"undefined"==typeof y.docUsage&&(n=void 0),f=e.biz.info&&e.biz.info.superAdmin?e.biz.info.superAdmin:"",w=e.biz.info&&e.biz.info.planName?e.biz.info.planName:"",v=e.biz.info&&e.biz.info.planExpiry?e.biz.info.planExpiry:"",0!==j&&0!==k&&(l=Math.round(t(j,k))),"undefined"==typeof n?m=0:0!==n&&0!==k&&(m=Math.round(t(n,k))),p=l+m,o="undefined"==typeof y.docsUsage?j.toFixed(2):(j+n).toFixed(2),c=o+" GB "+i.of+" "+k+" GB "+i.used;var E=['<div ref = "userInfo" class = "zmUserData"><div><div class = "zmUserImg" ref = "userImage"><a rel = "noreferrer" target = "_blank" ref = "changeProfileImage">'+i.change+"</a><img src ="+x.basicInfo.photo+'></img></div><strong ref = "uname"></strong><div class = "zmUserDtl"><p ref = "usermailid"></p><p ref = "userzuid">'+i.userId+' <span ref = "userid"> </span><span ref="helpP" style = "margin-bottom:5px;"><i ref = "help" class = "msi-help"> </i></span> </p><p ref = "superAdmin">'+i.superAdmin+' <strong ref = "adminSuper"> </strong></p><p class = "zmPadTop10" ref = "accountLink"><a ref = "_myaccount" rel = "noreferrer" target = "_blank" class = "zmLink" href = "'+x.basicInfo.myAccount+'">'+i.myAccount+'</a><a ref = "signOut" class = "zmLink zmFR">'+i.signOut+"</a></p></div></div></div>"].join(""),F=['<div class = "zmUPscroll" ref = "userPlan"><div class = "zmRowSDot"></div><div class = "zmBdrBtn" ref = "additional"><a rel = "noreferrer" target = "_blank" ref = "subscription"></a><a rel = "noreferrer" target = "_blank" ref = "controlPanel">'+i.controlPanel+'</a></div><div class = "zmUPBox zmModeBG" ref="planname"><span>'+i.plan+'</span><h3 ref="plan">'+w+" "+i.planType+'</h3><div ref = "expires">'+i.planExpires+" "+v+'</div><div ref = "separator" class = "zmRowSDot"></div><div class = "zmSCWrapper" ref = "storage"><div class="zmStorageInfo"><div ref="upgradeClass" class="zmStorageSplit"><div><div class="greyText">'+i.mail+'</div><div><span class="zmStorageApp mail"></span><span>'+l+'%</span></div></div><div ref="docUsage"><div class="greyText">'+i.docs+'</div><div><span class="zmStorageApp docs"></span><span>'+m+'%</span></div></div></div><p id = "storageUsed" ref = "storageUsed">'+c+'</p><a rel = "noreferrer" target = "_blank" ref= "upgradepar" class="zmRedButton">Upgrade</a></div></div></div><div class = "zmUPBox zmModeBG" ref = "mobileApps"><h4>'+i.forMobile+'</h4></div><div class = "zmUPBox zmModeBG zmUPraf" ref = "referFriend"><h3>'+i.referFriend+"</h3><p>"+i.refererText+"</p></div></div>"].join(""),G=['<ul class = "zmUPmApp" ref = "mobileAppIcons"><li><a target = "_blank" rel = "noreferrer" href="'+z+A+'"><span class = "zmMobApp mail"></span><span>Mail </span></a></li><li><a target = "_blank" rel = "noreferrer" href="'+z+B+'"><span class = "zmMobApp mailAdmin"></span><span>Mail Admin </span></a></li><li><a target = "_blank" rel = "noreferrer" href="'+z+C+'"><span class = "zmMobApp streams"></span><span>Streams </span></a></li><li><a  target = "_blank" rel = "noreferrer" href="'+z+D+'"><span class = "zmMobApp inboxInsight"></span><span>Inbox Insight </span></a></li></ul>'].join(""),H=['<div class = "SCmb puClose" ref = "closeIcon"><ul><li><b><span><i class = "msi-close"></i></span></b></li></ul></div>'].join(""),I=$('<li><div style = "width:350px;"><p>'+i.unique+"</p><p>"+i.identify+"</p></div></li>"),J=g.getDOMReferenceMap(G,!0),K=g.getDOMReferenceMap(E,!0),L={mailStorage:l,docStorage:m,percentageVal:p,usedTxt:i.used,refreshTxt:i.refresh};$(K.uname).text(x.basicInfo.name),$(K.adminSuper).text(f),$(K.userid).text(x.basicInfo.userId),$(K.usermailid).text(x.basicInfo.emailId),b=h.storageTemp(L);var M=g.getDOMReferenceMap(F,!0);"undefined"==typeof n&&$(M.docUsage).remove(),K.changeProfileImage.setAttribute("href",x.basicInfo.myAccount),$(M.storage).prepend(b),zmail.isBaihui||zmail.isRebranded?$(M.mobileApps).remove():M.mobileApps.appendChild(J.mobileAppIcons);var N=g.getDOMReferenceMap(H,!0),O=$('<div id = "zmUserProfile" class = "zmUserProfile"></div>');$(O).append(M.userPlan),$(O).append(K.userInfo),$(O).append(N.closeIcon),g._isPrivilegedUser()&&q&&u();var P=a("zmDropDownMenu"),Q=new P,R=function(){Q.hide()};$(b).on("click",d);var S=function(a){zmAjq.XHR({u:"/biz/cpanelUrlTracking.do",t:"POST",p:a,csr:"s"})},T=function(){var a={liDom:I,showArrow:!0,par:K.helpP,defaultclass:!1};Q.setDropObj(a),Q.paintArrowDrop(),$(K.help).on("mouseout",R)};zmail.isRebranded?($(K.userzuid).remove(),$(K._myaccount).remove()):$(K.help).on("mouseenter",T);var U=function(){$(O).removeClass("shw"),setTimeout(function(){$(O).remove(),$(document.body).off("click",U)},5e3)};$(K.userImage).on("click",U),$(e.accountLink).on("click",U),$(M.additional).on("click",U),$(M.upgradepar).on("click",U),$(J.mobileAppIcons).on("click",U),$(N.closeIcon).on("click",U);var V=x.biz;if(V.subscription&&"Subscription"===V.subscription.label){var W=document.createTextNode(i.subscription);M.subscription.appendChild(W),M.subscription.setAttribute("href",V.subscription.link),$(M.subscription).on("click",function(){var a={clickedFrom:"usrProfileSub"};S(a)})}else if(V.mailHosting&&"Enable Mailhosting"===V.mailHosting.label){var X=document.createTextNode(i.emailHosting);M.subscription.appendChild(X),M.subscription.setAttribute("href",V.mailHosting.link)}else $(M.subscription).remove();if(V.upgrade&&"Upgrade"===V.upgrade.label?(M.upgradepar.setAttribute("href",V.upgrade.link),$(M.upgradeClass).addClass("upgrade")):V.mailHosting&&"Enable Mailhosting"===V.mailHosting.label?(M.upgradepar.setAttribute("href","/biz/personalpurchase.do"),$(M.upgradepar).text(i.moreStorage),$(M.upgradeClass).addClass("upgrade")):$(M.upgradepar).remove(),!V.info||"undefined"==typeof V.info.planName||V.info.isAdmin===!1){var Y=M.planname.firstChild,Z=M.plan,_=M.separator;Y.parentElement.removeChild(Y),Z.parentElement.removeChild(Z),_.parentElement.removeChild(_)}return V.controlPanel&&"Control Panel"===V.controlPanel.label?(M.controlPanel.setAttribute("href",V.controlPanel.link),$(M.controlPanel).on("click",function(){var a={clickedFrom:"usrProfileCpanel"};S(a)})):$(M.controlPanel).remove(),V.referFriend&&"My Referrals"===V.referFriend.label?$(M.referFriend).on("click",function(){var a=location.protocol+"//"+zmail.urls.mailURL+"/"+V.referFriend.link;g.windowOpen(a)}):$(M.referFriend).remove(),K.signOut.setAttribute("href",x.basicInfo.signOut),V.info&&"undefined"!=typeof V.info.superAdmin||$(K.superAdmin).remove(),V.info&&"undefined"!=typeof V.info.expiryDate&&V.info.isAdmin!==!1||($(M.expires)[0].innerText=""),$(O).on("click",function(a){a.stopPropagation()}),$(document.body).on("click",U),O},x=function(a){return w(a)};return h.core=x,h.core}),define([],function(a){"use strict";var b,c,d,e,f,g,h,i,j,k,l=a("zmail.Core.Namespaces"),m=l.get("zmail.userProfile"),n={},o=100,p=.5,q=2;return k=function(a){var b={},c=Math.round(a.mailStorage);return j=Math.round(a.docStorage),e=c+j,0!==c&&0!==j&&100!==e||(p=0),i=1.8*p,g=i,"undefined"!=typeof a.docStorage&&(h=3.6*(c+p)-i,e<=95&&(c<=1||j<=1)&&(h=3.6*(c+p*q)-i,p=0),f=o-j+p),d=o-c+p,b.mailUsage=d,b.docUsage=f,b.totalUsage=e,b},n.getStorageTemplate=function(a){var c=Math.round(a.percentageVal),d=k(a);b=['<div class="zmStroageChart zmStorageRefresh" ref="storageDom"><svg viewBox="0 0 110 110" class="zmStroageChartSVG"><circle ref="orgMail" cx="55" cy="55" r="15.9" class="zmStroageChartMail"></circle><circle  ref="orgDocs" cx="55" cy="55" r="15.9"class="zmStroageChartDocs"></circle><circle cx="55" cy="55" r="15.9" class="zmStroageChartMask"></circle><circle cx="55" cy="55" r="15.9" ref="shadowMail"class="zmStroageChartMailShadow"></circle><circle cx="55" cy="55" r="15.9" ref="shadowDocs"ref="shadowDoc" class="zmStroageChartDocsShadow"></circle><circle cx="55" cy="55" r="15.9" class="zmStroageChartMask innerMask"></circle></svg><div class="zmStroageUsed"><font>'+a.usedTxt+'</font><span ref="totalPercentage">'+c+'%</span></div><span class="zmLink"><i class="msi-refresh SC_thm"></i><font>'+a.refreshTxt+"</font></span></div></div>"].join("");var e=n.update(d.mailUsage,d.docUsage);return p=.5,e},n.update=function(d,e){return c=a("_zm").getDOMReferenceMap(b,!0),n.updateUsage(d,e),c.storageDom},n.storageUpdate=function(a){var b=Math.round(a.percentageVal),d=e;if(e!==b){var f=function(){var a=setInterval(function(){$(c.totalPercentage).text(d+"%"),d<b?(d++,b<d&&clearInterval(a)):(d--,b>d&&clearInterval(a))},100)};f()}var g=k(a);n.updateUsage(g.mailUsage,g.docUsage)},n.updateUsage=function(a,b){d=a,f=b,a=Math.round(a),a=0===a?0:a>=0&&a<.99?a.toFixed(1):Math.round(a),"undefined"!=typeof b&&(b=Math.round(b),b=0===b?0:b>=0&&b<.99?b.toFixed(1):Math.round(b)),c.orgMail.setAttribute("stroke-dashoffset",d),c.orgMail.style.transform="rotate("+g+"deg)",c.shadowMail.setAttribute("stroke-dashoffset",d),c.shadowMail.style.transform="rotate("+g+"deg)","undefined"==typeof b||b<0||0===b?($(c.orgDocs).remove(),$(c.shadowDocs).remove()):(c.orgDocs.setAttribute("stroke-dashoffset",f),c.orgDocs.style.transform="rotate("+h+"deg)",c.shadowDocs.setAttribute("stroke-dashoffset",f),c.shadowDocs.style.transform="rotate("+h+"deg)")},m.storageTemp=n.getStorageTemplate,m.updateUsage=n.updateUsage,m.storageUpdate=n.storageUpdate,m.storageTemp});