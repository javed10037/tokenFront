(function(a){"use strict";var b=zmail.Core.Namespaces,c=b.create("zmail.Search.Utils.CommonUtil");a(c)})(function(a){"use strict";var b=1,c=function(a){var c=a.data,d={};if(c.length>1)for(var e in c)d.calmode=3,d.sindex=1,d.rcount=zmail.Search.Models.Contexts.calendarContextSearch.pageSize,a.paginate&&(b=b==1?d.rcount+1:b+d.rcount),d.sindex=b,c[e].name=="calendar"&&(d.calId=c[e].obj.calId),c[e].name=="title"&&(d.title=c[e].value),c[e].name=="date"&&(d.date=c[e].value,d.dateformat=zmail.userDateFormat),c[e].name=="location"&&(d.loc=c[e].value),c[e].name=="organizer"&&(d.orgId=c[e].obj.ORGANIZERID),c[e].name=="from-date"&&(d.from=c[e].value,d.dateformat=zmail.userDateFormat),c[e].name=="to-date"&&(d.to=c[e].value,d.dateformat=zmail.userDateFormat),c[e].name=="allday event"?d.allday=1:(d.title!=d.title?d.title="":d.title=d.title,d.from!=d.from?d.from="":d.from=d.from,d.to!=d.to?d.to="":d.to=d.to,d.calId!=d.calId?d.calId="":d.calId=d.calId,d.date!=d.date?d.date="":d.date=d.date,d.loc!=d.loc?d.loc="":d.loc=d.loc,d.orgId!=d.orgId?d.orgId="":d.orgId=d.orgId,d.dateformat!=d.dateformat?d.dateformat="":d.dateformat=d.dateformat,d.allday!=d.allday?d.allday="":d.allday=d.allday);else d.calmode=3,d.sindex=1,d.rcount=zmail.Search.Models.Contexts.calendarContextSearch.pageSize,a.paginate&&(b=b==1?d.rcount+1:b+d.rcount),d.sindex=b,c[0].name=="calendar"?d.calId=c[0].obj.calId:c[0].name=="title"?d.title=c[0].value:c[0].name=="location"?d.loc=c[0].value:c[0].name=="organizer"?d.orgId=c[0].obj.ORGANIZERID:c[0].name=="date"?(d.date=c[0].value,d.dateformat=zmail.userDateFormat):c[0].name=="from-date"?(d.from=c[0].value,d.dateformat=zmail.userDateFormat):c[0].name=="to-date"?(d.to=c[0].value,d.dateformat=zmail.userDateFormat):c[0].name=="allday event"&&(d.allday=1);return d};a.calendarParam=c}),function(a){"use strict";var b=zmail.Core.Namespaces,c=b.create("zmail.Search.Utils.CommonUtil");a(c)}(function(a){"use strict",a.calendarGenerator=function(a,c){var d=a.obj,e=$(document.createDocumentFragment()),f=["SPAN",{attrs:{"class":"SC_mtb"},child:[["text","Results from Calendar"]]}];f=_zm.getDOM(f),c.listingHeader.$el.find(".SC_flt").html(f);if(d!=undefined)if(d.length!=0){var g=$('<div class="zcl zcl_agendavw" id="zcl_workarea"></div>'),h=$('<ul id="zcl_encloser" class="zcl_frmbg"></ul>'),i=$("<li></li>"),j=$('<ul id="zcl_agnlst" class="zcl_agnlst"></ul>');g.append(h),h.append(i),i.append(j);for(var k in d)for(var l in d[k]){var m=d[k][l],n=l,o=zcal.getCalObj(m.CNAME),p=d[k][l].SD,q=ZCL_parseDateStr(p),r=d[k][l].ST,s=d[k][l].ET,t=d[k][l].LOC,u=d[k][l].ADAY,v=zcal.getCalObj(d[k][l].CNAME),w=v[1].split(":"),x=ZCL_getCalColor(w[0]),y=$('<li><div class="zcl_table"><ul><li class="zcl_w70"><img src='+d[k][l].PHOTO+' height="42px" width="42px">'+"</li>"+'<li class="zcl_w70">'+'<ul class="zcl_agdate">'+"<li>"+q.dateBy("E")+"</li>"+"<li>"+q.dateBy("dd")+"</li>"+"<li>"+q.dateBy("NNN yyyy")+"</li>"+"</ul> </li>"+'<li class="zcl_agncclr">'+'<span style = "background-color:'+x[1]+'"></span>'+"</li>"+'<li class="zcl_grevlst">'+"<ul><li><b>"+d[k][l].SUM+"</b></li>"+"<li>"+(u==1?"<em>All day</em>":"<em>"+ZCL_timeInUFormat(r)+"-"+ZCL_timeInUFormat(s)+"</em>")+(t!=""?"<span>Location</span>":"")+"<em>"+t+"</em></li>"+"</ul></li></ul></div></li>");b(y,m,n),j.append(y),e.append(g)}}else{var g=$('<div class="SC_nmsg" id="noevents">No Events Found</div>');e.append(g)}else{var g=$('<div class="SC_nmsg" id="noevents">No Events Found</div>');e.append(g)}return e};var b=function(a,b,c,d){a.on("click",{obj:b},function(a){ZCL_editEve(c,a,b.CNAME,b.EUID)})}}),function(a){"use strict";var b=zmail.Core.Namespaces,c=b.create("zmail.Search.Models.Filters");a.call(c,c,function(a){return b.get(a,{ignore__namespace:!0})})}(function(a,b){"use strict";var c=b("zmail.Search.Utils.TypeCreator"),d=b("zmail.ValueTypeInferrer.TYPES"),e=c.newType(a.StringFilter,{className:"ZCalTitleFilter",name:"title",description:"text",valueType:d.String.name,multipleInstance:!1,validate:function(a){return _.isString(a)}});a.ZCalTitleFilter=e}),function(a){"use strict";var b=zmail.Core.Namespaces,c=b.create("zmail.Search.Models.Filters");a.call(c,c,function(a){return b.get(a,{ignore__namespace:!0})})}(function(a,b){"use strict";var c=b("zmail.Search.Utils.TypeCreator"),d=c.newType(a.StringFilter,{className:"LocationFilter",name:"location",description:"text",values:function(a){var b=$.Deferred(),c=[];if(a!==""&&a.length==1)if(Object.keys(zcal.search).indexOf("location")!=-1)if(Object.keys(zcal.search.location).indexOf(a)!=-1){for(var d in zcal.search.location[a]){var e={LOC:zcal.search.location[a][d].LOC};c.push(e)}b.resolve(c)}else var f="/cal/suggest.do?mode=loc&srchLoc="+a,g=ZCL_XHR(f,function(c){var d=ZCL_Evl(1,c.responseText),e="",f=d.obj,g=[];for(var h in f)for(var i in f[h])g.push(f[h][i].LOC);var h,j=g.length,k=[],l={};for(h=0;h<j;h++)l[g[h]]=0;for(h in l){var m={LOC:h};k.push(m)}zcal.search.location?zcal.search.location[a]=k:(zcal.search.location={},zcal.search.location[a]=k),d.status=="success"?b.resolve(k):b.reject()});else var f="/cal/suggest.do?mode=loc&srchLoc="+a,g=ZCL_XHR(f,function(c){var d=ZCL_Evl(1,c.responseText),e="",f=d.obj,g=[];for(var h in f)for(var i in f[h])g.push(f[h][i].LOC);var h,j=g.length,k=[],l={};for(h=0;h<j;h++)l[g[h]]=0;for(h in l){var m={LOC:h};k.push(m)}zcal.search.location?zcal.search.location[a]=k:(zcal.search.location={},zcal.search.location[a]=k),d.status=="success"?b.resolve(k):b.reject()});return b.promise()},multipleInstance:!1,filterProps:["LOC"],filterValues:!0,autofillText:function(a){a=a||{};var b=[a.LOC||""].join(", ");return b},getValue:function(){var a=this.value||{};return _.isString(a)?a:a.LOC||""},validate:function(a){if(typeof a=="object"||_.isString(a))return!0}});a.LocationFilter=d}),function(a){"use strict";var b=zmail.Core.Namespaces,c=b.create("zmail.Search.Models.Filters");a.call(c,c,function(a){return b.get(a,{ignore__namespace:!0})})}(function(a,b){"use strict";var c=b("zmail.Search.Utils.TypeCreator"),d=c.newType(a.BaseFilter,{className:"ZCalOrganizerFilter",name:"organizer",description:"text/emailid",values:function(a){var b=$.Deferred(),c=[];if(Object.keys(zcal.search).indexOf("organizer")!=-1){for(var e in zcal.search)for(var f in zcal.search[e])c.push(zcal.search[e][f]);b.resolve(c)}else var g="/cal/suggest.do?mode=orgname&srchOrg="+d.name,h=ZCL_XHR(g,function(a){var d=ZCL_Evl(1,a.responseText),e="",f=d.obj;for(var g in f)for(var h in f[g])e=f[g][h],c.push(e);zcal.search.organizer=c,d.status=="success"?b.resolve(c):b.reject()});return b.promise()},multipleInstance:!1,filterProps:["ORGANIZERNAME","EMAIL_ID","PHOTO"],filterValues:!0,searchStartsWith:!0,autofillDOM:function(a){a=a||{};var b=a.ORGANIZERNAME||a.EMAIL_ID||a.PHOTO||"",c=a.EMAIL_ID||"",d=a.PHOTO||"",e=$('<div class="zmConWra">'),f=$('<div class="SC_avtr"><img src='+d+">"+"</div>"+'<div class="zmConData">'+"<div>"+'<strong class="js-name">'+b+"</strong>"+"</div>"+"<div>"+'<span class="js-desc">'+c+"</span>"+"</div>"+"</div>"+"</div>");return e.append(f),e},getValue:function(){var a=this.value||{};return _.isString(a)?a:a.ORGANIZERNAME||""},validate:function(a){var b;return typeof a=="object"&&(b=a.ORGANIZERNAME),_.isString(b)}});a.ZCalOrganizerFilter=d}),function(a){"use strict";var b=zmail.Core.Namespaces,c=b.create("zmail.Search.Models.Filters");a.call(c,c,function(a){return b.get(a,{ignore__namespace:!0})})}(function(a,b){"use strict";var c=b("zmail.Search.Utils.TypeCreator"),d=c.newType(a.BaseFilter,{className:"ZCalCalendarFilter",name:"calendar",description:"calendar name",values:function(){var a=zcal.cdata.calLst,b=[],c=Object.keys(a);for(var d in c){var e={};e.calName=a[c[d]][0],e.calId=c[d],b.push(e)}return b},multipleInstance:!1,filterProps:["calName"],filterValues:!0,autofillText:function(a){return a.calName},getValue:function(){var a=this.value||{};return a.calName||""},validate:function(a){return typeof a=="object"?!0:!1}});a.ZCalCalendarFilter=d}),function(a){"use strict";var b=zmail.Core.Namespaces,c=b.create("zmail.Search.Models.Filters");a.call(c,c,function(a){return b.get(a,{ignore__namespace:!0})})}(function(a,b){"use strict";var c=b("zmail.Search.Utils.TypeCreator"),d=c.newType(a.BooleanFilter,{className:"ZCalAlldayFilter",name:"allday event",multipleInstance:!1});a.ZCalAlldayFilter=d}),function(a){"use strict",a.call(zmail.Core.Namespaces.create("zmail.Search.Models.Filters"),zmail.Core.Namespaces.get)}(function(a){"use strict";var b=a("zmail.Search.Utils.TypeCreator"),c=b.newType(this.BaseFilter,{name:"date",className:"ZCalDateFilter",viewClassName:"DateFilter",value:undefined,multipleInstance:!0,validateOnSet:!1,validate:function(a){return a instanceof Date},getValue:function(){if(this.value instanceof Date)return this.value.getDateBy(zmail.userDateFormat);return}});this.ZCalDateFilter=c}),function(a){"use strict",a.call(zmail.Core.Namespaces.create("zmail.Search.Models.Filters"),zmail.Core.Namespaces.get)}(function(a){"use strict ";var b=a("zmail.Search.Utils.TypeCreator"),c=this.ZCalDateFilter;this.ZCalFromDateFilter=b.newType(c,{name:"from-date",className:"ZCalFromDateFilter",multipleInstance:!1,validate:function(b){if(c.validate(b)){var d=a("zmail.Search.Environment");if(d.has("ZCalToDateFilter")){var e=d.get("ZCalToDateFilter")[0].toJSON().actualValue;return c.validate(e)?b.getTime()<e.getTime():!1}return!0}return!1}})}),function(a){"use strict",a.call(zmail.Core.Namespaces.create("zmail.Search.Models.Filters"),zmail.Core.Namespaces.get)}(function(a){"use strict";var b=a("zmail.Search.Utils.TypeCreator"),c=this.ZCalDateFilter;this.ZCalToDateFilter=b.newType(c,{name:"to-date",className:"CalToDateFilter",multipleInstance:!1,validate:function(b){if(c.validate(b)){var d=a("zmail.Search.Environment");if(d.has("ZCalFromDateFilter")){var e=d.get("ZCalFromDateFilter")[0].toJSON().actualValue;return c.validate(e)?b.getTime()>e.getTime():!1}return!0}return!1}})}),function(){"use strict";var a=zmail.Search.Models.Contexts,b=function(){var a=zmail.Search.Models.Filters,b=zmail.Search.Utils.CommonUtil,c={contextName:"Calendar",tabRegexp:/zcal_Container/,placeholder:"Search Events",pageSize:100,defaultFilterClass:a.ZCalTitleFilter,filterClass:[a.ZCalTitleFilter,a.LocationFilter,a.ZCalOrganizerFilter,a.ZCalCalendarFilter,a.ZCalAlldayFilter,a.ZCalDateFilter,a.ZCalFromDateFilter,a.ZCalToDateFilter],shortcutId:"calendarSearch",url:"/mail/cal/srchAct.do",hasPagination:function(){return this.response&&this.response.haspagination},searchQuery:function(a){return b.calendarParam(a)},getView:function(a){var c=a.response,d=this.getFrameworkInstance(),e=c;return this.response=c,b.calendarGenerator(e,d)},contextIcon:"msi-calendar",ajax:function(a){var b=a;b.mstpcrdhkur=zmAjq.getCookie("aprmjrnpkcrkks");var c={url:this.url,type:"GET",data:$.param(b)};return $.ajax(c)}};return new zmail.Search.Models.Contexts.SearchContext(c)},c=function(){var a=$.Deferred();return zmApp.loadCalendar("/calendar/settings",a),a.promise()},d=function(){typeof zcal=="undefined"?c().done(function(){a.calendarContextSearch=b(),zmail.Search.registerContext(a.calendarContextSearch)}):(a.calendarContextSearch=b(),zmail.Search.registerContext(a.calendarContextSearch)),zmail.calSearchLoaded=!0,$.publish("CALSEARCH_INIT")};zmail.Search?d():$.subscribe("SEARCH_INIT",function(){d()})}();