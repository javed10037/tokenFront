define([],function(a,b){"use strict";var c=a("zmText"),d=a("zmUtil"),e=a("zmInit"),f=a("zmail.Core.Namespaces"),g=f.create("zmDrop"),h=c.get("dropMenus"),i=function(b,c){var e,f=a("zmComp"),g=!1;b&&"inline"===b&&(g=!0),c&&(e=c.cmpId);var i=[],j={htm:h.send};j.data={},j.data.action="s",g&&(j.data.cmpId=e);var k={htm:h.sendNow};k.data={},k.data.action="si",g&&(k.data.cmpId=e),i.push(j,k);var l={list:i,clk:function(a){var b=a.action,c=a.cmpId;"s"===b?(f.sendMail({action:"compose",cmpId:c}),d.hideMenu()):"si"===b&&(f.sendMail({action:"compose",sendIm:!0,cmpId:c}),d.hideMenu())}};return l},j=function(){var b=a("zmComposeTemplates"),c=a("zmComp"),d=$(b.getTemplate("schPop")),e=$(b.getTemplate("sendLater")),f=$(b.getTemplate("recBand")),g=$(b.getTemplate("recChild"));return d.find("tbody").append(e,f,g),c.bindScheduleEvents({parentElement:d,scheduleElement:e,recurringBand:f,recurringChild:g}),d},k=function(){var b=a("zmComp"),c=b.getCurrentCompId(),e={list:[{htm:h.draft,data:{action:"sdraft",cmpId:c}},{htm:h.template,data:{action:"stemplate",cmpId:c}}],clk:function(a){var c=a.action,e=a.cmpId,f={cmpId:e};switch(c){case"sdraft":f.action="sdraft",b.sendMail(f),d.hideMenu();break;case"stemplate":f.action="stemplate",b.sendMail(f),d.hideMenu()}}};return e},l=function(b){var c,e,f=a("zmComp"),g=a("zmCUtil"),i=f.getCurrentCompId(),j="",k="",l="",m={},n="";c="msi-tick",e=f.getPriority(f.getCurrentCompId());var o=f.getAskReceipt(i);return"yes"===o&&(n=c),"High"===e?j=c:"Low"===e?l=c:k=c,m={list:[{htm:"<b> "+h.priority+" : </b>",nohover:"nohr"},{htm:"<i class='msi-none "+j+"'></i>"+h.high,data:{action:"h",par:b}},{htm:"<i class='msi-none "+k+"'></i>"+h.medium,data:{action:"m",par:b}},{htm:"<i class='msi-none "+l+"'></i>"+h.low,data:{action:"l",par:b}},{sep:!0},{htm:"<b>"+h.insert+" : </b>",nohover:"nohr"},{htm:h.template,data:{action:"insTemplate",cmpId:i}},{htm:h.signature,data:{action:"sig",cmpId:i}},{sep:!0},{htm:h.encoding+"<i class='msi-rarrow'></i>",childCls:"SC_tin",child:function(){return g.compLst("encod",i)}},{sep:!0},{htm:"<i class='"+n+"'></i>"+h.askreceipt,data:{action:"askReceipt",par:o}}],clk:function(a){var b=a.action,c=a.cmpId,e=a.par,h={cmpId:c};switch(b){case"sdraft":h.action="sdraft",f.sendMail(h),d.hideMenu();break;case"stemplate":h.action="stemplate",f.sendMail(h),d.hideMenu();break;case"insTemplate":g.insTemplate(c),d.hideMenu();break;case"sig":g.insSign(c),d.hideMenu();break;case"h":g.chgPriority("h",e),d.hideMenu();break;case"m":g.chgPriority("m",e),d.hideMenu();break;case"l":g.chgPriority("l",e),d.hideMenu();break;case"askReceipt":g.askRepChk(e,f.getCurrentCompId()),d.hideMenu()}}}},m=function(b){var c=a("zmComp"),e={},f=c.getCurrentCompId();return e.list=[{htm:h.draft,data:{action:"d",par:b}},{htm:h.template,data:{action:"t",par:b}}],e.clk=function(a,b){var e,g=a.action;switch(g){case"d":e={action:"sdraft",cmpId:f},c.sendMail(e),d.hideMenu();break;case"t":e={action:"stemplate",cmpId:f},c.sendMail(e),d.hideMenu()}},e},n=function(b){var c,e,f=a("zmComp"),g=a("zmCUtil"),i="",j="",k="",l={};return c="msi-tick",e=f.getPriority(f.getCurrentCompId()),"High"===e?i=c:"Low"===e?k=c:j=c,l.list=[{htm:"<i class='msi-none "+i+"'></i>"+h.high,data:{action:"h",par:b}},{htm:"<i class='msi-none "+j+"'></i>"+h.medium,data:{action:"m",par:b}},{htm:"<i class='msi-none "+k+"'></i>"+h.low,data:{action:"l",par:b}}],l.clk=function(a,b){var c=a.action,e=a.par;switch(c){case"h":g.chgPriority("h",e),d.hideMenu();break;case"m":g.chgPriority("m",e),d.hideMenu();break;case"l":g.chgPriority("l",e),d.hideMenu()}},l},o=function(){var b,c=a("zmList"),f=[],g={date:"",size:""},i="<i class='msi-tick'></i>";return"s"===zmail.viewInfo[0].DT&&(g.date=i),"s"===zmail.viewInfo[0].SZ&&(g.size=i),b=e.getListingDetObj(),f=b.fId===zmail.folId.oId?[{htm:g.date+h.date,clk:function(){c.changeViewColumns("DT"),d.hideMenu()}}]:[{htm:g.date+h.date,clk:function(){c.changeViewColumns("DT"),d.hideMenu()}},{htm:g.size+h.size,clk:function(){c.changeViewColumns("SZ"),d.hideMenu()}}]},p=function(){var b,c=a("zmApp"),e=[],f=0;return _zm.isSmartComposeEnabled()&&(e.push({htm:h.smartCompose,data:{action:"smartdialog"}}),f=1),e.push({htm:h.composemail,data:{action:"mail"}},{htm:h.createnote,data:{action:"note"}},{htm:h.createtask,data:{action:"task"}},{htm:h.createevent,data:{action:"event"}},{htm:h.createcontact,data:{action:"contact"}},{htm:h.createlink,data:{action:"link"}}),zmail.showFeature&&e.push({htm:"Quick Compose",data:{action:"cmpdialog"}}),"m"===c.currentApp?e.splice(0,1):"n"===c.currentApp?e.splice(f+1,1):"t"===c.currentApp?e.splice(f+2,1):"c"===c.currentApp?e.splice(f+3,1):"cn"===c.currentApp?e.splice(f+4,1):"l"===c.currentApp&&e.splice(f+5,1),b=function(b){var e=a("zmcontact"),f=b.action;d.hideMenu(),"mail"===f?d.compose():"note"===f?d.loadNotes("popup"):"task"===f?d.loadTask({action:"addCTask",groupId:zmail.zuid}):"event"===f?c.loadCalendar("/calendar/event"):"contact"===f?e.showQuickCreate():"cmpdialog"===f?d.cmpDialog():"link"===f?d.loadLink({mode:"create",groupId:zmail.zuid,catid:""}):"smartdialog"===f&&d.loadSmartCompose({eType:"6",type:"tab"})},{list:e,clk:b}},q=function(b,c){var d,e=zmail.labInfo,f=[],g=0,i={};d="action"===c?b:"listview","flag"===b&&(e={1:{dispName:h.info,id:"1",seq:0},2:{dispName:h.important,id:"2",seq:1},3:{dispName:h.followup,id:"3",seq:2}},"action"===c&&(e[0]={dispName:h.clearflag,id:"0",seq:3}));var j=function(){return function(b,c){a("zmList").bindAction(b,c)}};for(var k in e)i={},"flag"===b?(i.fVal=e[k].id,g=e[k].seq):(i.lId=e[k].id,i.lA="add",i.disp=e[k].dispName),i.action=d,"view"===c&&(i.clk=j(),i.view=b,i.viewId=k),f[g]={htm:e[k].dispName,data:i},g++;return"label"===b&&"action"===c&&(0===g&&(f[g++]={htm:h.notagsfound}),f[g++]={sep:!0},i={lA:"deleteall",action:b},f[g++]={htm:h.cleartag,data:i}),f},r=function(b){var c={};return c.divId="zm_dropflag","view"===b?c.list=q("flag","view"):"action"===b&&(c.list=q("flag","action")),c.align="cleft",c.clk=function(b,c){a("zmList").bindAction(b,c)},c},s=[{htm:h.markfolderread,data:{action:"folread"}},{htm:h.sweep,data:{action:"sweep"}}],t=[{htm:h.markasread,data:{action:"read"}},{htm:h.markasunread,data:{action:"unread"}},{htm:h.flagas+" <i class='msi-rarrow'></i>",data:{action:"flaglist"},child:function(){return r("action")}},{htm:h.markspam,data:{action:"spam"}},{htm:h.marknotspam,data:{action:"notspam"}},{htm:h.forwardasinline,data:{action:"forward"}},{htm:h.forwardmultipleemail,data:{action:"FwdAttach"}}],u=function(){var b=function(a,b){for(var c=zmail.mailObj,d=a.length,e=0;e<d;e++)if(c[a[e]].S?b.unread=!0:b.read=!0,b.unread&&b.read)return};return function(c,d){var f,g,h,i=a("zmsuite"),j=a("zmList"),k={read:!1,unread:!1},l=e.getListingDetObj(),m=zmail.mailObj,n=i.getCenter()[0].getNodes()[2].$el;if(c.length&&b(c,k),k.unread&&k.read)return k;for(g=d.length,h=0;h<g;h++)if(f=m[d[h]],f.TS?(k.unread=!0,k.read||(c=j.getMailSummaryList(l,f.T),c.length&&b(c,k))):(k.read=!0,!k.unread&&n.find("#thd"+f.M).is(":visible")&&(c=j.getMailSummaryList(l,f.T),c.length&&b(c,k))),k.unread&&k.read)return k;return k}}(),v=function(b){var c,f=a("zmTab"),g=a("zmsuite"),i=$.extend([],s.slice()),j=$.extend([],b||t.slice()),k=d.getSelectedMails(),l=!k[1].length&&1===k[0].length,m=k[0].length+k[1].length,n=window.zmTab&&"zm_Container"===f.currentTab||!1,o=window.zmTab&&f.currentTab&&f.currentTab.indexOf("zm_srch")!==-1||!1,p=d.isChildWindow()?$("#zmWindowWrapper").data("detail"):g.getCenterOuter().$el.data("data-detail"),q=l&&zmail.mailObj[k[0][0]]&&zmail.mailObj[k[0][0]].FD||p&&p.fId||e.getListingDetObj().fId,r=zmail.folId,v=q===r.dId||q===r.teId||q===r.oId,w=!n||""===q||v||q===zmail.folId.sId;if(t[j.length-1].htm=h.forwardmultipleemail,w?i.splice(0,2):(0===m||q&&(q===r.sId||q===r.tId||q===r.spId||d.isSharedFolder(q)))&&i.splice(1,1),m&&!v){if(m>1?j.splice(5,1):1!==m||n||o||(j[6].htm=h.forwardasattachment),j.splice(3,2),q===r.spId&&j.splice(2,1),q===zmail.folId.sId)j.splice(0,2);else if(n||o)c=u(k[0],k[1]);else{c={read:!0,unread:!0};var x=k[0][0];x.indexOf("t")===-1&&(zmail.mailObj[x].S?c.read=!1:c.unread=!1)}c&&!c.read?j.splice(0,1):c&&!c.unread&&j.splice(1,1);var y=j.length-1;delete j[y].state,k[0].length<2&&k[1].length<1&&(d.isChildWindow()?j.splice(y,1):j[y].htm=h.forwardasattachment),i=w?j:j.concat(i)}return i},w=function(b){var c=a("zmList"),d={};return d.divId="zm_dropflag","view"===b?d.list=q("label","view"):"action"===b&&(d.list=q("label","action")),d.align="cleft",d.clk=function(a,b){c.bindAction(a,b)},d},x=function(){var a,b=[{htm:h.viewAll,data:{action:"view_all"}},{htm:h.unread,data:{action:"view_unread"}},{htm:h.flagged+"<i class='msi-rarrow'></i>",data:{action:"view_flag"},child:function(){return r("view")}},{htm:h.tags+"<i class='msi-rarrow'></i>",data:{action:"view_label"},child:function(){return w("view")}},{htm:h.archived,data:{action:"view_archive"}}],c=[{htm:h.info,data:{action:"listview",view:"flag",viewId:1}},{htm:h.important,data:{action:"listview",view:"flag",viewId:2}},{htm:h.followup,data:{action:"listview",view:"flag",viewId:3}},{htm:h.viewAll,data:{action:"view_flag"}}],d=e.getListingDetObj(),f=d.fId;if(f){var g=b.slice();$.isEmptyObject(zmail.labInfo)&&(g[3]=""),(f===zmail.folId.spId||f&&zmail.folTree[0][f]&&0===zmail.folTree[0][f].IA)&&(g[5]=""),f===zmail.folId.teId&&(g[1]="",g[2]="",g[4]="");for(var i;(i=g.indexOf(""))!==-1;)g.splice(i,1);a=g}else a=c;return a},y=function(){var a,b=[{htm:h.attachmentView,data:{action:"view_attach",isAttachOnly:!0}},{htm:h.mailWithAttach,data:{action:"view_attach"}}],c=e.getListingDetObj(),f=c.fId;return f&&(a=b,!d.isSharedFolder(f)&&d.isZohoAccount(zmail.accId)||(a.splice(0,1),a[0].htm=h.mailWithAttach)),a},z=function(){var a,b=[{htm:h.all,data:{action:"select_all"}},{htm:h.none,data:{action:"select_none"}},{htm:h.unread,data:{action:"select_unread"}},{htm:h.read,data:{action:"select_read"}},{htm:h.flagged,data:{action:"select_flag"}},{htm:h.tags,data:{action:"select_label"}},{htm:h.attachments,data:{action:"select_attach"}}],c=e.getListingDetObj(),d=b.slice();return $.isEmptyObject(zmail.labInfo)&&d.splice(4,1),c.fId!==zmail.folId.teId&&c.fId!==zmail.folId.dId&&c.fId!==zmail.folId.oId||d.splice(2,5),a=d},A=function(){var b=a("zmTab"),c=[],d={comfort:"",compact:""},e=b.currentTab;return"zm_Container"!==e&&"zm_srch1"!==e||(d.compact="<i class='msi-compact'></i>",d.comfort="<i class='msi-classic'></i>",c=[{htm:d.comfort+" "+h.classic,data:{action:"customize_view",value:"0"}},{htm:d.compact+" "+h.compact,data:{action:"customize_view",value:"1"}}]),c},B={consDropDown:function(b){var c=a("zmDropDownMenu"),d=new c(b);d.paint()},show:function(b,c,e,f){var h,q,r,s,t=a("zmWatch"),u=a("zmSchedule");switch(c=$(c),e=e||{id:b,par:c},e.cmpId&&(b=e.id),b&&(b=b.replace(/[0-9]/g,"")),b){case"zm_shdLst":c.addClass("SC_bsel"),e.align="pright",e.ulClass="SC_tin",e.list=o();break;case"zm_priLst":c.find("b").addClass("SC_ddn"),e.ulClass="SC_tin",h=n(c),e.list=h.list,e.clk=h.clk,e.align="pright",e.parWidth=!0;break;case"zm_watchLst":$(e.par).find("b").addClass("SC_ddn"),e.onHide=function(){t.hideWatch(e.cmpId)},e.htm=t.loadWatch(e.cmpId),e.parWidth=!0,e.loadCopt=!0,e.align="pright";break;case"zm_addWatch":$(e.par).find("b").addClass("SC_ddn"),e.align="mright",e.showArrow=!0,e.direction="top",e.loadHTML=!0,e.onHide=function(){t.hideWatch(e.cmpId)},e.htm=t.loadWatch(e.cmpId);break;case"zm_sendLater":e.par=c.find("b"),c.find("b").addClass("SC_ddn"),e.htm=u.scheduleDROP(b),e.loadCopt=!0,e.align="pright";break;case"zm_recurring":e.par=c.find("b"),c.find("b").addClass("SC_ddn"),e.htm=u.scheduleDROP(b),e.loadCopt=!0,e.align="pright";break;case"zm_savecomp":c.find("b").addClass("SC_ddn"),e.ulClass="SC_tin",s=m(c),e.list=s.list,e.clk=s.clk;break;case"zm_compactLst":c.find("b").addClass("SC_ddn"),e.ulClass="SC_tin",q=l(c),e.list=q.list,e.clk=q.clk;break;case"zm_SndLst":e.par=c;var v;f&&(v=f.snd_type);var w=i(v,f);c.find("b").addClass("SC_ddn"),e.list=w.list,e.clk=w.clk;break;case"zm_ScheduleLst":e.par=c,c.find("b").addClass("SC_ddn"),e.htm=j();break;case"zm_SveLst":e.par=c,c.find("b").addClass("SC_ddn"),e.list=k().list,e.clk=k().clk,e.align="pright",e.loadCopt=!0,e.parWidth=!0;break;case"zm_createLst":r=p(),e.list=r.list;var x=c.find(".msi-barrow");x.addClass("sel"),e.onHide=function(){x.removeClass("sel")},e.clk=r.clk,e.ulClass="zm_compul",e.defaultclass=!1,e.spanClass="SC_dd wbdr"}e.align=e.align||"pleft","pleft"!==e.align&&"pright"!==e.align||!c.attr("data-drop")?g.consDropDown(e):(c.removeAttr("data-drop"),d.hideMenu())},getActionDrop:v,getViewDrop:x,getAttachOptions:y,getSelectDrop:z,getCustomizeViewDrop:A};return g=$.extend(g,B)}),define([],function(a){"use strict";function b(){if(i.keybindings.scopeInfos.hasOwnProperty("dropDownNavigation")){for(var a=["upArrow","leftArrow","rightArrow","downArrow","enter","esc","space"],b=0;b<a.length;b++)i.keybindings.deregister("dropDownNavigation",a[b]);i.keybindings.dropScope("dropDownNavigation"),i.keybindings.setScope(f)}}function c(){var a=$(".zmcDrpDwnOpn");a.hasClass("SC_ddn")&&a.removeClass("SC_ddn"),a.children().hasClass("SC_ddn")&&a.children().removeClass("SC_ddn"),a.removeClass("zmcDrpDwnOpn"),b()}function d(a){$(a).off("mousemove.dd").one("mousemove.dd",function(a){$(this).children().removeClass("sel"),$(this).hasClass("sel")||($(this).addClass("SC_Phr"),$(a.target).trigger("mouseenter"))}).removeClass("SC_Phr")}function e(a){this.dropObj=a}var f,g=a("zmsuite"),h=a("_zm"),i=a("zmComponent"),j=function(a){var b,c;for(b=0;b<a.length;b++)a[b]&&(a[b].child&&(a[b].child.divId?$("#"+a[b].child.divId).remove():$("#"+a[b].child().divId).remove()),c="function"==typeof a[b].child?a[b].child("rem"):a[b].child,c&&c.list&&j(c.list))},k=function(c,d,e){var f=a("zmUtil");c&&c.removeAttr("data-drop"),d&&(f.removeHighlight(),b()),e.onHide&&e.onHide()};return e.prototype.removeBindings=function(){b()},e.prototype={setDropObj:function(a){this.dropObj=a},paint:function(){this.dropObj.showArrow?this.paintArrowDrop():this.paintDrop()},initShortcutHandler:function(a,b,e){if($(a).data({listArr:b,position:e}),this.dropObj.isChild===!0)return 0;var g=function(a){var b=a.parent().parent(),c=b.height(),d=a.position().top,e=b.scrollTop(),f=a.outerHeight();d+f>c?b.scrollTop(Math.abs(d+f-c)+e):d<0&&b.scrollTop(Math.abs(d+e))},h=function(a,b){(b<0||"undefined"==typeof b)&&(b=b||a.children().length-1);for(var c=a.children(),e=b;e>=0;e--){var f=$(c[e]);if("SC_lne"!==f.attr("class")&&"nohr"!==f.attr("class"))return g(f),a.children().closest(".sel").removeClass("sel"),f.addClass("sel"),d(f.parent()),a.data("currentSelected",e),!0}return!1},j=function(a,b){var c=a.children();b=b||0;for(var e=b;e<c.length;e++){var f=$(c[e]);if("SC_lne"!==f.attr("class")&&"nohr"!==f.attr("class"))return g(f),a.children().closest(".sel").removeClass("sel"),f.addClass("sel"),d(f.parent()),a.data("currentSelected",e),!0}return!1},k=function(a,b){var c=b.data("currentSelected")||0;1===a?j(b,c+1)||j(b):a===-1&&(h(b,c-1)||h(b))},l=function(a,b){1===b?k(1,a):b===-1&&k(-1,a),a.children().find(".sel").removeClass("sel")},m=function(a,b){var d,e,f=$(".zmcDrpDwnMnu").length;e=$($(".zmcDrpDwnMnu")[f-1]);var g=-1;if("undefined"!=typeof e.data("currentSelected")&&(g=e.data("currentSelected")),("nextChildElement"===a||"prevChildElement"===a)&&(d=e.children().closest(".sel").prevAll().length,"undefined"!=typeof $(e).data().listArr[d].data)){var i=$(e).data().listArr[d].data.dropMenudirection;"undefined"==typeof i&&(i=$(e).data().listArr[d].data.menuDirection),"left"!==i&&"cright"!==$(e).data().position||(a="nextChildElement"===a?"prevChildElement":"nextChildElement")}if(g===-1)"prevElement"===a?h(e):"nextElement"===a&&j(e);else{var k=0;if("prevElement"===a)k=-1,l(e,k);else if("nextElement"===a)k=1,l(e,k);else{if("selectElement"===a)return d=e.children().closest(".sel").prevAll().length,"undefined"!=typeof b[d]&&"function"==typeof b[d].child?void e.children().closest(".sel").trigger("mouseenter"):(e.children().closest(".sel").trigger("click"),void c());"nextChildElement"===a&&(d=e.children().closest(".sel").prevAll().length,"function"==typeof $(e).data().listArr[d].child&&(e.children().closest(".sel").trigger("mouseenter"),$(".zmcDrpDwnMnu").length>f&&$(".zmcDrpDwnMnu").last().children().eq(0).addClass("sel")))}}if("removeElement"===a||"prevChildElement"===a){var m=$(".zmcDrpDwnMnu").length;"removeElement"===a&&m<=1&&c(),(m>1||"removeElement"===a)&&e.parent().remove()}},n=function(a,c,d){m(a,b),d.preventDefault()},o=[n],p={scope:"dropDownNavigation",allowDefaultScope:!1,defaultOccurrence:!0,shortcuts:[{uid:"prevElement",keyStr:"upArrow",scope:"dropDownNavigation",actions:o},{uid:"removeElement",keyStr:"esc",scope:"dropDownNavigation",actions:o},{uid:"nextElement",keyStr:"downArrow",scope:"dropDownNavigation",actions:o},{uid:"nextChildElement",keyStr:"rightArrow",scope:"dropDownNavigation",actions:o},{uid:"prevChildElement",keyStr:"leftArrow",scope:"dropDownNavigation",actions:o},{uid:"selectElement",keyStr:"enter",scope:"dropDownNavigation",actions:o},{uid:"selectElement",keyStr:"space",scope:"dropDownNavigation",actions:o}]};"dropDownNavigation"!==i.keybindings.getScope()&&(f=i.keybindings.getScope(),i.keybindings.registerAll(p),i.keybindings.setScope("dropDownNavigation"))},paintDrop:function(){var a,b,f,i,l,m,n,o,p,q=this.dropObj,r=q.list||[],s=q.liDom||[],t=$(q.par),u=q.align,v=q.divId,w=t.offset(),x=t.outerHeight(),y=w.left,z=q.container||document.body,A=q.htm,B=w.top,C=void 0===q.defaultclass||q.defaultclass,D=q.dir,E=$(z).offset(),F=q.avoidScroll,G=q.paddingOffset||40,H=parseInt($(z).css("border-top-width")),I=parseInt($(z).css("margin-top")),J=q.avoidAutoPosition;$(q.par[0]).addClass("zmcDrpDwnOpn");var K,L,M,N,O,P,Q,R,S=r.length||s.length;l=z.offsetHeight,m=z.offsetWidth,u||(b=g.getCenter()[0].$el,i=b.offset().left+b.width()/2,u=t.offset().left>i?"pright":"pleft"),P=this,O=$("<div/>"),v?($("#"+v).remove(),O[0].id=v):($("#zm_dropDown").remove(),O[0].id="zm_dropDown");var T="SC_dd";if(!C&&q.spanClass&&(T=q.spanClass),O.addClass(T+" shw"),O.mousedown(function(a){h.stopEvents(a,!0)}),S){if(N=$("<ul/>"),q.clk&&N.click(function(a){var b,d=a.target||a.srcElement,e=$(d).closest("li");b=e.data(),e.hasClass("SC_op3")||(c(),q.clk(b,d,a))}),$(N).on("mouseleave",function(){$(this).data("childrenVisible")||$(N).find(".sel").removeClass("sel")}),q.ulClass&&N.addClass(q.ulClass),q.liDom)for(S=q.liDom.length,K=0;K<S;K++)N.append(q.liDom[K]);else{var U=function(a,b,c){return function(d){var f=$(d.target);if("disabled"!==r[a].state){var h,i,k,l,m;j(r),$(M).parent().hasClass("SC_Phr")&&($(M).parent().data("currentSelected",$(d.target).prevAll().length),$(f).parent().children().removeClass("sel")),h="function"==typeof r[a].child?r[a].child():r[a].child,h?(r[a].align?i=r[a].align:(l=zmail.isComposeMail?$("#zmComposeWrapper"):g.getCenter()[0].$el,m=l.offset().left+l.width()/2,i=t.offset().left>m?"cright":"cleft"),h.par=b,h.align=i,h.clk=h.clk||q.clk,h.isChild=!0,h.container=c.dropObj.container,k=new e(h),$(f).addClass("sel"),k.paint(),$(f).parent().data("childrenVisible",!0)):$(f).parent().data("childrenVisible",!1)}}};for(K=0;K<S;K++)r[K]&&(M=$("<li/>"),r[K].sep?M.addClass("SC_lne"):M.html(r[K].htm),r[K].className&&M.addClass(r[K].className),r[K].nohover&&M.addClass("nohr"),r[K].noclick&&M.addClass(r[K].noclick),r[K].data&&M.data(r[K].data),"disabled"===r[K].state&&M.addClass("SC_op3"),M.mouseover(U(K,M,P)),N.append(M))}d(N),N.on("contextmenu",function(){return!1}),a=$("<div/>"),a.append(N),O.append(a)}else A&&O.append(A);$(z).append(O),$(N).addClass("zmcDrpDwnMnu"),this.initShortcutHandler(N,r,u),q.parWidth&&O.width()<t.outerWidth()&&O.width(t.outerWidth());var V=O.height();"cleft"===u||"colorpicker"===u?(L="cleft"===u?t.parent().width():t.width(),f=O.width(),w.left+L+f>m?(O.find("ul").addClass("SC_ddr"),O.css("right",m-w.left)):O.css("left",y+L),B-=parseInt(O.find("ul").css("padding-top")),B+V>l&&B-V>0?O.css({top:B+x-V}):O.css({top:B})):"pright"===u?(f=t.outerWidth(!0),y-=E.left,B-=E.top,y=m-(y+f),q.loadCopt&&(y+=1),O.find("ul").addClass("SC_ddr"),.7*z.getBoundingClientRect().height<B&&!J&&(D="bottom"),D&&"bottom"===D?(R=B-V,R<10&&a&&!F&&(a.css("height",O.height()-(E.top+5-R)),R=E.top+5,F=!0),y+=1,o="SC_ddRtB",p="botRt"):(R=B+x-H-I,o="SC_ddRt",p="topRt",D="top"),a&&a.addClass(o),O.css({right:y+"px",top:R+"px"})):"cright"===u?(f=t.outerWidth(!0),y-=E.left,B-=E.top,y=m-y,O.find("ul").addClass("SC_ddr"),O.css({right:y+"px"}),O.find("ul").length&&(B-=parseInt(O.find("ul").css("padding-top"))),a&&a.addClass("SC_ddRt"),B+V>l&&B-V>0?O.css({top:B+x-V}):O.css({top:B})):"pleft"===u?(Q=y-E.left,B-=E.top,.7*z.getBoundingClientRect().height<B&&!J&&(D="bottom"),D&&"bottom"===D?(O.find("ul").addClass("SC_ddr"),R=B-V,R<10&&a&&!F&&(a.css("height",O.height()-(E.top+5-R)),R=E.top+5,F=!0),p="botLt"):(R=B+x-H-I-1,p="topLt",D="top"),O.css({left:Q+"px",top:R+"px"})):"mright"===u&&(f=t.width(),y=m-y,O.find("ul").addClass("SC_ddr"),O.css({right:y+"px",top:B-O.height()/2})),p&&O.addClass(p),n=O.height()+O.offset().top-E.top-(l-G),n>0&&a&&!F&&(n+=G,a.height(O.height()-n)),$("[data-drop='1']").removeAttr("data-drop"),"pleft"!==u&&"pright"!==u||t.attr("data-drop","1"),q.leftOffset&&(O[0].style.left=parseInt(O[0].style.left)+q.leftOffset+"px"),q.topOffset&&(O[0].style.top=parseInt(O[0].style.top)+q.topOffset+"px"),setTimeout(function(){O.addClass("shw")},300),$.publish("/mail/menuCreated",[{element:O[0],menuHandler:k,menuArgsArray:[t,!q.isChild,q]}]),this.dropObj.mountPosition=D,this.$el=O},paintArrowDrop:function(){var a,b,c,d,e,f,g=this.dropObj,i=g.list,j=$(g.par),l=j.offset(),m=j.height(),n=j.width(),o=g.divId,p={},q={};g.par&&(q=j[0].getBoundingClientRect());var r,s,t,u,v,w,x,y,z,A=0;if(c=$(document.body).height(),d=$(document.body).width(),u=$("<div/>"),o?($("#"+o).remove(),u[0].id=o):($("#zm_dropDown").remove(),u[0].id="zm_dropDown"),u.addClass("SC_arm"),u.mousedown(function(a){h.stopEvents(a,!0)}),e=g.ulClass||(g.liHover===!1?"":"SC_Phr "),t=$("<ul/>"),t[0].className=e,g.spanClass&&u.addClass(g.spanClass),g.clk&&t.click(function(a){var b,c=a.target||a.srcElement;b=$(c).closest("li").data(),g.clk(b,c)}),g.liDom)for(v=g.liDom.length,r=0;r<v;r++)t.append(g.liDom[r]);else if(i&&i.length)for(v=i.length,r=0;r<v;r++)i[r]&&(s=$("<li/>"),i[r].sep?s.addClass("SC_lne"):s.html(i[r].htm),i[r].data&&s.data(i[r].data),i[r].dataId&&s.attr("data-id",i[r].dataId),"disabled"===i[r].state&&s.addClass("SC_op3"),i[r].nohover&&s.addClass("nohr"),t.append(s));if(g.buttons){for(x=g.buttons,A=x.length,y=$("<div class='SC_PUbtm'/>"),s=$("<li/>"),r=0;r<A;r++)w=$("<span/>"),w.html(x[r].txt),w.on("click",x[r].callback),y.append(w);s.append(y),t.append(s)}g.htm&&g.loadHTML?u.append(g.htm):u.append(t);var B=13,C=15;if(g.removeArrow&&(u.addClass("na"),B=0),g.direction||(g.autoPosition=!0,l.top>c/2&&(g.direction="bottom")),"left"===g.direction)$(document.body).append(u),a=g.left||l.left+n,f=15,z=u.outerHeight(),b=g.top||l.top+m/2-z/2,b<10||b+z/2<c-f?l.top<c/2?(b=l.top-(B+C)+j.width()/2,u.addClass("ltt"),b+u.height()>c-f&&(t.css("height",u.height()-(b+u.height()-c+f)),t.css("overflow-y","auto"))):(b=g.top||l.top+m/2+C+B-z,u.addClass("ltb"),!g.top&&b<1&&(b=B,t.css("height",l.top+B),t.css("overflow-y","auto"))):u.addClass("lt"),u.css({left:a+"px",top:b+"px"}),setTimeout(function(){u.addClass("shw"),u.css("left",u.offset().left+B+"px")},200);else if("bottom"===g.direction)$(document.body).append(u),a=g.left+n/2-u.width()/2||l.left+n/2-u.outerWidth()/2,b=g.top-u.height()||l.top-u.outerHeight(),a+u.width()+5>d&&g.par?(u.addClass("btr"),a=l.right,p.right=d-q.right+j.width()/2-(B+C)+"px"):(u.addClass("bt"),p.left=a+"px"),b<10&&(t.css("height",l.top-(70+B)),t.css("overflow-y","auto"),b=70+B),p.top=b+"px",u.css(p),setTimeout(function(){u.addClass("shw"),u.css("top",u.offset().top-B+"px")},200);else if("right"===g.direction)$(document.body).append(u),z=u.height(),b=g.top||l.top+m/2-z/2,f=15,a=g.right||d-l.left,b<10||b+z/2<c-f?(l.top<c/2?(b=l.top-(B+C)+j.width()/2,u.addClass("rtt"),b+u.height()>c-f&&(t.css("height",u.height()-(b+u.height()-c+f)),t.css("overflow-y","auto"))):(b=g.top||l.top+m-u.height(),u.addClass("rtb"),!g.top&&b<1&&(b=B,t.css("height",l.top+B),t.css("overflow-y","auto"))),u.css({right:a+"px",top:b+"px"}),setTimeout(function(){u.addClass("shw"),u.css("right",d-u.offset().left-u.width()+B+"px")},200)):(u.addClass("rt"),u.css({right:a+"px",top:b+"px"}),setTimeout(function(){u.addClass("shw"),u.css("right",d-u.offset().left-u.width()+B+"px")},200));else if("rightBottom"===g.direction)$(document.body).append(u),a=g.right||d-l.left,b=g.top||l.top+m-u.height(),u.addClass("rtb"),!g.top&&b<1&&(b=B,t.css("height",l.top+B),t.css("overflow-y","auto")),u.css({right:a+"px",top:b+"px"}),g.bottom&&u.css({bottom:g.bottom}),setTimeout(function(){u.addClass("shw"),u.css("right",d-u.offset().left-u.width()+B+"px")},200);else{if($(document.body).append(u),a=g.left||l.left+n/2-u.width()/2,b=g.top||l.top,z=u.height(),a+u.width()+5>d&&g.par?(u.addClass("tpr"),p.right=d-q.right+j.width()/2-(B+C)+"px"):a<0?(p.left=l.left+n/2-(B+C)+"px",u.addClass("tpl")):(u.addClass("tp"),p.left=a+"px"),p.top=b+m+"px",b+z+10>c){var D=z+b-c;D+=70,t.css("height",z-D+"px"),t.css("overflow-y","auto")}u.css(p),setTimeout(function(){u.addClass("shw"),u.css("top",u.offset().top+B+"px")},200)}$.publish("/mail/menuCreated",[{element:u[0],menuHandler:k,menuArgsArray:[null,!g.isChild,g]}]),t.on("contextmenu",function(){return!1}),this.$el=u}},e.prototype.hide=function(){var a=this;a.$el.hide()},e.prototype.remove=function(){var a=this;a.$el.remove(),"function"==typeof a.dropObj.onHide&&a.dropObj.onHide()},e.prototype.show=function(){var a=this;a.$el.show(),a.position()},e.prototype.position=function(a){var b=this,c=zmail.Components.AutoFill.Helper.getAutofillViewPort();a=a||{},a.arrowPadding=a.arrowPadding||12,b.dropObj.showArrow||(a.arrowPadding=0);var d=$(b.$el)[0],e=$(b.dropObj.par)[0],f=null,g=null,h=null,i=a.arrowPadding,j=0,k=0,l=!1,m=!0;f={left:0,top:0},d&&e&&($(d).css({height:"auto"}),g=e.getBoundingClientRect(),h=d.getBoundingClientRect(),f.left=g.left,f.left-=(h.width-g.width)/2,j=Math.abs(g.top-c.top),k=Math.abs(g.bottom-c.bottom),b.dropObj.autoPosition||"top"!==b.dropObj.direction?b.dropObj.autoPosition===!0&&(m=j<k):m=!1,$(d).removeClass("tp").removeClass("bt").removeClass("scroll-active"),m?(f.top=g.bottom+i,k<h.height+i&&($(d).css({height:k-i+"px"}).addClass("scroll-active"),l=!0),$(d).addClass("tp")):(f.top=g.top-h.height-i,f.top<c.top&&(f.top=c.top),j<h.height+i&&($(d).css({height:j-i+"px"}).addClass("scroll-active"),l=!0),$(d).addClass("bt")),$(d).hide(),$(d).css({top:f.top+"px",left:f.left+"px"}),$(d).show(),l&&"function"==typeof a.onResize&&a.onResize({wrapperDOM:d,height:d.getBoundingClientRect().height,position:m?"bottom":"top",insufficientSpace:l}))},window.zmDropDownMenu=e,window.zmDropDownMenu}),define([],function(a){"use strict";function b(){if(j.keybindings.scopeInfos.hasOwnProperty("contextMenuNavigation")){for(var a=["upArrow","leftArrow","rightArrow","downArrow","enter","esc","space"],b=0;b<a.length;b++)j.keybindings.deregister("contextMenuNavigation",a[b]);j.keybindings.dropScope("contextMenuNavigation"),j.keybindings.setScope(e)}}function c(a){h(a).off("mousemove.cm").one("mousemove.cm",function(){h(this).children().removeClass("sel"),h(this).hasClass("sel")||h(this).addClass("SC_Phr")}).removeClass("SC_Phr")}function d(a){this.menuObj=a&&a.menuObj}var e,f,g,h=a("$"),i=a("zmUtil"),j=a("zmComponent"),k=function(a,c){a&&c&&i.removeRightClickSelection(a),b()};return d.prototype={setMenuObj:function(a){this.menuObj=a},initShortcutHandler:function(a,d,f){if(h(a).data({listArr:d,position:f}),"undefined"!=typeof this.menuObj.parent)return 0;var g=function(a,b){(b<0||"undefined"==typeof b)&&(b=b||a.children().length-1);for(var d=a.children(),e=b;e>=0;e--)if("SC_lne"!==h(d[e]).attr("class")&&"nohr"!==h(d[e]).attr("class"))return a.children().closest(".sel").removeClass("sel"),h(d[e]).addClass("sel"),c(h(d[e]).parent()),a.data("currentSelected",e),!0;return!1},i=function(a,b){var d=a.children();b=b||0;for(var e=b;e<d.length;e++)if("SC_lne"!==h(d[e]).attr("class")&&"nohr"!==h(d[e]).attr("class"))return a.children().closest(".sel").removeClass("sel"),h(d[e]).addClass("sel"),c(h(d[e]).parent()),a.data("currentSelected",e),!0;return!1},k=function(a,b){var c=b.data("currentSelected")||0;1===a?i(b,c+1)||i(b):a===-1&&(g(b,c-1)||g(b))},l=function(b,c){1===c?k(1,a):c===-1&&k(-1,a),a.children().find(".sel").removeClass("sel")},m=function(c,d){var e,f=h(".zmcCntxtMnu").length;a=h(h(".zmcCntxtMnu")[f-1]);var j=-1;if("undefined"!=typeof a.data("currentSelected")&&(j=a.data("currentSelected")),("nextChildElement"===c||"prevChildElement"===c)&&(e=a.children().closest(".sel").prevAll().length,"undefined"!=typeof h(a).data().listArr[e].data)){var k=h(a).data().listArr[e].data.dropMenudirection;"left"!==k&&"cright"!==h(a).data().position||(c="nextChildElement"===c?"prevChildElement":"nextChildElement")}if(j===-1)"prevElement"===c?g(a):"nextElement"===c&&i(a);else{var m=0;if("prevElement"===c)m=-1,l(a,m);else if("nextElement"===c)m=1,l(a,m);else{if("selectElement"===c)return e=a.children().closest(".sel").prevAll().length,"function"==typeof d[e].child?void a.children().closest(".sel").trigger("mouseenter"):void a.children().closest(".sel").trigger("click");"nextChildElement"===c&&(e=a.children().closest(".sel").prevAll().length,"function"==typeof h(a).data().listArr[e].child&&(a.children().closest(".sel").trigger("mouseenter"),h(".zmcCntxtMnu").length>f&&h(".zmcCntxtMnu").last().children().eq(0).addClass("sel")))}}if("removeElement"===c||"prevChildElement"===c){var n=h(".zmcCntxtMnu").length;"removeElement"===c&&n<=1&&b(),(n>1||"removeElement"===c)&&a.parent().remove()}},n=function(a,b,c){m(a,d),c.preventDefault()},o=[n],p={scope:"contextMenuNavigation",allowDefaultScope:!1,defaultOccurrence:!0,shortcuts:[{uid:"prevElement",keyStr:"upArrow",scope:"contextMenuNavigation",actions:o},{uid:"removeElement",keyStr:"esc",scope:"contextMenuNavigation",actions:o},{uid:"nextElement",keyStr:"downArrow",scope:"contextMenuNavigation",actions:o},{uid:"nextChildElement",keyStr:"rightArrow",scope:"contextMenuNavigation",actions:o},{uid:"prevChildElement",keyStr:"leftArrow",scope:"contextMenuNavigation",actions:o},{uid:"selectElement",keyStr:"enter",scope:"contextMenuNavigation",actions:o},{uid:"selectElement",keyStr:"space",scope:"contextMenuNavigation",actions:o}]};"contextMenuNavigation"!==j.keybindings.getScope()&&(e=j.keybindings.getScope(),j.keybindings.registerAll(p),j.keybindings.setScope("contextMenuNavigation"))},paint:function(a){var d,e,g,j,l=this.menuObj.conArr,m=this.menuObj.par,n=this.menuObj.position||"right",o=this,p=document.body.offsetWidth;if(l){d=this.menuObj.divId||"zmCntxtMenu";var q=l.length;if(q){var r=h("<div/>");h("#"+d).remove(),r[0].id=d,r[0].className="SC_dd shw",r.mousedown(function(a){i.stopEvents(a,!0)});var s=h("<div/>");r.append(s),r.click(function(a){var c=a.target||a.srcElement;b(),c=h(c).closest("li"),c.hasClass("SC_op3")||o.menuObj.clk(a,c.data())}),r.on("contextmenu",function(){return!1});var t=h("<ul/>");s.append(t);for(var u=function(){h(this).parent().children().removeClass("sel"),h(this).hasClass("nohr")||h(this).addClass("sel")},v=0;v<q;v++){var w=h("<li/>"),x=l[v].cEdit===!0,y=l[v].id?l[v].id:"";if(w.data(l[v].data),l[v].htm)if(x){var z=h("<div/>");z[0].innerHTML=l[v].htm,z[0].id=y,w.append(z)}else w[0].innerHTML=l[v].htm,w[0].id=y;else l[v].sep&&(w[0].className="SC_lne",w[0].id=y);t.append(w),m&&p<a.clientX+m[0].offsetWidth+200&&(n="left"),w.mouseover(f(v,l,w,n)),w.hover(u)}h(t).on("mouseleave",function(){h(this).data("childrenVisible")||h(t).find(".sel").removeClass("sel")}),c(t);var A=a.clientY,B=a.clientX;h("body").append(r),t.addClass("zmcCntxtMnu"),this.initShortcutHandler(t,l),e=r[0].offsetWidth||0,m&&(h(m).addClass("sel"),g=m[0].offsetWidth,j=m[0].getBoundingClientRect(),"left"===n?B=j.left-e:"right"===n?B=j.right:p<B+g+e&&(B=j.left-e),
A=j.top);var C=h("#"+d).height()+A,D=h("#"+d).height(),E=h(document.body).height();if(r)if(p<B+e&&(B-=e),C>E-100&&A-D>=0){m&&(A+=j.height);var F=E-A;r.css({bottom:F,left:B})}else r.css({top:A,left:B});h.publish("/mail/menuCreated",[{element:r[0],menuHandler:k,menuArgsArray:[a.target||a.srcElement,this.menuObj.removeSelection]}])}}}},g=function(a,b){for(var c=a.length,d=0;d<c;d++)if(a[d].child){var e=a[d].child();h("#"+e.divId)&&h("#"+e.divId).remove()}},f=function(a,b,c,e){return function(f){var i={};if(g(b,c),h(h(c).parent()).hasClass("SC_Phr")&&h(h(c).parent()).data("currentSelected",h(f.target).prevAll().length),b[a].child&&(i=b[a].child(),i.par=c,i.position=e),Object.keys(i).length>0){var j=new d;j.setMenuObj(i),j.paint(f),h(c).parent().data("childrenVisible",!0)}else h(c).parent().data("childrenVisible",!1)}},window.zmContextMenu=d,d});