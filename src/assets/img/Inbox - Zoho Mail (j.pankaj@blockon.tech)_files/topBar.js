define([],function(a){"use strict";var b=a("zmTopBar"),c=a("$"),d={getTopDOM:function(){return c(['<div id="topBar" class="SC_top">',"</div>"].join(""))},getHamburgerMenuItem:function(){var a=c("SPAN");return a},getHamburgerMenuDOM:function(){return c(['<div class="zmHamburger SC_flt">',"<div>","<span></span>","<span></span>","<span></span>","<span></span>","<span></span>","<span></span>","<span></span>","<span></span>","<span></span>","</div>","</div>"].join(""))},getLogoElement:function(){return c(['<span class="zmTopLogo SC_flt">','<a href="" style="cursor: pointer;" data-homePageLink>','<img src="" data-logo>',"</img>","</a>","</span>"].join(""))},getTopLinkItem:function(){return c(["<li>",'<a href="" class="SC_thm" target="_blank" data-topBarLinkItem></a>',"</li>"].join(""))},getSearchElement:function(){return c(['<div id="zm-search" class="zmTopSearch">','<i id="zm-search-filter" class="msi-search zmTopSearchFilter"></i>','<input id="zm-search-field" class="zmTopSearchField"',' type="text" placeholder="" data-placeholder />',"</div>"].join(""))},getRightTopOuterFrame:function(){return c(['<div class="SC_frt">',"</div>"].join(""))},getTopLinksContainer:function(){return c(['<ul id="zm-extraitems" class="zmTopLinks">',"</ul>"].join(""))},getTopNavBarItem:function(){return c(["<li data-navItem>",'<i class="" data-topNavBarItem></i>',"</li>"].join(""))},getTopNavBarContainer:function(){return c(['<ul class="zmTopNav">',"</ul>"].join(""))},getUserProfileItem:function(){return c(['<div class="zmUPImgC">','<img src="" data-userProfileLink />',"</div>"].join(""))},getNotificationDOM:function(){return c(['<div id="zm-notifications-popover" class="zmNotiWra zmHideD">','<div class="zmNotiHeader">','<strong id="zm-notification-header" class="zm-popover-label" data-notification-header>',"</strong>",'<div class="SCmb SC_frt zm-popoverClose" data-popoverClose>',"<ul>","<li>","<b>","<span>",'<i class="msi-close"></i>',"</span>","</b>","</li>","</ul>","</div>","</div>",'<div class="zm-popover-content" style="width: 450px;" id="zm-notification-list">',"</div>","</div>"].join(""))}};return b.View=d,b.View}),define([],function(a){"use strict";var b,c,d,e,f,g,h,i,j,k,l,m=a("zmTopBar"),n=m.View,o=a("zmail.Utils.FeatureUtil"),p=a("zmComponent"),q=a("zmText"),r=a("zmail"),s=a("zmAppLoader"),t=a("$"),u="topBar",v={},w={},x=!1,y={WHATSSEEN_UPDATE:"/whatsSeen/click",MENU_CREATED:"/mail/menuCreated",NAVBAR_ICON_CLOSE:"zmTopBar/navbarIcon/close",NOTIFICATION_POPOVER_OPEN:"zmTopBar/popover/open",NOTIFICATION_POPOVER_CLOSE:"zmTopBar/popover/close"},z={SEARCH_PLACEHOLDER:"data-placeholder",HOME_PAGE_LINK:"data-homePageLink",LOGO:"data-logo",NAV_ITEM:"data-navItem",TOPBAR_LINK_ITEM:"data-topBarLinkItem",TOPNAV_ITEM:"data-topNavBarItem",NOTIFICATION_HEADER_TEXT:"data-notification-header",NOTIFICATION_ALL_TEXT:"data-allNotifications-text",NOTIFICATION_CLOSE:"data-popoverClose",USER_PROFILE_LINK:"data-userProfileLink"},A={NOTIFICATION_CONTAINER_HIDE:"zmHideD",SELECTED_ITEM:"sel",WHATSNEW_CLASS:"zmWhatsNew"},B=function(a){return b.has(a).length>0},C=function(a){return["[",a,"]"].join("")},D=function(a){for(var b=v.navBar||[],c=b.length,d=0;d<c;++d){var e=b[d];if(e.id===a)return e}},E=function(){var a=t(document.body).find(".zmHApps").eq(0)[0];a&&a.childNodes.length>0&&(g.removeClass("zmHactive"),a.parentElement.removeChild(a)),t(document.body).off("click",E)},F=function(){if(!k.hasClass(A.NOTIFICATION_CONTAINER_HIDE)){k.addClass(A.NOTIFICATION_CONTAINER_HIDE);var b=a("zmNCenter");"function"==typeof b.popoutClose&&b.popoutClose()}},G=function(a){if(a){var b=a.target||a.srcElement,c=D(t(b).closest(C(z.NAV_ITEM)).attr("id"))||{};if(c.isNotification)return;if(t(b).closest(".SCS_popUp")[0]||k.has(b).length||t(".zmHApps").has(b).length)return}E(),f.find("."+A.SELECTED_ITEM).removeClass(A.SELECTED_ITEM),F()},H=function(){return b=b||n.getTopDOM(),document.getElementById(u)||t(document.body).append(b),b},I=function(){g=g||n.getHamburgerMenuDOM();var a,c,d,e=jQuery.ajax({url:"home/api/allapps",type:"POST",error:function(){},success:function(b){a=b}});return g.on("click",function(b){if(b&&b.stopPropagation(),G(),c=t(document.body).find(".zmHApps").eq(0)[0],c&&c.childNodes.length>0)E();else{d=t('<div class = "zmHApps" style = "height: 545px; width: 552px;">'),d[0].style.top=g[0].getBoundingClientRect().bottom+"px",g.addClass("zmHactive"),t(document.body).append(d[0]);var f=p.loadingBand({type:"pagination",container:d[0]});t(document.body).on("click",E),t.when(e,s.load("hamburgerMenu").done(function(){f(),d&&d[0].parentElement.removeChild(d[0]);var b=q.get("hamburgerMenu").topAppList;c=window.topApps.init(a,b),t(document.body).append(c),c.style.top=g[0].getBoundingClientRect().bottom+"px"})).fail(function(){t(d).append("<div> Unable to process your reqeuest")})}}),g.length&&(B(g)||b.prepend(g)),g},J=function(){var a=v.rebranding||{};return l=l||n.getLogoElement(),l.length&&(l.find(C(z.HOME_PAGE_LINK)).eq(0).attr("href",v.homePageLink||"").removeAttr(z.HOME_PAGE_LINK),l.find(C(z.LOGO)).eq(0).attr("src",a.logo||"").removeAttr(z.LOGO),B(l)||b.append(l)),l},K=function(){var a=v.search||{};return c=c||n.getSearchElement(),c.length&&(c.find(C(z.SEARCH_PLACEHOLDER)).eq(0).attr("placeholder",a.placeHolder||"").removeAttr(z.SEARCH_PLACEHOLDER),B(c)||b.append(c)),c},L=function(){return d=d||n.getRightTopOuterFrame(),B(d)||b.append(d),d},M=function(){var a=v.topBarLinks||[];return e=e||n.getTopLinksContainer(),a.forEach(function(a){a=a||{};var b=document.getElementById(a.id)||n.getTopLinkItem();b=t(b),a.$el=b,b.attr("id",a.id),a.label&&b.find(C(z.TOPBAR_LINK_ITEM)).text(a.label).attr("title",a.label),a.link&&b.find(C(z.TOPBAR_LINK_ITEM)).attr("href",a.link),b.find(C(z.TOPBAR_LINK_ITEM)).removeAttr(z.TOPBAR_LINK_ITEM),B(b)||e.append(b)}),B(e)||d.append(e),e},N=function(){return k=k||n.getNotificationDOM(),B(k)||t(document.body).append(k),k},O=function(){f=f||n.getTopNavBarContainer();var b=v.navBar||[];b.forEach(function(a){var b=document.getElementById(a.id)||n.getTopNavBarItem();if(b=t(b),a.$el=b,b.attr("id",a.id),a.title&&b.attr("title",a.title),a.iconClass&&b.find(C(z.TOPNAV_ITEM)).eq(0).addClass(a.iconClass).removeAttr(z.TOPNAV_ITEM),a.spanContent){var c=t("<span></span>");a.spanContent.className&&"badge-button"!==a.uitype&&c.addClass(a.spanContent.className),a.spanContent.text&&"badge-button"!==a.uitype&&c.text(a.spanContent.text),b.append(c)}a.isNotification&&(w.$el=b,w.className=(a.spanContent||{}).className),a.isWhatsNew&&(i=b),B(b)||f.append(b)}),f.off("click").on("click",function(b){b&&b.stopPropagation();var c=b.target||b.srcElement,d=t(c).closest(C(z.NAV_ITEM)),e=t(d).attr("id")||"",g=D(e);if(G(b),t(d)[0]&&(f.find("."+A.SELECTED_ITEM).removeClass(A.SELECTED_ITEM),t(d).addClass(A.SELECTED_ITEM)),g)if("button"===g.uitype)g.showSelection||t(d).removeClass(A.SELECTED_ITEM),"function"==typeof g.action&&g.action(d,b,{whatsSeen:{show:x,callback:j.clickHandler}});else if(g.isNotification)if(k=k||N(),k.hasClass(A.NOTIFICATION_CONTAINER_HIDE)){k.removeClass(A.NOTIFICATION_CONTAINER_HIDE),k.find(C(z.NOTIFICATION_CLOSE)).off("click").on("click",function(a){a&&a.stopPropagation(),G()});var h=document.getElementById("wmstoolbar")||document.body.lastElementChild;h=t(h),h.length&&h.before(k);var i=a("zmNCenter");"function"==typeof i.popoutOpen&&i.popoutOpen()}else G()}),B(f)||d.append(f)},P=function(){h=h||n.getUserProfileItem(),h.find(C(z.USER_PROFILE_LINK)).attr("src","//"+r.urls.contactsURL+"/file?fs=thumb&nocache="+Date.now());var a={},b=r.userProfile.getProfileInfo();b.done(function(b){a.usage={},a.biz={},b&&b.info&&(r.isAdmin=b.info.isAdmin),a.biz.info=b.info;for(var c=b.links.length,d=0;d<c;d++)"Upgrade"===b.links[d].label?a.biz.upgrade=b.links[d]:"Subscription"===b.links[d].label?a.biz.subscription=b.links[d]:"Control Panel"===b.links[d].label?a.biz.controlPanel=b.links[d]:"My Referrals"===b.links[d].label?a.biz.referFriend=b.links[d]:"Enable Mailhosting"===b.links[d].label&&(a.biz.mailHosting=b.links[d]);a.basicInfo={name:r.IAMFullName,emailId:r.aInfo[r.accId].mailId,userId:r.zuid,photo:"//"+r.urls.contactsURL+"/file?fs=thumb&nocache="+Date.now(),myAccount:r.urls.accURL,signOut:r.logoutURL},h.off("click").on("click",function(b){b.stopPropagation();var c=r.userProfile.getStorage();c.done(function(c){a.usage.curUsage=c.curUsage,a.usage.allotedUsage=c.allotedUsage,a.usage.docsUsage=c.docUsage,b.stopPropagation();var d=r.userProfile.init(a);t(document.body).append(d),setTimeout(function(){t(d).addClass("shw")},100);var e=t(d).find(".zmUserData")[0].getBoundingClientRect().height,f=t(d).find(".zmUPscroll");f[0].style.top=e+"px",t(f).on("scroll",function(){f.scrollTop()>0?t(d).addClass("scrolled"):t(d).removeClass("scrolled")})})})}),B(h)||d.append(h)},Q=function(){o.isHidden("topbar:apps")||I(),J(),K(),L(),M(),O(),P(),N()},R=function(a){a&&a>0&&w.$el?(t(w.$el).attr("title","("+a+")"),a=a>99?"99+":a,t(w.$el).find("SPAN").eq(0).text(a),w.className&&t(w.$el).find("SPAN").eq(0).addClass(w.className)):w.$el&&(t(w.$el).find("SPAN").eq(0).removeClass(w.className).text(""),t(w.$el).attr("title","(0)"))};j=function(){function a(){i=i||((v.navBar||[]).filter(function(a,b){return"undefined"!=typeof b.isWhatsNew&&b.isWhatsNew})[0]||{}).$el}function b(){a(),i.length&&(x=!0,i.addClass(A.WHATSNEW_CLASS))}function c(){a(),i.length&&(x=!1,i.removeClass(A.WHATSNEW_CLASS))}function d(){c(),t.publish(y.WHATSSEEN_UPDATE)}return{show:b,hide:c,clickHandler:d}}();var S=function(a){v=a||{},H(),Q(),t(document.body).off("mousedown").on("mousedown",G),t.subscribe(y.NAVBAR_ICON_CLOSE,function(){G()}),p.bind({elm:document.body,ev:"keydown",fn:function(a){27===a.keyCode&&G(a)}})};return m.init=S,m.updateNotificationsCount=R,m.WhatsSeen=j,m});