!function(a){"use strict";var b,c,d,e={},f={},g="c",h="previouslySelected",i="expanded";e.init=function(a){b=a.doAfterMailSelection,c=a.updateMailSelectionView,d=a.isThreadExpanded},e.isChildId=function(a){return a.indexOf(g)!==-1},e.getRawId=function(a){return a.replace(g,"")},e.getViewObjectStore=function(a){return a=a||zmTab.currentTab,f[a]||{}},e.getViewObject=function(a,b){return e.getViewObjectStore(b)[a]},e.setViewObject=function(a,b,c){c=c||zmTab.currentTab;var d=f[c]||{};d[a]=b,f[c]=d},e.dropViewObjectStore=function(a){a=a||zmTab.currentTab,delete f[a]};var j=function(a,b){if(a&&a.isSelected!==b)return void 0===b&&(b=!a.isSelected),a.isSelected=b,c(a.$element,b),!0};e.selectMail=function(a,c,d){var f=j(e.getViewObjectStore(d)[a],c);f&&b(c,{msgId:a,type:"single"})},e.selectMails=function(a,c,d){var f,g=e.getViewObjectStore(d),h=a.length;if(g){for(f=0;f<h;f++)j(g[a[f]],c);b(c,{type:"multiple"})}},e.getChildrenIdsOf=function(a,b){if(!zmail.mailObj[a])return b;var c,d=zmList.getViewBasedMsgList(zmail.mailObj[a].T,zmInit.getListingDetObj()),e=d.length;for(b=b||[],c=0;c<e;c++)b.push(g+d[c]);return b};var k=function(a,b){a=a||[];var c,d,f=a.length;for(d=0;d<f&&!(c=e.getViewObject(a[d],b));d++);return c};e.getViewParentOf=function(a,b){a=e.getRawId(a);var c=zmail.mailObj[a].T,d=k(zmList.getViewBasedMsgList(c,zmInit.getListingDetObj(),!0),b);if(zmail.listObj[c]&&(d=d||k(zmail.listObj[c].MO,b)),!d&&1===zmail.convSortOrder){var f=zmList.getDupThdRowId(a,zmUtil.getFolId());f&&(d=e.getViewObject(f,b))}return d},e.isChildrenAreSelected=function(a){a=e.getRawId(a);var b,c,d=zmList.getViewBasedMsgList(zmail.mailObj[a].T,zmInit.getListingDetObj()),f=d.length;for(c=0;c<f;c++)if(b=e.getViewObject(g+d[c]),b&&!b.isSelected)return!1;return!0},e.getAllViewObjectIds=function(a){var b,c,d,f=[],g=e.getMailOrders(),h=g.length;for(d=0;d<h;d++)b=g[d],f.push(b),c=e.getViewObject(b),a?e.getChildrenIdsOf(b,f):c&&c.$element.next(".zmTV").is(":visible")&&e.getChildrenIdsOf(b,f);return f},e.setPerviouslySelected=function(a,b){var c=e.getViewObjectStore(b);c[h]=a},e.getPerviouslySelected=function(a){var b=e.getViewObjectStore(a);return b[h]},e.setExpanded=function(a,b){var c=e.getViewObjectStore(b);c[i]=a},e.getExpanded=function(a){var b=e.getViewObjectStore(a);return b[i]},e.handleForChildSelection=function(a,b){if(e.isChildId(a)){var c=e.getViewParentOf(a),d=b&&e.isChildrenAreSelected(a);e.selectMail(c.id,d)}},e.filter=function(a){var b,c,f,g,h,i,j,k,l,m=[];for(b=e.getMailOrders(),j=b.length,k=0;k<j;k++)if(c=b[k],g=d(c)&&e.getChildrenIdsOf(c)||[],h=g.length){for(i=[],l=0;l<h;l++)f=g[l],a(e.getRawId(f))&&i.push(f);h===i.length&&m.push(c),m=m.concat(i)}else{var n=a(c);n&&m.push(c)}return m},e.readfilter=function(a){var b=zmail.mailObj[a];return 0===b.TH||0===zmUtil.getMLConversionValue()||"zm_srch1"===zmTab.currentTab?1===b.S:1===b.TS},e.unreadfilter=function(a){var b=zmail.mailObj[a];return 0===b.TH||0===zmUtil.getMLConversionValue()||"zm_srch1"===zmTab.currentTab?0===b.S:0===b.TS},e.flaggedfilter=function(a){var b=zmail.mailObj[a];return 0===b.TH||0===zmUtil.getMLConversionValue()||"zm_srch1"===zmTab.currentTab?void 0!==b.NFG&&"0"!==b.NFG:b.TI||b.TF||b.TM},e.taggedfilter=function(a){var b,c=zmail.mailObj[a];return 0===c.TH||0===zmUtil.getMLConversionValue()||"zm_srch1"===zmTab.currentTab?(b=c.TAG,b&&b.length>0):(b=c.TTAGS,b&&b.length>0)},e.attachmentfilter=function(a){var b=zmail.mailObj[a];return 0===b.TH||0===zmUtil.getMLConversionValue()||"zm_srch1"===zmTab.currentTab?1===b.AT:1===b.TA},e.hasElement=function(a,b){var c=e.getViewObjectStore(b),d=c[a];if(d){if(document.contains(d.$element[0]))return d;delete c[a]}return!1},e.getMailOrders=function(a){a=a||zmTab.currentTab;var b;return a.indexOf("zm_srch")>=0?b=zmSearchUtil.getSearchList():(b=zmail.listObj[zmUtil.getFolId()],b&&b.MO||[])},e.init({doAfterMailSelection:function(a,b){var c=zmList.getElemObj();c.mainElem.hasClass("SC_sw")&&(a?zmPrev.setCountinPreview(c):zmPrev.removeCountinPreview(c)),zmList.updateSelectionCount(zmTab.currentTab);var d=zmsuite.getCenter()[0].getNodes()[0].$el.find(".msi-uncheck");zmList.isAllListingChecked(c.listElem)?d.removeClass().addClass("msi-uncheck msi-check"):zmList.isListingChecked(c.listElem)?d.removeClass().addClass("msi-uncheck msi-partcheck"):(d.removeClass().addClass("msi-uncheck"),zmList.resetSelectionInfo()),zmUtil.removeDocSelection();var e,f="zm_srch1"===zmTab.currentTab,g=zmUtil.getCheckedMailList(),h=g[0].length+g[1].length,i="zm_srch1"===zmTab.currentTab?"zm_srch1":"zm_Container";if(a){var j=b.msgId&&"c"===b.msgId.charAt(0)?b.msgId.substring(1):b.msgId;if(0===h||h>2&&"single"===b.type)return;e="single"===b.type?0!==h&&(h>1||g[1].length)?{view:zmail.listDetails,isSearchView:f}:{msgId:j,isSearchView:f}:{view:zmail.listDetails,isSearchView:f},e.type="functional",e.tabId=i,zmTopMenus.util.show(e)}else a||h||zmTopMenus.util.hide({type:"functional",tabId:i})},updateMailSelectionView:function(a,b){b?a.addClass("SC_check"):a.removeClass("SC_check")},isThreadExpanded:function(a,b){if(!e.isChildId(a)){var c=e.getViewObjectStore(b),d=c[a];if(d.$element.next(".zmTV").is(":visible"))return!0}return!1}}),a=a||{},a.mailObjectAPI=e}(zmCenterListing),function(){"use strict";var a=zmText.get("mail"),b={INTENTIONAL_SPACE:"&nbsp;"},c=zmCenterListing.getMappedClass,d=function(d){d=d||{};var e,f,g,h;e=d.returnType,f=d.propertyMap,g=d.classMap,h=d.data;var i="",j="",k="",l="",m="",n="",o="",p="",q="",r="",s="",t="",u="",v="",w="",x=a.listing.common,y=h[f.sub]||h.sub||x.noSubject,z=h[f.sum]||h.sum||"",A=h[f.count]||h.count||"",B=h[f.size]||h.size||"",C=h[f.id]||h.id||"",D=h[f.from]||h.from||b.INTENTIONAL_SPACE,E=h[f.data]||h.data||"",F=h[f.date]||h.date||"",G=h[f.tagLst]||h.tagLst||"",H=h[f.fName]||h.fName||"",I=h[f.iconArr]||h.iconArr||"",J=I.length,K=h[f.draftCount]||h.draftCount||0,L=h.CMT,M=h.SCTX||"",N=h[f.schemaText]||h.schemaText||"",O=h[f.schemaTip]||h.schemaTip||"",P=h[f.sender]||"",Q=h[f.deliverySts]||0,R=h.mailDeliveryTip,S=h.sumTxt||"",T="",U=h.selBoxVisibility&&"msi-uncheck"||"";i=c(f,g,h,"bold"),j=c(f,g,h,"att"),k=c(f,g,h,"flag"),l=c(f,g,h,"pri"),m=c(f,g,h,"subIcon"),n=c(f,g,h,"arch"),o=c(f,g,h,"hasTask"),p=c(f,g,h,"outType"),u=c(f,g,h,"schemaIcon"),q=c(f,g,h,"calEvent"),r=c(f,g,h,"schemaDisable"),w=c(f,g,h,"schemaIconColor"),s=c(f,g,h,"deliverySts"),t=c(f,g,h,"mdsParentClass"),v=c(f,g,h,"adjustWidth"),T=c(f,g,h,"markupIcons"),H=h[f.fName]||"",S||(S="<span>"+y+'<span class="sum">'+(z.trim()?" - "+z:z)+"</span>");var V="";A>1&&(V=x.tooltip.showHideConversation);var W={count:['<div class="zmtCt" title="'+V+'">',A,"</div>"].join(""),icon:['<i class="msi-thread" title="'+x.tooltip.loadFullConversation+'"></i>'].join("")},X="";A===-1?X=W.icon:A>0&&(X=W.count);for(var Y=!1,Z=['<div class="zmSze">',"<span>"+B+"</span>","</div>"].join(""),_=['<span class="SC_mdet">','<i class="'+p+'" title="'+M+'"></i>',"</span>"].join(""),aa=K&&!h.hideDraftCount,ba=[K,K>1?x.draftPlural:x.draft].join(" "),ca=[],da=0;da<J;da++)ca.push('<i class="'+I[da]+'"></i>');ca.join("");var ea=0!==G.length,fa=['<div class="zm_lbl">',zmsTemplates.constructTagListHTML(G,!1,4),"</div>"].join(""),ga=['<div id="'+C+'" class="zmL SC_mlst '+(i+" "+n)+'" data-'+f.dataAttr+'="'+E+'" >','<div class="zmLst">','<div class="zmFlt '+v+'">','<i class="'+U+'"></i><i class="',(T||q?T||q:j)+'"></i>','<div class="zm_td">','<div class="zm_tlb"></div>',"</div>",X,'<div class="'+k+'"></div>',"</div>",'<div class="zmDtl">',o?'<div class="'+o+'"></div>':"",'<div class="zmDate">',"<span>"+F+"</span>","</div>",Y?Z:"",'<div class="zmFdr">',"<span>"+H+"</span>","</div>",Q?'<div class="zmSndSts" title="'+R+'"><div class="zmSndStsCon '+t+'" ><span class="zmSndStsIco"><i class="'+s+'"></i></span></div></div>':"",'<div class="zmFrm '+(l?"proCPri":"")+'">',l?'<i class="msi-priority '+l+'"></i>':"",p?_:"","<span"+(P?' title="'+P+'"':"")+">"+D+"</span>",'<div class="SC_dft">',"<span>",aa?"&nbsp;"+ba+"&nbsp;":"","</span>",'</div><div class="SC_cmt">',L?'<i class="msi-lcmnt" title="'+x.tooltip.commentsAvailable+'"></i><span>'+L+"</span>":"","</div></div>",'<div class="zmSub">',m?'<i class="'+m+'"></i>':"",S,N?'<span class="SC_zmlbtn '+w+" "+r+' zmLLmask zm_highlight"'+(O?' title="'+O+'"':"")+" >"+(r?'<font class="zm_highlight">'+N+"</font>":N)+'<i class="'+u+' zm_highlight"></i></span>':"","</span>","</div>",'<div class="SC_icn">',ca,"</div>",ea?fa:"","</div>",'<div class="zmFrt"></div>',"</div>","</div>"].join("");return"dom"===e&&(ga=$(ga)[0]),ga},e=function(){zmCenterListing.registerListItemTemplate({type:"mail",generator:d})};e()}(),function(){"use strict";var a={INTENTIONAL_SPACE:"&nbsp;"},b=zmCenterListing.getMappedClass,c=function(c){c=c||{};var d,e,f,g;d=c.returnType,e=c.propertyMap,f=c.classMap,g=c.data;var h,i,j="",k="",l="",m="",n="",o="",p="",q="",r="",s="",t="",u=g[e.id]||g.id||"",v=g[e.data]||g.data||"",w=g[e.date]||g.date||"",x=g[e.size]||g.size||"",y=g[e.sub]||g.sub||"",z=g[e.sum]||g.sum||"",A=g[e.from]||g.from||a.INTENTIONAL_SPACE,B=g[e.fName]||g.fName||"",C=g[e.tagLst]||g.tagLst||"",D=g[e.iconArr]||g.iconArr||[],E=g[e.sender]||"",F=g[e.schemaText]||g.schemaText||"",G=g[e.schemaTip]||g.schemaTip||"",H="",I=g.selBoxVisibility&&"msi-uncheck"||"";j=b(e,f,g,"bold"),l=b(e,f,g,"flag"),k=b(e,f,g,"att"),m=b(e,f,g,"pri"),n=b(e,f,g,"subIcon"),o=b(e,f,g,"hasTask"),p=b(e,f,g,"arch"),t=b(e,f,g,"calEvent"),r=b(e,f,g,"schemaIcon"),q=b(e,f,g,"schemaDisable"),s=b(e,f,g,"schemaIconColor"),H=b(e,f,g,"markupIcons"),j&&(j=" "+j);var J=!1,K=[];for(i=D.length,h=0;h<i;h++)K.push('<i class="'+D[h]+'"></i>');K.join("");var L=Boolean(C.length),M=['<div class="zm_lbl">',zmsTemplates.constructTagListHTML(C,!1,4),"</div>"].join(""),N=['<div class="zmL SC_mlst '+j+" "+p+'" id="'+u+'" data-'+e.dataAttr+'="'+v+'">','<div class="zmLst">','<div class="zmFlt">','<i class="'+I+'"></i>','<div class="zm_td">','<div class="zm_tlt"></div>','<div class="zm_tlb"></div>','<div class="zm_tls"></div>',"</div>",'<div class="'+l+'"></div>',"</div>",'<div class="zmDtl">',o?'<div class="'+o+'"></div>':"",'<div class="zmDate">',"<span>"+w+"</span>","</div>",J?'<div class="zmSze"><span>'+x+"</span></div>":"",'<div class="zmFdr">',"<span>"+B+"</span>","</div>",'<div class="zmFrm">',m?'<i class="msi-priority '+m+'"></i>':"",n?'<i class="'+n+'"></i>':"",'<i class="'+(H||t?H||t:k)+'"></i>','<span class="zm_mailFrom"'+(E?' title="'+E+'"':"")+">",A,"</span>",'<span class="zm_mailCont">'+z+"</span>","</div>",'<div class="zmSub">',"<span>",y,'<span class="sum">',z.trim()?" - "+z:z,"</span>","</span>","</div>",'<div class="SC_icn">',K,"</div>",L?M:"",F?'<span class="SC_zmlbtn '+s+" "+q+' zmLLmask zm_highlight"'+(G?' title="'+G+'"':"")+" >"+(q?'<font class="zm_highlight">'+F+"</font>":F)+'<i class="'+r+' zm_highlight"></i></span>':"","</div>",'<div class="zmFrt"></div>',"</div>","</div>"].join("");return"dom"===d&&(N=$(N)[0]),N},d=function(){zmCenterListing.registerListItemTemplate({type:"submail",generator:c})};d()}(),zmail.folderCache=function(){"use strict";var a=function(){this.MO=[],this.showNextPage=0},b=function(b,c,d){var e,f,g,h=c.length,i=[];for(f=new a,e=0;e<h;e++){var j=c[e],k="";if(j.M){k=j.M;var l,m,n=0;zmail.mailObj[k]?(j.opened=zmail.mailObj[k].opened,g=zmail.mailObj[k].PA,j.TH?(d||(n=zmail.mailObj[k].TC,j.DC=zmail.mailObj[k].DC||j.DC,j.DMID=zmail.mailObj[k].DMID,l=void 0===zmail.mailObj[k].TS?void 0!==j.TS?j.TS:j.S:zmail.mailObj[k].TS,j.TS=l,j.TI=zmail.mailObj[k].TI||j.TI||!1,j.TM=zmail.mailObj[k].TM||j.TM||!1,j.TF=zmail.mailObj[k].TF||j.TF||!1,m=j.TSN!==zmail.mailObj[k].TSN?zmail.mailObj[k].SN:j.SN,j.SN=m,j.TSM=zmail.mailObj[k].TSM||j.TSM||"",j.TSN=zmail.mailObj[k].TSN||j.TSN||"",j.TTAGS=j.TTAGS||zmail.mailObj[k].TTAGS||[],j.TSB=zmail.mailObj[k].TSB||j.TSB||"",j.TA=zmail.mailObj[k].TA||j.TA,j.TOADDR=zmail.mailObj[k].TOADDR||j.TOADDR,j.TSNADDR=zmail.mailObj[k].TSNADDR||"",j.TC>0&&(n=j.TC),j.TC=n),j.SM=zmail.mailObj[k].SM||j.SM,j.TO=zmail.mailObj[k].TO||j.TO,zmail.mailObj[k]=j):zmail.mailObj[k]=j,g&&(zmail.mailObj[k].PA=g),zmail.mailObj[k].opened+=1):(zmail.mailObj[k]=j,zmail.mailObj[k].opened=1),0===zmail.mailObj[k].TC&&(zmail.mailObj[k].TC=1),void 0===zmail.mailObj[k].FD&&zmail.mailObj[k].TAG[0]&&(zmail.mailObj[k].FD=zmail.mailObj[k].TAG[0]),i.push(k)}else void 0!==j.showNextPage?f.showNextPage=j.showNextPage:j.stateinfo?f.showNextPage=j.stateinfo.showNextPage:void 0!==j.showMore&&(f.showNextPage=j.showMore)}return f.MO=i,f},c=function(a,b,c,d){var e,f,g,h=zmail.listObj[c].MO,i=h.length,j=!1,k=!0,l=0;if(h.indexOf(a)!==-1)return void(k=!1);if(zmail.mailObj[a]&&zmail.mailObj[a].T&&(e=zmail.mailObj[a].T,"msg"===d&&(f=zmList.getViewBasedMsgList(e,{fId:c},!0),1===f.length&&(zmail.mailObj[a].TC=1))),d&&"newm"!==d)for(g=0;g<i;g++){if(h[g]===a){k=!1;break}if(void 0!==e&&zmail.mailObj[h[g]].T===e){if(k=!1,1===zmUtil.getMLConversionValue())if(l=zmail.mailObj[h[g]].TC,zmail.listObj[e]){for(var m=0;m<f.length;m++)if(b>zmail.mailObj[f[m]].R){zmail.listObj[c].MO.splice(g,1),j=!0,k=!0,i=h.length,"thd"===d?zmail.mailObj[a].TC+=l:zmail.mailObj[a].TC=l+1;break}j||("thd"===d?zmail.mailObj[h[g]].TC=l+zmail.mailObj[a].TC:zmail.mailObj[h[g]].TC=l+1)}else{var n=zmail.mailObj[h[g]].R;b>n?(zmail.listObj[c].MO.splice(g,1),"thd"===d?zmail.mailObj[a].TC+=l:zmail.mailObj[a].TC=l+1,i=h.length,k=!0):"thd"===d?zmail.mailObj[h[g]].TC=l+zmail.mailObj[a].TC:zmail.mailObj[h[g]].TC=l+1}j=!1;break}}if(k){if(1===zmail.convSortOrder&&"newm"===d){for(g=i-1;g>=0;g--)if(b>zmail.mailObj[h[g]].R){zmail.listObj[c].MO.splice(g+1,0,a),j=!0;break}}else if(0===zmUtil.getMLConversionValue()&&zmail.listObj[c].sortOrder&&c===zmUtil.getFolId())0===zmail.listObj[c].showNextPage&&zmail.listObj[c].MO.push(a),j=!0;else for(g=0;g<i;g++)if(b>zmail.mailObj[h[g]].R){zmail.listObj[c].MO.splice(g,0,a),j=!0;break}j||zmail.listObj[c].MO.push(a),zmail.mailObj[a].T&&0===zmail.mailObj[a].TC&&(zmail.mailObj[a].TC=1)}},d=function(a,b,c){for(var d=zmail.listObj[b].MO,e=d.length,f=0;f<e;f++)if(zmail.mailObj[a].T&&1===zmUtil.getMLConversionValue()&&"msg"===c){var g=zmail.mailObj[a].T;if(g===zmail.mailObj[d[f]].T&&zmail.listObj[g])for(var h=zmList.getMailSummaryList({fId:b},g,!0),i=0;i<h.length;i++){if(0!==i&&a===h[i])return void(zmail.mailObj[h[0]].TC-=1);if(0===i&&a===h[i]&&h.length>1){zmail.listObj[b].MO.splice(f,1);var j=zmail.mailObj[h[1]].R,k=!1;d=zmail.listObj[b].MO,e=d.length;for(var l=0;l<e;l++)if(j>zmail.mailObj[d[l]].R){zmail.listObj[b].MO.splice(l,0,h[1]),zmail.mailObj[h[1]].TC=zmail.mailObj[a].TC-1,zmail.mailObj[h[0]].TC=1,k=!0;break}return void(k||(zmail.listObj[b].MO.push(h[1]),zmail.mailObj[h[1]].TC=zmail.mailObj[a].TC-1,zmail.mailObj[h[0]].TC=1))}}}else if(a===d[f]){var m=zmail.listObj[b].MO.splice(f,1);return m}},e=function(a){if(zmail.mailObj[a].T){var b,c,d=zmail.mailObj[a].T;if(b="zm_Container"===zmTab.currentTab?zmInit.getListingDetObj():zmsuite.getCenterOuter().$el.data("data-detail"),1===zmUtil.getMLConversionValue()){if(c=zmList.getMailSummaryList(b,d,!0),c.length>1){var e=a===c[0]?c[1]:c[0];2===c.length&&($("#"+e).parent().prev().find(".zm_td").remove(),$("#"+e).parent().prev().removeClass("zmTLst"),$("#"+e).parent().prev().find("i.msi-tarrow").addClass("msi-barrow"),$("#"+e).parent().remove())}}else if(c=zmList.getViewBasedMsgList(zmail.mailObj[a].T,b),0===c.length){var f;$("#"+a).length?(f=$("#"+a).parent().prev().attr("id"),f&&(f=f.substring(1))):""!==zmPrev.prevDetails().msgId&&zmail.mailObj[a].T===zmail.mailObj[zmPrev.prevDetails().msgId].T&&(f=zmPrev.prevDetails().msgId),$("#thd"+f).remove(),$("#t"+f).remove()}}},f={dolistObj:function(a,c,d){return b(a,c,d)},updateObj:function(a){switch(a.mode){case"upd":zmail.mailObj[a.msgId][a.key]=a.val;break;case"insert":zmail.listObj[a.folId]&&c(a.msgId,a.rt,a.folId,a.type);break;case"delete":zmail.listObj[a.folId]&&d(a.msgId,a.folId,a.type),e(a.msgId,a.folId),zmail.mailObj[a.msgId].FD=zmail.folId.tId;break;case"move":zmail.listObj[a.rFrom]&&d(a.msgId,a.rFrom,a.type),e(a.msgId,a.rFrom),zmail.mailObj[a.msgId].FD=a.addTo,zmail.listObj[a.addTo]&&c(a.msgId,zmail.mailObj[a.msgId].R,a.addTo,a.type)}},clearListObj:function(a){var b;if(delete zmail.listObj.unread,delete zmail.listObj.all,delete zmail.listObj.flag,zmail.useCache)b=zmInit.getListingDetObj(),(b.view||b.label||b.flag||b.attach)&&delete zmail.listObj[b];else for(var c in zmail.listObj)(zmUtil.isFolderId(c)||zmUtil.isSharedFolder(c))&&(a&&zmCache.clearMailObj({listId:c,reinit:!0}),delete zmail.listObj[c])},updateCacheForViews:function(a){var b=0,c=zmUtil.getFolId();b=$.inArray(a,zmail.listObj[c].MO),b!==-1&&zmail.listObj[c].MO.splice(b,1)},clearSearchList:function(){var a,b,c=zmSearchUtil.getSearchList(),d=c.length;for(a=0;a<d;a++)b=c[a],!b||zmList.isMailListedInApp(b)||zmUtil.isMailContentInUse(b)||zmUtil.isDraftMail(b)||delete zmail.mailObj[b]},clearSearchMsg:function(a){!a||zmList.isMailListedInApp(a)||zmUtil.isMailContentInUse(a)||zmUtil.isDraftMail(a)||delete zmail.mailObj[a]},clearMailObj:function(a){var b,c,d=0,e=a.msgId,f=[];if(!e||zmUtil.isMailContentInUse(e)||zmList.isMailListedInSearch(e)||zmUtil.isDraftMail(e)){if(zmail.listObj[a.listId])for(f=zmail.listObj[a.listId].MO,b=f.length,d=0;d<b;d++)if(e=f[d],c=zmail.mailObj[e]){var g;if(zmUtil.isMailContentInUse(e)||zmList.isMailListedInSearch(e)||zmUtil.isDraftMail(e))a.reinit&&c.TH&&(g=c.T,$.publish("/mail/threadUpdated",g));else{if(c.TH&&(g=c.T,zmail.listObj[g])){var h,i=zmail.listObj[g],j=i.MO.length;for(h=0;h<j;h++)zmail.mailObj[i[h]]&&delete zmail.mailObj[i[h]];delete zmail.listObj[g]}delete zmail.mailObj[e]}}}else delete zmail.mailObj[e]},mailOpened:function(a){zmail.mailObj[a].opened+=1},mailClosed:function(a){zmail.mailObj[a].opened-=1}};return f}(),window.zmfolAction=function(a){"use strict";return a=a||{},a.getChildrenOf=function(){var a,b,c=function(d){var e=b[d];if(e){var f=e.CH;for(var g in f)a.push(g),b[g]&&c(g)}};return function(d){return a=[],b=zmail.folTree[1],c(d),a}}(),a}(window.zmfolAction),function(){"use strict";var a=window.zmInit||{};window.zmInit=a;var b=!1,c=!1,d=0,e=zmText.get("mail"),f=e.leftTree,g=e.listing,h=e.preview,i=e.actions,j={list:zmTopMenus.util.get("all")},k={list:{left:{leftHTML:""},right:[]}},l=function(){var a=["zmReader"];return a.forEach(function(a){zmAppLoader.load(a)}),!0},m=function(a){var b,c,d="",e="",h=!1,j=!1;b={selectFolder:i.bulkaction.common.selectall,selectFolderViewAll:i.bulkaction.common.selectfolder,clearSelection:i.bulkaction.common.clearselection,clearAndSelect:i.bulkaction.common.clearandselectall};var k=function(){var a=['<div id="bulkActBand" class="SC_simg">','<span x-id="message"></span>','<font x-id="action" id="selectOpt"></font>',"</div>"].join(""),b=$(a),c=b.find("[x-id=message]").removeAttr("x-id"),f=b.find("[x-id=action]").removeAttr("x-id");return c.text(e),f.text(d),b[0]},l=function(){var a=['<div x-id="wrapper">','<span x-id="message"></span>','<font x-id="action" id="clearSelect"></font>',"</div>"].join(""),b=$(a),c=b,f=b.find("[x-id=message]").removeAttr("x-id"),g=b.find("[x-id=action]").removeAttr("x-id");return f.text(e),g.text(d),$(c.children())};return a.isBulkActionSet=!1,a.toggleListingBand=function(b){b?a.SpamTrashBand.setBand():a.SpamTrashBand.removeBand()},a.createBulkActionBand=function(f,g){if(g&&f){var i,l;l="zm_srch1"===zmTab.currentTab?zmsuite.getCenter()[0].getNodes()[2].$el:$(zmail.mailCenter.listElem),a.toggleListingBand(!1),a.removeBulkActionBand(),d=b[g],e=f,i=k(),c=$(i),c.find("#selectOpt").off("click").on("click",function(){a.isBulkActionSet=!0,a.showClearSelectionBand();var b=_zm.getDOM(["DIV",{attrs:{"class":"SC_Pop noanim wht",style:"top: 90px;z-index:0;"}}]);zmsuite.getCenter()[0].$el.append(b)}),l.before(i),zmsuite.getCenter()[0].$el.addClass("SC_trsh"),h=!0,j=!0,zmUtil.applyLBDots(c)}},a.showClearSelectionBand=function(){var h;d=b.clearSelection,e=g.selmenuopt.all+" "+f.common.emailsel,h=l(),c.html(h),c.find("#clearSelect").off("click").on("click",function(){a.isBulkActionSet=!1,zmList.unchkAll()}),zmUtil.applyLBDots(c)},a.toggleBulkActionBand=function(a){a?!j&&h&&(c.show(),j=!0):j&&(c.hide(),j=!1)},a.removeBulkActionBand=function(){h&&(c.remove(),h=!1,m.isBulkActionSet=!1,zmsuite.getCenter()[0].$el.find(".noanim.wht").remove(),zmsuite.getCenter()[0].$el.removeClass("SC_trsh"),m.toggleListingBand(!0))},a}({});m=function(b){b=b||{};var c=['<div id="listingBand" class="SC_simg js-spam-trash-band">','<font id="emptyTSP" x-id="empty"></font>','<font id="helpET" x-id="more"></font>','<span x-id="message"></span>',"</div>"].join(""),d=function(a){a=a||{};var b=$(c);b.children().addClass("SC_ldot");var d={};return b.find("[x-id]").each(function(a,b){b=$(b),d[b.attr("x-id")]=b,b.removeAttr("x-id")}),"spam"===a.mode?($(d.empty).text(f.foldercontextmenu.emptyspam),$(d.message).text(f.foldercontextmenu.spamdelete),$(d.more).remove()):"trash"===a.mode&&($(d.empty).text(f.foldercontextmenu.emptytrash),$(d.message).text(f.foldercontextmenu.trashdelete),$(d.more).text(f.foldercontextmenu.lrnmore)),"undefined"!=typeof a.emptyAction&&$(d.empty).on("click",a.emptyAction),"undefined"!=typeof a.moreAction&&$(d.more).on("click",a.moreAction),a.hideEmpty&&$(d.empty).remove(),b},e=function(){return $(zmail.mailCenter.listElem)},g=function(){var b,c="",f=function(){var b=a.getListingDetObj()||{};b.fId!==zmail.folId.tId&&b.fId!==zmail.folId.spId||zmList.emptyFolContextMenu(b.fId)},g=function(){var a="//www.zoho.com/mail/help/deleting-mail.html#alink3";zmail.isFuji&&(a="ja"===zmail.user.lang?"//www.skydesk.jp/ja/apps/mail/help/deleting-mail.html#alink3":"//www.skydesk.jp/en/apps/mail/help/deleting-mail.html#alink3"),window.open(a,"_blank").focus()},h=function(){if(c){b&&b.remove();var a=e(),h=0===a.find(".zmL.SC_mlst").length;b=d({mode:c,hideEmpty:h,emptyAction:f,moreAction:g}),$("#listingBand.js-spam-trash-band").remove(),a.before(b),zmsuite.getCenter("zm_Container")[0].$el.addClass("SC_trsh")}},i=function(){zmsuite.getCenter("zm_Container")[0].$el.find("#bulkActBand").length||zmsuite.getCenter("zm_Container")[0].$el.removeClass("SC_trsh"),b&&(b.remove(),b=void 0)};return{setBand:function(){var b={};"zmlTreeH"===zmail.mailLeft.selLayerId&&(b=a.getListingDetObj()||{});var d=e().hasClass("zms_streams SC_streams"),f=zmail.listDetails&&"2"===zmail.listDetails.attach;d||b.fId!==zmail.folId.spId||f?d||b.fId!==zmail.folId.tId||f?i():(c="trash",h()):(c="spam",h())},removeBand:function(){i()}}},h=function(){$.subscribe("mail/listing/viewchanged",g.setBand)};return h(),b.SpamTrashBand=g(),b}(m);var n=function(){var b=a.getListingDetObj(),c={};if(b.fId===zmail.folId.dId)c.children=[["text",g.emptylist.drafts]];else if(b.fId===zmail.folId.teId)c.children=[["text",g.emptylist.templates+" "],["font",{child:[["text",g.emptylist.composer]]}]],c.action=!0,c.id=b.fId;else if(b.fId===zmail.folId.sId)c.children=[["text",g.emptylist.folder]];else if(b.fId===zmail.folId.spId&&"unread"!==b.view)c.children=[["text",g.emptylist.spam]];else if(b.fId===zmail.folId.tId)c.children=[["text",g.emptylist.trash]];else if(b.fId===zmail.folId.oId)c.children=[["text",g.emptylist.outbox]];else if(b.fId&&"unread"===b.view)c.children=[["text",g.emptylist.unreadfolder]];else if(b.label)if("-1"===b.label)c.children=[["text",g.emptylist.tagview]];else{var d=g.emptylist.filteredtagview,e=zmText.applyArgs(d,{tagname:zmUtil.findTagName(b.label)});c.children=[["text",e]]}else if(b.flag)if("-1"===b.flag)c.children=[["text",g.emptylist.flagview]];else{var f=g.emptylist.filteredflagview,h=zmText.applyArgs(f,{flagname:zmUtil.findFlagName(b.flag)});c.children=[["text",h]]}else b.fId?c.children=[["text",g.emptylist.nomailfolder]]:c.children=[["text",g.emptylist.nomailview]];return c},o=function(a,b){b.id===zmail.folId.teId&&$(a).find("font").on("click",function(){zmUtil.hideMenu(),zmUtil.compose()})},p=function(a){var b,c={};a?b=[["text",a]]:(c=n(),b=c.children);var d=_zm.getDOM(["DIV",{attrs:{"class":"SC_nmsg",id:"nomails"},child:b}]);return c.action&&o(d,c),d},q=function(){c||(c=!0,$.subscribe("/folder/rename",function(){zmList.updateFolderName()})),zmail.onDemandListing&&!zmail.initialListingLoaded&&($.subscribe("/apps/tabSwitching",function(a,b,c){zmInit.loadOnDemandListing(c)}),$.subscribe("mailsuite/appOpened",function(a,b){zmInit.loadOnDemandListing(b)})),$.subscribe("/maction/newm",function(a,b,c){for(var d,e,f=b.length-1;f>=0;f--){d=b[f],e=d.M,zmail.mailObj[e]=d;try{zmList.reviewMailNotification(d,c)}catch(g){zmUtil.debugLog("Problem while updating new mail with id "+e+" "+g)}zmList.updateAttachmentCache(e)}}),$.subscribe("folder/read",function(a,b,c){zmList.markFolderAsReadHandler(b,c)}),$.subscribe("folder/archived",function(a,b,c){zmList.markFolderAsArchived(b,c)}),$.subscribe("/mail/threadUpdated",function(a,b){zmList.updateThreadList(b)}),$.subscribe("/mail/listMails",function(a,b){"undefined"!=typeof zmList&&(b=b||{},zmList.showMailListing(b,{toSelFol:!0,retainPreview:b.retainPreview}))}),$.subscribe("/mail/updatemailview",function(a,b){zmPreviewTemplate.addMailsInView(b)}),$.subscribe("/mail/previewclosed",function(){zmList&&zmList.clearcpvReq()}),$.subscribe("/mail/msgDiscarded",function(a,b){zmUtil.discardMsg(b)}),$.subscribe("/mail/discardFromThread",function(a,b){zmUtil.discardFromThread(b)}),$.subscribe("wmsevents/mail",function(a,b){zmfolAction.handleWMSEvents(b.event,b.notification,b.content)}),$.subscribe("wmsevents/mail",function(a,b){zmmailAct.handleWMSEvents(b.event,b.notification,b.content)}),$.subscribe("m/mail_tab",function(a,b){if(!zmail.restoredAccId||zmail.restoredAccId&&zmail.restoredAccId===zmail.accId){var c=$.extend({},b.data);c.src="restore",zmList.getMailData(c)}else b.appId&&zmsuite.closeWorkspace(b.appId)}),$.subscribe("m/mail_attachment",function(a,b){b=b.data,b.attObj.src="restore",zmAttach.util.viewAttachment(b.attObj,b.mode,b.fileExtn)}),$.subscribe("stream/stream_app",function(a,b){var c=b.appId;b=b.data,b.src="restore",zmsuite.getAppObj(c).centerObj.paint(),zmsuite.addLoadingBand(c,"list"),$.when(zmUtil.requireStreamsApp()).done(function(){zmail.ContactBook.fetchProcess.done(function(){zmStreamsApp.init(b.groupId,b.src)})})}),$.subscribe("stream/stream_post",function(a,b){b=b.data,b.src="restore",zmUtil.loadStreamsInTab(b)}),$.subscribe("stream/stream_mail",function(a,b){b=b.data,zmUtil.loadStreamsInTab(b)}),$.subscribe("/zm/task/addTask",function(a,b,c){b.TASKID&&zmList.addTaskIndicator(b,c)}),$.subscribe("/note/add",function(a,b,c){b.id&&zmList.addNoteIndicator(b,c)}),$.subscribe("/mail/preview/draftClosed",zmUtil.removeComposer),$.subscribe("SETTINGS_MAIL_VIEW",function(a,b){var c={key:"_settMail",info:{type:b,action:"mailOpenType"}};zmCrosstab.renew("zm_mail",c)}),$.subscribe("SETTINGS_ASK_RECEIPT_ON_READ",function(a,b){var c={key:"_settCompose",info:{type:b,action:"askReceipt"}};zmCrosstab.renew("zm_mail",c)}),$.subscribe("CS_EDITOR_TYPE_CHANGED",function(a,b){var c={key:"_settCompose",info:{type:b,action:"composeOpenType"}};zmCrosstab.renew("zm_mail",c)}),$.subscribe("CS_ADD_RECIPIENTS_CHANGED",function(a,b){var c={key:"_settCompose",info:{type:b,action:"addRecipients"}};zmCrosstab.renew("zm_mail",c)}),$.subscribe("CS_ENCODING_CHANGED",function(a,b){var c={key:"_settCompose",info:{type:b,action:"encode"}};zmCrosstab.renew("zm_mail",c)}),$.subscribe("CS_FONT_FAMILY_CHANGED",function(a,b){var c={key:"_settCompose",info:{type:b,action:"font"}};zmCrosstab.renew("zm_mail",c)}),$.subscribe("CS_FONT_SIZE_CHANGED",function(a,b){var c={key:"_settCompose",info:{type:b,action:"fontSize"}};zmCrosstab.renew("zm_mail",c)}),$.subscribe("CS_SENDING_DELAY_CHANGED",function(a,b){var c={key:"_settCompose",info:{type:b,action:"mailSendingDelay"}};zmCrosstab.renew("zm_mail",c)}),$.subscribe("SIGNATURE_ADDED",function(a,b){var c={key:"_settSignature",info:{data:b,action:"newSign"}};zmCrosstab.renew("zm_mail",c)}),$.subscribe("SIGNATURE_UPDATED",function(a,b){var c={key:"_settSignature",info:{data:b,action:"updSign"}};zmCrosstab.renew("zm_mail",c)}),$.subscribe("SIGNATURE_DELETED",function(a,b){var c={key:"_settSignature",info:{data:b,action:"delSign"}};zmCrosstab.renew("zm_mail",c)}),$.subscribe("SIGNATURE_ASSOCIATED",function(a,b){var c={key:"_settSignature",info:{data:b,action:"assSign"}};zmCrosstab.renew("zm_mail",c)}),$.subscribe("/mail/updateSchema",function(a,b){zmList.updateSchemaAction(b.msgId,b)}),$.subscribe("FROM_ADDRESS/CHANGE",function(a,b){var c=zmail.cmpdata.FROM_LIST;c[b.emailId]?(c[b.emailId].FRM_DISN=b.dispName,b.attr.isDefault?c[b.emailId].FRM_SIGMODE=0:b.attr.isGroup?c[b.emailId].FRM_SIGMODE=2:b.attr.isAliasOrGroup&&(c[b.emailId].FRM_SIGMODE=1)):b.attr.isEnabled&&(c[b.emailId]={FRM_DISN:b.dispName,FRM_SIGID:"null",FRM_SIGMODE:null},b.attr.isDefault?c[b.emailId].FRM_SIGMODE=0:b.attr.isGroup?c[b.emailId].FRM_SIGMODE=2:b.attr.isAliasOrGroup?c[b.emailId].FRM_SIGMODE=1:c[b.emailId].FRM_SIGMODE=3)}),$.subscribe("FROM_ADDRESS/REMOVE",function(a,b){var c=zmail.cmpdata.FROM_LIST;c[b.emailId]&&delete c[b.emailId]})},r=function(){$(zmail.mailCenter.listElem).html(""),zmail.mailCenter.listElem.scrollTop=0,zmCache.clearListObj(),zmTopMenus.util.show({type:"listing",fId:zmUtil.getFolId(),tabId:"zm_Container"}),m.SpamTrashBand.setBand(),m.removeBulkActionBand(),zmCenterListing.mailObjectAPI.dropViewObjectStore("zm_Container")},s=function(){if("1"===zmail.collabVersion){var a=function(a,b){b=b||{};var c=zmAdHocSettings.getSuppressedMessagesState();if("off"!==c.mailShareTip){var d=zmail.mailObj[b.mailID]||{};if((b.mailID||"forward"!==b.mode)&&!(d&&[zmail.folId.teId,zmail.folId.oId,zmail.folId.dId].indexOf(d.FD)!==-1||d&&zmail.shrTree[0]&&zmail.shrTree[0][d.FD])){var e=zmUtil.getFolderObject(d.FD);e&&"-1"!==e.SH||zmmailAct.mailShareTip.show()}}};$.subscribe("/mail/forwardmail",a),$.subscribe("/compose/bccpresent",a)}},t=function(b){var c,d,e,f,h,i,j,l,m="sum unreadCount";if("zmStreamTree"!==zmail.mailLeft.selLayerId){i=a.getListingDetObj(),d=zmail.mailLeft.selId,e=zmail.mailLeft.getSelectedRowObj()[d],f=e.FN||e.dispName||e.name,c=zmsuite.getCenter("zm_Container")[0].getNodes()[1];var n=!1,o=function(a){var b={"-1":g.headertitle.flagmsg,1:g.headertitle.infoflagmsg,2:g.headertitle.impflagmsg,3:g.headertitle.followupmsg};return a&&b[a]?'<span class="'+m+'">'+b[a]+"</i></span>":""};if("notification"===b&&c.$el.find(".selCount").is(":visible"))return void c.$el.find(".unreadCount").hide();if("zm_unread"===d)if(h=a.getUnreadViewCount(),h>1){var p=g.headertitle.multiplemail;j=zmText.applyArgs(p,{count:h}),f+='<span class="'+m+'"> '+j+"</span>"}else 1===h&&(f+='<span class="'+m+'"> '+g.headertitle.singlemail+"</span>");else if("zm_flag"===d)f+=o(i.flag),n="-1"===i.flag?0:1;else if(zmail.folCount[d])if(i.flag)f+=o(i.flag),n=!0;else if(i.label)"-1"===i.label?(f+='<span class="'+m+'">'+g.headertitle.alltagged+"</span>",n=!0):(j=g.headertitle.filteredtag,l=zmText.applyArgs(j,{tagname:zmUtil.findTagName(i.label)}),f+='<span class="'+m+'">'+l+"</span>",n=!0);else if("1"===i.attach)f+='<span class="'+m+'">'+g.headertitle.attachview+"</span>",n=!0;else if("archive"===i.view)f+='<span class="'+m+'">'+g.headertitle.archiveview+"</span>",n=!0;else if("unread"===i.view){var q;q=d===zmail.folId.sId?g.headertitle.unreadEmails:parseInt(zmail.folCount[d].c)?1===zmail.folCount[d].c?g.headertitle.singleunread:zmText.applyArgs(g.headertitle.multipleunread,{n:zmail.folCount[d].c}):g.headertitle.noUnreadEmails,f+='<span class="'+m+'">'+q+"</i></span>",n=!0}else if(zmail.folCount[d].c>0){var r=g.headertitle.singleunread,s=g.headertitle.multipleunread;d===zmail.folId.oId&&(r=g.headertitle.singleunreadOutbox,s=g.headertitle.multipleunreadOutbox),d===zmail.folId.sId&&(r=g.headertitle.sUndeliveredCount,s=g.headertitle.mUndeliveredCount),1===zmail.folCount[d].c?f+='<span class="'+m+'"> '+r+" </span>":(l=zmText.applyArgs(s,{n:zmail.folCount[d].c}),f+='<span class="'+m+'"> '+l+" </span>")}if(n){var t=$("<div>"+f+"</div>");t.find(".sum").addClass("SC_folFil"),t.find(".sum").append('<i class = "msi-close"></i>'),f=t.html()}k.list.left.leftHTML=f,c.push(k.list),c.paint(),c.$el.find(".msi-close").off("click").on("click",function(){
var a="flag"===zmUtil.getFolId()?"zm_flag":zmUtil.getFolId();zmList.showMailListing({fId:a})}),"notification"===b&&c.$el.find(".selCount").is(":visible")&&c.$el.find(".unreadCount").hide()}},u=function(a){var b=a/1024;b=Math.ceil(b);var c=b.toString().length;return c>3?b=Math.ceil(b/1024)+" MB":b+=" KB",b},v=function(b){if(zmsuite.isWorkspaceAvailable("zm_Container")){var c,d=a.getListingDetObj();c=d.fId?parseInt(zmail.folCount[d.fId].c):parseInt(zmail.folCount[zmail.folId.iId].c),(d.fId&&d.fId!==zmail.folId.sId&&d.fId!==zmail.folId.teId&&d.fId!==zmail.folId.dId&&c!==b||!d.fId&&"unread"===d.view&&c!==b)&&a.getFolderTreeCount()}},w=function(a){var b,c={};c.parentDOM=$(a),c.displayAs="dropdown",c.hltPar=!0,c.offsets={left:0,top:-1},c.excludeList=[zmail.folId.dId,zmail.folId.teId,zmail.folId.oId],c.excludeChild=!0,c.viewDOM=$(zmsuite.getCenterOuter().$el).find(".SCmc"),c.onSelect=function(a){zmmailAct.doActions("move","drop",{action:"move",folId:a})},c.onCreate=function(a){zmfolAction.isValidName(a,void 0,{opType:"new"})&&(zmfolAction.sendNewFolderReq(a,{reqDoneClbk:function(a,b){a&&c.onSelect(b)}}),b.hide())},b=zmUtil.createFLComp("folder-path",c),b.show()},x=function(a){var b,c={};c.parentDOM=$(a),c.hltPar=!0,c.displayAs="dropdown",c.labelState={selectedMails:!0},c.offsets={left:0,top:-1},c.viewDOM=$(zmsuite.getCenterOuter().$el).find(".SCmc"),c.onStateChange=function(a,b){zmmailAct.applyActions("label","click",{lA:b?"add":"delete",lId:a,disp:zmail.labInfo[a].dispName})},c.onCreate=function(a,d){zmlab.isValidName(a)&&zmlab.labelCreate(a,"",{reqDoneClbk:function(a,d){a&&(c.onStateChange(d,!0,function(){}),b.hide())},color:d})},b=zmUtil.createFLComp("label",c),b.show()},y=function(){var b,c,d,e,f,h=a.getListingDetObj(),i=[],j="",k="",l=0;if(b={unread:g.common.unreadmsg,archive:g.common.archivemsg,all:g.common.allmsg},c={"-1":g.selmenuopt.all,1:g.flagmenu.infoflag,2:g.flagmenu.important,3:g.flagmenu.followup},d={"-1":g.windowtitle.flagfolder,1:g.windowtitle.infoflagfolder,2:g.windowtitle.impflagfolder,3:g.windowtitle.followupflagfolder},h){if(h.fId?(k=a.findFolName(h.fId),l=zmail.folCount[h.fId]&&zmail.folCount[h.fId].c,h.view?(e="unread"===h.view?l?g.windowtitle.unreadfolderwithoutmails:g.windowtitle.unreadfolder:"archive"===h.view?g.windowtitle.archivefolder:g.windowtitle.folder,f=zmText.applyArgs(e,{foldername:k}),i.push(f)):h.flag?(e=d[h.flag],f=zmText.applyArgs(e,{foldername:k}),i.push(f)):h.label?("-1"===h.label?(e=g.windowtitle.tagfolder,f=zmText.applyArgs(e,{foldername:k})):(e=g.windowtitle.filteredtagfolder,f=zmText.applyArgs(e,{foldername:k,tagname:zmail.labInfo[h.label].dispName})),i.push(f)):h.attach?(e=g.windowtitle.attachfolder,f=zmText.applyArgs(e,{foldername:k}),i.push(f)):(e=g.windowtitle.folder,f=zmText.applyArgs(e,{foldername:k}),i.push(f))):h.label?(e=g.windowtitle.tagview,f=zmText.applyArgs(e,{tagname:zmail.labInfo[h.label].dispName}),i.push(f)):h.view?(i.push(b[h.view]),"unread"===h.view&&(l=a.getUnreadViewCount())):h.flag&&("-1"!==h.flag?j=c[h.flag]+" ["+g.common.flagged+"]":j+=g.windowtitle.flagview,i.push(j)),l>0){if("undefined"!=typeof zmUtil){var m=!0;l=zmUtil.commaSeparateNum(l,m)}i.unshift("("+l+")")}return i}},z=function(){var a=function(a,b){b=b||{},b=b.data||{};var c={};if(b.cs&&(c=$.parseJSON(b.cs)[0]||{}),b.error)zmUtil.updOutbox(b);else if(c.event){var d=["moveMail","markFlagged","emptyFolder","folderRead","renameFolder","deleteFolder","moveFolder","addFolder"];"undo_expired"===c.event?window.zmRecall&&zmRecall.removeMessageBand():d.indexOf(c.event)!==-1&&$.publish("wmsevents/mail",{event:c.event,notification:b,content:c})}else b.MDS?zmInit.updateMailDeliveryStatus(b):zmmailAct.doActions("newm","chat",b)},b=function(a,b){if(b=b.data||{},b.act){var c=b.act;switch(c){case"MAIL_DELIVERY_STATUS":zmInit.updateMailDeliveryStatus(b.data);break;case"UNDO_EXPIRED":window.zmRecall&&zmRecall.removeMessageBand();break;case"NEW_MAIL":zmmailAct.doActions("newm","chat",b);break;case"OUTBOX_ACTIVITY":zmUtil.updOutbox(b.data);break;case"MARK_FLAGGED":case"MOVE_MAIL":zmmailAct.handleWMSEvents(c,b,b.data);break;case"EMPTY_FOLDER":case"FOLDER_READ":case"ADD_FOLDER":case"DELETE_FOLDER":case"MOVE_FOLDER":case"RENAME_FOLDER":zmfolAction.handleWMSEvents(c,b,b.data);break;case"BULK_OPR":zmmailAct.notifyBulkAction(b.data);break;case"NEWUI_SETTINGS_UPDATE":settSyncer.updProperties(b);break;case"WATCH_EXPIRED":var d=window.zmWatch;if(d){b.stat="success";var e={cmpId:b.data["MessageId "],watchMode:"d"};d.updateWatch(b,e)}}}else zmUtil.debugLog("WS notification ignored "+JSON.stringify(b))};zmail.isWSEnabled?zmComponent.notifier.addHandler("mail",b):zmComponent.notifier.addHandler("mail",a)},A=function(){var b=_zm("#","nmenc");b||(b=_zm.getDOM(["DIV",{attrs:{id:"nmenc","class":"SC_mnoti"}}]),document.body.appendChild(b)),a.mNotifier=zmComponent.mailNotifier({parent:b,openMail:function(a){var b=a&&a.M;b&&zmList.getMailData({msgId:b,opentype:2,type:"lt",src:"external",eprm:{accId:zmail.accId}})}}),z()},B=function(a,b){var c=zmsuite.getCenter(a)[0].getNodes()[0].$el.find(".msi-classic");c.length||(c=zmsuite.getCenter(a)[0].getNodes()[0].$el.find(".msi-compact")),"0"===b?c.removeClass().addClass("msi-classic"):"1"===b&&c.removeClass().addClass("msi-compact")},C=zmUtil.isChatletEnabled()&&zmail.isOrg?[{tooltip:zmText.applyArgs(zmText.get("mailsuite").tooltips.chatlet,{entity:zmText.get("mailsuite").entity[1]}),html:[["I",{attrs:{"class":"msi-cliqColor"},child:[["I",{attrs:{"class":"path1"}}],["I",{attrs:{"class":"path2"}}]]}]],data:{action:"chatlet"}}]:[],D=zmsuite.createAppRouter();$.extend(a,{rclkId:0,startFill:!1,leftMain:null,mapObj:{bold:"S",id:"M",data:"data",subIcon:"AT",count:"TC",flag:"NFG",date:"DT",from:"F",sub:"SB",sum:"SM",pri:"PR",tagLst:"TAG",dataAttr:"ty",fName:"FN",iconArr:"ICN",outboxSts:"OBT",att:"S",arch:"AR",hasTask:"HT",draftCount:"DC",outType:"OT",outText:"SCTX",calEvent:"HC",schemaIcon:"actionIcon",schemaIconColor:"actionIconColor",schemaDisable:"expired",sender:"fromaddr",deliverySts:"MDS",mdsParentClass:"MDS",adjustWidth:"AW",markupIcons:"MUI"},classObj:{bold:{0:"zm_urd",2:"zm_urd",3:"zm_urd"},markupIcons:{0:"msi-cart zmDoubleIcon zm_schmIco",1:"msi-flight zmDoubleIcon zm_schmIco"},att:{0:"msi-mail",1:"msi-mail","":"",2:"msi-rpd",3:"msi-fwd",4:"msi-rpd",5:"msi-fwd",6:"msi-edit",7:"msi-fwdRpd",8:"msi-fwdRpd"},calEvent:{2:"msi-calendar",3:"msi-calendar zmEvAcc",4:"msi-calendar zmEvDec",5:"msi-calendar zmEvMay",6:"msi-calendar zmEvCan",8:"msi-calendar",9:"msi-calendar",10:"msi-calendar",11:"msi-calendar",12:"msi-calendar"},subIcon:{1:"msi-attachicon"},flag:{0:"zm_icn zmflg",1:"zm_icn zmflg zm_fgB",2:"zm_icn zmflg zm_fgR",3:"zm_icn zmflg zm_fgG",4:"msi-priority zm_icn SC_lred",5:"msi-priority zm_icn SC_lgreen",6:"zm_icn zmflg zm_fgM"},pri:{1:"SC_red",2:"SC_red",4:"SC_blue",5:"SC_blue"},outboxSts:{0:"SC_lred",1:"SC_lgreen"},arch:{1:"zmarch"},hasTask:{1:"SC_mdata"},outType:{1:"msi-clock",2:"msi-reccur"},schemaIcon:{one_click:"msi-tick","goto":"msi-pout",review:"msi-rate",review_comment:"msi-review",rsvp:"msi-rsvp"},schemaIconColor:{one_click:"zmlbtn_green","goto":"zmlbtn_red",review:"zmlbtn_orange",review_comment:"zmlbtn_blue",rsvp:"zmlbtn_blue"},schemaDisable:{1:"zmlbtn_disable"},deliverySts:{0:"",1:"msi-mailQue",2:"msi-mailQue",3:"msi-mailQue",4:"msi-mailQue",5:"msi-mailSuc",6:"msi-mailFail",7:"msi-mailFail",8:"msi-mailUndo",9:"msi-mailRetry",10:"msi-mailRetry"},mdsParentClass:{0:"",1:"",2:"zmSndSts-pro",3:"zmSndSts-pro",4:"zmSndSts-pro",5:"zmSndSts-suc",6:"zmSndSts-fail",7:"zmSndSts-fail",8:"zmSndSts-fail",9:"zmSndSts-failB",10:"zmSndSts-fail"},adjustWidth:{1:"lsWidth"}},prevHeader:{id:"zmPrevHeader",text:"Preview Text",rIcons:[C,[{tooltip:i.iconTooltip.prev,iconClass:"msi-prev",data:{action:"msi-prev"}},{tooltip:i.iconTooltip.next,iconClass:"msi-next",data:{action:"msi-next"}}],[{tooltip:i.iconTooltip.popout,iconClass:"msi-popout",data:{action:"openwindow",from:"header"}}],[{tooltip:i.iconTooltip.close,tooltipDir:"right",iconClass:"msi-close",data:{action:"clsPrev"}}]]},initMailAppRouter:function(){D.initialize({hashKey:"mail",handler:zmUrlAct.manualHandler}),D.activate();var b=zmHash.decode();zmail.onDemandListing&&b.key&&(zmail.initialPageTrigger.hash=!0),!b.key||"mail"===b.key&&"tab"===b.params[0]||"mail"===b.key&&!b.params.length?a.lPageType()?(D.setParams(["folder","inbox"]),D.update()):(D.setParams(["views","unread"]),D.update()):"mail"!==b.key&&(a.lPageType()?D.setParams(["folder","inbox"]):D.setParams(["views","unread"]))},init:function(){var b={appname:"Mail",appId:"zm_Container",appIcon:"msi-mail",faqKey:"mail listing",searchPlaceHolder:zmText.get("mailsuite").searchMail,data:{LNodes:"2",CNodes:"3"},stateData:{type:"app",data:{accId:zmail.accId,listing:{view:{fId:zmail.folId.iId,view:"",viewId:""},expand:{mId:""}},preview:{p:""}}},handler:{create:function(){_zm.isSmartComposeEnabled()?zmUtil.loadSmartCompose({eType:"6",type:"tab"}):zmUtil.compose()}},shortcuts:zmshCut.mail,titleProvider:y,sortLeftLayers:!0,appBodyClassName:"SC_mailApp",router:D};zmsuite.setAppInfo(b),zmWinTitle.registerDefaultProvider(y),zmail.postJsDeffered.done(function(){zmail.onDemandListing||a.initMailAppRouter()}),$.subscribe("/mail/accountSwitch",function(b,c){c=c||{},"success"===c.status&&(a.lPageType()?D.update(["folder","inbox"]):D.update(["views","unread"]))}),zmCrosstab.subscribe("zm_mail",{},zmMsgProcessor._handler,!1),zmSearchUtil.isNewSearch()&&zmailSearch.Core.registerDemandFilter()},initials:function(){if(zmail.prevMails={},zmail.outboxFail){var a=zmsuite.getAppObj("zm_Container").centerObj.$el,b=e.global.notifoutbox,c=["DIV",{attrs:{id:"zm_outboxfail","class":"SC_msg SC_emsg"},child:[["SPAN",{}]]}],d=_zm.getDOM(c);a.append(d),b+=" <i class='msi-close' onclick='zmInit.outboxClose();'></i>",$("#zm_outboxfail").children("span").html(b),zmUtil.updSendErrorStatus(!0,zmail.folId.oId)}$("#MS_action span").unbind("click").click(function(){zmUtil.compose()}),$("#zmsignout").unbind("click").click(function(){location.href=zmail.logoutURL})},outboxClose:function(){$("#zm_outboxfail").remove()},sendLoadOutbox:function(a){if("hide"===a)$("#zm_outbox_send_load").remove();else{var b="Loading",c=["DIV",{attrs:{id:"zm_outbox_send_load","class":"SC_msg SC_imsg"},child:[["SPAN",{}]]}],d=_zm.getDOM(c);$("body").append(d),$("#zm_outbox_send_load").children("span").html(b)}},loadOnDemandListing:function(b){if("zm_Container"===b&&!zmail.initialListingLoaded)if(zmail.initialPageTrigger.restore&&"m"===zmail.restoredApp){var c=zmState.getStoredSessionState().state.data.app.data,d=$.Deferred();$.when(d).done(function(){var a=$.Deferred();c.listing.expand.mId?zmRestore.expandThread(c.listing.expand.mId,a):a.resolve(),$.when(a).done(function(){window.setTimeout(function(){c.preview.p&&zmRestore.restorePreview(c.preview.p)},400)})}),zmList.showMailListing(c.listing.view,{retainPreview:!1,sortAscending:void 0,mlDefObj:d})}else zmail.mailLeft.selId?zmList.showMailListing({fId:zmail.mailLeft.selId}):a.lPageType()?zmList.showMailListing({fId:zmail.folId.iId}):zmList.showMailListing({fId:"zm_unread"})},initMailList:function(){var b,c="",d={},e={},f={};1===a.lPageType()?(c=zmail.folId.iId,b=c,e={fId:c,view:"",label:"",flag:"",attach:""},f={fId:c,view:"",lId:"",flag:"",attach:""}):(c="zm_unread",b="unread",e={fId:"",view:"unread",label:"",flag:"",attach:""},f={fId:"",view:"unread",lId:"",flag:"",attach:""}),d=a.cacheDataObj(zmail.mailList,b,1),a.setListingDetObj(e),f.showNxt=d.showNextPage,a.mailList(d.MO,f),zmTopMenus.util.show({type:"listing",fId:b,tabId:"zm_Container"})},constructView:function(b){if(b&&(zmail.folId=b.folId,zmail.folTree=b.folTree,zmail.folCount=b.folCount,zmail.labInfo=b.labInfo,zmail.viewInfo=b.viewInfo,zmail.mailOpt=b.mailOpt),zmail.shrTree=zmail.shrTree||[],zmail.shrLabelTree=zmail.shrLabelTree||[],zmail.showFeature&&zmail.shrLabelTree.length){var c=$.extend({},zmail.shrTree[0],zmail.shrLabelTree[0]);zmail.shrTree[0]=c}zmail.zohoAccLabInfo||(zmail.zohoAccLabInfo=zmail.labInfo),zmail.mailObj={},zmail.listObj={},zmail.sortOrder=!zmail.mailOpt.isDesc,zmail.mailLeft=zmsuite.getLeft(),a.setListingDetObj({}),zmail.folCount[zmail.folId.sId].c="0",zmail.folCount[zmail.folId.dId].c="0",a.translateSystemFolders(),a.constructLeft(),a.constructCenter(),a.constructRight(),zmsuite.showExistingApp("zm_Container"),zmApp.selectedApp="m",zmail.mailCenter=zmsuite.getCenter(),zmail.mailCenter.listElem=zmail.mailCenter[0].getNodes()[2].$el[0],zmail.mailCenter.listObj=zmail.mailCenter[0].getNodes()[2],zmail.mailCenter.prevElem=zmail.mailCenter[1].$el[0],zmail.mailCenter.prevObj=zmail.mailCenter[1],zmail.mailCenter.prevObj.getNodes()[0].setListener("click",function(a,b){zmList.bindAction(a,b)})},zmfnPrecall:function(){zmail.win.zmCache=zmail.folderCache},getSuppressedFolders:function(){zmfolAction.getNotificationSuppressedFolders(zmail.accId).done(function(a){zmail.notificationSuppressedFolders=a.folderList||[]})},isNotificationSuppressed:function(a){return!(!a||!zmail.notificationSuppressedFolders||zmail.notificationSuppressedFolders.indexOf(a)===-1)},updateSuppressedFolders:function(a,b){zmail.notificationSuppressedFolders=zmail.notificationSuppressedFolders||[];var c,d=a.length;if(b)for(c=0;c<d;c++)zmail.notificationSuppressedFolders.indexOf(a[c]===-1)&&zmail.notificationSuppressedFolders.push(a[c]);else for(c=0;c<d;c++)zmail.notificationSuppressedFolders.indexOf(a[c]===-1)&&zmail.notificationSuppressedFolders.pop(a[c])},lPageType:function(){try{var a=zmail.Settings.Platform.Components.SettingManager.get("startup-action").get();if("new-session"===a)return zmail.mailOpt.isFol;if(a=zmail.Settings.Platform.Components.SettingManager.get("mail-app-startup").get(),"inbox"===a)return 1;if("unread"===a)return 0}catch(b){return zmUtil.debugLog(b),1}},initMailSuite:function(){if(zmshCut.currentLeftId=1===a.lPageType()?zmail.folId&&zmail.folId.iId:"zm_unread",zmUrlAct.init(),a.zmfnPrecall(),a.init(),a.constructView(),a.initials(),null===zmail.mailList){if(zmail.onDemandListing=!0,zmail.initialPageTrigger={hash:!1,restore:!1,setting:!1},zmail.initialListingLoaded=!1,a.initMailAppRouter(),!zmail.initialPageTrigger.hash&&"restore"===zmAdHocSettings.getLPageType()){zmail.initialPageTrigger.restore=!0;var b=zmState.getStoredSessionState().state;if(b&&b.data.app&&(zmail.restoredApp=b.data.app?b.data.app.currApp:"",zmail.restoredAccId=b.data.app.data?b.data.app.data.accId:"","m"===b.data.app.currApp)){var c=b.data.app.data;if(c.accId===zmail.accId){zmail.initialListingLoaded=!0;var d=c.listing.view;zmList.showMailListing(d,{retainPreview:!1,sortAscending:void 0})}}}zmail.initialListingLoaded||zmail.initialPageTrigger.hash&&zmail.initialPageTrigger.restore?a.removeMailPageLoader():(zmail.initialPageTrigger.setting=!0,zmail.initialListingLoaded=!0,a.lPageType()?zmList.showMailListing({fId:zmail.folId.iId}):zmList.showMailListing({fId:"zm_unread"}))}else a.initMailList();a.updateCountTitle(),A(),q(),s();var e=function(){zmail.allowInline=1!==zmail.mailOpt.compTab};zmAdHocSettings.subscribe("settingsloaded",e),zmAdHocSettings.subscribeComposeTypeChange(function(){e(),$.publish("/mail/listMails",{})}),zmail.loadCompleted=!0,zmInit.getSuppressedFolders(),l()},hashFolPath:function(a){var b="",c="";return a===zmail.folId.iId||"inbox"===a?(b+="inbox",c=zmail.folId.iId):a===zmail.folId.dId||"drafts"===a?(b+="drafts",c=zmail.folId.dId):a===zmail.folId.spId||"spam"===a?(b+="spam",c=zmail.folId.spId):a===zmail.folId.teId||"templates"===a?(b+="templates",c=zmail.folId.teId):a===zmail.folId.sId||"sent"===a?(b+="sent",c=zmail.folId.sId):a===zmail.folId.tId||"trash"===a?(b+="trash",c=zmail.folId.tId):a===zmail.folId.oId||"outbox"===a?(b+="outbox",c=zmail.folId.oId):"unread"===a||"zm_unread"===a?(b+="unread",c="zm_unread"):"all"===a||"zm_all"===a?(b+="all",c="zm_all"):"flag"===a||"zm_flag"===a?(b+="flagged",c="zm_flag"):/^\+?(0|[1-9]\d*)$/.test(a)&&(b+=a,c=a),{hashTxt:b,folId:c}},constructLeft:function(){var b,c,d=[];b=zmail.mailLeft.getNodes();var e={id:"id",name:"name",count:"scount",sequence:"order"},h={id:"id",name:"FN",count:"c",parentId:"p",hasChild:"HC",expChild:"E",sequence:"SE",shared:"SH"},i={name:"dispName",color:"color",id:"id",count:"c",sequence:"se"};zmail.showFeature&&(i.shared="shId");var j={id:"id",name:"FN",count:"c",parentId:"p"},k={id:"id",name:"FN",OZUID:"OZUID",accessText:"ROLE",entityClass:"RT"},l={accessText:{11:"R",12:"W",13:"W"}},m={entityClass:{91:"msi-folder",92:"msi-label"}},n={id:"id",name:"FN",sequence:"SE"},o=new ZMLayer,p={type:"1",listId:"zmsTree",hasChild:!1,mapObject:e,id:"zmStreamTree",dataObject:{headerObject:{id:"zmStreamTree",name:"STREAMS",showList:!0},listObject:zmUtil.getEmailEnabledGroup()}};p.disableSelection=!0,p.dataObject.headerObject.scount="<i class='msi-plus'></i>",zmUtil.isNewGroupUser()?(p.dataObject.headerObject.settingsOption=!0,p.dataObject.headerObject.settingsObject={className:"msi-manageGroup",onClick:function(){zmAppLoader.load("streamsGroupManagement").done(function(){zmStreamsApp.GroupManageApp.init({groupManage:!0,app:"streams",createCallback:function(a){zmsuite.loadStreams(a)}})})}},p.dataObject.headerObject.onAdd=function(){zmAppLoader.load("streamsGroupManagement").done(function(){zmStreamsApp.GroupManageApp.init({createGroup:!0,app:"streams",createCallback:function(a){zmsuite.loadStreams(a)}})})}):p.dataObject.headerObject.onAdd=function(){zmGroupSubscription.showPage({onPreviewClose:zmStreamsApp.util.closePreview})},o.push(p),d.push(o);var q=new ZMLayer,r={type:"1",listId:"zmlTree",hasChild:!0,hasCountObject:!0,mapObject:h,id:"zmlTreeH",dataObject:{headerObject:{id:"zmlTreeH",name:f.header.folders,c:"<i class='msi-plus'></i>",showList:!0,onAdd:function(){zmfolAction.showCreateFolderPopUp({mode:"new"})}},listObject:zmail.folTree[0],childObject:zmail.folTree[1],countObject:zmail.folCount}};q.push(r),q.setDragDrop({allowedParents:"#zmlTreeH",getDescendant:0===zmail.mailOpt.folSort,onDrop:function(a,b,c,d){zmfolAction.onDrop(a,b,c,d)},allowDrag:function(a){return zmfolAction.allowDrag(a)},allowDrop:function(a,b,c){return zmfolAction.allowDrop(a,b,c)},dragStart:function(a,b){var d,e={};for(d in b)c=d;return e.text=b[c].FN,e}});var s=new ZMLayer,t={type:"2",mapObject:i,listId:"zmllabel",id:"zmllabelH",dataObject:{headerObject:{id:"zmllabelH",name:f.header.tag,showList:!0,c:"<i class='msi-plus'></i>",onAdd:function(){zmlab.showCreateTagPopUp({mode:"new"})}},listObject:zmail.labInfo}};s.push(t),s.setDragDrop({allowedParents:"#zmllabelH,.zmL",onDrop:function(b,c,d,e){var f,g,h,i,j={},k=[],l=[];for(f in c)h=f;if("center"===e){if(i=a.getListingDetObj().fId,g=d.length,i===zmail.folId.dId||i===zmail.folId.teId||i===zmail.folId.oId||i===zmail.folId.spId)return!1;for(f=0;f<g;f++)d[f].id.indexOf("t")!==-1?k.push(a.zmsubStr(d[f].id,"t")):l.push(d[f].id);j={action:"label",msgId:l,thd:k,lA:"add",lId:h},zmmailAct.applyActions("label","click",j)}else zmlab.labelmov("m",c,d)},allowDrag:function(){return!0},allowDrop:function(a,b,c){return"inside"!==c&&(0===zmail.mailOpt.labSort||"next"!==c&&"prev"!==c)},dragStart:function(a,b){var c,d,e={};for(c in b)d=c;return e.text=b[d].dispName,e}});var u=new ZMLayer,v={type:"1",mapObject:j,listId:"zmlview",id:"zmlviewH",hasCountObject:!0,dataObject:{headerObject:{id:"zmlviewH",name:f.iconTooltip.views,showList:!0},listObject:{zm_unread:{FN:g.common.unread},zm_all:{FN:g.common.allmsg},zm_flag:{FN:g.common.flagged}},countObject:{zm_unread:{c:a.getUnreadViewCount(),p:"-1"},zm_all:{c:0,p:"-1"},zm_flag:{c:0,p:"-1"}}}};if(u.push(v),d.push(q),zmail.shrTree.length&&zmail.accId===zmail.defAccId){var w=new ZMLayer,x={type:"3",mapObject:k,listId:"zmlSTree",id:"zmlSTreeH",classObject:l,dataObject:{headerObject:{id:"zmlSTreeH",name:f.header.sharedwithme,showList:!0},listObject:zmail.shrTree[0]}};zmail.showFeature&&(x.entityClass=m),w.push(x),d.push(w)}if(d.push(s),d.push(u),zmail.savedSearchList&&Object.keys(zmail.savedSearchList).length>0){var y=new ZMLayer,z={type:"1",mapObject:n,disableSelection:!0,listId:"zmlSSrchTree",id:"zmlSSrchTreeH",dataObject:{headerObject:{id:"zmlSSrchTreeH",name:f.header.savedsearch,showList:!0},listObject:zmail.savedSearchList}};y.push(z),d.push(y)}b[0].push({layerArr:d}),zmail.mailLeft.render(),1===a.lPageType()?(c=zmail.folId.iId,zmsuite.getLeft().selRow(c,"zmlTreeH")):(c="zm_unread",zmsuite.getLeft().selRow(c,"zmlviewH")),zmail.mailLeft.setListener("click",function(b){a.bindLeftActions(b)}),zmail.mailLeft.setListener("contextmenu",function(b){a.bindLeftActions(b)}),zmail.mailLeft.getNodes()[0].getLayer("zmlTreeH").setChildToggle(a.viewChild)},constructCenter:function(){var b=zmsuite.getCenter(),c=b[0].getNodes();c[0].push(j.list,{rightElemCustomClass:"SC_prm"}),c[0].setListener("click",function(b,c){a.bindActionHeaderIcons(b,c)}),c[1].push(k.list),c[2].setListener("click",function(a){("zm_Container"!==zmTab.currentTab||"2"!==zmail.listDetails.attach&&"zmStreamTree"!==zmail.mailLeft.selLayerId)&&zmList.bindEventsMailRow(a)}),c[2].setListener("contextmenu",function(a){("zm_Container"!==zmTab.currentTab||"2"!==zmail.listDetails.attach&&"zmStreamTree"!==zmail.mailLeft.selLayerId)&&zmList.mailUtility(a)}),c[2].setDragDrop({onDrop:function(b,c,d){var e,f,g,h,i=[],j=[];for(g in d)e=g;for(h=c.length,g=0;g<h;g++)c[g].id.indexOf("t")!==-1?j.push(a.zmsubStr(c[g].id,"t")):i.push(c[g].id);d[e].FN?(f={action:"move",folId:e,msgId:i,thd:j},zmmailAct.doActions("move","drop",f)):(f={action:"label",msgId:i,thd:j,lA:"add",lId:e},zmmailAct.applyActions("label","drop",f))},allowDrag:function(){var b;return b=a.getListingDetObj().fId,b!==zmail.folId.dId&&b!==zmail.folId.teId&&b!==zmail.folId.spId&&b!==zmail.folId.oId&&"2"!==zmail.listDetails.attach&&!zmUtil.isSharedFolder(b)},allowDrop:function(a,b,c){var d,e;for(d in b)e=d;return b[e].FN?"inside"===c&&(e!==zmail.folId.dId&&e!==zmail.folId.teId&&e!==zmail.folId.oId&&"2"!==zmail.listDetails.attach):"inside"===c},dragStart:function(b,c){var d,e={};return c.length>1?(e.count=zmUtil.getCheckedMailCount(),e.text=f.common.emailsel):(d=a.zmsubStr(c[0].id,"t"),e.text=zmail.mailObj[d].SB),e},allowedParents:"#zmlTreeH,#zmllabelH,.zm_tabs"}),zmsuite.renderCenter(),t(),a.setDisplayDensity()},constructRight:function(){zmsuite.renderRight()},getListingDetObj:function(){return zmail.listDetails},setListingDetObj:function(a){"string"==typeof a?zmail.listDetails=$.parseJSON(a):zmail.listDetails=a},viewChild:function(a,b){var c,d,e,f;if(a.zmsData)for(var g in a.zmsData.rowObject)c=a.zmsData.rowObject[g],d=g;else c=a,d=b[0].id;e=b.find(".msi-arrow45"),f={accId:zmail.accId,mode:"expand",folId:d},e.length?(f.isExpand=1,c.E=1):(f.isExpand=0,c.E=0),zmAjq.XHR({u:zmail.conPath+"/folAction.do",t:"POST",fn:"",p:f,csr:"s"})},flgClass:function(a,b){var c="";return a=parseInt(a),c=1===a?"zm_icn zmflg zm_fgB":2===a?"zm_icn zmflg zm_fgR":3===a?"zm_icn zmflg zm_fgG":6===a?"zm_icn zmflg zm_fgM":"s"===b?"":"zm_icn zmflg"},getThdFlagvalue:function(a){var b=0;if(a){var c=zmail.mailObj[a];b=c.TI&&c.TF||c.TF&&c.TM||c.TM&&c.TI?6:zmail.mailObj[a].TF?3:zmail.mailObj[a].TM?2:zmail.mailObj[a].TI?1:0}return b},findFolName:function(a){if(zmail.folTree[0][a])return zmail.folTree[0][a].FN;var b,c=zmail.folTree[1];for(var d in c)if(b=c[d].CH,b[a])return b[a].FN;var e=zmail.shrTree||[];for(var f in e)if(e[f][a])return e[f][a].FN;return""},getMails:function(b,c,e,f,g){var h,i,j=zmail.mailOpt.isshowSummary,k=b.f,l=b.t,m=b.fId,n=b.label,o=b.flag,p=b.attach,q=b.view;k||(k=1),f=void 0!==f?f:zmail.sortOrder;var r,s={from:k,to:l,ty:c,fId:m,lId:n,view:q,flag:o,attach:p,cache:!1,scenario:b.scenario,retainPreview:b.retainPreview,sortOrder:f,mlDefObj:g},t={mode:"listing",accId:zmail.accId,from:k,to:l,summary:j,sortBy:"date",sortOrder:f,folderSpec:zmUtil.getMLConversionValue()};if(b.shId&&(t.shId=b.shId,2===zmail.folviewThread&&(t.folderSpec=1),zmail.opType.list?t.opType=zmail.opType.list:t.opType=0,m&&zmUtil.isSharedFolder(m)&&92===zmail.shrTree[0][m].RT&&(n=m,m="")),""!==m&&(t.folId=m,s.from=k,m===zmail.folId.sId&&(t.folderSpec=0)),""!==o&&(t.flag=o,b.sendReq=!0),""!==n&&(t.label=n,b.sendReq=!0),""!==p&&(t.attach=p,b.sendReq=!0),""!==q&&(m&&"all"===q||(t.view=q),b.sendReq=!0),r=m||n||q,zmail.listObj[r]&&(h=zmail.listObj[r].MO,s.showNxt=zmail.listObj[r].showNextPage),i=b.callbk?b.callbk:a.mailList,!zmail.listObj[r]||b.sendReq){s.req="server",s.reqId=++d;var u,v={u:zmail.conPath+"/ml.do",t:"POST",p:t,ep:s},w=zmail.mailCenter.listElem;if(!e){var x=1===b.f?"listing":"pagination";u=zmComponent.loadingBand({container:w,type:x,addAtFirst:1===b.f})}v.fn=function(a,b){u&&u(),i(a,b)},v.efn=function(b,c,d,e){u&&u(),a.onNetFailure(b,c,d,e)},zmAjq.XHR(v),zmUtil&&(zmUtil.isSharedFolder(m)||zmUtil.isFolderId(m)&&"-1"!==zmList.getRowInfo(m,"zmlTreeH","info").SH)&&"undefined"==typeof zmStream&&zmUtil.requireStreamsApp().done(function(){})}else i(h,s)},foldView:function(b){var c,d,e,f="",g="",h="",i="",j="",k="",l="",m=b.folId||"",n=b.view||"",o=b.viewId||"",p=b.reInitialize,q=b.isLoadingNotNeeded,s=b.retainPreview,t=b.sortOrder;if(d=a.getListingDetObj(),zmail.initialListingLoaded||(zmail.initialListingLoaded=!0),d.view?(l=d.view,g=d.view):d.label?(l="label",g=d.label):d.attach?(l="attach",g=d.attach):d.flag&&(l="flag",g=d.flag),d.fId?f=d.fId:d.label&&(f=d.label),m.indexOf("zm_")!==-1&&(n=m.substring(3,m.length),m="","unread"===n||"all"===n?o=n:""===o&&(o="-1")),f!==m||l!==n||g!==o){a.startFill=!1,c=m,"flag"===n?(n="",j=o||-1):"attach"===n?(n="",k=1):"label"===n&&(n="",i=o||-1),e=$("#zm_Main .SC_frt .SC_mtb").eq(1),m||"unread"!==n&&"all"!==n&&"flag"!==n?e.show():(m="","flag"===n?e.show():e.hide()),zmail.labInfo[m]&&(n="",i=m,m="",c=""),zmail.loadCompleted&&!s&&zmPrev.clsPreview("list"),("stream"===n||c&&"all"===n)&&(n=""),zmCache.clearMailObj({listId:zmUtil.getFolId()}),h='{"fId":"'+c+'","view":"'+n+'","flag":"'+j+'","label":"'+i+'","attach":"'+k+'"}',a.setListingDetObj(h),$.isEmptyObject(d)||r();var u={f:1,t:zmail.mailOpt.range,fId:m,view:n,flag:j,label:i,attach:k,callbk:a.mailList,retainPreview:s};p?(zmsuite.getCenter("zm_Container")[0].getNodes()[0].$el.find(".msi-uncheck").removeClass().addClass("msi-uncheck"),u.callbk=function(b,c){a.reInitListing(),a.mailList(b,c)}):zmList.unchkAll(),"zmlSTree"===$("#"+m).parent().attr("id")&&(u.shId=zmList.getRowInfo(m,"zmlSTreeH","info").SHID),$.publish("mail/listing/viewchanged",[]);var v={fId:b.folId||zmail.mailLeft.selId,view:b.view,viewId:b.viewId};zmRestore.saveState("listing",v,{}),zmUrlAct.update(b),a.getMails(u,"n",q,t,b.hashDeffObj)}},checkThreadRead:function(b){var c,d,e=[];if(zmail.listObj[b]){var f=a.getListingDetObj();for(e=zmList.getViewBasedMsgList(b,f),d=e.length,c=0;c<d;c++)if(0===zmail.mailObj[e[c]].S)return!1}return!0},onNetFailure:function(a,b,c,d){var e='<div class="zm_retMsg"><p><i class="msi-mailFail"></i>'+g.common.netFailure+'<br><span class="SC_nmsg"><font>'+g.common.eRetry+"</font></span></p></div>";$(zmail.mailCenter.listElem).html(e)},removeMailPageLoader:function(){$("#ms_load").remove()},mailList:function(c,e){if(!zmail.loadCompleted||e.reqId===d){var f,g,h,i;if(i=a.getListingDetObj(),h=i.fId||i.view||i.label||i.flag,"-1"!==h&&"1"!==h&&"2"!==h&&"3"!==h||(h="flag"),"server"===e.req?(f=a.cacheDataObj(c,h,e.from),g=f.showNextPage,f=f.MO):(f=c,g=e.showNxt,e.to=f.length),void 0===e.sortOrder||0!==zmUtil.getMLConversionValue()&&h!==zmail.folId.sId||h===zmail.folId.teId||(zmail.listObj[h].sortOrder=e.sortOrder,1===e.from&&zmInit.toggleSortingIcons(e.sortOrder)),b=!1,a.startFill=!0,h===zmail.folId.oId?$(zmail.mailCenter.listElem).addClass("SC_obox"):$(zmail.mailCenter.listElem).removeClass("SC_obox"),f.length>0){var j=$(a.constructMailRow(h,f));if("h"===zmail.viewInfo[0].DT&&j.find(".zmDate").hide(),"h"===zmail.viewInfo[0].SZ&&j.find(".zmSze").hide(),$(zmail.mailCenter.listElem).find(".zmL").length){var k=$(zmail.mailCenter.listElem)[0].scrollTop;$(zmail.mailCenter.listElem).append(j),$(zmail.mailCenter.listElem)[0].scrollTop=k;var l=zmsuite.getCenter()[0].getNodes()[0].$el.find(".msi-uncheck");l.hasClass("msi-check")&&l.removeClass().addClass("msi-uncheck msi-partcheck")}else $(zmail.mailCenter.listElem).html(j)}else $(zmail.mailCenter.listElem).html(p());if(zmail.showFeature===!0&&0===$(zmail.mailCenter.listElem).find(".zmScrollTrail").length&&zmComponent.customScrollBar("SC_mclst","class"),a.removeMailPageLoader(),g>=0&&$(zmail.mailCenter.listElem).data("data-ty",g),zmail.loadCompleted&&1===e.from){if(zmail.mailCenter.listElem.scrollTop=0,e.fId&&!zmUtil.isSharedFolder(e.fId)||!e.fId&&"unread"===e.view){var m=parseInt(c[c.length-1].unCnt);v(m)}a.listingBand.SpamTrashBand.setBand()}if($(zmail.mailCenter.listElem).unbind("scroll").bind("scroll",function(){zmTopMenus.hideMenus(),a.fillMails()}),zmail.loadCompleted&&e.retainPreview){var n=zmPrev.prevDetails();n.msgId&&zmail.mailObj[n.msgId]&&zmList.setMailSelection(n.msgId,n.type,$(zmail.mailCenter.listElem))}e.mlDefObj&&e.mlDefObj.resolve()}},cacheDataObj:function(b,c,d){var e,f;return c&&c.length||(f=a.getListingDetObj(),c=f.fId||f.view||f.label||f.flag,"-1"!==c&&"1"!==c&&"2"!==c&&"3"!==c||(c="flag")),e=zmail.folderCache.dolistObj(c,b,!0),c&&(zmail.listObj[c]&&1!==d?(zmail.listObj[c].MO=zmail.listObj[c].MO.concat(e.MO),zmail.listObj[c].showNextPage=e.showNextPage):zmail.listObj[c]=e),e},constructMailRow:function(b,c){var d,e,f,i,j,k=document.createDocumentFragment(),l=[],m=[],n=a.getListingDetObj(),o=zmCenterListing.create({type:"mail",mapObj:a.mapObj,classObj:a.classObj}),p={},q=" ("+h.contentOptions.archived+")",r="zm_Container",s=zmUtil.getMLConversionValue(b);for(b===zmail.folId.sId&&(p={0:"",1:g.mailDeliveryStatus.tooltips.queued,2:g.mailDeliveryStatus.tooltips.inprogress,3:g.mailDeliveryStatus.tooltips.inprogress,4:g.mailDeliveryStatus.tooltips.inprogress,5:g.mailDeliveryStatus.tooltips.success,6:g.mailDeliveryStatus.tooltips.failure,7:g.mailDeliveryStatus.tooltips.failure,8:g.mailDeliveryStatus.tooltips.undo,9:g.mailDeliveryStatus.tooltips.retry,10:g.mailDeliveryStatus.tooltips.retry}),b||zmTab.currentTab.indexOf("zm_srch")===-1||(b=zmSearchUtil.getSearchedFolders()[0]||"",r=zmTab.currentTab),l=a.getMailRowIcons(b),m=c?c:zmail.listObj[b].MO,j=m.length,i=0;i<j;i++){e=m[i],d=$.extend({},zmail.mailObj[e]),zmail.folCount[b]&&"zm_srch1"!==r||(d.FN=a.findFolName(zmail.mailObj[e].FD),zmail.mailObj[e].AR&&n.label&&!n.fId&&(d.FN+=q)),zmail.mailOpt.isshowSummary||(d.SM=""),b===zmail.folId.sId||b===zmail.folId.oId||b===zmail.folId.dId||b===zmail.folId.teId?d.fromaddr=d.TOADDR||d.TO||(d.CC&&"Not Provided"!==d.CC?d.CC:"")||d.BCC||"":d.fromaddr=d.F||d.SN||"",0!==r.indexOf("zm_srch")&&0!==s&&zmail.mailObj[e].TH&&b!==zmail.folId.tId&&b!==zmail.folId.dId&&b!==zmail.folId.sId&&zmail.mailObj[e].TC>0&&(d.M="t"+d.M,d.S=zmail.mailObj[e].TS,d.TS2&&(1===d.TS2?d.S=0===d.S?2:4:2===d.TS2?d.S=0===d.S?3:5:3===d.TS2&&(d.S=0===d.S?7:8)),d.NFG=a.getThdFlagvalue(e),zmail.mailOpt.isshowSummary&&(d.SM=zmail.mailObj[e].TSM),d.SB=a.getThreadSubject(e),d.TAG=zmail.mailObj[e].TTAGS,d.AT=zmail.mailObj[e].TA),b===zmail.folId.sId||b===zmail.folId.oId?(b===zmail.folId.oId&&(d.S="6"),d.F=zmail.mailObj[e].TOADDR||d.TO||(d.CC&&"Not Provided"!==d.CC?d.CC:"")||d.BCC||g.common.undisclosed):(b===zmail.folId.spId&&(d.NFG="-1",d.TAG=[]),0===s?d.F=zmail.mailObj[e].SN||zmail.mailObj[e].F:d.F=zmail.mailObj[e].TSN||zmail.mailObj[e].SN||zmail.mailObj[e].F);try{0===d.TH&&d.F===zmail.aInfo[zmail.accId].mailId&&(d.F="Me")}catch(t){}if(b===zmail.folId.oId?"queue"===d.S3?d.NFG="5":(d.NFG="4",d.OBT="0"):b===zmail.folId.teId?(d.AW=1,d.TC=0,d.NFG="-1",d.S="",d.F=zmail.mailObj[e].TOADDR||g.common.undisclosed):b===zmail.folId.dId?(d.AW=1,d.TC=0,d.NFG="-1",d.S="",d.TAG=[],d.F=zmail.mailObj[e].TOADDR||g.common.undisclosed):b===zmail.folId.tId?d.TC=0:b===zmail.folId.sId?(d.S="",d.TH&&(d.TC=-1)):!d.TH||0!==s&&0!==r.indexOf("zm_srch")||(d.TC=-1,1===d.NS2?d.S=0===d.S?2:4:2===d.NS2?d.S=0===d.S?3:5:3===d.NS2&&void 0===d.RR&&(d.S=0===d.S?7:8)),d.UW=zmList.isRMOBJ(e),d.AWMID=e,d.data="lt",d.ICN=$.extend([],l),(zmail.mailObj[e].MA&&!zmUtil.isSharedFolder(b)||d.UW)&&(d.HT="1"),
zmail.mailObj[e].FD===zmail.folId.sId&&b!==zmail.folId.sId&&(d.MDS=0),zmail.mailObj[e].SCO&&(d.OT=zmail.mailObj[e].SCO.OT,d.SCTX=zmail.mailObj[e].SCO.SCTX),d.hideDraftCount=zmail.mailObj[e].FD===zmail.folId.dId,d.CT=Boolean(zmail.mailObj[e].CT),d.mailDeliveryTip=p[d.MDS]||"",zmail.mailObj[e].SCOBJ&&zmail.mailObj[e].FD!==zmail.folId.spId&&b!==zmail.folId.sId){var u=g.quickactions,v=zmail.mailObj[e].SCOBJ[0]||{};if("REVIEWACTION"===v.SCATYPE)d.schemaTip=_zm.escapeTags(v.DESC||""),d.schemaText=u.review,v.SHOWRB?d.actionIcon=d.actionIconColor="review_comment":d.actionIcon=d.actionIconColor="review";else if("RSVPACTION"===v.SCATYPE){if(v.EXPIRED)d.schemaTip=u.eventexpired,d.schemaText=u.rsvp,d.expired=1;else{d.schemaTip=_zm.escapeTags(v.DESC||"");var w={yes:u.yes,no:u.no,maybe:u.maybe};v.RSVPSTUS?d.schemaText=u.attending+" : "+w[v.RSVPSTUS]:d.schemaText=u.rsvp}d.actionIcon=d.actionIconColor="rsvp"}else"CONFIRMACTION"===v.SCATYPE||"SAVEACTION"===v.SCATYPE?(d.schemaText=_zm.escapeTags(v.DN||""),d.schemaTip=_zm.escapeTags(v.DESC||""),d.actionIcon=d.actionIconColor="one_click",v.ASTATUS&&(d.expired=1)):"VIEWACTION"===v.SCATYPE||"TRACKACTION"===v.SCATYPE?(d.schemaText=_zm.escapeTags(v.DN||""),d.schemaTip=_zm.escapeTags(v.DESC||""),d.actionIcon=d.actionIconColor="goto"):"ORDER"===v.SCATYPE?(v.ORDEROBJ&&v.ORDEROBJ.VIEWORDERURL&&(d.schemaText=u.orderV,d.actionIcon=d.actionIconColor="goto"),d.F=d.SB,d.MUI=0,d.fromaddr="",d.sumTxt=zmMarkup.getSummary({schemaObj:v})):"PARCELDELIVERY"===v.SCATYPE?(v.PARCLDLVRYOBJ&&v.PARCLDLVRYOBJ.TRACKINGURL&&(d.schemaText=u.orderT,d.actionIcon=d.actionIconColor="goto"),d.F=d.SB,d.MUI=0,d.fromaddr="",d.sumTxt=zmMarkup.getSummary({schemaObj:v})):"FLIGHTRESERVATION"===v.SCATYPE&&(v.FLYTTKTOBJ&&v.FLYTTKTOBJ[0].url&&(d.schemaText=zmMarkup.flightReserv.urlType(v.FLYTTKTOBJ[0]),d.schemaTip=_zm.escapeTags(v.DESC||""),d.actionIcon=d.actionIconColor="goto"),d.F=d.SB,d.MUI=1,d.fromaddr="",d.sumTxt=zmMarkup.getSummary({schemaObj:v}))}d.selBoxVisibility=!0,zmUtil.isSharedFolder(b,"R")&&(d.selBoxVisibility=!1),o.setDataObj(d),f=$(o.getHTML()),zmCenterListing.mailObjectAPI.setViewObject(e,{id:e,$element:f,isSelected:!1,isExpanded:!1},r),k.appendChild(f[0])}return k},getFirstRecipientEmailId:function(a){if(!zmail.mailObj[a])return"";var b,c,d,e=zmail.mailObj[a].TOADDR;for(e=zmUtil.replaceHTMLEntities(e),e=e.split(","),d=e.length,b=0;b<d;b++)if(c=e[b],c.indexOf("@")!==-1&&c.indexOf(".")!==-1)return c.indexOf("<")!==-1?c.substring(c.indexOf("<")+1,c.indexOf(">")):c;return""},showProfileImages:function(a,b){var c;c="threadChild"===a?zmCenterListing.mailObjectAPI.getViewObjectStore("zm_Container"):zmCenterListing.mailObjectAPI.getViewObjectStore(a);var d=function(a,b,c){a=a||"",b=b||"";var d,e=zmail.ContactBook.get({eid:a.trim(),promise:!1})[0];d=e?e.avatar():zmail.ContactBook.Templates.avatar({isValidPhoto:!1,photo:void 0,initials:zmail.ContactBook.Utils.initials(a.trim()),avatarBgColor:zmail.ContactBook.Utils.colorClasses()}),c.prepend(d)},e=[zmail.folId.sId,zmail.folId.dId,zmail.folId.teId,zmail.folId.oId];b.forEach(function(b){var f,g=b;if("threadChild"===a&&(g="c"+b),zmail.mailObj[b]&&c[g]){var h=[],i=[],j=0,k="";for(zmail.mailObj[b].TSNADDR&&"threadChild"!==a&&a!==zmSearchUtil.getSearchTabId()?e.indexOf(zmUtil.getFolId())!==-1?(k=zmInit.getFirstRecipientEmailId(b)||zmail.mailObj[b].F,h.push(k),i=h):(h=zmail.mailObj[b].TSNADDR.split("... "),i=zmUtil.replaceHTMLEntities(zmail.mailObj[b].TSN).split("... "),h[0]===h[1]&&(h.pop(),i.pop())):"zm_Container"===a&&e.indexOf(zmUtil.getFolId())!==-1||a===zmSearchUtil.getSearchTabId()&&e.indexOf(zmSearchUtil.getSearchedFolders()[0])!==-1?(k=zmInit.getFirstRecipientEmailId(b)||zmail.mailObj[b].F,h.push(k),i=h):(h.push(zmail.mailObj[b].F),i.push(zmUtil.replaceHTMLEntities(zmail.mailObj[b].SN))),f=c[g].$element.find(".zm_prof_img"),j=0;j<h.length;j++)0===j&&f.empty(),d(h[j],i[j],f)}})},updateMailDeliveryStatus:function(a){var b=a.M;a.MDS=parseInt(a.MDS);var c=zmail.mailObj[b],d=a.ignorePopupUpdate||!1,e="",f=a.MDS;if(6===f||7===f){var h=zmail.mailLeft.getNodes()[0].getLayer("zmlTreeH");h.updateCount(zmail.folId.sId,"inc"),zmUtil.updSendErrorStatus(!0,zmail.folId.sId)}if(c&&f!==c.MDS){if(e=c.MDS,f>1&&f<5&&e>1&&e<5||f<5&&e>4)return;if(zmCache.updateObj({mode:"upd",msgId:b,key:"MDS",val:f}),zmUtil.getFolId()===zmail.folId.sId){var i,j=zmCenterListing.mailObjectAPI.getViewObject(b,"zm_Container"),k={0:"",1:g.mailDeliveryStatus.statusTitle.queued,2:g.mailDeliveryStatus.statusTitle.inprogress,3:g.mailDeliveryStatus.statusTitle.inprogress,4:g.mailDeliveryStatus.statusTitle.inprogress,5:g.mailDeliveryStatus.statusTitle.success,6:g.mailDeliveryStatus.statusTitle.failure,7:g.mailDeliveryStatus.statusTitle.failure,8:g.mailDeliveryStatus.statusTitle.undo,9:g.mailDeliveryStatus.statusTitle.retry,10:g.mailDeliveryStatus.statusTitle.retry},l=function(a,b){var c="",d=a.find(".zmSndSts-anipro"),f=a.find(".zmSndStsCon");!d.length&&b>1&&b<5&&(c='<span class="zmSndSts-anipro"><span class="zmSndSts-Inpro zm_delspinner"></span><span class="zmSndSts-Inpro zm_delfiller"></span><span class="zm_delmask"></span></span>'),a.length?(!d.length||b>1&&b<5?f.prepend($(c)):d.remove(),f.attr("class","zmSndStsCon "+zmInit.classObj.mdsParentClass[b]),10===e&&2===b&&f.addClass("zmSndSts-fpro"),a.find("i").removeClass().addClass(zmInit.classObj.deliverySts[b]),a.attr("title",k[b])):(a='<div class="zmSndSts" title="'+k[b]+'"><div class="zmSndStsCon '+zmInit.classObj.mdsParentClass[b]+'" >'+c+'<span class="zmSndStsIco"><i class="'+zmInit.classObj.deliverySts[b]+'"></i></span></div></div>',$(a).insertBefore(j.find(".zmFrm")))};j&&(j=$(j.$element),j.length&&(i=j.find(".zmSndSts"),1!==f?l(i,2):l(i,f),f>4&&(i.length||(i=j.find(".zmSndSts")),setTimeout(function(){l(i,f)},1500))))}!d&&$("#mail_delivery_status").length&&$("#mail_delivery_status").attr("data-msg")===b&&zmList.getMailDeliveryStatus(b)}},constructListHolder:function(){$(".SCl").last().after("<div id='zm_centerHolder' class='SCm_parent'></div>")},getCurrentLeftId:function(){return zmail.mailLeft.selId},checkLoadMoreMails:function(){var a=0;return function(){var b=$(zmail.mailCenter.listElem),c=b[0].scrollTop,d=b[0].scrollHeight-b[0].offsetHeight,e=!1;return a>c?e=!1:c>=.8*Math.floor(d)&&(e=!0),a=c,e}}(),fillMails:_.debounce(function(c){var d,e,f,g,h,i,j="all",k="",l="",m="",n=!1,o="";if(a.checkLoadMoreMails()){if("2"===zmail.listDetails.attach)return void zmail.listObj.attachVw.attachUtil.getAttachemntOnScroll();n=!0,zmUtil.debugLog("Mail Listing","Scroll bottom reached. Have to fill new content")}if(c?(h=c<zmail.mailOpt.range?c:zmail.mailOpt.range,n=!0,a.startFill=!0):h=zmail.mailOpt.range,b&&(n=!1),n&&a.startFill===!0)if(g=$(zmail.mailCenter.listElem).data("data-ty"),g>0){i=a.getCurrentLeftId(),i.indexOf("zm_")!==-1&&(i=i.substring(3,i.length)),f=a.getListingDetObj(),o=f.fId,k=f.label,j=f.view,l=f.flag,m=f.attach,"unread"!==o&&"all"!==o&&"flag"!==o||(j=o,"flag"===o&&(j=""),o="");var p=zmPrev.prevDetails("zm_Container");if("unread"===j&&p.msgId){var q=p.msgId;e=zmail.mailObj[q]&&(0===zmail.mailObj[q].TH||zmail.mailObj[q].TH&&zmInit.checkThreadRead(zmail.mailObj[q].T))?zmail.listObj[i].MO.length:zmail.listObj[i].MO.length+1}else e=zmail.listObj[i].MO.length+1;d={f:e,t:h,fId:o,view:j,flag:l,label:k,attach:m,sendReq:!0},zmUtil.isSharedFolder(o)&&(d.shId=zmUtil.getShareId(o)),$(zmail.mailCenter.listElem).unbind("scroll").bind("scroll",function(){a.fillMails()}),b=!0,a.getMails(d,"n","",zmail.listObj[i].sortOrder)}else zmList.setEmptyListing()},500),constructListOuter:function(a){var b,c;b=["DIV",{attrs:{"class":"SCm SC_show",id:a.tId||""},child:[["DIV",{attrs:{"class":"SCmb SCmenu",id:a.actId||""}}],["DIV",{attrs:{"class":"SCmc",id:a.mId||""}}]]}],c=_zm.getDOM(b),$("#zm_centerHolder").append(c)},getUnreadViewCount:function(){var a=[zmail.folId.sId,zmail.folId.spId,zmail.folId.oId,zmail.folId.tId];a=a.concat(zmfolAction.getChildrenOf(zmail.folId.tId));var b=$.extend({},zmail.folCount),c=a.length;if(a)for(var d=0;d<c;d++)delete b[a[d]];var e=0;for(var f in b)e+=parseInt(b[f].c);return e},updateCountTitle:function(){zmWinTitle.updateTitle()},zmsubStr:function(a,b){return a.indexOf(b)!==-1&&(a=a.substring(b.length,a.length)),a},bindLeftActions:function(b){var c,d,e,f,g,h,i,j,k="",l="",m="";"clbk"in b&&(j=b.clbk),b=b.zmsData,e=b.type,f=b.eventInfo,d=f.srcElement||f.target,g=b.rowInfo.layerId,c=b.rowInfo.type,i=b.prevSelectLayer;for(var n in b.rowObject){k=b.rowObject.id||n;break}if("contextmenu"===e)zmList.FLUtility(f,d,g,c);else if("click"===e){if("zmlSSrchTreeH"===g)return void("header"===c&&"zmlSSrchTreeH"===k||zmSearch.processSavedSearch({id:k,mode:"get"}));if("zmStreamTree"===g&&g!==k){var o,p=zmail.mailLeft.getNodes()[0].getLayer("zmStreamTree");if("disabledGrp"===k)zmAppLoader.load("streamsGroupManagement").done(function(){zmStreamsApp.GroupManageApp.init({groupManage:!0,view:"disabled"})});else if("createGrp"===k)zmAppLoader.load("streamsGroupManagement").done(function(){zmStreamsApp.GroupManageApp.init({app:"streams",isOnboard:!0,createCallback:function(a){zmsuite.loadStreams(a)}})});else if("more"===k||"less"===k){var q=k,s="less"===k?"more":"less",u=p.listObject,v="more"===k?"showNode":"hideNode",w=p.el.children("#zmsTree").children();_.each(w,function(a,b){o=a.id,(u[o].hideNode&&"more"===k||"less"===k&&b>5&&"more"!==o&&"less"!==o)&&p[v](o,j)}),p.hideNode(q,j),p.showNode(s,j),"more"===s&&($("#"+zmail.zuid)[0].scrollIntoView(),j&&"function"==typeof j&&j())}else{if(h=zmail.mailLeft.getNodes()[0].getLayer(g),$(d).find(".SC_ct.SC_new").removeClass("SC_new"),zmStreamsApp&&zmStreamsApp.GroupApp&&zmStreamsApp.GroupApp.GroupId&&zmStreamsApp.GroupApp.GroupId===k&&zmsuite.isWorkspaceAvailable("zmStreamsApp"))return zmsuite.showWorkSpace("zmStreamsApp"),void zmStreamsApp.util.removeCommentClass(k,h);zmSearch.updateSearchValues("zmStreamsApp"),zmUtil.requireStreamsApp().done(function(){zmail.ContactBook.fetchProcess.done(function(){zmStreamsApp.init(k,!0)})}),zmStreamsApp.util.removeCommentClass(k,h)}}else{if(zmshCut.currentLeftId=k,"header"!==c&&zmsuite.showExistingApp("zm_Container"),"zmStreamTree"===i&&g!==i&&!b.rowObject.id){zmStreamsApp.PostApp.unsubscribeEvents(),zmail.mailCenter=zmsuite.getCenter("zm_Container"),a.constructCenter(),zmail.mailCenter.listElem=zmail.mailCenter[0].getNodes()[2].$el[0],zmail.mailCenter.listObj=zmail.mailCenter[0].getNodes()[2],zmail.mailCenter.prevElem=zmail.mailCenter[1].$el[0],zmail.mailCenter.prevObj=zmail.mailCenter[1],zmail.mailCenter.prevObj.getNodes()[0].setListener("click",function(a,b){zmList.bindAction(a,b)}),zmail.mailCenter[0].$el.removeClass("zms_streams SC_streams"),r(),a.setListingDetObj({}),zmSearch.updateSearchValues("m");var x=zmTab.getTabObject("zm_Container");x.searchPlaceHolder=zmText.get("search","searchInApp",{appname:"Mail"}),x.appIcon="msi-mail",zmTab.updateTabLst(x)}"zmlTreeH"===g&&"zmlTreeH"!==k&&(h=zmsuite.getLeft().getNodes()[0].getLayer(g),h.removeHighlightFromParent(k,!0)),k!==g&&("zmllabelH"===g?(l="label",m=k):"zmlviewH"===g&&(l=k.substring(3)),k===zmail.folId.sId&&zmUtil.updSendErrorStatus(!1,zmail.folId.sId),a.foldView({folId:k,view:l,viewId:m})),t(),(zmUtil.isSharedFolder(k)||zmUtil.isFolderId(k)&&"-1"!==zmList.getRowInfo(k,"zmlTreeH","info").SH)&&"undefined"==typeof zmStream&&zmUtil.requireStreamsApp(1).done(function(){})}}a.isLeftFocused=!0},bindActionHeaderIcons:function(b,c,d){var e,f,g,h=d||b.srcElement||b.target;switch(c&&c.indexOf("msi-")===-1&&$(h).prev().hasClass("msi-send")&&(c="msi-send"),c){case"msi-uncheck msi-check":case"msi-uncheck msi-partcheck":zmList.unchkAll();break;case"msi-uncheck":$(h).hasClass("msi-uncheck")||(h=$(h).find(".msi-uncheck")),zmList.chkAll(h);break;case"msi-action":case"msi-customize":case"msi-filter":case"msi-barrow":e=$(h).closest("li"),f="pleft",e.find(".msi-action").length?(g=zmDrop.getActionDrop(),zmTab.currentTab.indexOf("zm_tab")!==-1&&(f="pright")):e.find(".msi-uncheck").length?g=zmDrop.getSelectDrop():e.find(".msi-filter").length&&(g=zmDrop.getViewDrop()),g&&(zmUtil.hideMenu(),e.find("b").addClass("SC_ddn"),zmsuite.showMenu({par:e,list:g,align:f,clk:function(a,b){zmList.bindAction(a,b)}}));break;case"msi-sortdatedn":zmList.changeLisingSortOrder(!1);break;case"msi-sortdateup":zmList.changeLisingSortOrder(!0);break;case"msi-folder":zmUtil.hideMenu(),e=$(h).closest("li"),w(e);break;case"msi-label":zmUtil.hideMenu(),e=$(h).closest("li"),x(e);break;case"msi-spam":zmList.bindAction({action:"spam"});break;case"msi-notspam":zmList.bindAction({action:"notspam"});break;case"msi-trash":zmList.bindAction({action:"delete"});break;case"msi-reply":zmList.bindAction({action:"reply"});break;case"msi-replyall":zmList.bindAction({action:"replyall"});break;case"forward":zmList.bindAction({action:"forward"}),zmUtil.hideMenu();break;case"msi-send":zmList.sendOutbox();break;case"msi-archive":zmList.bindAction({action:"archive"}),zmUtil.hideMenu();break;case"msi-unarchive":zmList.bindAction({action:"unarchive"}),zmUtil.hideMenu();break;case"msi-classic":case"msi-compact":e=$(h).closest("li"),f="pright",g=zmDrop.getCustomizeViewDrop(),g&&(zmUtil.hideMenu(),e.find("b").addClass("SC_ddn"),zmsuite.showMenu({par:e,list:g,align:f,clk:function(a,b){zmList.bindAction(a,b)}}));break;case"msi-thread":zmList.changeListingView(0);break;case"msi-conversation":zmList.changeListingView(2);break;case"msi-listview":zmList.toggleAVView(h,"list");break;case"msi-thumbview":zmList.toggleAVView(h,"thumb");break;case"msi-chat":zmUtil.createContexualChat(h);break;case"msi-attsearch":e=$(h).closest("li"),f="pleft",g=zmDrop.getAttachOptions(),g&&(zmUtil.hideMenu(),e.find("b").addClass("SC_ddn"),zmsuite.showMenu({par:e,list:g,align:f,clk:function(a,b){zmList.bindAction(a,b)}}));break;case"msi-plus":zmComponent.createTemplate()}a.isLeftFocused=!1},getFolderTreeCount:function(){var b={accId:zmail.accId,mode:"foldertree"};zmAjq.XHR({u:zmail.conPath+"/folAction.do",t:"POST",fn:a.updFolTreeCount,p:b})},updFolTreeCount:function(b){var c,d,e,f="zmlTreeH",g={},h="0",i=!1;zmail.folCount&&(h=zmail.folCount[zmail.folId.sId].c||"0",$("#"+zmail.folId.sId).hasClass("SC_redtxt")&&(i=!0));var j=b&&b.foltree;if(j){g=zmail.mailLeft.getNodes()[0].getLayer(f),j[zmail.folId.sId].c=h,j[zmail.folId.dId].c="0";for(var k in j)c=k,e=zmail.folCount[c].c,j[c]!==e&&g.updateCount(c,"upd",j[c].c,!1);zmail.outboxFail&&zmUtil.updSendErrorStatus(!0,zmail.folId.oId),"0"!==h&&i&&zmUtil.updSendErrorStatus(!0,zmail.folId.sId),d=a.getUnreadViewCount(),f="zmlviewH",g=zmail.mailLeft.getNodes()[0].getLayer(f),g.updateCount("zm_unread","upd",d),zmUtil.updateCountForAcc(zmail.accId,"upd",d),zmWinTitle.updateTitle(),"zm_unread"===zmail.mailLeft.selId&&zmail.mailLeft.selRow(zmail.mailLeft.selId,"zmlviewH"),t()}},getAccountInfo:function(){var b={mode:"getAccInfo"};zmAjq.XHR({u:zmail.conPath+"/mailUtilAction.do",t:"POST",fn:a.updateAccountUnreadCount,p:b})},updateAccountUnreadCount:function(a){if(a instanceof Object){var b=a.aInfo;for(var c in b)zmUtil.updateCountForAcc(b[c].accId,"upd",b[c].c)}},getMailRowIcons:function(a){var b=["msi-trash"];return a&&zmUtil.isSharedFolder(a)&&(b=[]),b},emptyRow:p,reInitListing:r,cSize:u,updateHeaderBand:t,listingBand:m,getThreadSubject:function(a){var b=zmail.mailObj[a].SB||"",c=b.trim();return 0!==c.indexOf("Re:")&&0!==c.indexOf("Fwd:")||(b=zmail.mailObj[a].TSB||b),b},isLeftFocused:!1,setDisplayDensity:function(b){var c=b||zmAdHocSettings.getListingDisplayDensity();a.customizeDisplayDensity(c)},customizeDisplayDensity:function(a){var b,c,d,e=["zm_Container","zm_srch1"],f=e.length;for(b=0;b<f;b++)zmsuite.isWorkspaceAvailable(e[b])&&(B(e[b],a),d="","zm_Container"===e[b]&&"zmStreamTree"!==zmail.mailLeft.selLayerId&&(d="m"),"zm_srch1"===e[b]&&(d=zmSearch.forceSearch?zmSearch.forceSearch:zmSearchUtil.getSearchAppType()),"m"===d&&(c=zmsuite.getCenter(e[b])[0].getNodes()[2].$el||[],"1"===a?(c.addClass("SC_cmpct"),zmAdHocSettings.setListingDisplayDensity(a)):"0"===a&&(c.removeClass("SC_cmpct"),zmAdHocSettings.setListingDisplayDensity(a))))},translateSystemFolders:function(){var a,b=zmail.folId,c=zmail.folTree[0];for(var d in b)a=b[d],c[a].FN=f.systemFolder[c[a].FN]},toggleSortingIcons:function(a){var b=zmsuite.getCenter("zm_Container")[0].getNodes()[0].$el;a?(b.find(".msi-sortdatedn").closest("li").show(),b.find(".msi-sortdateup").closest("li").hide()):(b.find(".msi-sortdateup").closest("li").show(),b.find(".msi-sortdatedn").closest("li").hide())}})}(),window.zmList=function(){"use strict";var a,b,c=zmCenterListing.mailObjectAPI,d=zmText.get("mail"),e=d.leftTree,f=d.listing,g=d.preview,h=d.actions,i=["zmLTMenu_Nf","zmLTMenu_lne1","zmLTMenu_Fr","zmLTMenu_lne2","zmLTMenu_Sf","zmLTMenu_lne3","zmLTMenu_Rf","zmLTMenu_Df","zmLTMenu_lne4","zmLTMenu_Af","zmLTMenu_Ef"],j=0,k=function(a){return b="pvreq_"+Date.now(),a.cpvreq=b,b},l=function(a,b){var c,d=$(b.listElem).scrollTop(),e=a.height();c=d-e,$(b.listElem).scrollTop(c)},m=function(a){var b;b=a.mainElem.find(".zmTV:visible"),l(b,a),b.prev().removeClass("zmTLst"),b.prev().find("i.msi-tarrow").addClass("msi-barrow"),b.hide()},n=function(a){var b,c="";b=a.mainElem.find(".zmTV:visible"),b.children("div.zmSLst").length?(c=b.prev().attr("id"),c.indexOf("t")||(c=c.substring(1)),zmList.setMailSelection(c,"lt",$(a.listElem))):b.prev().hasClass("zmSLst")&&(c=zmUtil.getSelectedMails()[0][0],c&&zmList.setMailSelection(c,"th",$(a.listElem)))},o=function(a){a.rowElem.addClass("zmTLst"),a.rowElem.hasClass("SC_check")&&a.rowElem.next().children("div").addClass("SC_check")},p=function(a,b,d){var e,f=document.createDocumentFragment(),g=b.mId,h=a.MO,i=!0;if(e=d.rowElem.next(),e.hasClass("zmTV"))d.rowElem.hasClass("zmTLst")?(e.slideUp(400,function(){return function(){d.rowElem.removeClass("zmTLst")}}(d)),i=!1):(m(d),e.slideDown(400),o(d));else{m(d);for(var j=$('<div class="zmTV" id="thd'+g+'">'),k=c.getViewObject(g)||c.getViewParentOf(h[0]),l=k&&k.isSelected,p=0;p<h.length;p++)f.appendChild(zmList.constructThreadChildRow(h[p],l)[0]);j.append(f),$(j).insertAfter(d.rowElem).hide().slideDown(400),o(d)}var q;q=i?{mId:b.mId}:{mId:""},zmRestore.saveState("expandThd",q,{mId:b.mId}),n(d),b.eTDefObj&&b.eTDefObj.resolve()},q=function(a,b,c){var d,e,f="",g=b.mId,h=a.MO,i=h.length,j="",k={},l=!1;"zm_Container"===zmTab.currentTab?k=zmInit.getListingDetObj():zmTab.currentTab.indexOf("zm_tab")!==-1?k=zmsuite.getCenterOuter().$el.data("data-detail"):zmTab.currentTab.indexOf("zm_srch")!==-1&&(k=zmSearchUtil.getSearchViewDetails()),0===b.opentype?j="search"===k.view?"S":"P":2===b.opentype?j="T":3===b.opentype&&(j="N"),b.streamsMail||0===zmUtil.getMLConversionValue()&&(0!==zmUtil.getMLConversionValue()||"conversation"!==b.src)||(l=!0);for(var m=0;m<i;m++){var n=zmail.mailObj[h[m]];if(e=j+n.M,n.SM=n.SM||"",n.M&&n.M!==g){if(n.FD===zmail.folId.spId&&k.fId!==zmail.folId.spId||n.FD===zmail.folId.tId&&k.fId!==zmail.folId.tId)continue;f+=n.FD!==k.fId&&zmail.folCount[k.fId]&&3!==b.opentype?'<div class="SC_pct SC_Tfdr">':'<div class="SC_pct">',f+=zmPrev.getHeader({msgId:n.M,thd:!0,opentype:b.opentype,frm:n.F,sender:n.SN,hasAtt:n.AT,sm:n.SM,label:n.TAG,flag:n.NFG,date:n.DT,elemId:e,hdrId:c.hdrId,elemObj:c,showIndex:l}),f+="</div>"}}0===b.opentype?(d=c.contElem,d.append(f),$(c.prevElem).addClass("tmail"),$(c.listElem).parent().addClass("SC_sw")):2===b.opentype?(d=c.contElem,d.append(f),zmsuite.getCenter()[1].$el.addClass("tmail")):3===b.opentype&&(d=c.contElem,_zm.addClass(d.parentElement,"tmail"),$(d).append(f))},r=function(a,b){var c,d=b.mId,e=[],f=[],g=0,h=zmail.mailObj[d].T;a.tdata&&(a=a.tdata),c=b.elemObj;var i=c.viewDetails||zmInit.getListingDetObj();if(!h||zmail.listObj[h]&&!zmUtil.isInlineCompose()||!a.length&&!a.tdata||(zmail.listObj[h]=zmCache.dolistObj(h,a),zmUtil.isInlineCompose()&&zmUtil.mapDraftId(h)),"search"===i.view?f=e=zmail.listObj[h]?zmail.listObj[h].MO:[]:(f=zmList.getViewBasedMsgList(h,i,!1),e=zmail.listObj[h]?zmail.listObj[h].MO:[]),"tIcon"===b.from){if(f.length>1)p({MO:f},b,c);else if("unread"===i.view){var j=$.extend({},i);j.view="all",f=zmList.getViewBasedMsgList(h,j,!1),p({MO:f},b,c)}}else if("showMail"===b.from){q({MO:e},b,c),"0"===b.opentype&&zmsuite.getCenter()[1].$el.find(".SC_pct").removeClass("SC_Tfcs");for(var k=0;k<e.length;k++)if(b.mId===e[k]){g=k;break}g>0&&($(c.prevElem).find("#zmHdrP"+d).parent().insertAfter($(c.prevElem).find("#zmHdrP"+e[g-1]).parent()),$(c.prevElem).find("#zmHdrT"+d).parent().insertAfter($(c.prevElem).find("#zmHdrT"+e[g-1]).parent()),$(c.prevElem).find("#zmHdrS"+d).parent().insertAfter($(c.prevElem).find("#zmHdrS"+e[g-1]).parent()),$("#zmHdrN"+d).parent().insertAfter($("#zmHdrN"+e[g-1]).parent()))}},s=function(a,b,c){var d;if(d=b.attr("id")||b.attr("data-detail"),"add"===a){var e=zmail.mailObj[d]?zmail.mailObj[d].PA:"";c.find(".zmL").each(function(){var a=$(this),b=this.id||$(this).attr("data-detail");a.removeClass("zm_tst zm_ted zm_trd zm_tsel"),b===d&&a.addClass("zm_trd"),b===e&&(a.addClass("zm_trd"),e=void 0===zmail.mailObj[e].PA?"":zmail.mailObj[e].PA)})}else"remove"===a&&c.find(".zmL").removeClass("zm_tst zm_ted zm_trd zm_tsel")},t=function(a){var b,c,d,e,g,h,i=[],j=zmSearchUtil.isNewSearch();if(b=zmInit.rclkId,b=zmInit.zmsubStr(b,"t"),"zm_srch1"===zmTab.currentTab)i=zmSearchUtil.getSearchedFolders().slice();else{var k=zmInit.getListingDetObj();h=k.fId,h&&i.push(h)}if("sender"===a)c=zmail.mailObj[b].F||zmail.mailObj[b].SN,c&&(j?(g=g||[],g.push({className:"Sender",value:c}),i.length&&zmUtil.isSharedFolder(i[0])&&g.push({className:"ShareFolFilter",value:zmfolAction.getSharedFolPath(i[0])})):g={searchQueryArr:[{lhs:"Sender",contains:!0,value:c}],folderArr:i});else if("recipient"===a)try{var l=zmail.mailObj[b].TO||zmail.mailObj[b].TOADDR||(zmail.mailObj[b].CC&&"Not Provided"!==zmail.mailObj[b].CC?zmail.mailObj[b].CC:"")||zmail.mailObj[b].CCADDR||void 0;d=l?zmConUtil.splitncheck(l,"object"):[],d=d.length?d[0].eid:void 0,d&&(j?(g=g||[],g.push({className:"toorcc",value:d}),i.length&&zmUtil.isSharedFolder(i[0])&&g.push({className:"ShareFolFilter",value:zmfolAction.getSharedFolPath(i[0])})):g={searchQueryArr:[{lhs:"To/Cc",contains:!0,value:d}],folderArr:i})}catch(m){}else"subject"===a&&(e=zmInit.rclkId.indexOf("t")!==-1?zmInit.getThreadSubject(b):zmail.mailObj[b].SB,e&&(e=zmUtil.replaceHtmlInSubject(e),e='"'+e+'"',j?(g=g||[],g.push({className:"subject",value:e}),i.length&&zmUtil.isSharedFolder(i[0])&&g.push({className:"ShareFolFilter",value:zmfolAction.getSharedFolPath(i[0])})):g={searchQueryArr:[{lhs:"Subject",contains:!0,value:e}],folderArr:i}));g?j?(zmail.Search.setContext(zmail.Search.Models.Contexts.mailSearchContext),zmail.Search.newSearch(g)):(zmSearch.setPrevAppSearch("m"),zmSearch.addSearch(g)):_zm.succErrMsg("e",f.common.errorsearch),zmUtil.hideMenu()},u=function(a,b,c){zmail.mailObj[a]||(zmail.mailObj[a]={M:a,FD:c||"",T:"",TAG:"",NFG:"",SM:"",SB:"",TH:0}),b&&(zmail.mailObj[a].TH=1,zmail.mailObj[a].T=b)},v=function(a,b,c){u(a,c);var d=zmail.mailObj[a];d.F=d.F||b.FROM,d.TO=d.TO||b.TO,d.SN=d.SN||b.SENDER,d.R=d.R||b.RDT,d.SB=d.SB||b.SUBJECT,d.AT=d.AT||(b.NEWATT?1:0),d.MA=d.MA||b.MA},w=function(a,b,c){var d,e=b.msgId,f=b.type,h=b.prevId||e,i=zmail.mailObj[e],j=b.tabId||zmTab.currentTab,k="",l=zmPreviewTemplate.getSubjectToPreview(i.SB);$(c.prevElem).removeClass("tmail smail"),c.rowElem&&zmList.doThreadPath(c.rowElem,"remove"),d=zmsuite.getCenter(j)[1].getNodes(),k=!i.TH||(0!==zmUtil.getMLConversionValue()&&zmail.mailLeft.selId!==zmail.folId.sId||"zm_Container"!==zmTab.currentTab)&&"zm_srch1"!==zmTab.currentTab?["DIV",{attrs:{"class":"SC_phd"},child:[["text",l]]}]:["DIV",{attrs:{"class":"SC_phd"},child:[["text",l],["I",{attrs:{"class":"msi-thread","data-event":"viewfullthd","data-from":"header",title:g.contextmenu.viewthd}}]]}];var m=_zm.copyOf(zmInit.prevHeader);i.streams&&(m.rIcons=_zm.copyOf(zmInit.prevHeader.rIcons),b.showIcons?m.rIcons.splice(2,m.rIcons.length-3):m.rIcons.splice(0,m.rIcons.length-1),b.titleTxt&&(k=["DIV",{child:[["SPAN",{attrs:{"class":"SC_StrmMT"},child:[["text",b.titleTxt]]}],["DIV",{attrs:{"class":"SC_phd"},child:[["text",l]]}]]}])),zmInit.prevHeader.text=k,m.text=k,d[0].push(m),zmPrev.setMailDOMContent(a.mdata,b),"lt"===f&&zmsuite.getCenter(j)[1].contentObj.$el.find(".SC_pct").removeClass("SC_Tfcs"),c.contElem=zmsuite.getCenter(j)[1].contentObj.$el,c.hdrElem=zmsuite.getCenter(j)[1].getNodes()[0].$el,$(c.prevElem).attr({"data-mid":h,"data-ty":b.type}),zmsuite.getCenter(j)[1].show(),i.TH&&c.viewDetails.fId!==zmail.folId.tId&&(0!==zmUtil.getMLConversionValue()&&"search"!==c.viewDetails.view&&c.viewDetails.fId!==zmail.folId.sId||i.streams||"conversation"===b.src)?(r("",{mId:e,from:"showMail",opentype:b.opentype,elemObj:c}),$(c.prevElem).addClass("tmail"),"th"===f&&c.viewDetails.fId!==zmail.folId.spId&&c.viewDetails.fId!==zmail.folId.tId&&zmList.doThreadPath(c.rowElem,"add")):($(c.prevElem).addClass("smail"),c.mainElem.addClass("SC_sw")),zmPreviewTemplate.setPreviewHeaderHeight(c),$(c.prevElem).hasClass("tmail")?c.contElem.css({bottom:"0px"}):c.contElem.css({bottom:$(c.prevElem).find(".zmQRB").height()+"px"}),zmUtil.setScrollShadow(c.contElem),"conversation"===b.src?($(c.mainElem).find("i.msi-prev,i.msi-next").closest("b").addClass("SC_opy3"),zmTopMenus.util.show({type:"functional",view:zmail.listDetails,tabId:b.tabId})):b.streamsShowMail||(zmTopMenus.util.show({type:"functional",msgId:e,view:zmail.listDetails,tabId:b.tabId}),zmList.unchkAll(c),zmPrev.PvNt(b.rowId,b.type,b.opentype,zmTab.currentTab,c))},x=function(a,b,c){zmPrev.setMailDOMContent(a.mdata,b);var d=zmail.mailObj[b.msgId],e=a.tdata&&a.tdata.length?"t"+d.T:d.M,f=c.contElem[0].parentElement,g=d.TH?d.T:"";_zm.setAttr(f,{msgId:e,groupId:b.shOwner||b.groupId,thId:g,pid:d.M,actionType:b.streamAction}),a.tdata&&a.tdata.length&&r(a.tdata,{mId:b.msgId,from:"showMail",opentype:3,elemObj:c})},y=function(a,b,c){var d,e=zmail.mailObj[a]&&zmail.mailObj[a].T||void 0,f="zm_tab"+a;if(zmsuite.isWorkspaceAvailable(f)&&zmTopMenus.util.show({type:"functional",msgId:a,tabId:f,elem:zmsuite.getCenter(f)[1].getNodes()[0]}),f="zm_tabt"+e,e&&zmsuite.isWorkspaceAvailable(f)&&(d=zmUtil.getSelectedMails(f)[0][0],a===d&&zmTopMenus.util.show({type:"functional",msgId:a,tabId:f,elem:zmsuite.getCenter(f)[1].getNodes()[0]})),zmPrev.prevDetails()&&!zmList.getSelectedRowCount()){var g=zmUtil.getSelectedMails("zm_Container");d=g[0][0]||g[1][0],d===a&&zmTopMenus.util.show({type:"functional",msgId:a,tabId:"zm_Container"})}},z=function(a,b,c){var d,e,f=b.msgId,i=f,j=zmPreviewTemplate.getSubjectToPreview(zmail.mailObj[f].SB),k="",l=zmail.mailObj[f],m={},n=b.msgId;l.TH&&(0!==zmUtil.getMLConversionValue()&&c.viewDetails&&"search"!==c.viewDetails.view&&c.viewDetails.fId!==zmail.folId.sId||l.streams||"conversation"===b.src||"restore"===b.src&&"conversation"===b.toOpen)&&(e=l.T,i=e,f="t"+e,n=e),d="zm_tab"+f;var o=function(a,b){var c=b.id.split("#")[1];c===n&&zmsuite.isWorkspaceAvailable(d)&&zmsuite.closeWorkspace(d)};if($.subscribe("zmstreamsapp/deletePost",o),zmsuite.isWorkspaceAvailable(d)&&"restore"!==b.src&&!b.streamsMail)return void zmsuite.showWorkSpace(d);b.tabId=d,b.from&&zmsuite.isWorkspaceAvailable("zm_tab"+b.from)&&"restore"!==b.src&&zmsuite.closeWorkspace("zm_tab"+b.from);var p=b.actionType;b.streamsMail&&(p=zmCont.isGroup(b.groupId)?"viewGroupEntity":"viewSelfData");var q=function(){var a=zmsuite.createAppRouter();return b.streamsMail?(a._hashKey="stream",a.initialize({hashKey:"stream",handler:function(){return{updateParams:!1,handled:!1,daultAction:!1}}}),a.setParams(["tab",b.groupId,i,b.entityType,p])):(a._hashKey="mail",a.initialize({hashKey:"mail",handler:function(){return{updateParams:!1,handled:!1,daultAction:!1}}}),a.setParams(["tab",f])),a},s=q(),t=function(){var b={appname:j,title:a.mdata.SENDER,appId:d,faqKey:"Conversations",data:{CNodes:"2"},router:s,appIcon:"msi-mailopen",shortcuts:zmshCut.mail,titleProvider:function(){return zmUtil.decodeHTMLEntities(j)}};return b},u=t(),v={appId:d,msgId:b.msgId,opentype:2,type:b.type};u.onDelete=function(){var a=zmsuite.getCenter(d)[1].$el;return zmPreviewTemplate.unsubscribeNotesTasks(a),!0},("restore"===b.src||b.streamsMail)&&zmsuite.isWorkspaceAvailable(d)?zmsuite.resetWorkspace(d,u):zmsuite.setWorkSpace(u),c=c||zmList.getListingElemObj(b);var w=zmsuite.getCenter(),x=w[0].getNodes(),y=w[1].getNodes();x[1].$el.remove(),zmsuite.renderCenter(),k=l.TH&&(0===zmUtil.getMLConversionValue()||c.viewDetails&&c.viewDetails.folId===zmail.folId.sId||c.viewDetails&&"search"===c.viewDetails.view)?["DIV",{attrs:{"class":"SC_phd"},child:[["text",j],["I",{attrs:{"class":"msi-thread","data-event":"msi-thread","data-action":"viewfullthd","data-from":"header",title:g.contextmenu.viewthd}}]]}]:b.titleTxt?["DIV",{child:[["SPAN",{attrs:{"class":"SC_StrmMT"},child:[["text",b.titleTxt]]}],["DIV",{attrs:{"class":"SC_phd"},child:[["text",j]]}]]}]:["DIV",{attrs:{"class":"SC_phd"},child:[["text",j]]}];var z=zmTopMenus.util.get("functional");if(!zmail.isPopupMail&&zmail.isOrg&&zmUtil.isChatletEnabled()&&z.unshift({groupId:"chat",actionArr:[{html:[["I",{attrs:{"class":"msi-cliqColor"},child:[["I",{attrs:{"class":"path1"}}],["I",{attrs:{"class":"path2"}}]]}]],tooltip:zmText.applyArgs(zmText.get("mailsuite").tooltips.chatlet,{entity:zmText.get("mailsuite").entity[1]}),data:"msi-chat",hideIcon:!0}],hideGroup:!0}),z.push({groupId:"prevIcons",actionArr:[{iconClass:"msi-prev",data:"msi-prev",tooltip:h.iconTooltip.prev},{iconClass:"msi-next",data:"msi-next",tooltip:h.iconTooltip.next},{iconClass:"msi-close",data:"msi-close",tooltip:h.iconTooltip.close}]}),m={id:"zmPrevHeader",rIcons:z},m.text=k,y[0].push(m),b.streamsMail&&(m.rIcons=[{groupId:"prevIcons",actionArr:[{iconClass:"msi-close",data:"msi-close",tooltip:h.iconTooltip.close}]}]),y[0].setListener("click",function(a,b){switch(a){case"msi-prev":zmPreviewTemplate.loadPrevMail();break;case"msi-next":zmPreviewTemplate.loadNextMail();break;case"msi-close":zmList.bindAction({action:"clsPrev"}),$.unsubscribe("zmstreamsapp/deletePost",o);break;case"msi-thread":zmList.bindAction($(b).data(),b);break;default:zmInit.bindActionHeaderIcons(null,a,b)}}),zmsuite.getCenterOuter().$el.data("row-detail",b),c.viewDetails&&"search"===c.viewDetails.view)zmsuite.isWorkspaceAvailable("zm_srch1")&&zmsuite.getCenterOuter().$el.data("data-maillist",zmSearchUtil.getSearchList().slice()),zmsuite.getCenterOuter().$el.data("data-detail",c.viewDetails);else if(c.viewDetails&&"stream"===c.viewDetails.view)zmsuite.getCenterOuter().$el.data("data-maillist",[b.msgId]),zmsuite.getCenterOuter().$el.data("data-detail",c.viewDetails);else{var A=zmInit.getListingDetObj(),B=zmUtil.getFolId(A);zmsuite.getCenterOuter().$el.data("data-detail",A),zmsuite.getCenterOuter().$el.data("data-maillist",zmail.listObj[B]&&zmail.listObj[B].MO.slice()||[])}zmPrev.setMailDOMContent(a.mdata,b),c.mainElem=w[0].$el,c.contElem=w[1].contentObj.$el,c.hdrElem=y[0].$el,c.prevElem=w[1].$el,w[1].show(),(b.isReminder||l.TH&&l.FD!==zmail.folId.tId&&(0!==zmUtil.getMLConversionValue()&&c.viewDetails&&"search"!==c.viewDetails.view&&c.viewDetails.fId!==zmail.folId.sId||l.streams||"conversation"===b.src||"restore"===b.src&&"conversation"===b.toOpen))&&(v.tId=l.T,r("",{mId:b.msgId,from:"showMail",opentype:b.opentype,elemObj:c})),zmsuite.showWorkSpace(d),w[0].$el.addClass("SC_sw"),w[1].$el.addClass("SC_w100"),zmTopMenus.util.show({type:"functional",msgId:a.mdata&&a.mdata.MSGID||void 0,view:c.viewDetails,elem:y[0],tabId:d});var C=zmsuite.getCenter()[1].getNodes()[0].$el[0].clientHeight;c.contElem.css({top:C+"px"}),$(c.prevElem).hasClass("tmail")?c.contElem.css({bottom:"0px"}):(w[1].contentObj.$el.find(".SC_pct").removeClass("SC_Tfcs"),c.contElem.css({bottom:$(c.prevElem).find(".zmQRB").height()+"px"})),$(c.prevElem).attr({"data-mid":b.msgId,"data-ty":b.type}),zmUtil.setScrollShadow(c.contElem),b.src&&("conversation"===b.src||"external"===b.src||"restore"===b.src)||l.streams?$(c.mainElem).find("i.msi-prev,i.msi-next").closest("b").addClass("SC_opy3"):b.streamsShowMail||zmPrev.PvNt(b.rowId,b.type,b.opentype,d,c),
v.fId=l.FD,v.viewDetails=c.viewDetails,v.toOpen=b.toOpen||"conversation"===b.src?"conversation":void 0;var D={actionType:"viewGroupEntity",etype:b.entityType,gid:b.groupId};if(D.pid=v.tId?v.tId:b.msgId,b.streamsMail){var E={appId:d,appname:j,data:{},appIcon:"msi-mailopen"};$.publish("zmail/SaveTabState",[{appId:d,app:"stream",appObj:E,category:"stream_mail",data:D}])}else $.publish("zmail/SaveTabState",[{appId:d,app:"m",appObj:{appId:d,appname:j,data:{},appIcon:"msi-mailopen"},category:"mail_tab",data:v}]),zmRestore.saveState("tab",{key:"tab",data:{app:"m",category:"mail_tab",data:v}},{action:"open"})},A=function(a,b,c,d){if(b=b||{},"tIcon"!==b.from&&"bulk"!==a.mode){var e=zmail.mailObj[a.msgId]||{},f=a.entityId||e.T||a.msgId;f&&(a.entityId=f),a.groupId=a.groupId||zmail.zuid,a.entityType=1}(a.shId||a.shareId)&&(b.avoidCache=!0),a.msgId&&zmContentCache.isCached(a.msgId)&&a.hasdraft&&(b.forceFetch=!0);var g={u:zmail.conPath+"/md.do",t:"POST",fn:c,p:a,ep:b,setSessionId:b.setSessionId};"function"==typeof d&&(g.efn=d),zmContentCache.fetch(g)},B=function(a){var b,c={};return a=a||zmTab.currentTab,b=zmsuite.getCenter(a),b[1]&&(c.prevElem=b[1].$el[0]),b[0].getNodes()[2]&&(c.listElem=b[0].getNodes()[2].$el[0]),c.mainElem=b[0].$el,c.hdrId="zmHdr",c.viewDetails=$.extend({},zmsuite.getCenterOuter(a).$el.data("data-detail")),a.indexOf("zm_srch")?a.indexOf("zmStreamsApp")?a.indexOf("zmncenter")?a.indexOf("zm_tab")?c.viewDetails=$.extend({},zmInit.getListingDetObj()):c.viewDetails=$.extend({},zmsuite.getCenterOuter(a).$el.data("data-detail")):c.viewDetails={view:"zmncenter"}:c.viewDetails={view:"stream"}:(c.id=1,c.viewDetails=$.extend({},zmSearchUtil.getSearchViewDetails())),c},C=function(a){var b,c,d,e,f,g,h,i,j={},k=!1,l=!1;return i=a.tabId||zmTab.currentTab,(g=a.msgId)?(g.indexOf("t")||(g=g.substring(1)),b=zmail.listObj,i.indexOf("zm_srch")||(k=!0),zmUtil.getFolId()===zmail.folId.sId&&(l=!0),k?(h=i.substring(7),e=zmSearchUtil.getSearchViewDetails(),c="lt"===a.type?zmSearchUtil.getSearchList():zmList.getViewBasedMsgList(zmail.mailObj[g].T,e,!1)):(e=zmInit.getListingDetObj(),f=a.opentype,d=zmUtil.getFolId(),"lt"===a.type||2===f&&0!==zmUtil.getMLConversionValue()?b[d]&&(c=b[d].MO):b[zmail.mailObj[g].T]&&(c=zmList.getViewBasedMsgList(zmail.mailObj[g].T,e,!1))),0===f?j=B("zmStreamsApp"===i?"zmStreamsApp":"zm_Container"):(j=B(i),j.listElem||(k?j.listElem=zmsuite.getCenter("zm_srch1")[0].getNodes()[2].$el:j.listElem=zmail.mailCenter.listElem)),j.listArr=c,j.id=h,j.msgId=g,j.isParent=zmail.mailObj[g].TH&&"lt"===a.type&&0!==zmUtil.getMLConversionValue(),"lt"===a.type&&zmail.mailObj[g].TH&&0!==zmUtil.getMLConversionValue()?k||l?j.rowElem=$(j.listElem).find("#"+g):j.rowElem=$(zmail.mailCenter.listElem).find("#t"+g):k||l?j.rowElem=$(j.listElem).find("#"+g):j.rowElem=$(zmail.mailCenter.listElem).find("#"+g),k&&(zmSearchUtil.isNewSearch()?j.collection={}:j.collection=zmail.searchObj[1].collection),2===a.opentype?(j.contElem=zmsuite.getCenter("zm_Container")[1].getNodes()[1].$el.children().eq(0),j.hdrElem=zmsuite.getCenter("zm_Container")[1].getNodes()[0].$el):(j.contElem=zmsuite.getCenter()[1].getNodes()[1].$el.children().eq(0),j.hdrElem=zmsuite.getCenter()[1].getNodes()[0].$el),j.type=a.type,j):j},D=function(a,b,c,d,e){var f,g,h,i={attData:{},addInfo:{}},j=zmail.attachmentContainer;for(f in c)g=c[f].e,i.attData[g]||(i.attData[g]={},i.attData[g].attData=[],i.attData[g].addInfo={}),i.attData[g].attData[parseInt(c[f].Id)-1]=c[f];i.addInfo.shownext=d,i.addInfo.isFull=!0,"tc"===e&&(i.addInfo.isFull=!1),h=j.getObject(b),h?"tc"===e?h.data.attData[a]=i.attData[a]:"t"===e&&(h.data=i):j.addObject({id:b,data:i})},E=function(a,b,c){var d=!1,e=zmail.attachmentContainer;switch(c){case"sm":(e.getObject(b)||zmail.mailAttachments[a])&&(d=!0);break;case"tc":(e.getObject(b)||zmail.mailAttachments[b])&&zmail.mailAttachments[b].data.attData[a]&&(d=!0);break;case"t":(e.getObject(b)||zmail.mailAttachments[b])&&zmail.mailAttachments[b].data.addInfo.isFull&&(d=!0)}return d},F=function(a,b,c){var d=[];switch(c){case"sm":zmail.mailAttachments[a]&&(d=zmail.mailAttachments[a].data.attData[a].attData);break;case"tc":zmail.mailAttachments[b]&&zmail.mailAttachments[b].data.attData[a]&&(d=zmail.mailAttachments[b].data.attData[a].attData);break;case"t":if(zmail.mailAttachments[b]){var e,f,g,h=zmail.mailAttachments[b].data.attData,i=Object.getOwnPropertyNames(h);for(e=0;e<i.length;e++){g=h[i[e]].attData;for(f in g)d.push(g[f])}}break;default:d=[]}return d},G=function(a){var b,c,d=a.mId||a.mailID,e=zmail.mailObj[d],f=e.T?e.CMT:e.CT;"opening"===a.state?(b="/mail/openingincontainer",c={mailID:String(d),useConversation:Boolean(e.T),conversationID:e.T?String(e.T):"",openedBy:a.openedBy,openedTab:a.openedTab,folderID:e.FD,commentValue:f}):"opened"===a.state&&(b="/mail/openedincontainer",c={mailID:String(d),containerDOM:a.elem,useConversation:Boolean(e.T),commentValue:f,conversationID:e.T?String(e.T):"",openedBy:a.openedBy,folderID:e.FD,openedTab:a.openedTab}),$.publish(b,c)},H=function(a,c){if(!a.MSGID||"bulk"!==c.mode&&"oldest"!==c.getUnread&&"latest"!==c.getUnread||c.msgId===a.MSGID||(zmail.mailObj[c.msgId].TH?v(a.MSGID,a,zmail.mailObj[c.msgId].T):v(a.MSGID,a),c.msgId=a.MSGID),a.mdata&&c.streamsMail?zmContentCache.processResponse(a,"",c):zmContentCache.populateMailData(a,c),a.mdata&&a.mdata.MSGID&&1===Object.keys(a.mdata).length)return void(c.prevDefObj&&c.prevDefObj.resolve());zmUtil.debugLog("zmList.openMail()",a,c);var d,e,f,g,h,i,j,k,l;if(d=c.msgId,"external"!==c.src&&"restore"!==c.src&&"zmncenter"!==c.src||!a.mdata||(v(d,a.mdata),zmail.mailObj[d].AT&&(c.att=zmail.mailObj[d].AT),a.tdata&&a.tdata.length&&!zmail.mailObj[d].T&&(zmail.mailObj[d].TH=1,zmail.mailObj[d].T=a.tdata[0].T)),c.streamsShowMail=c.streamsShowMail||!1,c.isDraftMail=c.isDraftMail||!1,c.isDraftEditable=c.isDraftEditable||!1,e=zmail.mailObj[d].T,g=c.opentype,f=c.elemObj,k=c.isSh||!1,k&&3!==g&&delete c.streams,e&&!c.streamsMail&&("zm_srch1"===zmTab.currentTab&&("conversation"===c.src||"conversation"===c.toOpen||"content"===c.type)||0!==zmUtil.getMLConversionValue()&&"zm_srch1"!==zmTab.currentTab||0===zmUtil.getMLConversionValue()&&("conversation"===c.src||"conversation"===c.toOpen))&&(c.showIndex=!0),0===g?f&&"search"===f.viewDetails.view?(j="S"+d,l="S"):(j="P"+d,l="P"):2===g?(j="T"+d,l="T"):3===g&&(j="N"+d,l="N"),c.prefix=l,f&&"search"===f.viewDetails.view&&!f.listArr){var m=f.id;zmSearchUtil.isNewSearch()?(f.searchStr=zmSearchUtil.getSearchString(),f.listArr=zmSearchUtil.getSearchList()):("srch"===zmail.searchObj[m].collection.type?(f.searchStr=zmail.searchObj[m].collection.searchContArr[0],f.searchType=2):(f.searchStr=zmail.searchObj[m].collection.advSearchStr,f.searchType=3),f.listArr=zmail.searchObj[m].collection.searchList),"lt"===c.type&&zmail.mailObj[d].TH?f.rowElem=$(f.listElem).find("#t"+d):f.rowElem=$(f.listElem).find("#"+d)}if(a.tdata&&(c.sm=zmail.mailObj[d].SM||"",c.streamsMail)){var n,o,p=a.tdata,q=p.length;for(n=0;n<q;n++)o=p[n].M,o&&(zmail.mailObj[o].accId=c.accId,zmail.mailObj[o].actionType=c.actionType,zmail.mailObj[o].entityType=c.entityType,zmail.mailObj[o].groupId=c.groupId,zmail.mailObj[o].entityType=c.entityType,zmail.mailObj[o].S=1,zmail.mailObj[o].streams=!0,zmail.mailObj[o].isFav=c.isFav,zmail.mailObj[o].TAG=c.TAG,c.newStreams&&(zmail.mailObj[o].newStreams=!0))}if(c.vfc){var r=zmContentCache.isCached(d)&&zmContentCache.get(d).EXTIMG||{};c.imgStatus=r.link,zmPreviewTemplate.showFullContent(a,c)}else if("content"===c.type)"bulk_mail"!==c.load_action&&$(f.prevElem).find(".SC_pct").removeClass("SC_Tfcs"),zmPrev.setMailDOMContent(a.mdata,c),2===g&&f&&("search"===f.viewDetails.view&&(f=zmList.getElemObj()),$(f.prevElem).attr({"data-mid":c.msgId,"data-ty":"th"})),3!==g&&zmPreviewTemplate.setPreviewHeaderHeight(f);else{if(0===g){if(c.cpvreq&&c.cpvreq!==b)return void(c.markread&&zmmailAct.applyActions("unread","click",{msgId:[d],thd:[]}));w(a,c,f),c.streamsShowMail||"zm_srch1"===c.tabId||(zmUrlAct.update({from:"zmCenter",msgId:c.msgId,type:c.type,opentype:0}),zmRestore.saveState("preview",{p:c.msgId},{}))}else 2===g?z(a,c,f):3===g&&("zmncenter"===c.src&&(zmList.getNotifyPopupContainer(a.mdata,f.prevElem,k,f),c.parentElm=f.contElem,f.prevElem.className.indexOf("SC_Twpr")===-1&&(f.contElem[0].style.maxHeight=document.body.getBoundingClientRect().height-zmUtil.wmsBarHeight()-320+"px",f.contElem[0].style.overflow="auto"),a.mdata.shareId=c.shId||c.shareId),x(a,c,f));if(c.streamsMail&&3!==g&&!a.mdata.newStreams&&!k){var s=e||d;s=zmail.mailObj[s].groupId+"#"+s,zmUtil.requireStreamsApp().done(function(){zmStreamsApp.PostActions.getSharedMail(s,$(f.contElem)[0])}).fail(function(){zmUtil.debugLog("Could not load comments !","zmList.openMail()",arguments)})}if(f.contElem){var t=$.extend({},c);$(f.contElem).data("msg_params",t)}}if(zmPreviewTemplate.addDraftsToView(zmail.mailObj[d].T,$(f.prevElem),l),a.mdata&&a.mdata.READSTATUS&&c.reqSent)"success"===a.mdata.READSTATUS&&zmmailAct.rapplyAction({result:"success"},{mailId:[d],thd:[],action:"read"});else if(0===zmail.mailObj[d].S&&zmail.mailObj[d].FD!==zmail.folId.oId&&"stream"!==f.viewDetails.view||c.markread){var u={};u.msgId=[d],u.thd=[],zmmailAct.applyActions("read","click",u)}if(f?(h=$(f.prevElem),3===g&&(h.closest(".SCS_popUp").length?h=h.closest(".SCS_popUp"):h.closest("#postpopUp").length&&(h=h.closest("#postpopUp"))),i="th"===c.type||"content"===c.type?$("#zmCon"+j):$(f.prevElem)):h=i=$(c.parentElm),zmail.mailObj[d].FD===zmail.folId.oId&&$(f.prevElem).find("i.msi-popout").closest("b").addClass("SC_opy3"),zmPreviewTemplate.showInvitation(d,h),zmail.mailObj[d].SCOBJ&&zmail.mailObj[d].FD!==zmail.folId.spId&&zmail.mailObj[d].FD!==zmail.folId.sId&&zmMarkup.load({msgId:d,schemaObj:zmail.mailObj[d].SCOBJ[0],selector:h,prefix:c.prefix}),zmPreviewTemplate.showImageDisplayElem(d,h,{isvfc:c.vfc,imgStatus:c.imgStatus}),zmail.mailObj[d].FD!==zmail.folId.spId&&zmPreviewTemplate.showUnsubscribe(d,h),"content"!==c.type&&(c.vfc||zmPreviewTemplate.showProfilePhoto({msgId:c.msgId,type:"lt"},h),e&&zmail.listObj[e]&&1===zmail.listObj[e].showNextPage&&(0!==zmUtil.getMLConversionValue()&&"search"!==f.viewDetails.view||"conversation"===c.src||"conversation"===c.toOpen||c.streamsMail)&&zmPreviewTemplate.addShowMoreMailsLink(f,g)),zmPreviewTemplate.bindPreviewEvents(h,g),zmPreviewTemplate.applyHeaderState($("#zmHdr"+j)),"bulk_mail"===c.load_action||c.noScroll||c.vfc||zmUtil.setPreviewScroll($("#zmHdr"+j).closest(".SC_pct"),f.contElem),zmail.mailObj[d].TH&&"lt"===c.type&&!c.streamsShowMail&&"1"===zmAdHocSettings.getMarkConversationRead()&&(zmInit.checkThreadRead(e)||zmList.loadUnreadMails(e,g,f.viewDetails)),c.showIndex&&$('[id="zmHdr'+j+'"]').each(function(a,b){setTimeout(function(){$(b).find("#zm_readtitle").fadeOut()},5e3)}),a.mdata.NEWATT){var y,A,B,C,F,H,I=a.mdata.NEWATT,J=I.length,K=0,L=zmail.mailObj[d],M=zmail.mailObj[d].TH;for(M?(F=L.T,H="tc"):(F=d,H="sm"),E(d,F,H)||D(d,F,I,void 0,H),C=L.FD,C&&zmUtil.isSharedFolder(C)&&(y=zmUtil.getShareId(C)),L.streams&&(B=L.groupId,A="viewGroupEntity"),K=0;K<J;K++)y&&(I[K].shId=y),B&&(I[K].gId=B,I[K].type=A);zmPreviewTemplate.setSlideShow(I,i[0])}if(!c.vfc){if(a.comment&&k){a.comment.comments||(a.comment={comments:{},order:[]}),a.comment.shOwner=c.shOwner;var N=e||d;zmUtil.requireStreamsApp().done(function(){var b=a.sharedUsers||[],d={comment:a.comment,shId:c.shId||c.shareId,sharedUsers:b,commentuuid:c.commentuuid};3===g&&(d.fixedComment=!0),zmStreamsApp.PostActions.getSharedMail(N,f.contElem[0],d,!0)}).fail(function(){zmUtil.debugLog("Could not load comments for shared folder mail !","zmList.openMail()",arguments)})}else c.streamsMail||k||"content"!==c.type&&c.vfc!==!0&&($(f.contElem).siblings(".zms_fixed").remove(),zmUtil.requireMailCollab().done(function(){G({state:"opened",mId:d,elem:$(f.contElem)[0],openedBy:g,openedTab:zmTab.currentTab})}));zmUtil.publishMPreviewEvent(),zmPreviewTemplate.processReadReceipt(d)}c.prevDefObj&&c.prevDefObj.resolve(d)},I=function(a,b){var c,d=b.msgId||[],e=d.length,f=!1;for(c=0;c<e;c++){var g=d[c];if(zmContentCache.isCached(g)){var h={},i={msgId:g,type:"content",reqSent:f,load_action:"bulk_mail"};i.elemObj=B(),i.opentype=b.opentype,i.markread=b.markread;var j=$(i.elemObj.prevElem).find(".zmPHdr[data-mid='"+g+"']"),k=j.attr("id");if(k){k=k.substring(5),i.from=$(i.elemObj.prevElem).find(".zmPHdr[data-mid='"+g+"']");var l=$("<div />");l.attr("id","zmCon"+k),j.after(l),H(h,i)}}}zmInit.checkThreadRead(b.thdId)||zmList.loadUnreadMails(b.thdId,b.opentype,b.viewDet)},J=function(a,b,c){var d=zmPrev.prevDetails().msgId;if(d&&(d.indexOf("t")||(d=d.substring(1)),zmail.mailObj[d]&&zmail.mailObj[d].T===a)){var e,f,g,h=[],i=[],j=[],k=[],l=5;for(c=c||B().viewDetails,h=zmList.getViewBasedMsgList(a,c,!0),e=h.length,f=0,g=0;f<e&&g<l;f++)zmail.mailObj[h[f]]&&0===zmail.mailObj[h[f]].S&&(j.push(h[f]),zmContentCache.isCached(h[f])||(i.push(h[f]),zmail.mailObj[h[f]].AR?k.push(!0):k.push(!1)),g++);if(j.length){var m={accId:zmail.accId,summary:!0,mode:"bulk",markread:!0},n={markread:m.markread,msgId:j,thdId:a,opentype:b,viewDet:c};m.msgId=i.join(),m.archiveStatus=k.join(),m.folId=zmail.mailObj[j[0]].FD,zmUtil.isSharedFolder(zmail.mailObj[j[0]].FD)&&(m.shId=n.shId=zmUtil.getShareId(zmail.mailObj[j[0]].FD)),i.length?A(m,n,I):I({},n)}}},K=function(a,b){var c,d,e=a,f=[],g=0;for(c=zmail.mailObj[a].T,f=zmList.getViewBasedMsgList(c,b,!0),g=f.length,d=g-1;d>=0;d--)if(0===zmail.mailObj[f[d]].S&&0===zmail.mailObj[f[d]].AR){e=f[d];break}return e},L=function(a,b){var c,d,e=a,f=[],g=0;for(c=zmail.mailObj[a].T,f=zmList.getViewBasedMsgList(c,b,!0),g=f.length,d=0;d<g;d++)if(0===zmail.mailObj[f[d]].S&&0===zmail.mailObj[f[d]].AR){e=f[d];break}return e},M=function(a,b){if(a){var c=zmUtil.getFolId(),d=zmail.listObj[c]?zmail.listObj[c].MO:[],e=d.length;if(e>0){var f,g,h,i,j,k=2,l=4,m=0,n=!1,o=!1,p=!1,q=!1,r=0,s=10,t=d.indexOf(a),u=[],v=[];if(t!==-1){for(0!==zmUtil.getMLConversionValue()&&"archive"!==zmInit.getListingDetObj().view&&"0"===zmAdHocSettings.getMarkConversationRead()&&(q=!0),f=t-1,g=0,h=0;f>=0&&g<k&&h<s;f--){if(i=d[f],j=zmail.mailObj[i],j&&j.TH&&q&&0===j.TS&&zmail.listObj[j.T]&&(i=K(i,zmInit.getListingDetObj())||d[f]),zmail.mailObj[i]&&0===zmail.mailObj[i].S){if(n=!0,zmContentCache.isCached(i)){m++;break}v.push(i),u.push(!1),g++}h++}for(k=l-v.length,f=t+1,g=0,h=0;f<e&&g<k&&h<s;f++){if(i=d[f],j=zmail.mailObj[i],j&&j.TH&&q&&0===j.TS&&zmail.listObj[j.T]&&(i=K(i,zmInit.getListingDetObj())||d[f]),zmail.mailObj[i]&&0===zmail.mailObj[i].S){if(o=!0,zmContentCache.isCached(i)){r++;break}v.push(i),u.push(!1),g++}h++}if((n&&0===m)|(o&&0===r)&&(p=!0),v.length&&p){if("mailIds"===b)return v;var w={},x={accId:zmail.accId,summary:!0};x.msgId=v[0],x.folId=zmail.mailObj[v[0]].FD,v.splice(0,1),v.length&&(x.mailId=v.join(),w.setSessionId=!0),w=$.extend(w,x),A(x,w,"")}}}}},N=function(a,b){var c,d,e;if("header"===a.from){var f=$(b).closest(".SC_pv");zmInit.rclkId=f.attr("data-mid"),"zm_Container"===zmTab.currentTab&&"lt"===f.attr("data-ty")&&zmail.mailObj[zmInit.rclkId].TH&&(zmInit.rclkId="t"+zmInit.rclkId)}else"list"===a.from&&(zmInit.rclkId=$(b).closest(".zmL").attr("id"));if(zmInit.rclkId.indexOf("t")){if(c=zmInit.rclkId,zmail.mailObj[c].FD===zmail.folId.oId)return;e=zmail.conPath+"/popMail.do?accId="+zmail.accId+"&msgId="+c+"&folId="+zmail.mailObj[c].FD+"&att="+zmail.mailObj[c].AT,zmUtil.isInlineCompose()&&(e+="&inlineCompose=true"),zmail.mailObj[c].TH&&(e+="&thId="+zmail.mailObj[c].T+"&showConv=false")}else c=zmInit.rclkId.substring(1),d=zmail.mailObj[c].T,e=zmail.conPath+"/popMail.do?accId="+zmail.accId+"&msgId="+c+"&thId="+d+"&folId="+zmail.mailObj[c].FD+"&att="+zmail.mailObj[c].AT+"&showConv=true",zmUtil.isInlineCompose()&&(e+="&inlineCompose=true");var g,h=zmail.mailObj[c].FD,i=!1;zmUtil.isSharedFolder(h)?(i=!0,e+="&rShareId="+zmUtil.getShareId(h)+"&isSh=true&groupId="+zmail.shrTree[0][h].OZUID):zmUtil.isFolderId(h)&&(i=!0,g=zmList.getRowInfo(h,"zmlTreeH","info").SH,"-1"!==g&&(e+="&isSh=true&groupId="+zmail.zuid+"&rShareId="+g)),i&&(e+="&entityId="+c+"&entityType=1"),zmTab.currentTab.indexOf("zm_srch")||(e+="&isSrch=true"),e+="&feature="+zmail.showFeature,a.actionSrc&&(e+="&actionSrc="+a.actionSrc),zmUtil.openWindow(e,60,80)},O=function(a){var b=$(a).children(".zmL");if(b.length>0){var c=b.filter(":not(.SC_check)");if(0===c.length)return!0}return!1},P=function(a){return!!$(a).find(".SC_check").length},Q=function(a,b){var c=b.cName,d=zmList.getElemObj();"success"===a.result?"show"===b.opt?("SZ"===c?$(d.listElem).find(".zmSze").show():"DT"===c&&$(d.listElem).find(".zmDate").show(),zmail.viewInfo[0][c]="s"):("SZ"===c?$(d.listElem).find(".zmSze").hide():"DT"===c&&$(d.listElem).find(".zmDate").hide(),zmail.viewInfo[0][c]="h"):zmsDialog.alert(f.common.errorCustomizeColumn)},R=function(a){var b,c=a.parents(".zmL").attr("id");b=c.indexOf("t")?{msgId:[c],thd:[]}:{thd:[c.substring(1,c.length)],msgId:[]},zmmailAct.doActions("delete","mail",b)},S=function(a,b){var c;a&&""!==a&&(c=a.indexOf("t")?{msgId:[a],thd:[]}:{thd:[a.substring(1,a.length)],msgId:[]},c.actionSrc=b,zmmailAct.doActions("delete","mail",c))},T=function(a,b){var c;a&&""!==a&&(c=a.indexOf("t")?{msgId:[a],thd:[]}:{thd:[a.substring(1,a.length)],msgId:[]},c.actionSrc=b,zmmailAct.doActions("spam","mail",c))},U=function(a,b){var c;a&&""!==a&&(c=a.indexOf("t")?{msgId:[a],thd:[]}:{thd:[a.substring(1,a.length)],msgId:[]},c.actionSrc=b,zmmailAct.doActions("notspam","mail",c))},V=function(a){var b,c={};a=a.parents(".zmL"),b=$(a)[0].id,b.indexOf("t")!==-1?(c.thd=[zmInit.zmsubStr(b,"t")],c.msgId=[]):(c.msgId=[b],c.thd=[]),a.hasClass("zm_urd")?zmmailAct.applyActions("read","dropdown",c):zmmailAct.applyActions("unread","dropdown",c)},W=function(a){var b=a.entityId,d=zmail.mailObj[b];if(d){var e=d&&d.T,g=[];g=e&&zmail.listObj[e]?zmail.listObj[e].MO:[b];var h,i,j=a.total;if(!isNaN(j)){var k={};k.update=function(a,b){var c=$(a).find(".SC_cmt");if(c.length){if(c.is(":empty")){var d='<i class="msi-lcmnt" title="'+f.common.tooltip.commentsAvailable+'"></i><span></span>';c.html(d)}c.find("span").text(b)}},k.remove=function(a){var b=$(a).find(".SC_cmt");b.length&&b.children().remove()},k.getElem=function(){var a,b=["zm_Container","zm_srch1"],d=[];return b.forEach(function(b){a=c.getViewObject(i,b),a=a&&a.$element,a&&a.length&&d.push(a)}),d};for(h in g)i=g[h],zmail.mailObj[i]&&(zmail.mailObj[i].CMT=j),k.getElem().forEach(function(a){0===j?k.remove(a):k.update(a,j)})}}};$.subscribe("/streams/comment",function(a,b){if("1"===b.etype)try{W(b)}catch(c){zmUtil.debugLog(c)}});var X=function(a,b){var c,d="",e=[];if(!a||!zmail.mailObj[a])return"";if(zmail.listObj[b]?e=zmail.listObj[b].MO:"search"===b&&(e=zmSearchUtil.getSearchList()),c=e.length,c>0){var f,g=zmail.mailObj[a].T;for(f=0;f<c;f++)if(e[f]===zmail.mailObj[a].T||zmail.mailObj[e[f]].TH&&zmail.mailObj[e[f]].T===g){d=e[f];break}}return d},Y=function(a){var b=0,c=zmail.listObj[a]?zmail.listObj[a].MO:[],d=c.length,e=0;if(zmUtil.isInlineCompose())for(e=0;e<d;e++)zmail.mailObj[c[e]].DMID&&b++;else for(e=0;e<d;e++)zmail.mailObj[c[e]].FD===zmail.folId.dId&&b++;return b},Z=function(a,b){var c,d=$(zmail.mailCenter.listElem).find("#"+a),e="",f=zmInit.getThreadSubject(b.M);if(b.FD!==zmail.folId.dId&&(zmail.mailOpt.isshowSummary&&b.TSM&&b.TSM.trim()&&(e=" - "+b.TSM),d.find(".zmFrm span:first").html(b.TSN),c=_zm.getDOM(["SPAN",{child:[["text",f],["SPAN",{attrs:{"class":"sum"},child:[["text",e]]}]]}]),d.find(".zmSub span:first").html($(c))),b.TC>0){var g=d.find(".zmtCt");g.length&&b.FD!==zmail.folId.dId?g.text(b.TC):g.length||(g=$(_zm.getDOM(["DIV",{attrs:{"class":"zmtCt"},child:[["text",b.TC]]}])),g.insertAfter(d.find(".zm_td")))}var h=a;if(0===a.indexOf("t")&&(h=a.substring(1)),b.FD===zmail.folId.dId){var i=Y(b.T)||1;zmail.mailObj[h]&&(zmail.mailObj[h].DC=i)}if(b.TS2){var j=["","msi-rpd","msi-fwd","msi-fwdRpd"],k=d.find(".msi-mail,.msi-rpd,.msi-fwd,.msi-fwdRpd");k.length&&(k.removeClass(),k.addClass(j[b.TS2]))}},_=function(a,b,c,d){var e,f,g,h;a.TC=a.TC||1,e=zmUtil.getFolId(),f=X(a.M,e),h=zmail.mailObj[f]||{},f&&(g=$(zmail.mailCenter.listElem).find("#t"+f),h.T||(h.TC=1,h.TH=1,h.T=f),a.FD===zmail.folId.sId&&(2===c||1===c&&d)?(a.TC=h.TC+1,h.TC+=1):a.TC=h.TC||a.TC,a.DT=h.DT||a.DT,g.length?(Z("t"+f,a),$(zmail.mailCenter.listElem).find("#thd"+f).remove()):(g=$(zmail.mailCenter.listElem).find("#"+f),g.length&&(Z(f,a),a.TC&&g.find(".zmFlt").append(_zm.getDOM(["DIV",{attrs:{"class":"zmtCt"},child:[["text",a.TC]]}])))))},aa=function(a,b){var c,d,e,f=a.T,g=[],h=!1,i=!1,j=$.Deferred();if(a.TC=a.TC||1,g=zmList.getViewBasedMsgList(f,b,!0),c=zmUtil.getFolId(),g.length>0&&(i=!0,e=$(zmail.mailCenter.listElem).find("#t"+g[1])),i&&a.FD!==zmail.folId.dId&&e.length?(a.TC=g.length,e.remove(),$(zmail.mailCenter.listElem).find("#thd"+g[1]).remove(),h=!0,d=g[1]):(d=X(a.M,c),d&&(zmail.mailObj[d].T?($(zmail.mailCenter.listElem).find("#"+d).remove(),$(zmail.mailCenter.listElem).find("#t"+d).remove(),$(zmail.mailCenter.listElem).find("#thd"+d).remove()):(zmail.mailObj[d].TC=1,zmail.mailObj[d].TH=1,zmail.mailObj[d].T=d,$(zmail.mailCenter.listElem).find("#"+d).remove()),a.FD!==zmail.folId.dId?a.TC=zmail.mailObj[d].TC+1:a.TC=zmail.mailObj[d].TC,h=!0)),h){var k=zmail.listObj[c].MO.indexOf(d);k!==-1&&zmail.listObj[c].MO.splice(k,1),j.resolve()}else zmList.getThreadCount({msgId:a.M,viewObj:b,deferredObj:j});return j},ba=function(a,b){var c,d,e,f=!1;if(d=b.msgId,e=b.type,d.indexOf("t")||(d=d.substring(1,d.length)),0===a){var g=b.tabId;c=zmPrev.prevDetails(g),f=d===c.msgId&&e===c.type&&"content"!==e}else 2===a&&("lt"!==e&&"th"!==e||!zmail.mailObj[d].T||(d="t"+zmail.mailObj[d].T),zmsuite.isWorkspaceAvailable("zm_tab"+d)&&"restore"!==b.src&&(zmsuite.showWorkSpace("zm_tab"+d),c=zmPrev.prevDetails("zm_tab"+d),f=b.msgId===c.msgId&&e===c.type&&"content"!==e));return f},ca=function(a){var b,c="",d="";return"string"==typeof a?(d=a,c=$("#"+a).attr("data-ty")):(b=$(a).closest(".zmL"),b.length&&(c=b.attr("data-ty"),d=b[0].id||b.attr("data-detail"))),{msgId:d,type:c,opentype:zmail.mailOpt.isPopup}},da=function(){var a=zmsuite.getCenter()[0].getNodes()[2].$el[0];a.scrollTop=0;var b=$(a).children(".SC_check:first");b.length&&(a.scrollTop=b.offset().top-$(a).offset().top)},ea=function(a){return a=a||{},!!(a.view||a.flag||a.label||a.attach)},fa=function(a,b){var c;"zm_Container"===a&&(c="mListing",zmList.selDetails[c]={},"select_flag"===b?zmList.selDetails[c].flag="-1":"select_label"===b?zmList.selDetails[c].label="-1":"select_attach"===b?zmList.selDetails[c].attach="1":"select_unread"===b&&(zmList.selDetails[c].view="unread"))},ga=function(a){a=a||zmTab.currentTab,"zm_Container"===a?zmList.selDetails.mListing={}:"zm_srch1"===a&&(zmList.selDetails.sListing={})},ha=function(a){var b,d=a.action,e=!0,g={},h=zmTab.currentTab,i=!1;"zm_Container"===h?(g=zmInit.getListingDetObj(),zmList.selDetails.mListing={}):h.indexOf("zm_srch")!==-1?(g=zmSearchUtil.getSearchViewDetails(),zmList.selDetails.sListing={}):g=zmsuite.getCenterOuter().$el.data("data-detail");var j=ea(g);switch(d){case"select_all":zmList.chkAll();break;case"select_none":e=!1;break;case"select_read":b=c.filter(c.readfilter),b.length?c.selectMails(b,!0):i=!0;break;case"select_unread":"unread"===g.view?zmList.chkAll():(b=c.filter(c.unreadfilter),b.length?(c.selectMails(b,!0),j||(zmList.showBulkActionBand("selFilter"),fa(h,d))):i=!0);break;case"select_flag":g.flag?zmList.chkAll():(b=c.filter(c.flaggedfilter),b.length?(c.selectMails(b,!0),j||(zmList.showBulkActionBand("selFilter"),fa(h,d))):i=!0);break;case"select_label":g.label?zmList.chkAll():(b=c.filter(c.taggedfilter),b.length?(c.selectMails(b,!0),j||(zmList.showBulkActionBand("selFilter"),fa(h,d))):i=!0);break;case"select_attach":g.attach?zmList.chkAll():(b=c.filter(c.attachmentfilter),b.length?(c.selectMails(b,!0),j||(zmList.showBulkActionBand("selFilter"),fa(h,d))):i=!0);break;default:e=!1}i&&_zm.succErrMsg("i",f.common.selectionWarnMsg),e&&"select_all"!==d&&da(),zmUtil.hideMenu()},ia=function(){var b=zmUtil.getFolId(),c=zmInit.findFolName(b),d='<b class="SC_opa50">'+f.headertitle.attViewerHeader+'</b> <i class="msi-rarrow"></i>'+_zm.escapeTags(c),e=zmText.applyArgs(f.headertitle.attViewerTabName,{folName:c}),g={accId:zmail.accId,mode:"lstEntity",thb:!0,fldId:b},h={workspaceConfig:{appname:e,headerHTML:d,onClose:function(){a=null},workspaceKey:b},attachListingConfig:{requireParams:g}};return a?void(a.getWorkspacekey()===b?zmsuite.showWorkSpace("attachList"):a.rerender(h)):void zmUtil.createAttachListingWorkspace(h,function(b){a=b})},ja=function(a){var b="",c="",d="",e=a.action,f=zmInit.getListingDetObj(),g=!0;switch(b=f.fId,e){case"view_all":c="all";break;case"view_unread":c="unread";break;case"view_flag":c="flag",d="-1";break;case"view_label":c="label",d="-1";break;case"view_attach":c="attach",d="1";break;case"view_archive":c="archive";break;case"listview":c=a.view,d=a.viewId;break;default:g=!1}g&&(zmList.unchkAll(),zmInit.foldView({folId:b,view:c,viewId:d}),zmInit.updateHeaderBand()),zmUtil.hideMenu()},ka=function(a,b){var c,d=[],e=[];"t"===a.charAt(0)?(a=a.substring(1),e.push(a)):d.push(a);var f="";zmail.mailObj[a]&&zmail.mailObj[a].streams&&(f="default");var g={};g.parentDOM=$(b),g.displayAs="popup",g.accType=f,g.labelState={mailList:[{id:a,ttag:Boolean(e.length)}]},g.onStateChange=function(a,b){zmmailAct.applyActions("label","click",{msgId:d,thd:e,lA:b?"add":"delete",lId:a,accType:f,disp:zmail.labInfo[a].dispName})},g.onCreate=function(a,b){zmlab.isValidName(a)&&zmlab.labelCreate(a,"",{reqDoneClbk:function(a,b){a&&(g.onStateChange(b,!0),c.hide())},color:b})},c=zmUtil.createFLComp("label",g),c.show()},la=function(a,b){var c=zmail.mailObj[a],d=zmail.mailObj[b];if(c&&d){0===d.S?d.TS=0:d.TS=void 0!==c.TS?c.TS:c.S,d.TC=c.TC||1,d.TTAGS=c.TTAGS||c.TAG,d.TSB=d.TSB||c.TSB||c.SB,d.FD===zmail.folId.sId?d.TSM=c.TSM||c.SM:d.TSM=d.TSM||c.TSM||c.SM,d.TSN=d.TSN||c.TSN||c.SN,d.TI=c.TI||!1,d.TF=c.TF||!1,d.TM=c.TM||!1,1===d.AT?d.TA=1:d.TA=void 0!==c.TA?c.TA:c.AT;var e=c.NFG?parseInt(c.NFG):0;if(!d.TI&&!d.TF&&!d.TM&&0!==e)switch(e){case 1:d.TI=!0;break;case 2:d.TM=!0;break;case 3:d.TF=!0}d.NFG&&(1===parseInt(d.NFG)?d.TI=!0:2===parseInt(d.NFG)?d.TM=!0:3===parseInt(d.NFG)&&(d.TF=!0)),d.FD===zmail.folId.dId&&(d.DC=Y(d.T))}},ma=function(a,b){var c=X(a,b);return!!c&&(la(c,a),!0)},na=function(a){var b=a.length,c=1,d=a[c];for(c=1;c<b;c++)if(zmail.mailObj[a[c]].FD!==zmail.folId.sId){d=a[c];break}return d},oa=function(a,b){a.src="conversation",a.opentype=zmail.mailOpt.isPopup,zmList.getMailData(a,b)},pa=function(a,b,c,d){var e,f,g;e=f=a.msgId,g=zmTab.currentTab.indexOf("zm_srch")?zmInit.getListingDetObj():zmSearchUtil.getSearchViewDetails(),e.indexOf("t")||(f=e.substring(1)),"unread"!==g.view||!c||f===c||zmail.mailObj[f].TH&&zmail.mailObj[f].T===zmail.mailObj[c].T||zmList.remReadMail(),zmList.getMailData(a,b,d)},qa=function(a,b,c,d,e,f){zmAjq.XHR({u:zmail.conPath+a,t:b,fn:c,onerror:d,p:e,ep:f})},ra=function(a,b,c,d,e,f){var g,h,i="t"===d?1:0;g=i?"downloadconv":"downloadall";var j,k='<div><div class="SC_PUtt"><div class="SCmb"><ul><li><b><div class="SC_hd"></div><span class="SC_ttip ttr" data-tooltip="Close"><i class="msi-close" data-msg="close"></i></span></b></li></ul></div></div></div></div>';h=i?"zm_threadAtt":"",j=zmAttach.build({appName:"ML_popup",attList:b,zipType:g,showMOpt:!0,showTag:!0,supportDrag:!0,attClass:"zmAch",attListClass:"zmPAtt "+h,fileNameLen:20,entityInfo:{id:f,isThd:i,et:1}}),k=$(k),k.append(j),setTimeout(function(){var a=$("#zm_dropDown");a.find(".zmPAtt").length||($("#zm_dropDown ul").removeClass(),$("#zm_dropDown ul").append(k),e(),c.position(),zmPreviewTemplate.setSlideShow(b,a))},200)},sa=function(a){var b=zmsuite.showMenu(a),c=document.getElementById("zm_dropDown"),d=zmComponent.loadingBand({container:c,type:"pagination"});return b.position(),[b,d]},ta=function(a,b,c,d,e,f){var g=function(g,h){if(h.reqId===j){var i;i="tc"===d?g[a]:g[b],i.length?(ra(c,i,f,d,e,b),D(a,b,i,g.shownext,d)):$("#zm_dropDown").remove()}},h=function(a,b){if(b.reqId===j){var c=a.msg;c&&_zm.succErrMsg("e",c),$("#zm_dropDown").remove()}},i={accId:zmail.accId,mode:"lstEntity",thb:!0};"t"===d?i.tId=b:i.mId=a,j++,qa("/attach.do","POST",g,h,i,{loadingBand:e,reqId:j})},ua=function(a){var b=zmail.mailObj[a]||{},c=function(){return b.AT};if(c(a)&&b.TH){var d=b.T;E(a,d,"t")&&(zmail.mailAttachments[d].data.addInfo.isFull=!1)}};$.subscribe("mail/spam",function(a,b){ua(b)}),$.subscribe("mail/notspam",function(a,b){ua(b)}),$.subscribe("mail/delete",function(a,b,c,d){5===d&&ua(b)}),$.subscribe("mail/archive",function(a,b){ua(b)});var va=function(a,b){var c,d,e,f=a.msgId,g=a.type,h="zm_Container"===zmTab.currentTab&&zmUtil.getFolId();if(!h||!zmUtil.isSharedFolder(h)){if("t"===f.charAt(0)){if("zm_Container"===zmTab.currentTab&&(h===zmail.folId.spId||"archive"===zmail.listDetails.view))return;f=f.substring(1),c="t"}var i={par:b,showArrow:!0,liDom:"",spanClass:"zm_attPop minwid zmAtt_mulMail",clk:function(a,b){var c=$(b).attr("data-msg");"close"===c?e[0].remove():zmAttach.util.removeMAct()}};if(e=sa(i),"t"===c?d=zmail.mailObj[f].T:"lt"!==g||zmail.mailObj[f].TH?(c="tc",d=zmail.mailObj[f].T):(c="sm",d=f),E(f,d,c)){var j=F(f,d,c);ra(b,j,e[0],c,e[1],d),e[1]()}else ta(f,d,b,c,e[1],e[0])}},wa=function(a,b){if(a&&zmail.mailObj[a]&&zmail.mailObj[a].SCOBJ[0]){var c,d=zmail.mailObj[a].SCOBJ[0];d.ASTATUS=!0,b.suppress||_zm.succErrMsg("s",f.quickactions.success),"CONFIRMACTION"===b.actName||"SAVEACTION"===b.actName?(c=$("#"+a+" span.zm_highlight"),!c.length&&zmail.mailObj[a].TH&&(c=$("#t"+a+" span.zm_highlight")),c.length&&c.each(function(a,b){$(b).html("<font class='SC_op3'>"+_zm.escapeTags(d.DN)+"</font>"),$(b).append("<i class='msi-tick zm_highlight'></i>")})):"REVIEWACTION"===b.actName?(d.RB=b.reviewBody||"",d.RR=b.reviewRating):"RSVPACTION"===b.actName&&(d.RSVPSTUS=b.rsvpStatus.toLowerCase(),c=$("#"+a+" span.zm_highlight"),!c.length&&zmail.mailObj[a].TH&&(c=$("#t"+a+" span.zm_highlight")),c.length&&c.each(function(a,c){$(c).text(f.quickactions.attending+" : "+b.rsvpStatus),$(c).append("<i class='msi-rsvp zm_highlight'></i>")}))}},xa=function(a,b,c){if(a&&b){c=c||{};var d={msgId:b,accountId:zmail.accId,actName:a.SCATYPE},e=$.extend({},d);c.evtstatus?(d.rsvpStatus=c.evtstatus.toLowerCase(),e.rsvpStatus=c.evtstatus):c.reviewRating&&(d.reviewRating=e.reviewRating=c.reviewRating,c.reviewBody&&(d.reviewBody=e.reviewBody=c.reviewBody));var f=function(a,c){"SUCCESS"===a.ASTATUS&&wa(b,c)},g=function(a){_zm.succErrMsg("e",a.msg)};if(!a.ASTATUS||"RSVPACTION"===a.SCATYPE){var h={u:zmail.conPath+"/executeActSchema.do",t:"POST",fn:f,onerror:g,p:d,ep:e};zmAjq.XHR(h)}}},ya=function(a,b,c){var d=$(a).data().value||"";d&&c&&!c.EXPIRED&&(xa(c,b,{evtstatus:d}),zmUtil.hideMenu())},za=function(a){if(a){var b=a.GURL||a.AURL;if(b=b?decodeURIComponent(b):a.ORDEROBJ&&a.ORDEROBJ.VIEWORDERURL||a.FLYTTKTOBJ&&a.FLYTTKTOBJ[0].url||a.PARCLDLVRYOBJ&&a.PARCLDLVRYOBJ.TRACKINGURL,a.ZMAIL_INTERNAL_SERVICE&&"task"===a.ZMAIL_INTERNAL_SERVICE){var c=zmHash.decode(b);if("stream"===c.key){var d=c.params;zmUtil.loadStreamsInTab({pid:d[1],gid:d[0],etype:d[2],actionType:d[3],commentId:d[4]})}else{var e=window.open(b,"_blank");e.focus()}}else{var f=window.open(b,"_blank");f.focus()}}},Aa=function(a,b){a&&xa(a,b)},Ba=function(a,b,c){var d=$(a).data().value||"";if("publish"===d){var e,g,h;if(h=$(a).closest("ul"),e=h.find("#zm_reviewbody").val(),g=h.find(".sel").length,0===g)_zm.succErrMsg("e",f.quickactions.alertrating);else if(c.REVPARAM){var i={};i=e?{reviewRating:g,reviewBody:e}:{reviewRating:g},xa(c,b,i),zmUtil.hideMenu()}}else if(0===d.indexOf("rate")){var j=d.substring(4)||0,k=$(a).closest("li").find(".msi-fav"),l=k.length,m=0;for(j=parseInt(j),k.removeClass("sel"),m=1;m<=j;m++)k.eq(l-m).addClass("sel")}},Ca=function(a,b,c){if(a&&c.length){var d,e={},g="",h="",i="",j="SC_Rating yetToRate",k=f.quickactions.reviewcomment,l="";for(a.ASTATUS&&(k=_zm.escapeTags(a.RB||""),l="readonly",h="sel",j="SC_Rating"),d=a.RWR;d<=a.RBR;d++)i=d<=a.RR?"msi-fav "+h:"msi-fav",g='<i class="'+i+'" data-value="rate'+d+'" title="'+d+'"></i>'+g;
var m=["<li><b>"+a.DN+"</b></li>",'<li style="width:200px">'+_zm.escapeTags(a.DESC||"")+"</li>",a.SHOWRB?'<li><textarea tabindex="0" placeholder="'+k+'" maxlength="1500" id="zm_reviewbody" '+l+"></textarea></li>":"",'<li><div class="'+j+'"><div>'+g+"</div></div></li>"];a.ASTATUS||(m=m.concat(['<li><div class="SC_PUbtm"><span data-value="publish">'+f.quickactions.submit+"</span></div></li>"])),m=m.join(""),e={par:c,showArrow:!0,liDom:$(m),spanClass:"minwid",ulClass:"noclass",clk:function(c,d){Ba(d,b,a)}},zmsuite.showMenu(e)}},Da=function(a,b,c){if(a&&c.length){var e,g,h,i,j,k={},l=a.EXPIRED,m="",n="",o="";e=new Date(a.SD),a.ED&&(g=new Date(a.ED));var p=function(){var a=(new Date).getTime(),b=e.getTime(),c=g&&g.getTime();return!!(a>=b&&(c&&a<c||!c))},q=p();if(l||q){m="zmsEventExpired",n="zmEvExp";var r;r=q?f.quickactions.ongoing:f.quickactions.expired,o='<div class="zmEventTag"><span>'+r+"</span></div>"}var s={0:"Jan",1:"Feb",2:"Mar",3:"Apr",4:"May",5:"Jun",6:"Jul",7:"Aug",8:"Sep",9:"Oct",10:"Nov",11:"Dec"},t={0:d.days.sun,1:d.days.mon,2:d.days.tue,3:d.days.wed,4:d.days.thu,5:d.days.fri,6:d.days.sat};h=s[e.getMonth()],i=e.getDate();var u=function(){var a=!0;return g&&(a=e.getFullYear()===g.getFullYear()&&e.getDate()===g.getDate()&&e.getMonth()===g.getMonth()),a},v=function(a){var b="",c="",d="";return c=a.getHours().toString(),1===c.length&&(c="0"+c),d=a.getMinutes().toString(),1===d.length&&(d="0"+d),b=c+":"+d},w=function(){var a="";return a=u()?[t[e.getDay()],v(e),"-",v(g)].join(" "):s[e.getMonth()]+" "+e.getDate()+" "+e.getFullYear()+" "+v(e)+" - "+s[g.getMonth()]+" "+g.getDate()+" "+g.getFullYear()+" "+v(g)};j=w();var x={yes:"",no:"",maybe:""};a.ASTATUS&&(x[a.RSVPSTUS]="sel");var y=['<div class="zmsEventAction '+m+'">'+f.quickactions.query+'<ul><li class="'+x.yes+'" data-value="Yes">'+f.quickactions.yes+"</li>","true"===a.SHOWMB&&a.MBURL?'<li  class="'+x.maybe+'" data-value="Maybe">'+f.quickactions.maybe+"</li>":"",'<li class="'+x.no+'" data-value="No">'+f.quickactions.no+"</li>","</ul></div>"].join(""),z=[a.PADDR.ADDRNAME?a.PADDR.ADDRNAME+",":"",a.PADDR.ADDRBOXNO?a.PADDR.ADDRBOXNO+",":"",a.PADDR.STREET?a.PADDR.STREET+",":"",a.PADDR.ADDRLOCALITY?a.PADDR.ADDRLOCALITY+",":"",a.PADDR.ADDRREGION?a.PADDR.ADDRREGION+",":"",a.PADDR.ADDRCOUNTRY?a.PADDR.ADDRCOUNTRY+",":"",a.PADDR.ADDRPCODE?a.PADDR.ADDRPCODE:""].join(" ");z=z.trim(),z.endsWith(",")&&(z=z.substring(0,z.length-1)+" "),z=_zm.escapeTags(z);var A=['<div class="zmsEventCal zmEventInfo '+n+'">',"<span>"+h+"</span><span>"+i+"</span>",o,"</div>"].join(""),B=['<div class="zmsEventDtl">','<div><i class="msi-clock"></i><strong>'+j+"</strong></div>",z.length?'<div><i class="msi-location"></i>'+z+"</div>":"",y,"</div>"].join(""),C=["<li><h3>"+a.DN+"</h3>",'<div class="zmsEventPost '+m+'"><div class="zmsEventWra">',A,B,"</div></div></li>"].join("");k={par:c,showArrow:!0,liDom:$(C),spanClass:"minwid",ulClass:"noclass",clk:function(c,d){ya(d,b,a)}},zmsuite.showMenu(k)}},Ea=function(a,b){var c,d=a.msgId;if(d&&0===d.indexOf("t")&&(d=d.substring(1)),c=zmail.mailObj[d],c&&c.SCOBJ){var e,f;switch(f=c.SCOBJ[0],e=f.SCATYPE){case"VIEWACTION":case"TRACKACTION":case"ORDER":case"FLIGHTRESERVATION":case"PARCELDELIVERY":za(f,e);break;case"SAVEACTION":case"CONFIRMACTION":Aa(f,d);break;case"REVIEWACTION":Ca(f,d,b);break;case"RSVPACTION":Da(f,d,b)}}},Fa=function(){zmsDialog.remove(),$("#sweeppopup").remove()},Ga=function(a,b,c){if((c||a.length)&&b.length){var d=[],e=[];if(c=c||a.find(".msi-option").data("value"),b.find(".msi-check").each(function(){d.push($(this).data("value")),e.push($(this).data("msg"))}),0===d.length)return void zmUtil.succErrMsg("i",f.sweep.selonesender);if(d.length>5)return void zmUtil.succErrMsg("i",f.sweep.sellimit);if(!c)return void zmUtil.succErrMsg("i",f.sweep.seloption);var g={mode:"sweep",senderList:d,actionType:c,msgId:e,thd:[]};zmmailAct.doActions("sweep","dropdown",g),Fa()}},Ha=function(a){var b,c="",d=0,e="msi-check";for(a.length>5&&(e="msi-uncheck"),d=0;d<a.length;d++)c+='<li class="senderid"><i class="'+e+'" data-msg="'+a[d].msgId+'" data-value="'+a[d].emailId+'"></i><label>'+a[d].emailId+"</label></li>";b=['<div id="sweeppopup" style="display:none">','<ul class="zm_formArea">',"<li>"+zmText.applyArgs(f.sweep.sweepmsg,{foldername:zmInit.findFolName(zmUtil.getFolId())})+"</li>"+c,"</ul>","</div>"].join(""),b=$(b);var g=b.find(".action_type"),i=b.find(".senderid");i.off("click").on("click",function(a){var b=a.srcElement||a.target;b=$(b),b.length&&(b=b.closest("i").length?b.closest("i"):b.closest("li").find("i"),b.hasClass("msi-check")?b.removeClass().addClass("msi-uncheck"):b.hasClass("msi-uncheck")&&b.removeClass().addClass("msi-check"))}),g.off("click").on("click",function(a){var b=a.srcElement||a.target;b=$(b),b.length&&(b=b.closest("i").length?b.closest("i"):b.prev(),(b.hasClass("msi-option")||b.hasClass("msi-unoption"))&&(g.find("i").removeClass().addClass("msi-unoption"),b.removeClass().addClass("msi-option")))}),$("body").append(b);var j={title:f.sweep.title+" - "+zmInit.findFolName(zmUtil.getFolId()),style:{width:"500px"},buttons:[{txt:h.common.archive,selected:!1,callback:function(){Ga(g,i,"archive")}},{txt:h.common["delete"],selected:!1,callback:function(){Ga(g,i,"delete")}},{isCancel:!0,txt:h.common.cancel,callback:function(){Fa()}}],drag:!0,mask:!0,hideclose:!1,pos:"center",closeaction:function(){Fa()}};zmsDialog.create("sweeppopup",j)},Ia=function(a){var b,c=[],d=[],e=0,g=0;a||(a=zmUtil.getSelectedMails(),a=a[0].concat(a[1])),g=a.length;var h=function(a){return a=a.replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&quot;/gi,'"'),a.indexOf("<")!==-1&&(a=a.substring(a.lastIndexOf("<")+1,a.lastIndexOf(">"))),a=a.trim()};for(e=0;e<g;e++)b=zmail.mailObj[a[e]].F,b&&(b=h(b),c.indexOf(b)===-1&&(c.push(b),d.push({msgId:a[e],emailId:b})));0===c.length?zmUtil.succErrMsg("i",f.sweep.selone):Ha(d)},Ja={selDetails:{},excludeSent:!1,listingFocused:!0,showNotificationPopup:function(a){var b={},c={};b={msgId:a.pid,opentype:3,type:"lt",tabId:"zmncenter",src:"zmncenter",commentuuid:a.commentuuid},b.eprm={accId:zmUtil.getZohoAccId(),isSh:!0,groupId:a.gid,shareId:a.shId,thId:a.pid},a.gid!==zmail.zuid&&(b.eprm.shId=a.shId),c.prevElem=a.elm,c.viewDetails={view:"notification"},zmList.getMailData(b,c)},getNotifyPopupContainer:function(a,b,c,d){var e=a.SUBJECT,f=["DIV",{attrs:{"class":"SC_ptit"},child:[["DIV",{attrs:{"class":"SCmb SC_frt"},child:[["UL",{child:[["LI",{child:[["B",{child:[["SPAN",{attrs:{"class":"SC_ttip ttr"},child:[["I",{attrs:{"class":"msi-more","data-shared":c}}]]}]]}]]}]]}]]}],["DIV",{child:[["DIV",{attrs:{"class":"SC_phd"},child:[["text",e]]}]]}]]}],g=["DIV",{attrs:{"class":"SCS_postMail",type:"fixedComment"}}];b.appendChild(_zm.getDOM(f)),b.appendChild(_zm.getDOM(g)),d.contElem=$(d.prevElem.childNodes[1])},isMailOpenInTab:function(a){var b;return b=zmail.mailObj[a]&&zmail.mailObj[a].TH?"zm_tabt"+zmail.mailObj[a].T:"zm_tab"+a,zmsuite.isWorkspaceAvailable(b)},getMailData:function(a,b,c){var d,e,g,h,i,j,l,m="",n={},o={},p=a.type,q=a.opentype,r={},s=a.tabId||zmTab.currentTab,t=!1,v=!1;m=a.msgId,d=a.from;var w=a.invokedFrom||"";if(o.invokedFrom=w,r=b&&b.viewDetails||{},("external"===a.src||"restore"===a.src||"zmncenter"===a.src&&!zmail.mailObj[m])&&("restore"===a.src&&(e=a.fId,r=a.viewDetails||{},l=a.toOpen),u(m,a.tId,e),zmail.mailObj[m]=$.extend(zmail.mailObj[m],a.eprm)),Object.keys(r).length||("zm_Container"===s?r=zmInit.getListingDetObj():s.indexOf("zm_tab")!==-1?r=zmsuite.getCenterOuter(s).$el.data("data-detail"):s.indexOf("zm_srch")!==-1?r=zmSearchUtil.getSearchViewDetails():s.indexOf("zmncenter")!==-1&&(r=b?b.viewDetails:{view:"zmncenter"})),r=r||{},"search"===r.view&&zmSearchUtil.isWorkspaceAvailable()&&(a.tabId="zm_srch1"),b=b||C(a),"restore"===a.src&&(b.viewDetails=r),m&&!m.indexOf("t")&&(m=m.substring(1,m.length)),"search"===r.view&&"th"===p&&(b.listArr=zmList.getViewBasedMsgList(zmail.mailObj[m].T,b.viewDetails,!1)),h=m,m&&zmail.mailObj[m]&&(a.vfc||!ba(a.opentype,a,b)||("lt"!==p||zmail.mailObj[m].TH)&&"th"!==p)){if(1===zmail.mailObj[m].TH&&"external"===a.src&&(a.msgId="t"+a.msgId),e||(e=zmail.mailObj[m].FD),zmUtil.isInlineCompose()||e!==zmail.folId.dId||"lt"!==p||b.viewDetails.fId===zmail.folId.dId||"search"===b.viewDetails.view||(m=zmail.mailObj[m].T,e="",zmail.mailObj[m]||(zmail.mailObj[m]={M:m,FD:"",S:1,TH:1,T:m,SB:zmail.mailObj[h].SB})),0===q&&(!zmUtil.isMailOpenInPreview(m,s)||"zm_Container"===s&&zmList.isListingChecked(b.listElem))&&$(b.prevElem).attr({"data-mid":"","data-ty":""}),e!==zmail.folId.dId||r.fId!==zmail.folId.dId&&zmUtil.isInlineCompose()&&"search"!==r.view)if(e===zmail.folId.teId)zmUtil.invokeComposer({msgId:m,mode:"template"});else{if(b.rowElem&&b.rowElem.length&&b.rowElem.is(":visible")&&0===a.opentype&&($(b.listElem).find("div.zmL").removeClass("zmSLst"),$(b.listElem).find(b.rowElem).addClass("zmSLst")),n={accId:zmail.accId,split:!0,summary:!0},"external"!==a.src&&"zmncenter"!==a.src||(a.eprm?n=$.extend(n,a.eprm):n.accId=zmUtil.getZohoAccId()),g=zmail.mailObj[m],0!==zmUtil.getMLConversionValue()&&"search"!==r.view&&"archive"!==r.view&&1!==g.TS&&g.TH&&"lt"===p&&("1"===zmAdHocSettings.getMarkConversationRead()?zmail.listObj[g.T]?m=L(m,r):n.getUnread="latest":zmail.listObj[g.T]?m=K(m,r):n.getUnread="oldest"),zmUtil.isInlineCompose()&&("lt"===p?zmail.mailObj[m].DC&&zmail.mailObj[m].DC>0&&(n.hasdraft=!0,zmail.mailObj[m].T&&(n.thId=zmail.mailObj[m].T),zmail.mailObj[m].FD===zmail.folId.dId&&(m=zmail.mailObj[m].PA?zmail.mailObj[m].PA:zmail.mailObj[m].T,zmail.mailObj[m]||u(m),zmail.mailObj[m].TH=1,zmail.mailObj[m].T=n.thId)):"th"===p&&zmail.mailObj[m].DMID&&(n.hasdraft=!0,zmail.mailObj[m].T&&(n.thId=zmail.mailObj[m].T))),g=zmail.mailObj[m],n.msgId=m,"zmncenter"===a.src){var x=n.groupId!==zmail.zuid;e=e||zmUtil.getFolderForShID(n.shId,x)}e&&(g.FD||(g.FD=e),r.fId&&zmUtil.isSharedFolder(r.fId)&&92===zmail.shrTree[0][r.fId].RT?(n.label=r.fId,e=r.fId):n.folId=e),o={msgId:m,att:g.AT,tg:g.TAG,flg:g.NFG,type:p,sm:g.SM,opentype:a.opentype,from:d,noanim:a.noanim,rowId:a.msgId,prevId:h,src:a.src,reqSent:!0,invokedFrom:w,tabId:s,prevDefObj:c,toOpen:l,commentuuid:a.commentuuid,mode:n.mode,getUnread:n.getUnread,isReminder:a.isReminder},(a.isReminder||g.TH&&"content"!==p&&r.fId!==zmail.folId.tId&&("conversation"===a.src||"restore"===a.src&&"conversation"===l||0!==zmUtil.getMLConversionValue()&&"search"!==r.view&&r.fId!==zmail.folId.sId))&&(!zmail.listObj[g.T]||zmail.mailObj[g.T]&&zmail.mailObj[g.T].streams)&&(n.thId=g.T),"zmncenter"!==a.src&&(zmContentCache.isCached(m)&&zmContentCache.get(m).shareId&&(n.isSh=!0,n.shareId=j,n.groupId=zmail.mailObj[m].groupId),zmUtil.isSharedFolder(e)?(n.shId=o.shId=zmUtil.getShareId(e),n.isSh=!0,n.shareId=n.shId,n.groupId=zmail.shrTree[0][e].OZUID):r.fId&&zmUtil.isFolderId(r.fId)?(i=zmList.getRowInfo(r.fId,"zmlTreeH","info"),j=i?i.SH:"",j&&"-1"!==j&&(n.isSh=!0,n.shareId=j,n.groupId=zmail.zuid)):r.label&&zmUtil.isLabelId(r.label)?(i=zmList.getRowInfo(r.label,"zmllabelH","info"),j=i?i.shId:"",j&&"-1"!==j&&(n.isSh=!0,n.shareId=j,n.groupId=zmail.zuid)):"search"===r.view&&zmUtil.isFolderId(zmail.mailObj[m].FD)&&(i=zmList.getRowInfo(zmail.mailObj[m].FD,"zmlTreeH","info"),j=i?i.SH:"",j&&"-1"!==j&&(n.isSh=!0,n.shareId=j,n.groupId=zmail.zuid))),n.isSh&&(n.entityId=g.T?g.T:m,n.entityType=1,o.shOwner=n.groupId,o.shId=n.shId||j||"",o.shareId=n.shareId||"",zmContentCache.isCached(m)&&"notification-popout"!==w&&zmContentCache.remove(m),n.isSh="content"!==p&&n.isSh),o.isSh=n.isSh||!1,zmail.mailObj[m].FD===zmail.folId.oId?o.opentype=0:0===zmail.mailObj[m].S&&(n.markread=!0,zmail.mailObj[m].AR&&(n.archiveStatus=!0)),a.vfc&&(n.vfc=o.vfc=a.vfc,o.forceFetch=!0),o.elemObj=b;var y=b.viewDetails.view;if("stream"!==y&&3!==q&&"zmStreamsApp"!==s&&!g.streams||!zmail.mailObj[m].actionType||a.src||(n.accId=zmail.mailObj[m].accId,delete n.folId,n.actionType=zmail.mailObj[m].actionType,n.streamsView="true",n.groupId=zmail.mailObj[m].groupId,n.entityId=m,n.entityType=zmail.mailObj[m].entityType),zmail.mailObj[m].TH||0!==zmail.mailObj[m].S||zmail.mailObj[m].FD===zmail.folId.oId||0!==a.opentype||(zmmailAct.rapplyAction({result:"success"},{mailId:[m],thd:[],action:"read",from:"mail_preview"}),o.markread=!0),0===a.opentype&&k(o),"zmncenter"===a.src||!zmContentCache.isCached(m)||n.hasdraft||n.vfc||(n.thId?zmail.listObj[n.thId]?t=!0:o.forceFetch=!0:t=!0),a.actionSrc&&(n.actionSrc=a.actionSrc),1===a.opentype)N({from:"list"},$("#"+a.msgId));else if(2!==a.opentype&&0!==a.opentype||a.vfc||"content"===p||!zmail.mailObj[m].TH||0===zmUtil.getMLConversionValue()||"search"===b.viewDetails.view||b.viewDetails.fId===zmail.folId.sId||b.viewDetails.fId===zmail.folId.tId||!(2===a.opentype&&"restore"!==a.src&&zmList.isMailOpenInTab(m)||0===a.opentype&&zmUtil.isMailOpenInPreview(m,s)))if(!t||a.vfc||n.thId){if(0===a.opentype&&"content"!==p){var z=zmsuite.getCenter(s)[1].getNodes(),B=zmail.mailObj[m].SB||f.common.noSubject,D=["DIV",{attrs:{"class":"SC_phd"},child:[["text",B]]}];zmInit.prevHeader.text=D,z[0].push(zmInit.prevHeader),n.vfc||(z[1].getDOMNode().html(""),zmComponent.loadingBand({container:z[1].getDOMNode()[0],type:"pagination"}),zmsuite.getCenter(s)[1].show()),"content"===p||n.vfc||n.isSh||G({state:"opening",mId:m,openedBy:w})}if("lt"===a.type&&"zm_Container"===s&&!n.isSh)try{v=!0;var E;E=M(h||m,"mailIds")||[],E.length&&(n.mailId=E.join(),o.setSessionId=!0)}catch(F){zmUtil.debugLog("Error while prefetch content for "+h||m,F)}A(n,o,H)}else o.reqSent=!1,"content"!==p&&G({state:"opening",mId:m,openedBy:w}),H({},o);else{var I,J,O,P=a.type;0===a.opentype?(I="#zmHdr"+("search"===b.viewDetails.view?"S":"P")+m,J=$(I),zmPrev.removeCountinPreview(b),"lt"!==P&&(J.length||(O=zmPreviewTemplate.getMissingMailList(zmail.mailObj[m].T,"P"),zmPreviewTemplate.removeNotifBand(b.prevElem),zmPreviewTemplate.addMailsInView({list:O,opentype:a.opentype}),J=$(I)),J.length&&(J.find(".zmpr:first").trigger("click"),J.removeClass("zm_tm"),zmPreviewTemplate.alignMailTopToPreview(String(m))),zmRestore.saveState("preview",{p:m},{})),J.parent().addClass("js-scrolltop"),zmList.setMailSelection(m,P,$(b.listElem)),zmPreviewTemplate.setPreviewHeaderHeight(b),zmList.listingFocused=!0):(I="#zmHdr"+("search"===b.viewDetails.view?"S":"T")+m,J=$(I),"lt"!==P&&(J.length||(O=zmPreviewTemplate.getMissingMailList(zmail.mailObj[m].T,"T"),zmPreviewTemplate.removeNotifBand(b.prevElem),zmPreviewTemplate.addMailsInView({list:O,opentype:a.opentype}),J=$(I)),J.length&&(J.find(".zmpr:first").trigger("click"),J.removeClass("zm_tm"))),J.parent().addClass("js-scrolltop"),zmList.listingFocused=!0)}}else zmUtil.invokeComposer({msgId:m,mode:"draft"});if(!v&&"lt"===a.type&&"zm_Container"===s&&!n.isSh){var Q=h||m;try{M(Q,"sendReq")}catch(F){zmUtil.debugLog("Error while prefetch content for "+Q,F)}}}},constructThreadChildRow:function(a,b){var d,e={},g={},h=[],i=zmInit.getListingDetObj(),j="";e=zmCenterListing.create({type:"submail",mapObj:zmInit.mapObj,classObj:zmInit.classObj}),g=$.extend({},zmail.mailObj[a]),g.data="th",j=g.FD,""!==i.fId&&2!==zmUtil.getMLConversionValue()||(g.FN=zmInit.findFolName(zmail.mailObj[a].FD)),h=zmInit.getMailRowIcons(i.fId),1===g.NS2?g.S=0===g.S?2:4:2===g.NS2?g.S=0===g.S?3:5:3===g.NS2&&void 0!==g.RR&&(g.S=0===g.S?7:8),j===zmail.folId.oId||j===zmail.folId.dId||j===zmail.folId.teId?g.fromaddr=g.TO||g.TOADDR||"":g.fromaddr=g.F||g.SN||"",j===zmail.folId.oId?g.F=zmail.mailObj[a].TOADDR||zmail.mailObj[a].TO||f.common.undisclosed:(i.fId===zmail.folId.spId?(g.NFG="-1",g.TAG=[]):i.fId===zmail.folId.teId||i.fId===zmail.folId.dId?(g.NFG="-1",g.S=""):j===zmail.folId.sId&&(g.S=""),g.F=zmail.mailObj[a].SN||zmail.mailObj[a].F),g.UW=zmList.isRMOBJ(a),(zmail.mailObj[a].MA||g.UW)&&(g.HT="1");try{g.F===zmail.aInfo[zmail.accId].mailId&&(g.F="Me")}catch(k){}if(zmail.mailObj[a].SCOBJ&&zmail.mailObj[a].FD!==zmail.folId.spId&&j!==zmail.folId.sId){var l=zmail.mailObj[a].SCOBJ[0]||{};if("REVIEWACTION"===l.SCATYPE)g.schemaTip=_zm.escapeTags(l.DESC||""),g.schemaText=f.quickactions.review,l.SHOWRB?g.actionIcon=g.actionIconColor="review_comment":g.actionIcon=g.actionIconColor="review";else if("RSVPACTION"===l.SCATYPE){if(l.EXPIRED)g.schemaTip=f.quickactions.eventexpired,g.schemaText=f.quickactions.rsvp,g.expired=1;else{g.schemaTip=_zm.escapeTags(l.DESC||"");var m={yes:f.quickactions.yes,no:f.quickactions.no,maybe:f.quickactions.maybe};l.RSVPSTUS?g.schemaText=m[l.RSVPSTUS]:g.schemaText=f.quickactions.rsvp}g.actionIcon=g.actionIconColor="rsvp"}else"CONFIRMACTION"===l.SCATYPE||"SAVEACTION"===l.SCATYPE?(g.schemaText=_zm.escapeTags(l.DN||""),g.schemaTip=_zm.escapeTags(l.DESC||""),g.actionIcon=g.actionIconColor="one_click"):"VIEWACTION"===l.SCATYPE||"TRACKACTION"===l.SCATYPE?(g.schemaText=_zm.escapeTags(l.DN||""),g.schemaTip=_zm.escapeTags(l.DESC||""),g.actionIcon=g.actionIconColor="goto"):"ORDER"===l.SCATYPE?(l.ORDEROBJ&&l.ORDEROBJ.VIEWORDERURL&&(g.schemaText=f.quickactions.orderV,g.actionIcon=g.actionIconColor="goto"),g.F=g.SB,g.MUI=0,g.fromaddr=""):"PARCELDELIVERY"===l.SCATYPE?(l.PARCLDLVRYOBJ&&l.PARCLDLVRYOBJ.TRACKINGURL&&(g.schemaText=f.quickactions.orderT,g.actionIcon=g.actionIconColor="goto"),g.F=g.SB,g.MUI=0,g.fromaddr=""):"FLIGHTRESERVATION"===l.SCATYPE&&(l.FLYTTKTOBJ&&l.FLYTTKTOBJ[0].url&&(g.schemaText=zmMarkup.flightReserv.urlType(l.FLYTTKTOBJ[0]),g.schemaTip=_zm.escapeTags(l.DESC||""),g.actionIcon=g.actionIconColor="goto"),g.F=g.SB,g.MUI=1,g.fromaddr="")}if(g.selBoxVisibility=!0,zmUtil.isSharedFolder(j,"R")&&(g.selBoxVisibility=!1),g.iconArr=h,e.setDataObj(g),d=$(e.getHTML()),"h"===zmail.viewInfo[0].DT&&d.find(".zmDate").hide(),"h"===zmail.viewInfo[0].SZ&&d.find(".zmSze").hide(),zmail.mailObj[a]&&j===zmail.folId.sId&&d.addClass("zmsnt"),void 0===b){var n=c.getViewParentOf(a);b=n&&n.isSelected||!1}return zmCenterListing.mailObjectAPI.setViewObject("c"+a,{id:"c"+a,$element:d,isSelected:b,isExpanded:!0}),d},bindEventsMailRow:function(a,b){var c,d,e,f,g,h,i,j=a.target||a.srcElement;if(c=$(j),d=c.attr("class")||"",e=ca(j),zmList.listingFocused=!0,!e.msgId){if("SC_nmsg"!==c.parent().attr("class"))return;d="SC_nmsg"}if(h=e.msgId,e.msgId.indexOf("t")||(h=e.msgId.substring(1)),i=h&&zmail.mailObj[h]&&zmail.mailObj[h].FD,(e.msgId||b)&&(b=b||zmList.getListingElemObj(e),b.rowElem=c.closest(".zmL")),c.closest(".zm_lbl").length&&(d="zm_lbl"),d.indexOf("msi-rpd")===-1&&d.indexOf("msi-fwd")===-1&&d.indexOf("msi-fwdRpd")===-1||(d="msi-mail"),d.indexOf("zmtCt")!==-1)"1"===c.text()?(f=zmPrev.prevDetails().msgId,f&&f!==h?$.when(zmPrev.cmpClose()).then(function(a){a&&(zmContentCache.remove(f),zmList.getMailData(e,b))}):zmList.getMailData(e,b)):zmList.showHideThread(c,b);else if(d.indexOf("msi-uncheck")!==-1||d.indexOf("zmFlt")!==-1){if(zmUtil.isReadOnlyMail(h))return;e=ca(c),b=zmList.getListingElemObj(e),zmList.chkBox(c,b,a)}else if(d.indexOf("zmflg")!==-1){if(zmUtil.isReadOnlyMail(h))return;c.is(".zm_fgG,.zm_fgB,.zm_fgR,.zm_fgM")?zmList.flagMail(c,"0"):zmList.flagMail(c,"2")}else if(d.indexOf("msi-trash")!==-1)zmUtil.isSharedFolder(i)||R(c);else if(d.indexOf("msi-edit")!==-1)zmUtil.invokeComposer({msgId:e.msgId,mode:"outbox"});else if(c.parent().attr("class")&&c.parent().attr("class").indexOf("zmSndSts")===-1&&d.indexOf("msi-mail")!==-1||d.indexOf("msi-calendar")!==-1||d.indexOf("msi-cart")!==-1||d.indexOf("msi-flight")!==-1)zmUtil.isReadOnlyMail(h)||V(c);else if(d.indexOf("zm_lbl")!==-1){if(!zmUtil.isSharedFolder(i)){var k=c.closest(".zm_lbl"),l=String(e.msgId);ka(l,k)}}else d.indexOf("SC_mdata")!==-1?zmList.associateDialog({msgId:h,elemObj:b,rowDet:e,elem:c,loadType:"list",openWatch:"header_all"}):d.indexOf("msi-thread")!==-1?(f=zmPrev.prevDetails().msgId,f?$.when(zmPrev.cmpClose()).then(function(a){a&&oa(e,b)}):oa(e,b)):d.indexOf("msi-mailReminder")!==-1?zmWatch.showWatch({msgId:h,elemObj:b,rowDet:e,elem:c,loadType:"popup",openWatch:"header_list"}):d.indexOf("zm_highlight")!==-1?Ea(e,c):0===d.indexOf("zmSndSts")||0===d.indexOf("msi-mail")&&c.parent().attr("class")&&c.parent().attr("class").indexOf("zmSndSts")!==-1?zmList.getMailDeliveryStatus(e.msgId):"msi-attachicon"===d?va(e,c):"SC_nmsg"===d?zmList.showMailListing():(f=zmPrev.prevDetails().msgId,g=zmUtil.getMLConversionValue(),f&&((0===zmail.mailObj[f].TH||0===g)&&f!==h||0!==g&&zmail.mailObj[f].T!==zmail.mailObj[h].T)?$.when(zmPrev.cmpClose()).then(function(a){a&&(zmContentCache.remove(f),pa(e,b,f))}):pa(e,b));zmInit.isLeftFocused=!1},isRMOBJ:function(a){var b=!1;if(zmail.mailObj&&zmail.mailObj[a]&&zmail.mailObj[a].RMOBJ&&!$.isEmptyObject(zmail.mailObj[a].RMOBJ)){var c=zmail.mailObj[a].RMOBJ.WT;1!==c&&2!==c&&3!==c||(b=!0)}return zmail.folId.oId!==zmail.mailObj[a].FD&&zmail.folId.dId!==zmail.mailObj[a].FD&&zmail.folId.spId!==zmail.mailObj[a].FD&&zmail.folId.tId!==zmail.mailObj[a].FD&&zmail.folId.teId!==zmail.mailObj[a].FD||(b=!1),b},associateDialog:function(a){var b,c,d,e,g=a.msgId,h=zmList.isRMOBJ(g),i={text:f.mailAssociates.titleReminder,selected:!0,tabName:"watch",onClk:function(b){zmWatch.listDialog(a,b)},buttons:[{text:f.mailAssociates.updateReminder,onClk:function(b){var c=a.msgId,d=b.getButtonContainer().find("span").eq(0);d.attr("id","zmWatch_save_"+c),zmWatch.addWatch(c,d)}}]},j=function(){$.unsubscribe("zm/closeAllOpenDialog",e)};if((32|zmail.mailObj[a.msgId].MA)===zmail.mailObj[a.msgId].MA&&(b={text:f.mailAssociates.titleTask,hideCloseButton:!0,tabName:"task",onClk:function(b){b.showLoadingBand("task");var c=function(){b.removeLoadingBand("task"),b.hideButtons("task")},d=b.getCenterElem("task"),e={mailId:a.msgId,mountingElem:d,listParam:{showHeader:!1,dialog:b},preCallBk:c};zmList.taskAssociates(a.msgId,e)},icons:[{iconClass:"msi-add",selected:!0,text:f.mailAssociates.addTask,onClk:function(b){zmUtil.loadTask({action:"addAsTask",addparams:{msgid:a.msgId,accid:zmail.accId,senderid:zmail.mailObj[a.msgId].F},groupId:zmail.zuid,tasks:{SUMMARY:zmail.mailObj[a.msgId].SM,TITLE:zmail.mailObj[a.msgId].SB}},function(c){b.getCenterElem("task").html(c.$el),c.setHeightforEle(),b.replaceButtons([{text:f.mailAssociates.add,onClk:function(){var d=b.getCenterElem("task"),e={mailId:a.msgId,mountingElem:d,listParam:{showHeader:!1,dialog:b}};c.addTask(zmList.taskAssociates.bind(zmList,a.msgId,e))}},{text:f.mailAssociates.cancel,onClk:function(){var c=b.getCenterElem("task"),d={mailId:a.msgId,mountingElem:c,listParam:{showHeader:!1,dialog:b}};zmList.taskAssociates(a.msgId,d)},attr:{"data-val":"Cancel"}}],"task")}),b.showButtons("task")}}]}),(64|zmail.mailObj[a.msgId].MA)===zmail.mailObj[a.msgId].MA){var k,l;c={text:f.mailAssociates.titleNotes,hideCloseButton:!0,tabName:"notes",onClk:function(b){b.showLoadingBand("notes"),k=function(){b.removeLoadingBand("notes"),b.hideButtons("notes")},l=function(a){b.configOption.onClose=function(){j(),ReactDOM.unmountComponentAtNode(b.getCenterElem("notes")[0])}},zmList.notesAssociates(a.msgId,{mountingElem:b.getCenterElem("notes"),preCallback:k,postCallback:l})},icons:[{iconClass:"msi-add",selected:!0,text:f.mailAssociates.addNotes,onClk:function(b){zNote.loadAddNote({addparams:{msgid:a.msgId,accid:zmail.accId,senderid:zmail.mailObj[a.msgId].F}}),b.showButtons("notes")}}]}}(4|zmail.mailObj[a.msgId].MA)===zmail.mailObj[a.msgId].MA&&(d={text:zmText.applyArgs(f.mailAssociates.titleProjects,{companyName:zmail.globalI18N.companyName}),tabName:"projectsEntity",hideCloseButton:!0,onClk:function(b){b.showLoadingBand("projectsEntity"),zmUtil.loadProjects(function(){b.removeLoadingBand("projectsEntity"),zmail.projectsInteg.util.listProjectsEntities(a.msgId,b.getCenterElem("projectsEntity"))})}});var m={};m.tabs=[],h&&m.tabs.push(i),b&&m.tabs.push(b),m.onClose=function(){j(),b&&zmtCom.unsubscribeTaskListeners()},m.ignoreMouseDown=!0,zmUtil.isNoteReactUser()&&(64|zmail.mailObj[a.msgId].MA)===zmail.mailObj[a.msgId].MA&&m.tabs.push(c),(4|zmail.mailObj[a.msgId].MA)===zmail.mailObj[a.msgId].MA&&m.tabs.push(d),h||(m.tabs[0].selected=!0);var n=zmsDialog.createTabPopupDialog(m);e=function(){n.close()},$.subscribe("zm/closeAllOpenDialog",e)},taskAssociates:function(a,b){var c={taction:"getTasksAssociatedMail",msgid:a,accid:zmail.accId,streamsView:!0},d=$.extend(!0,{},b);zmAjq.XHR({u:zmail.conPath+"/getTasks.do",t:"POST",fn:zmList.showTaskAssociates,p:c,ep:d})},notesAssociates:function(a,b){var c={mode:"getMailNotes",messageId:a,accid:zmail.accId,streamsView:"Notes"},d=$.extend(!0,{},b);d.mailId=a,d.accId=zmail.defAccId,zmAjq.XHR({u:zmail.conPath+"/NotesAction.do",t:"POST",fn:zmList.showNotesAssociates,p:c,ep:d})},showNotesAssociates:function(a,b){b.preCallback();var c={id:"mailassociated",msgid:b.mailId,accid:b.accId,senderid:zmail.mailObj[b.mailId].F},d=b.listParam;zNote.getNoteList(a,{options:d,listInfo:c},b.mountingElem,b.postCallback)},showTaskAssociates:function(a,b){var c="";b.preCallBk&&b.preCallBk(),b.listParam&&b.listParam.dialog&&(b.listParam.dialog.removeLoadingBand("task"),b.listParam.dialog.hideButtons("task")),zmUtil.requireTaskModule().done(function(){c=zmTask.generateTaskList(a,b),b.mountingElem&&(b.mountingElem.empty(),b.mountingElem.append(c))}),b.postCallBk&&b.postCallBk(c)},getMailDeliveryStatus:function(a,b,c){if(a){0===a.indexOf("t")&&(a=a.subtring(1));var d={accId:zmail.accId,mode:"getMailDeliveryStatus",msgId:a};zmAjq.XHR({u:zmail.conPath+"/mailUtilAction.do",t:"POST",fn:zmList.showDeliveryStatusDialog,p:d,ep:{msgId:a,refresh:b,dInst:c},csr:"s"})}},showDeliveryStatusDialog:function(a,b){if(!a.error&&a.MDS){1===a.MDS&&a.userstatus&&a.userstatus.toLogs.length&&(a.MDS=5);var c,d,e,g={},h=a.MDS,i=b.msgId,j="",k=b.dInst||{},l=f.mailDeliveryStatus.common.learnmore,m={},n="",o={0:"",1:f.mailDeliveryStatus.statusTitle.queued,2:f.mailDeliveryStatus.statusTitle.inprogress,3:f.mailDeliveryStatus.statusTitle.inprogress,4:f.mailDeliveryStatus.statusTitle.inprogress,5:f.mailDeliveryStatus.statusTitle.success,6:f.mailDeliveryStatus.statusTitle.failure,7:f.mailDeliveryStatus.statusTitle.failure,8:f.mailDeliveryStatus.statusTitle.undo,9:f.mailDeliveryStatus.statusTitle.retry,10:f.mailDeliveryStatus.statusTitle.retry},p={0:"",1:f.mailDeliveryStatus.statusContent.queued,2:f.mailDeliveryStatus.statusContent.inprogress,3:f.mailDeliveryStatus.statusContent.inprogress,4:f.mailDeliveryStatus.statusContent.inprogress,5:f.mailDeliveryStatus.statusContent.success,6:f.mailDeliveryStatus.statusContent.failure,7:f.mailDeliveryStatus.statusContent.failure,8:f.mailDeliveryStatus.statusContent.undo,9:f.mailDeliveryStatus.statusContent.retry,10:f.mailDeliveryStatus.statusContent.retry};6!==h&&7!==h||(n='<font id="helpDF" class="SC_ldot">'+l+"</font>"),d=b.refresh||!1,a.userstatus.toLogs?(e=a.userstatus.toLogs||[],j=a.userstatus.nrcpts||""):(e=a.userstatus||[],j=e.length);var q=function(a){var b="",c=zmail.ContactBook.get({eid:a,promise:!1})[0];return b=c?c.attrs.fn||c.attrs.nn||c.attrs.eid:zmConUtil.parseContacts(a)[0].fn||a},r=function(a){var b="";return b="<div>"+q(a)+"<font><b> - </b>"+a+"</font><span>"+a+"</span></div>",b+='<img src="">'},s=function(a,b){if(!a&&!b)return"";var c="",d={TEMP_FAILURE:"msi-mailRetry",SUCCESS:"msi-mailSuc",PERM_FAILURE:"msi-mailFail"},e={TEMP_FAILURE:"zmSndSts-fail",SUCCESS:"zmSndSts-suc",PERM_FAILURE:"zmSndSts-fail"};return c='<div class="zmDel_status">',b&&(c+='<span class="zmSndSts_PopupIcon"><div class="zmSndStsCon '+e[b]+'"><span class="zmSndStsIco"><i class="'+d[b]+'"></i></span></div></span>'),a&&(c+='<span class="zmDel_time">'+a+"</span>"),"TEMP_FAILURE"!==b&&"PERM_FAILURE"!==b||(c+='<span class="zmDel_failLnk">'+f.mailDeliveryStatus.common.knowwhy+"</span>"),c+="</div>"},t=function(a){var b="";return a&&(b='<div class="zmDel_failMsg"><p>'+a+"</p></div>"),b},u=function(a){var b="";return b+='<li eid="'+a.rcpt+'">',h>1&&h<10&&8!==h&&(b+=s(a.deliveryTime,a.status)),b+=r(a.rcpt)+"</li>",6!==h&&7!==h&&10!==h&&9!==h||(b+=t(a.reason)),b},v=function(a){var b,c=e.length,d=0,f=!1;for(d=0;d<c;d++)if(b=e[d],b.rcpt===a){f=!0;break}return f},w=function(){var b,c,d=e.length,f="";for(b=0;b<d;b++)c=e[b],f+=u(c),m[c.rcpt]=c.status;if(h>0&&h<5||8===h||9===h||10===h)for(d=a.undelivered.length,b=0;b<d;b++)c=a.undelivered[b],v(c)||(f+=u({rcpt:c,status:"",reason:"",deliveryTime:""}),m[c]="PERM_FAILURE");return f},x=function(){var a=$("#mail_delivery_status");return a.length||(a=$('<div id="mail_delivery_status" class="delStatus_content" data-msg="'+b.msgId+'">')),a},y=function(){var a,b,c="",d="",g=f.mailDeliveryStatus.common.member,i=f.mailDeliveryStatus.common.members,k="",l=0,m=0;if(7===h){for(a=0;a<j;a++)b=e[a]||{},"PERM_FAILURE"===b.status?(k+=u(b),m++):"SUCCESS"===b.status&&(d+=u(b),l++);c=['<div id=mds_right class="delStatus_rht">','<div class="partialMail_contact zmTV">',"<h4>"+f.mailDeliveryStatus.common.delivered+" "+l+" "+(l>1?i:g)+"</h4>",'<div class="SC_PUcen">','<ul class="SC_P2r">'+d+"</ul>","</div>","</div>",'<div class="partialMail_contact">',"<h4>"+f.mailDeliveryStatus.common.failure+" "+m+" "+(m>1?i:g)+"</h4>",'<div class="SC_PUcen">','<ul class="SC_P2r">'+k+"</ul>","</div>","</div>","</div>"].join("")}else c=['<div id=mds_right class="delStatus_rht">','<div class="singleMail_contact">','<ul class="SC_P2r">'+w()+"</ul>","</div>","</div>"].join("");return c},z=function(){var a=[];return a=['<div class="delStatus_row">','<div id=mds_left class="delStatus_lft">',"<h3>"+o[h]+"</h3>","<p>"+p[h]+" "+n+"</p>",h>1&&h<5?'<p><a id="mds_update" class="SC_lnk">'+f.mailDeliveryStatus.common.refresh+"</a>  "+f.mailDeliveryStatus.common.inprogresstext+"</p>":"",6===h||7===h||8===h?'<div id="mds_resend" class="SC_PUbtm"><span>'+f.mailDeliveryStatus.common.resend+"</span></div>":"","</div>",y(),"</div>"].join("")},A=function(){var a=c.find("li");a.each(function(a,b){var c=$(b).attr("eId");c&&zmail.ContactBook.get({eid:c}).done(function(a){var d,e=a[0];d=e?e.avatar():zmail.ContactBook.Templates.avatar({isValidPhoto:!1,photo:void 0,initials:zmail.ContactBook.Utils.initials(c),avatarBgColor:zmail.ContactBook.Utils.colorClasses()}),$(b).find("img").remove(),$(b).append(d)})})},B=function(){var a,b,d,e;c.length&&(a=c.find("#mds_update"),b=c.find(".zmDel_failLnk"),d=c.find("#mds_resend"),e=c.find("#helpDF"),a.length&&a.off("click").on("click",function(){zmList.getMailDeliveryStatus(i,!0,k)}),b.length&&b.off("click").on("click",function(){var a=$(this).closest("li");a.next().slideToggle(),a.toggleClass("zm_failMsg")}),d.length&&d.off("click").on("click",function(){k.remove(),zmUtil.invokeComposer({mode:"eanew",msgId:i,recipientList:m})}),e.length&&e.off("click").on("click",function(){6===h?window.open("//www.zoho.com/mail/help/how-email-works.html#alink1","_blank").focus():7===h&&window.open("//www.zoho.com/mail/help/how-email-works.html#alink2","_blank").focus()}))};if(a.undelivered.length){var C,D=a.undelivered.length,E=0;for(E=0;E<D;E++)C=a.undelivered[E],0===C.indexOf(i)&&(a.undelivered[E]=a.undelivered[E].substring(i.length+1,C.length)),v(a.undelivered[E])||j++}!d&&x().parent().length&&(d=!0),d?(c=x(),c.html(z()),A(),B()):(c=x(),c.html(z()),g.$content=c,g.ignoreMouseDown=!1,g.contentWrapperClass="SC_PU singleMail_DelStatus zmSnd_stsPopup",g.dialogDidMount=function(){},g.dialogWillMount=function(){A(),B()},k=Dialog["new"](g)),h!==zmail.mailObj[i].MDS&&zmInit.updateMailDeliveryStatus({module:"mail",MDS:h,M:i,ignorePopupUpdate:!0})}},unchkAll:function(){var a=zmsuite.getCenter()[0].getNodes()[0].$el.find(".msi-uncheck");a.length&&(a.hasClass("msi-check")||a.hasClass("msi-partcheck"))&&(c.selectMails(c.getAllViewObjectIds(!0),!1),zmList.resetThreadPath(),zmInit.listingBand.removeBulkActionBand())},chkAll:function(){c.selectMails(c.getAllViewObjectIds(!0),!0),zmList.showBulkActionBand()},chkBox:function(a,b,d){d=d||{};var e,f,g,h=b.isParent,i=b.msgId,j=i,k=c.getPerviouslySelected(),l=b.type;j="th"===l?"c"+i:i,e=c.getViewObject(j),f=!(e&&e.isSelected),c.selectMail(j,f),d.shiftKey&&k&&k!==j&&c.hasElement(k)&&(g=zmUtil.arrayExtractor(c.getAllViewObjectIds(),k,j),c.selectMails(g,f),c.handleForChildSelection(k,f)),h?c.selectMails(c.getChildrenIdsOf(i),f):c.handleForChildSelection(j,f),c.setPerviouslySelected(j),f||zmList.resetThreadPath(),
zmList.showBulkActionBand()},chkSingleMsg:function(){var a={},b=zmPrev.prevDetails(),d=b.msgId,e="";d||(d=c.getMailOrders()[0]);var f=c.getViewObject(d);e=f&&f.$element.data("ty"),a.isParent=zmail.mailObj[d].TH&&"lt"===e&&0!==zmUtil.getMLConversionValue(),a.msgId=d,a.type=e,a.msgId&&zmList.chkBox(null,a)},updateSelectionCount:function(a,b){a=a||"zm_Container";var c,d=zmsuite.getCenter(a)[0].getNodes()[1].$el,e=d.find(".unreadCount"),g=d.find(".zm_refine"),h=d.find(".zm_savesearch");if(d.length)if(c=d.find(".selCount"),void 0===b||b){var i=zmUtil.getCheckedMailCount();0===i?(c.remove(),"zm_Container"===a&&zmInit.updateHeaderBand(),g.show(),h.show()):(c.length||(c=$(_zm.getDOM(["SPAN",{attrs:{"class":"sum selCount"}}])),d.find(".SC_flt .SC_mtb").append(c)),1===i?c.text(f.common.singlemail):c.text(zmText.applyArgs(f.common.multiplemail,{count:i})),e.hide(),g.hide(),h.hide())}else c.remove(),"zm_Container"===a&&zmInit.updateHeaderBand(),g.show(),h.show()},doThreadPath:function(a,b){var c="";c=a.parents(".SC_mclst"),s(b,a,c)},resetThreadPath:function(){if("zm_Container"===zmTab.currentTab||"zm_srch1"===zmTab.currentTab){var a,b,c=zmPrev.prevDetails(zmTab.currentTab),d=c.msgId,e=c.type;a=zmsuite.getCenter(zmTab.currentTab)[0].getNodes()[2].$el,b="th"===e?a.find("#"+d):a.find("#t"+d),zmList.doThreadPath(b,"add")}},allowFLOperation:function(a){var b=!0;if(!a)return!1;for(var c in zmail.folId)if(zmail.folId[c]===a){b=!1;break}return b},remReadMail:function(){var a,b=zmList.getElemObj().listElem||zmail.mailCenter.listElem,c=$(b);a="zm_Container"===zmTab.currentTab?c.children(".zmL:not(.zm_urd)"):c.children(".zmL:not(.zm_urd,.zmSLst)"),a.each(function(){var a,b,c=this.id;a=$(this),b=a.parent(),b.hasClass("zmTV")?b.children(".zmL").hasClass("zm_urd")||(b.remove(),b.prev().remove()):(a.remove(),c.indexOf("t")||(c=c.substring(1,c.length)),$("#thd"+c).length&&$("#thd"+c).remove()),zmCache.updateCacheForViews(c)})},mailUtility:function(a){var b,c,d,e,h,i,j="contextmenu";if(h=a.target||a.srcElement,b=$(h).closest(".zmL").attr("id")){zmInit.rclkId=b,i="t"===b.charAt(0)?zmUtil.getFolId():zmail.mailObj[b]&&zmail.mailObj[b].FD,c=a.target||a.srcElement,d=$(c);var k=d.closest(".zmL");if(k.length&&k.addClass("SC_rgtClk"),d.hasClass("zmflg")){if(zmUtil.isSharedFolder(i,"R"))return;d.css("visibility","visible"),e={clk:function(a,b){zmList.setFlag(d,b)},removeSelection:!0,conArr:[{htm:"<i class='zm_icn zmflg zm_fgB'></i>"+f.flagmenu.infoflag,data:{flag:"1"}},{htm:"<i class='zm_icn zmflg zm_fgR'></i>"+f.flagmenu.important,data:{flag:"2"}},{htm:"<i class='zm_icn zmflg zm_fgG'></i>"+f.flagmenu.followup,data:{flag:"3"}},{sep:!0},{htm:"<i class='zm_icn zmflg'></i>"+f.flagmenu.clearflag,data:{flag:"0"}}]},zmsuite.showContextMenu(a,e),zmUtil.stopEvents(a)}else if(i!==zmail.folId.oId&&i!==zmail.folId.teId&&i!==zmail.folId.dId){var l;l=i===zmail.folId.sId?{htm:f.contextmenu.listrecipient,data:{action:"listrecipient",from:"ctxtMenu"}}:{htm:f.contextmenu.listfromsender,data:{action:"listsender",from:"ctxtMenu"}};var m=[l,{htm:f.contextmenu.listbysubject,data:{action:"listsubject",from:"ctxtMenu"}},{sep:!0},{htm:f.contextmenu.openpreview,data:{action:"openpreview",opentype:0}},{htm:f.contextmenu.opentab,data:{action:"opentab",opentype:2}},{htm:f.contextmenu.popout,data:{action:"openwindow",from:"ctxtMenu"}},{sep:!0},{htm:f.contextmenu.reply,data:{action:"reply",from:"ctxtMenu"}},{htm:f.contextmenu.replyall,data:{action:"replyall",from:"ctxtMenu"}},{htm:f.contextmenu.forward,data:{action:"forward",from:"ctxtMenu"}},{sep:!0},{htm:f.contextmenu.markspam,data:{action:"spam",from:"ctxtMenu"}},{htm:f.contextmenu.marknotspam,data:{action:"notspam",from:"ctxtMenu"}},{htm:f.contextmenu["delete"],data:{action:"delete",from:"ctxtMenu"}}];0===zmail.mailOpt.isPopup?m.splice(3,1):1===zmail.mailOpt.isPopup?m.splice(5,1):m.splice(4,1),zmUtil.isSharedFolder(i)?m.splice(9,4):i===zmail.folId.spId?m.splice(10,1):m.splice(11,1),zmUtil.isSharedFolder(i,"R")&&m.splice(5,9);var n=[];zmUtil.isSharedFolder(i)||n.push({htm:f.contextmenu.addfilter,data:{action:"addFilter"}}),zmUtil.isZohoAccount(zmail.accId)&&!zmUtil.isSharedFolder(i)&&(n.push({htm:f.contextmenu.addtask,data:{action:"addTask"}}),zmUtil.isZohoAccount(zmail.accId)&&zmUtil.isNoteReactUser()&&!zmUtil.isSharedFolder(i)&&n.push({htm:f.contextmenu.addnote,data:{action:"addNote"}})),n.length&&(m.push({sep:!0}),1===n.length?m.push({htm:f.contextmenu.addtofilter,data:{action:"addFilter"}}):m.push({htm:g.contextmenu.addto+"<i class='msi-rarrow'></i>",data:{action:"addtomenu"},child:function(){var a={clk:function(a,b){b.actionSrc=j,zmList.bindAction(b,a)},divId:"zm_addtomenu",removeSelection:!0,conArr:n};return a}})),e={clk:function(a,b){b.actionSrc=j,zmList.bindAction(b,a)},conArr:m,removeSelection:!0},zmsuite.showContextMenu(a,e),zmUtil.stopEvents(a)}}},leftUtility:function(a,b,c){var d,f=b.id||$(b).parents(".SC_tre").attr("id");if(zmInit.rclkId=f,"zmlTreeH"===c)d={clk:function(a,b){zmList.bindAction(b,a)},conArr:[{htm:e.foldercontextmenu.createsub,id:"zmLTMenu_Nf",cEdit:!0,data:{action:"zmLTMenu_Nf"}},{sep:!0,id:"zmLTMenu_lne1"},{htm:e.foldercontextmenu.markfolread,id:"zmLTMenu_Fr",cEdit:!1,data:{action:"zmLTMenu_Fr"}},{sep:!0,id:"zmLTMenu_lne2"},{htm:e.foldercontextmenu.sharefol,id:"zmLTMenu_Sf",cEdit:!1,data:{action:"zmLTMenu_Sf"}},{sep:!0,id:"zmLTMenu_lne3"},{htm:e.foldercontextmenu.renamefol,id:"zmLTMenu_Rf",cEdit:!0,data:{action:"zmLTMenu_Rf"}},{htm:e.foldercontextmenu.delfol,id:"zmLTMenu_Df",cEdit:!1,data:{action:"zmLTMenu_Df"}},{sep:!0,id:"zmLTMenu_lne4"},{htm:e.foldercontextmenu.archfol,id:"zmLTMenu_Af",cEdit:!1,data:{action:"zmLTMenu_Af"}},{htm:e.foldercontextmenu.emptyfol,id:"zmLTMenu_Ef",cEdit:!1,data:{action:"zmLTMenu_Ef"}}]},zmsuite.showContextMenu(a,d),zmUtil.stopEvents(a);else if("zmllabelH"===c){if(!zmUtil.isSystemLabel(f)){var g=[{htm:e.tagCreateEdit.edittag,id:"zmLTMenu_El",cEdit:!0,data:{action:"zmLTMenu_El"}},{htm:e.tagCreateEdit.deltag,id:"zmLTMenu_Dl",cEdit:!1,data:{action:"zmLTMenu_Dl"}}];if(zmail.showFeature){var h={},i=e.tagCreateEdit.sharetag,j=zmList.getRowInfo(f,"zmllabelH","info");j&&j.shId&&"-1"!==j.shId&&(i=e.foldercontextmenu.shareinfo),h.htm=i,h.id="zmLTMenu_Sl",h.data={action:"zmLTMenu_Sl"},h.cEdit=!0,g.push(h)}d={clk:function(a,b){zmList.bindAction(b,a)},conArr:g},zmsuite.showContextMenu(a,d)}zmUtil.stopEvents(a)}else if("zmlSSrchTreeH"===c)d={clk:function(a,b){zmList.bindAction(b,a)},conArr:[{htm:e.common.rename,id:"zmLTMenu_Rss",cEdit:!1,data:{action:"zmLTMenu_Rss"}},{htm:e.common["delete"],id:"zmLTMenu_Dss",cEdit:!1,data:{action:"zmLTMenu_Dss"}}]},zmsuite.showContextMenu(a,d),zmUtil.stopEvents(a);else if("zmlSTreeH"===c)d={clk:function(a,b){zmList.bindAction(b,a)},conArr:[{htm:e.foldercontextmenu.unsubscribe,id:"zmLTMenu_Unshare",cEdit:!1,data:{action:"zmLTMenu_Unshare",cur:b,zm_unshareId:f}}]},zmsuite.showContextMenu(a,d),zmUtil.stopEvents(a);else if("zmStreamTree"===c){if(d={clk:function(a,b){zmStreamsApp.events.groupAction(b)},conArr:[{htm:e.streams.chatGroup,id:"zmLTMenu_CChat",cEdit:!1,data:{action:"createChat",gid:f}},{htm:e.streams.viewMembers,id:"zmLTMenu_VMem",cEdit:!1,data:{action:"viewMembers",gid:f}}]},f!==zmail.zuid&&$.isNumeric(f)){var k=zmCont.getGroup(f);k.eid&&d.conArr.push({htm:e.streams.emailGroup,id:"zmLTMenu_Email",cEdit:!1,data:{action:"email",gid:f}}),k.scount>0&&d.conArr.push({htm:e.streams.markRead,id:"zmLTMenu_Email",cEdit:!1,data:{action:"markRead",gid:f}}),zmUtil.isNewGroupUser()&&d.conArr.push({htm:e.streams.hideGrp,id:"zmLTMenu_Email",cEdit:!1,data:{action:"hideGroup",gid:f}}),zmsuite.showContextMenu(a,d)}zmUtil.stopEvents(a)}},setFlag:function(a,b){var c=b.flag;a.css("visibility",""),zmList.flagMail(a,c),zmUtil.hideMenu()},getMailSummaryList:function(a,b,c){var d,e=[],f=!1,g="archive"===a.view;if(a.fId!==zmail.folId.sId&&zmList.excludeSent||(f=!0),zmail.listObj[b]){var h=zmail.listObj[b].MO,i=zmail.folId.dId,j=zmail.folId.sId,k={};if(zmail.folCount[a.fId]||$("#"+a.fId).length)if(a.flag)if(parseInt(a.flag)===-1)for(d=0;d<h.length;d++)k=zmail.mailObj[h[d]],k.FD===a.fId&&0!==parseInt(k.NFG)&&1!==k.AR&&k.FD!==i&&(k.FD!==j||k.FD===j&&f)&&e.push(h[d]);else for(d=0;d<h.length;d++)k=zmail.mailObj[h[d]],k.FD===a.fId&&parseInt(k.NFG)===parseInt(a.flag)&&1!==k.AR&&k.FD!==i&&(k.FD!==j||k.FD===j&&f)&&e.push(h[d]);else if(a.label)if("-1"===a.label)for(d=0;d<h.length;d++)k=zmail.mailObj[h[d]],k.FD===a.fId&&k.TAG&&k.TAG.length>0&&1!==k.AR&&k.FD!==i&&(k.FD!==j||k.FD===j&&f)&&e.push(h[d]);else for(d=0;d<h.length;d++){k=zmail.mailObj[h[d]];var l=$.inArray(a.label,k.TAG);k.FD===a.fId&&l!==-1&&1!==k.AR&&k.FD!==i&&(k.FD!==j||k.FD===j&&f)&&e.push(h[d])}else if("unread"===a.view)for(d=0;d<h.length;d++)k=zmail.mailObj[h[d]],k.FD===a.fId&&0===k.S&&1!==k.AR&&k.FD!==i&&(k.FD!==j||k.FD===j&&f)&&e.push(h[d]);else if(a.attach)for(d=0;d<h.length;d++)k=zmail.mailObj[h[d]],k.FD===a.fId&&1===k.AT&&1!==k.AR&&k.FD!==i&&(k.FD!==j||k.FD===j&&f)&&e.push(h[d]);else if(g)for(d=0;d<h.length;d++)k=zmail.mailObj[h[d]],k.FD===a.fId&&1===k.AR&&k.FD!==i&&(k.FD!==j||k.FD===j&&f)&&e.push(h[d]);else for(d=0;d<h.length;d++)k=zmail.mailObj[h[d]],k.FD===a.fId&&1!==k.AR&&k.FD!==i&&(k.FD!==j||k.FD===j&&f)&&e.push(h[d]);else if(zmail.labInfo[a.label]){for(d=0;d<h.length;d++)if(k=zmail.mailObj[h[d]],k.TAG&&k.FD!==zmail.folId.spId&&k.FD!==zmail.folId.tId&&k.FD!==i&&(k.FD!==j||k.FD===j&&f))for(var m=k.TAG,n=0;n<m.length;n++)m[n]===a.label&&e.push(h[d])}else if("unread"===a.view)for(d=0;d<h.length;d++)k=zmail.mailObj[h[d]],k.FD!==zmail.folId.spId&&k.FD!==zmail.folId.tId&&0===k.S&&k.FD!==i&&(k.FD!==j||k.FD===j&&f)&&e.push(h[d]);else if(a.flag)if(parseInt(a.flag)===-1)for(d=0;d<h.length;d++)k=zmail.mailObj[h[d]],k.FD!==zmail.folId.spId&&k.FD!==zmail.folId.tId&&0!==parseInt(k.NFG)&&k.FD!==i&&(k.FD!==j||k.FD===j&&f)&&e.push(h[d]);else for(d=0;d<h.length;d++)k=zmail.mailObj[h[d]],k.FD!==zmail.folId.spId&&k.FD!==zmail.folId.tId&&parseInt(k.NFG)===parseInt(a.flag)&&k.FD!==i&&(k.FD!==j||k.FD===j&&f)&&e.push(h[d]);else if("all"===a.view)for(d=0;d<h.length;d++)k=zmail.mailObj[h[d]],k.FD!==zmail.folId.spId&&k.FD!==zmail.folId.tId&&k.FD!==i&&(k.FD!==j||k.FD===j&&f)&&e.push(h[d])}return zmail.convSortOrder&&c?e.reverse():e},getListForAllMailsView:function(a,b,c){a=a||{};var d=[],e=0,f=!1,g="archive"===a.view;if(a=a||{},a.fId!==zmail.folId.sId&&zmList.excludeSent||(f=!0),zmail.listObj[b]){var h,i=zmail.listObj[b].MO,j=zmail.folId.dId;for(e=0;e<i.length;e++)h=zmail.mailObj[i[e]],h&&h.FD!==zmail.folId.spId&&h.FD!==zmail.folId.tId&&(g&&1===h.AR||!g&&1!==h.AR||c)&&h.FD!==j&&(h.FD!==zmail.folId.sId||h.FD===zmail.folId.sId&&f)&&d.push(i[e])}return d},flagMail:function(a,b){var c,d,e={};d=a.parents(".zmL"),c=d[0].id,c.indexOf("t")!==-1?(e.thd=[zmInit.zmsubStr(c,"t")],e.msgId=[]):(e.msgId=[c],e.thd=[]),e.fVal=b,zmmailAct.applyActions("flag","click",e)},showHideThread:function(a,b,c,d){var e,f,g,h,i,j={},k={};h=$(a).closest(".zmL"),f=e=h[0].id,f.indexOf("t")||(e=f.substring(1)),j={from:"tIcon",mId:e,elemObj:b},d&&(j.eTDefObj=d),"search"!==b.viewDetails.view&&zmail.listObj[zmail.mailObj[e].T]?r({},{mId:e,from:j.from,elemObj:b,opentype:c}):(g=zmail.mailObj[e].T,i=zmail.mailObj[e].FD,k={accId:zmail.accId,thId:g,from:0,to:10,summary:!0},b.viewDetails.fId&&zmUtil.isSharedFolder(b.viewDetails.fId)?(i=b.viewDetails.fId,k.shId=zmUtil.getShareId(i),zmail.opType.read_mail?k.opType=zmail.opType.read_mail:k.opType=0):"zm_Container"===zmTab.currentTab&&(k.folId=i),A(k,j,r))},getThreadCount:function(a){var b,c=zmail.mailObj[a.msgId].T,d={accId:zmail.accId,tId:c},e=a.viewDetails||zmInit.getListingDetObj();1===zmUtil.getMLConversionValue()||2===zmUtil.getMLConversionValue()&&(e.fId===zmail.folId.spId||e.fId===zmail.folId.sId)?(e.fId&&(d.folId=e.fId),e.flag&&(d.flag=e.flag),e.attach&&(d.attach=e.attach),e.view&&(d.view=e.view),e.label&&(d.label=e.label),d.folderSpec=1,d.mode="count",b=zmList.updThdCount):(d.folderSpec=2,d.mode="metadata",d.tId=a.msgId,b=zmList.updThdDetails),zmAjq.XHR({u:zmail.conPath+"/getThdCount.do",t:"POST",fn:b,p:d,ep:{msgId:a.msgId,deferredObj:a.deferredObj}})},updThdCount:function(a,b){var c=b.msgId,d=1;a.cntdata[0].count&&(d=parseInt(a.cntdata[0].count)),zmail.mailObj[c].TC=d,b.deferredObj&&b.deferredObj.resolve()},updThdDetails:function(a,b){var c=b.msgId,d=zmail.mailObj[c];a&&(d.TC=a.TC,d.TA=a.TA,d.TS=a.TS,d.TI=a.TI,d.TM=a.TM,d.TF=a.TF,d.TTAGS=a.TTAGS,d.TSN=a.TSN,d.TSB=a.TSB,d.TSM=a.TSM),b.deferredObj&&b.deferredObj.resolve()},setEmptyListing:function(){var a,b;a=$(zmail.mailCenter.listElem),0!==a.find(".zmL").length||a.data("ty")||(b=zmInit.emptyRow(),a.html(b),zmInit.listingBand.SpamTrashBand.setBand())},FLUtility:function(a,b,c,d){var f=b.id||$(b).parents(".SC_tre").attr("id"),g=zmail.folId;if(zmUtil.stopEvents(a),"zm_unread"===f||"zm_all"===f||"zm_flag"===f||f===g.dId||f===g.teId&&!_zm._isPrivilegedUser())return void zmUtil.hideMenu();if("header"!==d)if(zmList.leftUtility(a,b,c),f&&"zmlTreeH"===c?zmfolAction.rgtFolId=f:"zmllabelH"===c?zmlab.labelId=f:"zmlSSrchTreeH"===c?zmSearch.savedSearchId=f:"zmStreamTree"===c&&zmUtil.loadStreams().done(function(){zmStreamsApp.constants.rightClickId=f}),f===g.iId)zmList.dimUtility(i,[4,6,7]);else if(f===g.tId)zmList.dimUtility(i,[0,4,6,7,9]),zmfolAction.rgtFolId=zmail.folId.tId,$("#zmLTMenu_Ef").html(e.emptyfolder.emptytrash);else if(zmfolAction.isDeletedFolder(f))zmList.dimUtility(i,[0,4,6,9]),$("#zmLTMenu_Ef").html(e.emptyfolder.emptytrash);else if(f===g.sId)$("#zmLTMenu_Ef").html(e.emptyfolder.emptysent),zmList.dimUtility(i,[0,2,4,6,7]);else if(f===g.spId)$("#zmLTMenu_Ef").html(e.emptyfolder.emptyspam),zmList.dimUtility(i,[0,4,6,7,9]);else if(f===g.oId){$("#zmLTMenu_Ef").html(e.foldercontextmenu.sendnow);var h=[0,2,4,6,7,9];0===Number(zmail.folCount[zmail.folId.oId].c)&&h.push(10),zmList.dimUtility(i,h)}else f===g.teId?($("#zmLTMenu_Ef").text("Create Template"),zmList.dimUtility(i,[0,2,4,6,7,9])):$("#zmLTMenu_Ef").html(e.foldercontextmenu.emptyfol);zmail.isOrg||"1"!==zmail.aInfo[zmail.accId].accountType?"0"===zmail.aInfo[zmail.accId].accountType?($("#zmLTMenu_lne2").remove(),$("#zmLTMenu_Sf").remove()):zmUtil.isFolderId(f)&&"-1"!==zmList.getRowInfo(f,"zmlTreeH","info").SH&&$("#zmLTMenu_Sf").html(e.foldercontextmenu.shareinfo):$("#zmLTMenu_Sf").addClass("SC_op3")},getParent:function(a,b){for(;$(a).attr("tagName")!==zmInit.topelement&&!$(a).hasClass(b);)if(a=zmInit.nn6?a.parentNode:a.parentElement,$(a).hasClass(b)&&"DIV"===a.tagName)return a;return a},dimUtility:function(a,b){b=b.sort(function(a,b){return a===b?0:a>b?1:-1});for(var c=0,d=0;d<a.length;d++)d===b[c]?("zmLTMenu_Rf"===a[d]||"zmLTMenu_Nf"===a[d]?$("#"+a[d]).parent().addClass("SC_op3"):$("#"+a[d]).addClass("SC_op3"),c++):$("#"+a[d]).removeClass("SC_op3")},changeViewColumns:function(a){var b,c={},d={};b="s"===zmail.viewInfo[0][a]?"hide":"show",d={opt:b,accId:zmail.accId,cName:a},c.opt=b,c.cName=a,zmAjq.XHR({u:zmail.conPath+"/editHeader.do",t:"POST",fn:Q,p:d,csr:"s",ep:c})},getRowInfo:function(a,b,c){var d,e,f={};return a&&(d=zmail.mailLeft.getNodes()[0].getLayer(b),f=d.getRowObj(a),c)?e=f[a]:f},editLeftRow:function(a,b){var c;c=zmail.mailLeft.getNodes()[0].getLayer(b),c.editNode(a,c.mapObject)},nwFolContextMenu:function(){var a=$("#zmLTMenu_Nf"),b=zmfolAction.rgtFolId;zmUtil.setEditable({ele:a,target:$("#"+b),callback:zmUtil.hideMenu,allowCondition:function(){return zmail.folId.iId===b||"zmlTreeH"===b,!0},parentdiv:$("#zmCntxtMenu"),hideMenu:zmUtil.hideMenu}),$.publish("/mail/activeMenu",[{activeMenuElement:a,activeMenuHandler:zmfolAction.newFolderMenuHandler}])},rnSSrchContextMenu:function(){zmUtil.hideMenu(),zmSearch.getSavedSearchName({mode:"rename"}).then(function(a){zmSearch.processSavedSearch({id:zmSearch.savedSearchId,searchName:a.savedsearchname,mode:"rename"})}).fail(function(){})},rnFolContextMenu:function(){var a=zmfolAction.rgtFolId,b=zmList.allowFLOperation(a),c=$("#zmLTMenu_Rf");zmUtil.setEditable({ele:c,target:$("#"+a),callback:zmUtil.hideMenu,initialize:!0,allowCondition:function(){return!(!a||zmfolAction.getParentFolderId(a)===zmail.folId.tId)&&b},parentdiv:$("#zmCntxtMenu"),hideMenu:zmUtil.hideMenu}),$.publish("/mail/activeMenu",[{activeMenuElement:c,activeMenuHandler:zmfolAction.renameFolderMenuHandler}])},delFolContextMenu:function(){var a=zmfolAction.rgtFolId,b="delete",c=zmList.allowFLOperation(a);if(!c||!a)return void zmUtil.hideMenu(!0);zmfolAction.isDeletedFolder(a)&&(b="deleteTrashFolder");var d;d=zmail.folTree[1][a]?"deleteTrashFolder"===b?e.emptyfolconfmsg.perDelWitSubFol:e.emptyfolconfmsg.delWithSubFol:"deleteTrashFolder"===b?e.emptyfolconfmsg.permanentDel:e.emptyfolconfmsg.delFol,zmsDialog.confirm(zmText.applyArgs(d,{foldername:'"'+zmInit.findFolName(a)+'"'}),{onOk:function(){var c=zmfolAction.deleteFolder,d={accId:zmail.accId,mode:b,folId:a};"deleteTrashFolder"===b&&(c=zmfolAction.deleteTrashFolder),zmAjq.XHR({u:zmail.conPath+"/folAction.do",t:"POST",fn:c,p:d,ep:{toTrash:"delete"===b?1:0,mode:b},csr:"s"})}}),$("#zmCntxtMenu").hide()},rnLabContextMenu:function(){var a="zmllabelH"!==zmlab.labelId,b=a?"e":"a",c=$("#zmLTMenu_El");zmUtil.setEditable({ele:$("#zmLTMenu_El"),target:$("#"+zmlab.labelId),callback:zmUtil.hideMenu,initialize:a,parentdiv:$("#zmCntxtMenu"),hideMenu:zmUtil.hideMenu}),$.publish("/mail/activeMenu",[{activeMenuElement:c,activeMenuHandler:zmlab.labelMenuHadler,activeMenuArgsArray:[b]}])},delLabContextMenu:function(){var a=zmlab.labelId,b=zmList.allowFLOperation(a);return b&&a?(zmsDialog.confirm(e.tagCreateEdit.deltagdialogmsg,{onOk:function(){zmlab.labelreq("d")}}),void zmUtil.hideMenu(!0)):void zmUtil.hideMenu(!0)},delSavedSrchContextMenu:function(){var a=zmSearch.savedSearchId,b=zmail.savedSearchList[a]?zmail.savedSearchList[a].FN:"";zmsDialog.confirm(zmText.get("search","savedsearch.confirmDelete",{name:b}),{onOk:function(){zmSearch.processSavedSearch({id:a,mode:"delete"})}}),zmUtil.hideMenu()},mrkReadContextMenu:function(){var a=zmfolAction.rgtFolId;return a?void zmfolAction.markAsReadFolder(a):void zmUtil.hideMenu(!0)},unshareContextMenu:function(a){zmshare.unshare(a)},emptyFolContextMenu:function(a){var b,c=a||zmfolAction.rgtFolId;return c!==zmail.folId.dId&&c!==zmail.folId.teId&&c!==zmail.folId.oId&&(c===zmail.folId.spId?zmsDialog.confirm(e.emptyfolconfmsg.spammsg,{onOk:function(){b={accId:zmail.accId,mode:"emptyspam",folId:c},zmAjq.XHR({u:zmail.conPath+"/folAction.do",t:"POST",fn:zmfolAction.emptyFolder,p:b,csr:"s"})}}):c===zmail.folId.tId?zmsDialog.confirm(e.emptyfolconfmsg.trashmsg,{onOk:function(){b={accId:zmail.accId,mode:"emptytrash",folId:c},zmAjq.XHR({u:zmail.conPath+"/folAction.do",t:"POST",fn:zmfolAction.emptyFolder,p:b,csr:"s"})}}):c===zmail.folId.sId?zmsDialog.confirm(e.emptyfolconfmsg.sentmsg,{onOk:function(){b={accId:zmail.accId,mode:"emptysent",folId:c},zmAjq.XHR({u:zmail.conPath+"/folAction.do",t:"POST",fn:zmfolAction.emptyFolder,p:b,csr:"s"})}}):zmfolAction.sendEmptyFolderReq(c),void zmUtil.hideMenu(!0))},shareFolContextMenu:function(a){var b,c,d="",e=[];if("fol"===a){if(b=zmfolAction.rgtFolId,c=zmList.allowFLOperation(b),!c||!b)return void zmUtil.hideMenu(!0)}else if("tag"===a&&(b=zmlab.labelId,!b))return void zmUtil.hideMenu(!0);var f=zmText.get("sharefolder","share_folder"),g="",h="";e&&("tag"===a?(e=zmList.getRowInfo(b,"zmllabelH","info"),h=e.dispName?e.dispName:"",h=e.label?e.label:h,e&&"-1"!==e.shId&&(g=e.shId),f=zmText.get("sharefolder","share_tag")):"fol"===a&&(e=zmList.getRowInfo(b,"zmlTreeH","info"),h=e.FN?e.FN:"",h=e.SN?e.SN:h,e&&"-1"!==e.SH&&(g=e.SH))),""!==h&&(d=" - "+h);var i=$('<div class="shrFol" id="sharepopup"/>'),j=[];j=["<div>",'<div class="SC_input">','<input id="zmshr_usrinp" type="text" placeholder="'+zmText.get("sharefolder","org_member")+'">',"</div>",'<div id="zmshr_role" data-readval="read" data-read="'+zmText.get("sharefolder","read")+'" data-write="'+zmText.get("sharefolder","write")+'" class="SC_rwToggle"></div>','<div id="zmshr_delegate" class="SC_tp10 SC_dyn"><span id="zmshr_frmchk"  class="cursorPointer"><i class="msi-uncheck"></i>'+zmText.get("sharefolder","allow_delegation")+"</span>",'<div class="SC_cs SC_np SC_dyn" id="zmshr_frmlst"><span>'+zmail.cmpdata.DEFFRM_ADDR+'</span><i class="msi-barrow"></i></div>',"</div>",'<div class="SC_PUbtm"><span id="zmshr_share">'+zmText.get("sharefolder","share")+"</span></div>","</div>"],i.append($(j.join(""))),i.append('<div id="zmshr_usrlst" class="SC_dyn"/>');var k={};k.$content=i,k.title=f+" "+d,k.ignoreMouseDown=!1,k.dialogDidMount=function(c){$("#sharepopup")[0].zm_share_dialog_ele=c,c.$els.$contentWrapper.css({"min-width":"500px"}),zmail.showFeature||$("#zmshr_unshare_opt").remove(),$("#zmshr_role").off("click").on("click",function(){$(this).toggleClass("SC_rwWrite");var a=$("#zmshr_role").attr("class");a.indexOf("SC_rwWrite")===-1?($("#zmshr_delegate").addClass("SC_dyn"),$("#zmshr_frmchk").find("i").eq(0).removeClass("msi-check").addClass("msi-uncheck"),$("#zmshr_frmlst").addClass("SC_dyn")):$("#zmshr_delegate").removeClass("SC_dyn")}),$("#zmshr_unshare").off("click").on("click",function(){zmshare.unshared(g)}),$("#zmshr_share").off("click").on("click",function(){zmshare.saveShare(b,a,g)}),$("#zmshr_cancel").off("click").on("click",function(){zmshare.closeDialog()}),$("#sharepopup").attr("data-resId",b).attr("data-shId",g),$("#sharepopup").attr("data-resType",a);var d=Object.keys(zmList.frmListObj(zmail.cmpdata.FROM_LIST)),e=d.length;if(1===e?$("#zmshr_frmlst").removeClass().addClass("SC_cs SC_np SC_ni"):e>1&&$("#zmshr_frmlst").off("click").on("click",function(){zmList.getFrmLst($(this))}),$("#zmshr_frmchk").off("click").on("click",function(){$("#zmshr_frmchk").find("i").eq(0).hasClass("msi-check")?($("#zmshr_frmchk").find("i").eq(0).removeClass("msi-check").addClass("msi-uncheck"),$("#zmshr_frmlst").addClass("SC_dyn")):($("#zmshr_frmchk").find("i").eq(0).removeClass("msi-uncheck").addClass("msi-check"),$("#zmshr_frmlst").removeClass("SC_dyn"))}),g&&""!==g)$("#zmshr_usrlst").removeClass("SC_dyn"),$("#zmshr_usrlst > ul").html('<li id="zmshr_load">'+zmText.get("sharefolder","loading")+" <blink>...</blink></li>"),zmshare.getUserLst(g);else{$("#zmshr_unshare_opt").remove();var f={contentArray:"org",compare:["fn","ln","nn","eid"],LType:"3",OType:"2",display:"fn"};zmAutoFill.setAutofill(f,$("#sharepopup #zmshr_usrinp"))}},k.dialogWillMount=function(a){var b=['<div id="zmshare_folder_error_band" class="SC_msg SC_emsg SC_dyn"><span><font  id="zmshare_folder_error_msg"></font><i id="zmshare_folder_error_close" class="msi-close"></i></span></div>'];a.$els.$contentWrapper.before(b.join(""))},k.defaultNavigator=!1,k.navigator=new zmail.Navigator({onEscape:function(){var a=$("#sharepopup")[0].zm_share_dialog_ele;a.remove()}}),Dialog["new"](k)},archiveFolderContextMenu:function(a){var b=a||zmfolAction.rgtFolId;b===zmail.folId.dId||b===zmail.folId.teId||b===zmail.folId.spId||b===zmail.folId.oId||b===zmail.folId.tId||zmfolAction.isDeletedFolder(b)||zmfolAction.sendArchiveFolderReq(b)},frmListObj:function(a){var b={};for(var c in a)a[c]&&"undefined"!=typeof a[c].FRM_SIGMODE&&6!==a[c].FRM_SIGMODE&&(b[c]=a[c]);return b},getFrmLst:function(a){var b,c=zmList.frmListObj(zmail.cmpdata.FROM_LIST),d={},e=[];for(var f in c)b={htm:f,data:{frm:f}},a.find("span").eq(0).text()!==f&&e.push(b);d.list=e,d.par=$("#zmshr_frmlst"),d.align="pleft",d.clk=function(a){$("#zmshr_frmlst").find("span").eq(0).text(a.frm),$("#zm_dropDown").remove()},zmsuite.showMenu(d)},updateThreadList:function(a){var b={},c={thId:a};a&&zmail.listObj[a]&&(b={accId:zmail.accId,thId:a,from:0,to:50,summary:!0},c={thId:a,from:"tIcon"},A(b,c,zmUtil.cacheThreadList))},updateFolderName:function(){var a,b=zmList.getElemObj();a=b.viewDetails,$(b.listElem).length&&(""!==a.fId||"unread"!==a.view&&"all"!==a.view&&"flag"!==a.view?a.fId&&zmInit.updateHeaderBand():$(b.listElem).find("div.zmL").each(function(){var a;a=this.id,a.indexOf("t")!==-1&&(a=a.substring(1,a.length)),a&&$(this).find(".zmFdr span").text(zmInit.findFolName(zmail.mailObj[a].FD))}))},reviewMailNotification:function(a,b){var c,d,e=zmUtil.getFolId(),f=zmInit.getListingDetObj(),g=!1,h=!1,i=!1,j=!1,k=zmUtil.getMLConversionValue(e);if(e===zmail.folId.sId||e===zmail.folId.tId?k=0:2===k&&e===zmail.folId.spId&&(k=1),a.T&&(a.FD===zmail.folId.dId&&zmUtil.isInlineCompose()||zmCache.updateObj({mode:"insert",msgId:a.M,rt:a.R,folId:a.T,type:"newm"}),a.FD===zmail.folId.dId&&zmUtil.isInlineCompose()&&zmail.mailObj[a.PA]&&(zmail.mailObj[a.PA].DMID=a.M,0===k&&(zmail.mailObj[a.PA].DC=zmail.mailObj[a.PA].DC+1||1)),zmail.mailObj[a.T]&&0===zmail.mailObj[a.T].TH&&(zmail.mailObj[a.T].TH=1,zmail.mailObj[a.T].T=a.T,zmail.mailObj[a.T].TC=1,zmail.listObj[a.T]?zmail.listObj[a.T].MO?1===zmail.convSortOrder?zmail.listObj[a.T].MO.unshift(a.M):zmail.listObj[a.T].MO.push(a.M):a.FD===zmail.folId.dId&&zmUtil.isInlineCompose()?zmail.listObj[a.T].MO=[a.T]:1===zmail.convSortOrder?zmail.listObj[a.T].MO=[a.T,a.M]:zmail.listObj[a.T].MO=[a.M,a.T]:a.FD===zmail.folId.dId&&zmUtil.isInlineCompose()?(zmail.mailObj[a.T].DC=1,zmail.listObj[a.T]={MO:[a.T]}):(a.FD===zmail.folId.dId&&(zmail.mailObj[a.T].DC=1),1===zmail.convSortOrder?zmail.listObj[a.T]={MO:[a.T,a.M]}:zmail.listObj[a.T]={MO:[a.M,a.T]}),$.publish("mail/threadCreated",{conversationID:a.T}))),!(a.FD===zmail.folId.spId&&e!==zmail.folId.spId||a.FD===zmail.folId.tId&&e!==zmail.folId.tId)&&((f.fId&&e===a.FD||!f.fId)&&(i=!0),("unread"===f.view&&0===a.S||"1"===f.attach&&1===a.AT||a.NFG&&f.flag&&("-1"===f.flag&&0!==parseInt(a.NFG)||parseInt(f.flag)===parseInt(a.NFG))||f.label&&a.TAG&&("-1"===f.label||a.TAG.indexOf(f.label)!==-1)||(f.fId&&e===a.FD||!f.fId&&"all"===e)&&!f.flag&&!f.label&&!f.attach&&"unread"!==f.view)&&(h=!0),(zmail.listObj[a.FD]&&zmail.listObj[a.FD].MO.indexOf(a.M)===-1||zmail.listObj[e]&&zmail.listObj[e].MO.indexOf(a.M)===-1)&&(j=!0),i&&h&&j&&(g=!0,a.TH&&0!==k))){var l=X(a.M,e);l?la(l,a.M):zmail.listObj[a.T]&&(d=zmList.getViewBasedMsgList(a.T,f,!0),d.length>0&&(a.FD===zmail.folId.dId?la(a.M,a.M):zmail.mailObj[d[1]].FD===zmail.folId.sId?(c=na(d),la(c,a.M)):la(d[1],a.M)))}!g&&0!==k&&a.TH&&e!==zmail.folId.spId&&e!==zmail.folId.tId&&(zmail.listObj[a.T]?(d=zmList.getMailSummaryList(f,a.T),d.length>0&&(d=zmList.getViewBasedMsgList(a.T,f,!0),a.FD===zmail.folId.dId?la(a.M,a.M):zmail.mailObj[d[1]].FD===zmail.folId.sId?(c=na(d),la(c,a.M)):la(d[1],a.M),g=!0)):g=ma(a.M,e)),g&&zmList.updateForNewMail(a,b,h);var m=[zmail.folId.spId,zmail.folId.tId,zmail.folId.dId];if("zmailReconnect"!==b&&m.indexOf(a.FD)===-1&&0===a.S&&(void 0!==a.SNS&&"1"!==a.SNS||!zmInit.isNotificationSuppressed(a.FD))){zmInit.mNotifier.push(a);var n={};n.title=a.SN||a.F||"",n.msg=zmUtil.decodeHTMLEntities(a.SB)||"",n.tag="Mail";var o=null,p=zmail.defaultPhoto;o=zmail.ContactBook.get({promise:!1,eid:a.F,type:["personal","org"]})[0],o&&(p=o.photo(!1)),n.imgUrl=p,n.callback=function(){zmList.getMailData({msgId:a.M,opentype:2,type:"lt",src:"external",eprm:{accId:zmail.accId}})},_zm.pushDesktopNotification(n)}},updateForNewMail:function(a,b,c){var d,e,f,g,h,i=!1,j=!1,k=!1,l=[],m="",n=!0,o="",p=zmUtil.getMLConversionValue();if(e=a.FD,d=zmInit.getListingDetObj(),f=zmUtil.getFolId(),a.AR||(a.AR=0),a.NFG||(a.NFG="0"),"zmailReconnect"!==b&&a.FD!==zmail.folId.sId&&a.FD!==zmail.folId.dId||(n=!1),f===zmail.folId.sId||f===zmail.folId.tId?p=0:2===p&&f===zmail.folId.spId&&(p=1),a.T&&0!==p){if(o="zm_tabt"+a.T,0!==a.S||a.TS||(a.TS=0),zmsuite.isWorkspaceAvailable(o)&&(k=!0),$(zmail.mailCenter.prevElem).hasClass("shw")&&(g=$(zmail.mailCenter.prevElem).attr("data-mid"),zmail.mailObj[g].T===a.T||g===a.T)){j=!0,i=!0,m=g;var q=$(zmail.mailCenter.listElem).find("#"+m);h=$(zmail.mailCenter.listElem).find("#thd"+m),!h.length&&q.length?(m="t"+m,q.attr("id",m)):(m="t"+m,q=$(zmail.mailCenter.listElem).find("#"+m))}}else 0===p&&a.TH&&(a.TC=-1);if(j||"archive"===d.view||(0===p||(2===p||1===p&&c)&&f===zmail.folId.sId==(a.FD===zmail.folId.sId)&&f===zmail.folId.dId==(a.FD===zmail.folId.dId)?0!==p&&a.TH&&!i?$.when(aa(a,d)).then(function(){var b=!0;"unread"===d.view&&1===a.TS&&(b=!1),b&&zmList.addMailsToListing(a,f),zmCache.updateObj({mode:"insert",msgId:a.M,rt:a.R,folId:f}),zmPrev.updatePvNtforNewMails()}):(zmList.addMailsToListing(a,f),i||(zmCache.updateObj({mode:"insert",msgId:a.M,rt:a.R,folId:e}),""===d.fId&&zmCache.updateObj({mode:"insert",msgId:a.M,rt:a.R,folId:f})),zmPrev.updatePvNtforNewMails()):_(a,d,p,c)),n||(j?l=zmPreviewTemplate.getMissingMailList(a.T,"P"):k&&(l=zmPreviewTemplate.getMissingMailList(a.T,"T"))),j&&(n?zmPreviewTemplate.showNotifBand({targetElem:zmsuite.getCenter("zm_Container")[1].getNodes()[1].$el,thdId:a.T,opentype:0}):$.publish("/mail/updatemailview",[{list:l,opentype:0}]),"archive"!==d.view&&(a.FD!==zmail.folId.sId||a.FD===zmail.folId.sId&&!zmList.excludeSent)&&(2===p||1===p&&(c||a.FD===zmail.folId.dId)))){if(a.FD!==zmail.folId.dId){if($(zmail.mailCenter.listElem).find("#thd"+g).length){var r=document.createDocumentFragment();r.appendChild(zmList.constructThreadChildRow(a.M,!1)[0]),zmail.convSortOrder?h.append(r):h.prepend(r)}zmail.mailObj[g]?(zmail.mailObj[g].TC+=1,a.TC=zmail.mailObj[g].TC):a.TC+=1,0===a.TS&&m&&a.FD!==zmail.folId.dId&&$("#"+m).addClass("zm_urd")}Z(m,a)}k&&(n?zmPreviewTemplate.showNotifBand({targetElem:zmsuite.getCenter(o)[1].getNodes()[1].$el,thdId:a.T,opentype:2}):$.publish("/mail/updatemailview",[{list:l,opentype:2}]))},addMailsToListing:function(a,b){var c;if(c=$(zmail.mailCenter.listElem),zmail.mailOpt.isshowSummary||(a.SM=""),!c.closest(".SC_streams").length){O(c)&&zmsuite.getCenter("zm_Container")[0].getNodes()[0].$el.find(".msi-uncheck").removeClass().addClass("msi-uncheck msi-partcheck");var d=$(zmInit.constructMailRow(b,[a.M]));"h"===zmail.viewInfo[0].DT&&d.find(".zmDate").hide(),"h"===zmail.viewInfo[0].SZ&&d.find(".zmSze").hide(),c.find("#nomails").length?c.html(d):zmail.listObj[b]&&zmail.listObj[b].sortOrder?0===zmail.listObj[b].showNextPage&&c.append(d):c.prepend(d),zmInit.listingBand.SpamTrashBand.setBand()}},bindAction:function(a,b){if(a){var c,d,e,f,g,h,i,j,k,l=a.action||a,m=a.actionSrc;switch(l){case"actionmenu":break;case"folread":zmfolAction.markAsReadFolder(),zmUtil.hideMenu(!0);break;case"unread":zmmailAct.applyActions(l,"dropdown"),zmUtil.hideMenu(!0);break;case"read":zmmailAct.applyActions(l,"dropdown"),zmUtil.hideMenu(!0);break;case"flag":case"label":zmmailAct.applyActions(l,"click",a),zmUtil.hideMenu(!0);break;case"move":zmmailAct.doActions(l,"drop",a);break;case"spam":a.from&&"ctxtMenu"===a.from?(h=zmInit.rclkId,i=T):(h="spam",i=zmmailAct.doActions),i(h,m);break;case"delete":a.from&&"ctxtMenu"===a.from?(h=zmInit.rclkId,i=S):(h="delete",i=zmmailAct.doActions),i(h,m);break;case"notspam":a.from&&"ctxtMenu"===a.from?(h=zmInit.rclkId,i=U):(h="notspam",i=zmmailAct.doActions),i(h,m);break;case"archive":zmmailAct.doActions("archive"),zmUtil.hideMenu();break;case"unarchive":zmmailAct.doActions("unarchive"),zmUtil.hideMenu();break;case"views":zmList.show("zm_viewLst",b);break;case"editrow":zmList.show("zm_shdLst",b);break;case"listview":zmUtil.hideMenu(),ja(a);break;case"clsPrev":if("zm_Container"!==zmTab.currentTab&&zmTab.currentTab.indexOf("zm_srch")){var n=zmsuite.getCenterOuter().$el.data("data-detail");"unread"===n.view&&zmList.remReadMail(),$.when(zmPrev.cmpClose()).then(function(a){if(a){var b=zmPrev.prevDetails(zmTab.currentTab).msgId;zmContentCache.remove(b),zmsuite.closeWorkspace(zmTab.currentTab)}})}else zmPrev.clsPreview();break;case"editHeader":zmList.changeViewColumns(a.column),zmUtil.hideMenu();break;case"zmLTMenu_Nf":zmUtil.hideMenu(),zmfolAction.showCreateFolderPopUp({mode:"new",type:"subfolder"});break;case"zmLTMenu_Rf":zmUtil.hideMenu(),zmfolAction.showCreateFolderPopUp({mode:"rename"});break;case"zmLTMenu_Fr":zmList.mrkReadContextMenu(),zmUtil.hideMenu(!0);break;case"zmLTMenu_Unshare":zmList.unshareContextMenu(a),zmUtil.hideMenu(!0);break;case"zmLTMenu_Ef":zmfolAction.rgtFolId===zmail.folId.oId?zmList.sendOutbox("sendI"):zmfolAction.rgtFolId===zmail.folId.teId?(zmComponent.createTemplate(),zmUtil.hideMenu()):zmList.emptyFolContextMenu();
break;case"zmLTMenu_Df":zmList.delFolContextMenu();break;case"zmLTMenu_El":zmUtil.hideMenu(),zmlab.showCreateTagPopUp({mode:"rename"});break;case"zmLTMenu_Dl":zmList.delLabContextMenu();break;case"zmLTMenu_Sf":zmList.shareFolContextMenu("fol"),zmUtil.hideMenu(!0);break;case"zmLTMenu_Sl":zmList.shareFolContextMenu("tag"),zmUtil.hideMenu(!0);break;case"zmLTMenu_Af":zmList.archiveFolderContextMenu(),zmUtil.hideMenu(!0);break;case"zmLTMenu_Dss":zmList.delSavedSrchContextMenu(),zmUtil.hideMenu();break;case"zmLTMenu_Rss":zmList.rnSSrchContextMenu();break;case"listsender":t("sender",m);break;case"listrecipient":t("recipient",m);break;case"listsubject":t("subject",m);break;case"openpreview":c=ca(zmInit.rclkId),c.src=m,c.opentype=a.opentype,j=c.msgId,c.msgId.indexOf("t")||(j=c.msgId.substring(1));var o=zmUtil.getMLConversionValue(),p=zmPrev.prevDetails().msgId;p&&((0===zmail.mailObj[p].TH||0===o)&&p!==j||0!==o&&zmail.mailObj[p].T!==zmail.mailObj[j].T)?$.when(zmPrev.cmpClose()).then(function(a){a&&(zmContentCache.remove(p),zmList.getMailData(c))}):zmList.getMailData(c),zmUtil.hideMenu();break;case"opentab":c=ca(zmInit.rclkId),c.actionSrc=m,c.opentype=a.opentype,zmsuite.isMaxLimitReached()||zmList.getMailData(c),zmUtil.hideMenu();break;case"openwindow":N(a,b),zmUtil.hideMenu();break;case"viewfullthd":var q=a.from||$(b).attr("data-from");"header"===q&&(d=$(b).closest(".SC_pv"),j=d.attr("data-mid"),j&&zmList.getMailData({msgId:j,type:"lt",opentype:2,src:"conversation"}));break;case"reply":a.from&&"ctxtMenu"===a.from&&(d=zmsuite.getCenter()[1].$el,j=zmInit.rclkId.indexOf("t")?zmInit.rclkId:zmInit.rclkId.substring(1),k={mode:"reply",msgId:j,prevElem:d},k.actionSrc=m,zmUtil.invokeComposer(k)),zmUtil.hideMenu();break;case"replyall":a.from&&"ctxtMenu"===a.from&&(d=zmsuite.getCenter()[1].$el,j=zmInit.rclkId.indexOf("t")?zmInit.rclkId:zmInit.rclkId.substring(1),k={mode:"replyall",msgId:j,prevElem:d},zmUtil.invokeComposer(k)),zmUtil.hideMenu();break;case"forward":a.from&&"ctxtMenu"===a.from?(d=zmsuite.getCenter()[1].$el,j=zmInit.rclkId.indexOf("t")?zmInit.rclkId:zmInit.rclkId.substring(1),k={mode:"fwdi",msgId:j,prevElem:d}):k={mode:"fwdi"},"2"===zmail.collabVersion&&$.publish("/mail/forwardmail",{mailID:j,mode:"forward"}),zmUtil.invokeComposer(k),zmUtil.hideMenu();break;case"FwdAttach":var r=zmUtil.getSelectedMails();if(zmUtil.hideMenu(),r[1].length){var s=r[0].length+zmUtil.getTotalMailCountInThreads(r[1]);zmmailAct.confThreadAction("multipleforward",s,function(){zmUtil.invokeComposer({mode:"fwdme"})},zmInit.getListingDetObj())}else zmUtil.invokeComposer({mode:"fwdme"});break;case"select_all":case"select_none":case"select_unread":case"select_read":case"select_flag":case"select_label":case"select_attach":zmList.unchkAll(),ha(a);break;case"view_all":case"view_unread":case"view_flag":case"view_label":case"view_attach":case"view_archive":a&&a.isAttachOnly?(ia(),zmUtil.hideMenu()):ja(a);break;case"customize":var u,v=a.value;"date"===v?u="DT":"size"===v&&(u="SZ"),zmList.changeViewColumns(u),zmUtil.hideMenu();break;case"addTask":j=zmInit.rclkId.indexOf("t")?zmInit.rclkId:zmInit.rclkId.substring(1),e=zmail.mailObj[j],f=e.SB?_zm.unescapeTags(e.SB):"",g=e.SM?_zm.unescapeTags(e.SM):"",zmUtil.hideMenu(),zmUtil.loadTask({action:"addPopupTask",groupId:zmail.zuid,tasks:{SUMMARY:g,TITLE:f},addparams:{msgid:j,accid:zmail.accId,senderid:e.F},actionSrc:m});break;case"addFilter":j=zmInit.rclkId.indexOf("t")?zmInit.rclkId:zmInit.rclkId.substring(1),zmUtil.hideMenu(),zmPreviewTemplate.createNewFilter({action:l,msgId:j,actionSrc:m});break;case"addNote":j=zmInit.rclkId.indexOf("t")?zmInit.rclkId:zmInit.rclkId.substring(1),e=zmail.mailObj[j],f=e.SB?_zm.unescapeTags(e.SB):"",g=e.SM,zmUtil.hideMenu(),zmUtil.loadNotes("popup",{desc:g,title:f,addparams:{msgid:j,accid:zmail.accId,senderid:e.F,actionSrc:m}});break;case"msi-prev":zmPreviewTemplate.loadPrevMail();break;case"msi-next":zmPreviewTemplate.loadNextMail();break;case"customize_view":zmInit.customizeDisplayDensity(a.value),zmUtil.hideMenu();break;case"sweep":Ia();break;case"chatlet":zmUtil.createContexualChat(b);break;default:zmUtil.hideMenu()}}},updOutbox:function(a,b){zmInit.sendLoadOutbox("hide"),zmList.unchkAll();var c=a.res.split(",")[0];if(c>0)for(var d=0;d<c;d++)zmmailAct.updateCount({fId:zmail.folId.oId,mode:"dec"});var e=zmInit.getListingDetObj();if("zm_Container"===zmTab.currentTab&&zmail.folId.oId===e.fId){var f={folId:zmail.folId.oId};$(zmail.mailCenter.listElem).html(""),zmCache.clearListObj(),zmInit.setListingDetObj({});var g=zmPrev.prevDetails("zm_Container").msgId;if(g&&"sendM"===b.mode){var h=b.mIds||[];h.indexOf(g)===-1&&(f.retainPreview=!0)}zmInit.foldView(f)}},sendOutbox:function(a){zmUtil.hideMenu(),zmInit.sendLoadOutbox("show"),a||(a="sendM");var b={aId:zmail.accId},c={mode:a};if(b.mode=a,"sendM"===a){var d=zmUtil.getSelectedMails()[0];b.mId=d.join(","),c.mIds=d}zmAjq.XHR({u:zmail.conPath+"/cOpt.do",t:"POST",fn:zmList.updOutbox,p:b,csr:"s",ep:c})},getElemObj:B,consPreview:H,getListingElemObj:C,markFolderAsReadHandler:function(a,b){b=b||[];var c,d,e,f,g,h,i,j=0!==b.length,k=zmInit.getListingDetObj(),l="unread"===k.view,m=!1,n=zmail.mailObj,o=[],p=[],q={action:"read"};if(j||(g=k.flag&&"flag"||k.view||k.label,c=zmail.listObj[g],b=c&&c.MO||[]),h=b.length){for(i=0;i<h;i++){if(d=n[b[i]],!j&&(d.TH||l&&d.FD===a)){m=!0;break}a===d.FD&&(d.TH?p.push(d.M):o.push(d.M))}m?(e="unread"===k.view?"zm_unread":"",g=k.label&&"label"||g,f=k.label||k.flag,zmCache.clearListObj(),zmInit.setListingDetObj({}),zmInit.foldView({folId:e,view:g,viewId:f,reInitialize:!0})):(0===zmUtil.getMLConversionValue()?(o=o.concat(p),q.mailId=o):(q.mailId=o,q.tmailId=p),zmmailAct.rapplyAction({result:"success"},q))}},markFolderAsArchived:function(a,b){if(a){var c;zmUtil.isFolderId(a)&&(c=zmList.getRowInfo(a,"zmlTreeH","info")),c&&(b?c.IA=parseInt(b):c.IA=1)}},showMailListing:function(a,b){b=b||{};var c,d,e,f="",g=!1,h={unread:"zm_unread",all:"zm_all",flag:"zm_flag"},i=b&&!(b.toSelFol===!1);if(a&&!$.isEmptyObject(a)?(c=a,f=c.fId||c.folId||"",d=c.view||"",e=c.viewId||""):(c=zmInit.getListingDetObj(),d=c.flag&&"flag"||c.label&&"label"||c.view||c.attach&&"attach",f=c.fId||c.folId||h[d]||"",e=c.label||c.flag),i?f?zmUtil.isViewId(f)?(g=!0,zmail.mailLeft.selRow(f,"zmlviewH",!0)):zmUtil.isSharedFolder(f)?(g=!0,zmail.mailLeft.selRow(f,"zmlSTreeH",!0)):zmUtil.isFolderId(f)?(g=!0,zmail.mailLeft.selRow(f,"zmlTreeH",!0)):zmUtil.isLabelId(f)&&(g=!0,zmail.mailLeft.selRow(f,"zmllabelH",!0)):e&&zmUtil.isLabelId(e)&&(g=!0,zmail.mailLeft.selRow(e,"zmllabelH",!0)):g=!0,g){$(zmail.mailCenter.listElem).html(""),zmCache.clearListObj(!0),zmInit.setListingDetObj({});var j={folId:f,view:d,viewId:e,reInitialize:!0,sortOrder:b.sortAscending,hashDeffObj:b.mlDefObj};b.retainPreview&&(j.retainPreview=!0),zmInit.foldView(j),zmInit.updateHeaderBand()}else b.mlDefObj&&b.mlDefObj.resolve()},getViewBasedMsgList:function(a,b,c){var d=[],e=zmUtil.getMLConversionValue();return a&&(b||(b=zmInit.getListingDetObj()),b.fId===zmail.folId.spId&&2===e?e=1:b.fId!==zmail.folId.sId&&b.fId!==zmail.folId.tId||(e=0),1===e?d=zmList.getMailSummaryList(b,a):0!==e&&(d=zmList.getListForAllMailsView(b,a))),zmail.convSortOrder&&c?d.reverse():d},setScrollUnreadView:function(a,b){var c=a.find("#"+b);$(c).length&&$(a).length&&a.scrollTop($(a).scrollTop()+$(c).offset().top-$(a).offset().top)},isMailListedInApp:function(a){var b,c=zmUtil.getFolId(),d=zmail.listObj[c]&&zmail.listObj[c].MO||[];return b=d.indexOf(a),b!==-1},isMailListedInSearch:function(a){if(zmSearchUtil.isWorkspaceAvailable()){var b,c=zmSearchUtil.getSearchList();if(b=c.indexOf(a),b!==-1)return!0}return!1},setMailSelection:function(a,b,c){var d,e,f,g,h,i=!1;if(f=Boolean(zmail.mailObj[a].TH),zmsuite.getWorkSpace(zmTab.currentTab)[1]&&(e=zmsuite.getWorkSpace(zmTab.currentTab)[1].$el),d=f&&"lt"===b?c.find("#t"+a):c.find("#"+a),g=Boolean(d&&d.length&&d.is(":visible")),!g&&e&&e.attr("data-mid")&&(d=c.find("#"+e.attr("data-mid"))),d&&d.length&&(g&&d.is(":visible")?(c.find("div.zmL").removeClass("zmSLst"),d.addClass("zmSLst")):d.parent().hasClass("zmTV")&&(c.find("div.zmL").removeClass("zmSLst"),d.parent().prev().addClass("zmSLst"))),g&&e)e.attr("data-mid",a),"content"===b&&f&&e.hasClass("tmail")&&e.attr("data-ty","th"),"lt"===b&&e.attr("data-ty","lt"),zmList.doThreadPath(d,"add"),i=!0;else if(d&&d.length&&d.parent().hasClass("zmTV")&&e){var j=d.parent().prev().attr("id");j="t"===j.charAt(0)?j.substr(1):j,e.attr("data-mid",j),e.attr("data-ty","lt"),zmList.doThreadPath(d,"remove"),i=!0}i&&"zmStreamsApp"!==zmTab.currentTab&&"zm_srch1"!==zmTab.currentTab&&(b="content"===b?"th":b,h=zmList.getListingElemObj({msgId:a,type:b,opentype:0}),"lt"===b&&zmail.mailObj[a].TH&&a.indexOf("t")===-1&&(a="t"+a),zmPrev.PvNt(a,b,0,zmTab.currentTab,h))},clearcpvReq:function(){b=void 0},changeListingView:function(a,b,c){if(b||(b=zmUtil.getFolId()),zmUtil.hasFolSpecConversation(b)){var d=function(c){"success"===c.status&&(zmfolAction.updateCV(b,a),zmList.showMailListing())},e=function(a){var b=a.msg;b&&_zm.succErrMsg("e",b)},f=function(){var c={accId:zmail.accId,mode:"updateConversationView",folId:b,convView:a};zmAjq.XHR({u:zmail.conPath+"/folAction.do",t:"POST",fn:d,onerror:e,p:c})};c?d({status:"success"}):f()}},setListingType:function(a,b){var c={accId:zmail.accId,folderSpec:a,mode:"setlisttype"},d=function(b){"success"===b.result&&(zmail.listObj={},zmail.mailObj={},zmail.folviewThread=a,zmUtil.closeMailTabs(),zmfolAction.updateFoldersCV(a),zmList.showMailListing())};return b?void d({result:"success"}):zmAjq.XHR({u:zmail.conPath+"/listOpt.do",t:"POST",fn:d,p:c})},setConversationOrder:function(a){a=Number(a);var b={accId:zmail.accId,isAscending:a,mode:"setsortorder"},c=function(a){"success"!==a.result&&_zm.succErrMsg("e",d.global.errmsg)};return zmAjq.XHR({u:zmail.conPath+"/listOpt.do",t:"POST",fn:c,p:b}).then(function(){zmUtil.succErrMsg("s",f.common.succConvSortorder,{hideAfter:3e3}),zmail.convSortOrder=a})},changeLisingSortOrder:function(a){var b=zmUtil.getFolId();zmail.listObj[b]&&zmList.showMailListing({},{retainPreview:!1,sortAscending:a})},showBulkActionBand:function(a){var b=!1,c=300;if("zm_Container"===zmTab.currentTab){var d=zmUtil.getFolId();b=zmail.listObj[d].showNextPage}else"zm_srch1"===zmTab.currentTab&&(b=zmSearchUtil.hasNextPage());var e,g,i=zmUtil.getCheckedMailCount();if(i)if(i>c)e=zmText.applyArgs(h.bulkaction.common.selexceed,{n:c}),g="clearAndSelect",zmInit.listingBand.createBulkActionBand(e,g);else if(b&&i<=c&&i>=10){e=zmText.applyArgs(f.common.multiplemail,{count:i}),g="selectFolder";var j=zmInit.getListingDetObj();"zm_Container"===zmTab.currentTab&&""===j.view&&""===j.flag&&""===j.label&&""===j.attach&&"selFilter"!==a&&(g="selectFolderViewAll"),zmInit.listingBand.createBulkActionBand(e,g)}else zmInit.listingBand.removeBulkActionBand()},showThreadTree:function(){var a,b,c=zmTab.currentTab;if("zm_Container"===c||"zm_srch1"===c){var d=zmUtil.getSelectedMails();if(b=d[1][0],!b){var e=d[0][0];e&&zmail.mailObj[e]&&zmail.mailObj[e].TH&&(b=e)}if(b){a=zmList.getListingElemObj({msgId:b,type:"lt",tabId:c,opentype:0});var f=a.rowElem||[];f.length&&f.hasClass("zmTLst")||(zmList.hideThreadTree(),zmList.showHideThread(f,a))}}},hideThreadTree:function(){var a,b=zmTab.currentTab;"zm_Container"!==b&&"zm_srch1"!==b||(a=B(b),n(a),m(a))},addTaskIndicator:function(a){var b,c,d,e,f,g,h=["zm_Container","zm_srch1"],i=h.length;if(a.data.tasks.email&&a.data.tasks.email.msgid){for(b=a.data.tasks.email.msgid,zmail.mailObj[b]&&zmCache.updateObj({mode:"upd",msgId:b,key:"MA",val:32|zmail.mailObj[b].MA}),f=0;f<i;f++)g=h[f],zmsuite.isWorkspaceAvailable(g)&&(d=zmCenterListing.mailObjectAPI.getViewObject(b,g),d?e=d.$element:(c=zmsuite.getCenter(g)[0].getNodes()[2].$el,e=c.find("#"+b)),e.length&&!e.find(".SC_mdata").length&&e.find(".zmDtl").prepend('<div class="SC_mdata"></div>'));zmPreviewTemplate.updateTaskComponent(b)}},addNoteIndicator:function(a){var b,c,d,e,f,g,h=["zm_Container","zm_srch1"],i=h.length;if(a.email&&a.email.accid&&a.email.msgid){for(b=a.email.msgid,zmail.mailObj[b]&&zmCache.updateObj({mode:"upd",msgId:b,key:"MA",val:64|zmail.mailObj[b].MA}),f=0;f<i;f++)g=h[f],zmsuite.isWorkspaceAvailable(g)&&(d=zmCenterListing.mailObjectAPI.getViewObject(b,g),d?e=d.$element:(c=zmsuite.getCenter(g)[0].getNodes()[2].$el,e=c.find("#"+b)),e.length&&!e.find(".SC_mdata").length&&e.find(".zmDtl").prepend('<div class="SC_mdata"></div>'));zmPreviewTemplate.updateNoteComponent(b)}},getSelectedRowCount:function(){var a=zmUtil.getCheckedMailList();return a[0].length+a[1].length},toggleAVView:function(a,b){var c=zmail.listObj.attachVw&&zmail.listObj.attachVw.attachUtil.viewType;c&&c!==b&&($(a).closest("ul").find("b").removeClass("SC_sel"),$(a).closest("b").addClass("SC_sel"),zmail.listObj.attachVw.toggleView())},resetSelectionInfo:ga,updateAttachmentCache:ua,isListingChecked:P,isAllListingChecked:O,getDupThdRowId:X,sendMailDataReq:A,showMailPreview:pa,loadUnreadMails:J,getCachedAttachmentData:F,updateSchemaAction:wa,stimulateToTabView:y};return function(){$.subscribe("zmailReconnect",function(){if(window.console.log("Updating Listing View, in respond to zmailReconnect - "+new Date),zmInit.getFolderTreeCount(),zmInit.getAccountInfo(),"zmStreamTree"!==zmail.mailLeft.selLayerId){var a=!0;"zmStreamsApp"===zmTab.currentTab&&(a=!1);var b=zmail.listObj[zmUtil.getFolId()]?zmail.listObj[zmUtil.getFolId()].sortOrder:zmail.sortOrder;zmList.showMailListing({},{retainPreview:!0,sortAscending:b,mlDefObj:void 0,toSelFol:a})}})}(),zmail.postJsDeffered.done(function(){zmail.mailAttachments={},zmail.attachmentContainer=new zmail.Container({store:zmail.mailAttachments,containerSize:200,evictCount:20,idName:"id",considerAsHitOnRetrieval:!0})}),Ja}(),window.zmPrev=function(){"use strict";var a=zmText.get("mail"),b=a.listing,c=a.preview,d=function(a,b){var c,d=!0;b=b||zmInit.getListingDetObj(),a.indexOf("t")!==-1?(c=a.substring(1,a.length),0===zmList.getMailSummaryList(b,zmail.mailObj[c].T).length&&(d=!1)):(c=a,d=!1),("unread"===b.view&&1===zmail.mailObj[c].S||b.flag&&("-1"===b.flag&&0===zmail.mailObj[c].NFG||"-1"!==b.flag&&zmail.mailObj[c].NFG!==b.flag))&&(d||zmList.remReadMail(),zmList.setEmptyListing())},e={prevDetails:function(a){a=a||zmTab.currentTab;var b="",c="";return zmsuite.isWorkspaceAvailable(a)&&zmsuite.getCenter(a)[1]&&(b=zmsuite.getCenter(a)[1].$el.attr("data-mid")||"",c=zmsuite.getCenter(a)[1].$el.attr("data-ty")||""),{msgId:b,type:c}},isPrevOpen:function(a){return a=a||zmTab.currentTab,zmsuite.getCenter(a)[1].$el.hasClass("shw")},posAView:function(a){var b=$("#zmC"+a+" div.zmPAtt");b.is(":visible")&&b[0].scrollIntoView()},PvNt:function(a,b,c,d,e){var f,g,h,i,j,k,l;if(f=e.listArr||[],j=zmUtil.getFolId(),a.indexOf("t")||(a=a.substring(1)),f.length&&(i=$.inArray(a,f),g=f[i-1],h=f[i+1]),g||"th"===b&&(k=zmail.mailObj[a]||{},k.TH&&zmail.listObj[j]&&(l=zmList.getDupThdRowId(a,j),l&&(f=zmail.listObj[j].MO,f.length&&(i=f.indexOf(l),g=f[i-1])))),h||"th"===b&&(k=zmail.mailObj[a]||{},k.TH&&zmail.listObj[j]&&(l=zmList.getDupThdRowId(a,j),l&&(i=f.indexOf(l),h=f[i+1]))),g||h?g?h?zmUtil.enableNavigation(d,"both"):zmUtil.disableNavigation(d,"next"):zmUtil.disableNavigation(d,"prev"):zmUtil.disableNavigation(d,"both"),2===c){var m=function(a){return function(){a&&zmUtil.disableNavigation(a,"both"),$.unsubscribe("mail/listing/viewchanged",m)}}(d);$.subscribe("mail/listing/viewchanged",m)}},cmpClose:function(a){a=a||zmTab.currentTab;var b=$.Deferred();if(zmsuite.getCenter(a)[1]){var c=zmsuite.getCenter(a)[1].getNodes()[1].$el;zmPreviewTemplate.unsubscribeNotesTasks(c);var d=zmPrev.prevDetails(a).msgId,e="";if(d&&zmail.mailObj[d]&&(e=zmail.mailObj[d].T||"",$.publish("mail/preview/unload",{prevElem:c,msgId:d,thdId:e})),"undefined"!=typeof zmComp){var f=zmsuite.getCenter(a)[1].getNodes()[1].$el,g=[],h=f.find(".zm_cmp");h.each(function(){var a=$(this).attr("id"),b={};a&&(b=a.split("_"),g.push({cmpId:b[0],msgId:b[1]}))}),g.length?zmComp.saveReply({deferObj:b,cmpList:g}):b.resolve(!0)}else b.resolve(!0)}else b.resolve(!0);return b},composeReply:function(a,b){var d=zmsuite.getCenter()[1].$el,e=b.M;a=$.extend(a,zmUtil.getCmpViewType()),zmUtil.isInlineCompose()?b&&b.DMID?(a.prevDOM=d.find("#zmCon"+a.viewType+b.DMID),zmPreviewTemplate.loadInlineCompose(e,a.prevDOM,a.mode)):zmUtil.getMailContent(e).done(function(b){a.prevElem=d,a.msgId=e,zmContentCache.isCached(e)&&(a.draftCont=b),zmUtil.invokeComposer(a)}).fail(function(){_zm.succErrMsg(c.inlinecompose.error)}):(a.prevElem=d,a.msgId=e,zmUtil.invokeComposer(a))},clsPreview:function(a){var b=a||zmTab.currentTab;"list"===a&&(b="zm_Container"),$.when(zmPrev.cmpClose(b)).then(function(b){if(b){var c,d,e,f;a=a||zmTab.currentTab;var g="zm_srch1"===a?"zm_srch1":"zm_Container";zmPrev.prevDetails(g).msgId&&(a.indexOf("zm_tab")===-1&&(zmTopMenus.util.hide({type:"functional",isForceHide:!0,tabId:g}),zmUtil.hideMenu()),zmUrlAct.update({from:"zmCenter",remove:!0}),zmRestore.saveState("preview",{p:""},{})),"list"===a?(c=zmPrev.prevDetails("zm_Container").msgId,e=!0,f=zmList.getElemObj("zm_Container")):c=zmPrev.prevDetails().msgId,zmUtil.setInlineCmpScope(!1),f=f||zmList.getElemObj(a),f.rowElem=$(f.listElem).find(".zmSLst"),$(f.prevElem).attr("data-mid",""),$(f.prevElem).attr("data-ty",""),$(f.prevElem).removeClass("SC_notr"),f.mainElem.removeClass("SC_sw"),zmList.listingFocused=!0,f.rowElem.length&&f.rowElem.removeClass("zmSLst"),d="zm_Container"===a||"list"===a?zmInit.getListingDetObj():zmsuite.getCenterOuter().$el.data("data-detail"),d&&"unread"===d.view&&c&&(e||zmList.remReadMail(),(""===d.fId&&0===zmInit.getUnreadViewCount()||""!==d.fId&&!zmUtil.isSharedFolder(d.fId)&&0===zmail.folCount[d.fId].c)&&zmList.setEmptyListing()),f.rowElem.length&&zmList.doThreadPath(f.rowElem,"remove"),a.indexOf("zm_srch")?zmsuite.getCenter("zm_Container")[1].close():zmsuite.getCenter(a)[1].close(),zmContentCache.remove(c),$.publish("/mail/previewclosed",{})}})},updatePrevOnDeletion:function(a,b){var c,d,e,f,g,h;b=b||"zm_Container",a.indexOf("t")||(a=a.substring(1)),"zm_Container"===b?(e=zmInit.getListingDetObj(),c=zmUtil.getFolId(),h=$(zmail.mailCenter.listElem),"th"===h.find("#"+a).data("ty")?g=zmList.getViewBasedMsgList(zmail.mailObj[a].T,e):zmail.listObj[c]&&(g=zmail.listObj[c].MO)):"zm_srch1"===b&&(e=zmsuite.getCenterOuter(b).$el.data("data-detail"),c=e.view,h=zmsuite.getCenter(b)[0].getNodes()[2].$el,g="th"===h.find("#"+a).data("ty")?zmList.getListForAllMailsView(zmail.mailObj[a].T,e):zmSearchUtil.getSearchList()),d=$.inArray(a,g),d!==-1&&(f=g[d+1],f||(f=g[d-1])),f&&b===zmTab.currentTab?(zmail.mailObj[f].TH&&0!==zmUtil.getMLConversionValue()&&"zm_srch1"!==b&&(f="t"+f),$.when(zmPrev.cmpClose(b)).then(function(c){c&&(zmContentCache.remove(a),zmList.getMailData({msgId:f,type:"lt",opentype:0,tabId:b}))})):zmPrev.clsPreview(b)},setCountinPreview:function(a){var c,d,e,f,g=zmPrev.prevDetails(),h=g.msgId;a.rowElem&&a.rowElem.length||($("#"+h).length?a.rowElem=$(a.listElem).find("#"+h):a.rowElem=$(a.listElem).find("#t"+h));var i,j=a.rowElem;if(j.removeClass("zmSLst"),c=$(a.prevElem),c.find(".SC_Popn").length&&c.find(".SC_Popn").remove(),d=zmUtil.getCheckedMailCount(),e=$("<div/>"),e.addClass("SC_pct SC_Popn"),1===d)e.text(b.common.singlemail);else{var k=b.common.multiplemail,l=zmText.applyArgs(k,{count:d});e.text(l)}if(f=a.mainElem.height()-55,e.height(f),i=c.find(".SC_frt").eq(0).find("ul"),i.eq(0).hide(),i.eq(1).hide(),c.find(".SC_pct").hide(),c.find(".zm_shwconv").parent().hide(),c.find(".SCS_postWra").hide(),c.find(".zms_fixed").length){c.find(".zms_fixed").hide();var m=c.find(".SC_Twpr"),n=String(m.css("bottom"));"0px"!==n&&(m.data("bottom",n),m.css("bottom","0px"))}zmsuite.getCenter()[1].getNodes()[1].$el.append(e),c.find(".SC_phd").hide(),c.find(".zmQry").hide(),zmList.doThreadPath(j,"remove")},removeCountinPreview:function(a){var c,d,e,f=$(a.prevElem);if(c=zmPrev.prevDetails(),d=c.msgId,e=zmUtil.getCheckedMailCount(),e>0)if(1===e)f.find(".SC_Popn").text(b.common.singlemail);else{var g=b.common.multiplemail,h=zmText.applyArgs(g,{count:e});f.find(".SC_Popn").text(h)}else{if(f.find(".SC_Popn").remove(),f.find(".SC_pct").show(),f.find(".zm_shwconv").parent().show(),f.find(".SCS_postWra").show(),f.find(".zms_fixed").length){f.find(".zms_fixed").show();var i=f.find(".SC_Twpr");i.css("bottom",i.data("bottom"))}if(f.find(".SC_frt").eq(0).find("ul").show(),d){f.find(".SC_phd").show();var j;j="zm_srch1"===zmTab.currentTab?0:zmUtil.getMLConversionValue(),"lt"===c.type&&1===zmail.mailObj[d].TH&&0!==j?a.rowElem=$(a.listElem).find("#t"+d):a.rowElem=$(a.listElem).find("#"+d),a.rowElem.addClass("zmSLst")}}},toggleMailContentViewMode:function(a,b,c){var d,e,f,g=$(a),h=g.attr("data-mid"),i=g.attr("id"),j=g.next(),k=!1;if(c=c||zmTab.currentTab,i.indexOf("zmHdrT")||(b=2),3===b?(d={contElem:$(a).closest(".SC_pct"),hdrElem:$(a),viewDetails:{view:"notification"}},d.prevElem=d.contElem.parent(),e=[]):(d=zmList.getElemObj(c),e=d.listElem),zmList.setMailSelection(h,"content",$(e)),0===b){var l=zmsuite.getWorkSpace(c)[1].$el,m=l.find(".SC_ptit").find(".SC_phd"),n=zmPreviewTemplate.getSubjectToPreview(zmail.mailObj[h].SB);m.html(n),!zmail.mailObj[h].TH||(0!==zmUtil.getMLConversionValue()&&zmail.mailLeft.selId!==zmail.folId.sId||"zm_Container"!==zmTab.currentTab)&&"zm_srch1"!==zmTab.currentTab||m.append('<i class="msi-thread" data-event="viewfullthd" data-from="header"></i>'),zmPrev.removeCountinPreview(d),zmPreviewTemplate.setPreviewHeaderHeight(d)}0===j.length&&(k=!0,zmail.mailObj[h].FD!==zmail.folId.dId&&(f=$("<div />"),f.attr("id","zmCon"+i.substr(5)),setTimeout(function(){f.children().length||zmComponent.loadingBand({container:f[0],type:"pagination"})},100),g.after(f)),zmList.getMailData({msgId:h,type:"content",from:g,opentype:b,tabId:c},d)),zmail.mailObj[h].T&&!$("t"+h).length&&$(e).find(".zmL").removeClass("SC_check"),k||zmPreviewTemplate.applyHeaderState(g),0===b&&g.parent().hasClass("js-scrolltop")&&zmPreviewTemplate.alignMailTopToPreview(String(h)),3!==b&&zmTopMenus.util.show({type:"functional",msgId:zmUtil.getSelectedMails()[0][0],tabId:zmTab.currentTab})},setMailDOMContent:function(a,b){var c=zmPreviewTemplate.getTemplate("content",{data:a,prms:b});c=$(c);var d;a.NEWATT&&a.NEWATT.length&&(d=zmAttach.build({appName:"mail",attList:a.NEWATT,zipType:"downloadall",showMOpt:!0,showTag:!0,supportDrag:!0,attClass:"zmAch",attListClass:"zmPAtt",fileNameLen:23,entityInfo:{id:b.msgId}})),d&&c.find(".zmPCnt").after(d);var e,f,g,h=b.opentype,i=b.msgId,j=b.tabId||zmTab.currentTab;"content"===b.type?(e=$(b.from),f=$(e.next()),f.html(""),f.append($(c).children().eq(1).children()),c=f,zmPreviewTemplate.applyHeaderState(e),"bulk_mail"!==b.load_action&&e.closest(".SC_pct").addClass("SC_Tfcs"),0===h&&(zmPrev.removeCountinPreview(zmList.getElemObj(j)),e.parent().hasClass("js-scrolltop")&&zmPreviewTemplate.alignMailTopToPreview(String(i)))):(g=c,b.parentElm?$(b.parentElm).append($(g)):zmsuite.getCenter(j)[1].getNodes()[1].push($(g))),3!==h&&zmail.mailObj[i]&&!zmUtil.isSharedFolder(zmail.mailObj[i].FD)&&(b.mailContElem=$(c),zmPreviewTemplate.showNotes(b),zmPreviewTemplate.showTasks(b),zmPreviewTemplate.showProjectsEntities(b)),zmUtil.addSelectMenu({applyDOM:[$(c).find(".zmPCon")[0]]}),zmUtil.applyLBDots(c.find("[id^=vfc]").parent())},changeFlag:function(a,b){var c=b.flag;zmPrev.flagMail(a,c),zmUtil.hideMenu()},flagMail:function(a,b){var c,d,e={};d=a.parents(".zmPHdr"),c=d.attr("data-mid"),e.msgId=[c],e.thd=[],e.fVal=b,zmmailAct.applyActions("flag","click",e)},consFlagContextMenu:function(a){var c,d,e;return c=a.target||a.srcElement,d=$(c),d.hasClass("zmflg")&&(e={clk:function(a,b){zmPrev.changeFlag(d,b)},conArr:[{htm:"<i class='zm_icn zmflg zm_fgB'></i>"+b.flagmenu.infoflag,data:{flag:"1"}},{htm:"<i class='zm_icn zmflg zm_fgR'></i>"+b.flagmenu.important,data:{flag:"2"}},{htm:"<i class='zm_icn zmflg zm_fgG'></i>"+b.flagmenu.followup,data:{flag:"3"}},{sep:!0},{htm:"<i class='zm_icn zmflg'></i>"+b.flagmenu.clearflag,data:{flag:"0"}}]},zmsuite.showContextMenu(a,e),zmUtil.stopEvents(a)),!1},getHeader:function(a){return zmPreviewTemplate.getTemplate("header",a)},updatePvNtforNewMails:function(){if(zmsuite.isWorkspaceAvailable("zm_Container")&&$(zmail.mailCenter.prevElem).hasClass("shw")){var a,b,c=zmPrev.prevDetails("zm_Container").msgId,d=zmUtil.getFolId();a=$("#"+c).length>0?c:"t"+c,b=zmList.getElemObj("zm_Container"),b.rowElem=$("#"+a),b.listArr=zmail.listObj[d]?zmail.listObj[d].MO:[],zmPrev.PvNt(a,"lt",0,"zm_Container",b)}},show:function(a,d){var e={},f="",g=!1;f=$(d).closest(".SC_pct").find(".zmPHdr").attr("data-mid");var h=$(d).closest("li"),i=[],j=zmail.mailObj[f],k=j.FD;if(g="zm_Container"!==zmTab.currentTab&&(j.streams||zmPreviewTemplate.isMailOpenedViaStreams(d)),zmail.folId.dId===j.FD)i=[{htm:c.contextmenu.editdraft,data:{action:"editdraft",msgId:f}},{htm:c.contextmenu.discarddraft,data:{action:"delete",msgId:f}}];else if(g)i=i.concat([{htm:c.contextmenu.editasnew,data:{action:"editasnew",msgId:f}},{sep:!0},{htm:c.contextmenu.save,data:{action:"save",msgId:f}},{htm:c.contextmenu.print,data:{action:"print",msgId:f}},{htm:c.contextmenu.showorg,data:{action:"original",msgId:f}},{htm:c.contextmenu.garbledmsg,data:{action:"garbled",msgId:f}}]),i=i.concat(zmStreamsApp.util.getDropdownMenu(f,"1"));else{if(j&&k&&!zmUtil.isSharedFolder(k,"R")&&j.FD!==zmail.folId.sId){var l=j.S?"markunread":"markread",m=j.S?b.maillistopt.markunread:b.maillistopt.markread;i=i.concat([{htm:m,data:{action:l,msgId:f}},{sep:!0}])}var n={allowed:void 0};"2"===zmail.collabVersion&&$.publish("/mail/collab/share/status",{mailID:f,config:n}),n.allowed!==!0||zmUtil.isSharedFolder(k)||(j.TH?i.push({htm:c.contextmenu.sharethd,data:{action:"share",from:"preview",msgId:f}}):i.push({htm:c.contextmenu.share,data:{action:"share",from:"preview",msgId:f}}));var o=zmText.get("zmreminder").watch.setrem;if(zmList.isRMOBJ(f)&&(o=zmText.get("zmreminder").watch.updrem),zmUtil.isSharedFolder(k,"R")||(i=i.concat([{htm:c.contextmenu.editasnew,data:{action:"editasnew",msgId:f}},{sep:!0}])),zmUtil.isZohoAccount(zmail.accId)&&!zmUtil.isSharedFolder(k)&&(i=i.concat([{htm:o,data:{action:"addtowatch",msgId:f}},{sep:!0}])),i=i.concat([{htm:"<i class='msi-larrow'></i>"+c.contextmenu.addto,data:{action:"addtolist",dropMenudirection:"left"},child:function(){return zmPreviewTemplate.getAddToMenu(f)}},{sep:!0},{htm:c.contextmenu.save,data:{action:"save",msgId:f}},{htm:c.contextmenu.print,data:{action:"print",msgId:f}},{htm:c.contextmenu.showorg,data:{action:"original",msgId:f}},{htm:c.contextmenu.garbledmsg,data:{action:"garbled",msgId:f}}]),j&&!zmUtil.isSharedFolder(k)){if(i.push({sep:!0}),j.FD===zmail.folId.spId)i=i.concat([{htm:b.maillistopt.notspam,data:{action:"marknotspam",msgId:f}},{sep:!0}]);else{var p=j.AR;p||(i=i.concat([{htm:b.maillistopt.markspam,data:{action:"markspam",msgId:f}},{sep:!0}]))}i.push({htm:b.contextmenu["delete"],data:{action:"delete",msgId:f}})}}var q=[{htm:b.contextmenu.reply,data:{action:"reply",from:"prvInline",msgId:f,par:h}},{htm:b.contextmenu.replyall,data:{action:"replyall",from:"prvInline",msgId:f,par:h}},{htm:b.contextmenu.forward,data:{action:"forward",from:"prvInline",msgId:f,par:h}}],r=[{htm:c.attachmentmenu.downloadaszip,data:{action:"downloadall",msgId:f}}];e.align="pright",e.clk=function(a,b){zmPrev.bindAction(a,b,{sourceDOM:$(d).closest("li")})},"zm_prvRepLst"===a?(e.align="pleft",e.list=q,e.par=$(d).closest("li"),$(d).closest("b").addClass("SC_ddn")):"zm_dldLst"===a?(e.list=r,e.par=$(d).closest("li"),$(d).closest("b").addClass("SC_ddn")):"zm_preaLst"===a&&(e.list=i,e.par=$(d).closest("li"),$(d).closest("b").addClass("SC_ddn")),e.paddingOffset=5,zmsuite.showMenu(e)},isEntityOpenedInPreview:function(a,b){if(!zmail.mailObj[a])return!1;b=b||"zm_Container";var c=zmPrev.prevDetails(b).msgId;if(a===c)return!0;if(zmail.mailObj[a].TH){var d=zmail.mailObj[a].T;return d&&c&&zmail.listObj[d]&&zmail.listObj[d].MO.indexOf(a)!==-1}return!1},bindAction:function(a,b,c){c=c||{};var d=a.action,e=a.msgId,f={},g=a.from;e||(e=$(b).closest(".SC_pct").find(".zmPHdr").attr("data-mid")),"view"!==d&&zmUtil.hideMenu();var h="t",i=!1,j=null;g&&"prvInline"===g&&(h="p",i=!0,j=a.par);var k=zmail.mailObj[e];switch(k&&k.streams&&(f.groupId=k.groupId,f.streamsView=!0),d){case"reply":i?zmComp.chgReply("reply",h,e,j):(f.mode="reply",zmPrev.composeReply(f,k));break;case"replyall":i?zmComp.chgReply("replyall",h,e,j):(f.mode="replyall",zmPrev.composeReply(f,k));break;case"forward":"2"===zmail.collabVersion&&$.publish("/mail/forwardmail",{mailID:e,workspaceID:zmTab.currentTab,containerDOM:c.containerDOM,mode:"forward"}),i?zmComp.chgReply("fwdi",h,e,j):(f.mode="fwdi",zmPrev.composeReply(f,k));break;case"editasnew":i?zmComp.chgReply("eanew",h,e,j):(f.mode="eanew",f.msgId=e,zmUtil.invokeComposer(f));break;case"save":zmPreviewTemplate.saveHTMLFile({mId:e,mode:"msg"});break;case"print":zmPreviewTemplate.printMsg({mId:e});break;case"original":zmPreviewTemplate.showOrgMsg({mId:e});break;case"garbled":zmPreviewTemplate.garbMsg({mId:e});break;case"delete":zmList.bindAction({action:"delete"});break;case"markunread":zmmailAct.applyActions("unread","dropdown",{thd:[],msgId:[e]});break;case"markread":zmmailAct.applyActions("read","dropdown",{thd:[],msgId:[e]});break;case"markspam":zmmailAct.doActions("spam","dropdown",{thd:[],msgId:[e]});break;case"marknotspam":zmmailAct.doActions("notspam","dropdown",{thd:[],msgId:[e]});break;case"editdraft":var l=zmsuite.getCenter()[1].$el;f.mode="draft",f.msgId=e,f.prevElem=l,zmUtil.invokeComposer(f);break;case"addtotasks":var m=zmail.mailObj[e],n=m.SB?_zm.unescapeTags(m.SB):"",o=m.SM?_zm.unescapeTags(m.SM):"";zmUtil.loadTask({action:"addPopupTask",groupId:zmail.zuid,tasks:{SUMMARY:o,TITLE:n},addparams:{msgid:e,accid:zmail.accId,senderid:m.F}});break;case"addtowatch":zmWatch.showWatch({msgId:e,elem:b,openWatch:"preview_dropdown",loadType:"popup"}),_zm.stopEvents();break;case"addtonotes":m=zmail.mailObj[e],n=m.SB?_zm.unescapeTags(m.SB):"",o=m.SM;var p={addparams:{msgid:e,accid:zmail.defAccId,senderid:m.F}};(64|m.MA)!==m.MA&&(p.title=n,p.desc=o),zmUtil.loadNotes("popup",p);break;case"share":if("2"===zmail.collabVersion){var q=$(c.sourceDOM).parents(".zmPHdr").parents(".SC_pct").parent();$.publish("/mail/view/focuscommentbox",{mailID:e,containerDOM:$(q)[0]})}break;case"addfilter":zmPreviewTemplate.createNewFilter(a);break;case"viewfullthd":zmList.getMailData({msgId:e,type:"lt",opentype:2,src:"conversation"});break;case"copylink":case"watch":case"streamsdelete":case"streamsTimeline":a.fn&&a.fn();break;case"addsmartfilter":zmPreviewTemplate.classifySmartFilter(e,a.filtervalue,!0,$(b).closest(".SC_pct"));break;case"addtoprojects":zmUtil.loadProjects(function(){zmail.projectsInteg.util.addTaskBugFromMail(e),zmUtil.hideMenu()})}},updateListOnNavigation:d};return zmail.postJsDeffered.done(function(){zmail.mailContainer=new zmail.Container({store:zmail.prevMails,containerSize:100,evictCount:25,idName:"id",isObjectInUse:zmUtil.isMailContentInUse,considerAsHitOnRetrieval:!1})}),e}(),window.zmDragger=function(){"use strict";var a={},b=zmText.get("mail").listing.common.dropMsg;a.currPos=0,a.newPos=0,a.updatePos=_.throttle(function(b,c){var d,e;c=c[0],a.currPos?a.newPos=b.getBoundingClientRect().top:a.currPos=a.newPos=b.getBoundingClientRect().top,a.newPos<0||(d=a.newPos-a.currPos,e=c.scrollTop+d,e=Math.min(e,c.scrollHeight),c.scrollTop=e)},100),a.reset=function(){a.currPos=0,a.newPos=0};var c=function(a){try{var b;if("I"===a.prop("tagName")?b=a.parent():"LI"===a.prop("tagName")&&(b=a),b){var c=b.index(),d=zmTab.tabArr[c]&&zmTab.tabArr[c].appId;d.indexOf("Cmp")&&("zm_Container"!==d&&d.indexOf("zm_tab")&&d.indexOf("zm_srch")||!zmsuite.getCenter(d)[1].$el.find(".SC_drag").length)||(zmsuite.showExistingApp(d),zmUtil.hideMenu())}}catch(e){zmUtil.debugLog(e)}},d=function(a,b,c){var d={};if(a.length>1)d=zmUtil.getSelectedMails(b),d.mIds=d[0],d.tIds=d[1];else{var e=a&&a[0].id;"t"===e.charAt(0)?(e=e.substring(1),d={mIds:[],tIds:[e]}):d={mIds:[e],tIds:[]
}}zmComp.dropCmpFwdMe({msgList:d,maskElem:c})},e=function(){return b};return{updateScroll:a.updatePos,resetScrollPos:a.reset,hoverOnTabs:c,dropOnCompose:d,getDropMessage:e}}(),window.zmmailAct=function(){"use strict";var a,b=zmText.get("mail"),c=b.listing,d=b.actions,e=b.preview,f={},g={},h=[],i=zmail.folviewThread;h=["read","unread","flag","label","move","delete","archive","unarchive","spam","notspam","folderread","sweep"];var j=function(a,b,c){zmAjq.XHR({u:zmail.conPath+"/mA.do",t:"POST",fn:c,p:a,csr:"s",ep:b,setSessionId:b.suppressWSNoti})},k=function(a,b){a="thd"===b?"zm_tabt"+zmail.mailObj[a].T:"zm_tab"+a,zmsuite.isWorkspaceAvailable(a)&&(zmsuite.closeWorkspace(a),zmsuite.showExistingApp(zmTab.currentTab))},l=function(a){zmCache.updateObj(a)},m=function(a,b){void 0!==zmail.mailObj[a].TS&&l({mode:"upd",msgId:a,key:"TS",val:b})},n=function(a,b,c){var d,e,g,h,j=[];if(zmail.mailObj[a])switch(g=zmail.mailObj[a],e=g.T,d=$.extend({},f),d.label="",d.attach="",d.flag=b,2!==i&&d.fId===zmail.folId.spId||(d.fId=""),j=zmList.getMailSummaryList(d,e),h=j.length,c){case"0":1===h&&("1"===b?g.TI=!1:"2"===b?g.TM=!1:"3"===b&&(g.TF=!1));break;case"1":g.TI=!0,1===h&&("2"===b?g.TM=!1:"3"===b&&(g.TF=!1));break;case"2":g.TM=!0,1===h&&("1"===b?g.TI=!1:"3"===b&&(g.TF=!1));break;case"3":g.TF=!0,1===h&&("1"===b?g.TI=!1:"2"===b&&(g.TM=!1))}},o=function(a,b){if(zmail.mailObj[a])switch(l({mode:"upd",msgId:a,key:"NFG",val:b}),b){case"0":zmail.mailObj[a].TI=!1,zmail.mailObj[a].TF=!1,zmail.mailObj[a].TM=!1;break;case"1":zmail.mailObj[a].TI=!0,zmail.mailObj[a].TF=!1,zmail.mailObj[a].TM=!1;break;case"2":zmail.mailObj[a].TI=!1,zmail.mailObj[a].TF=!1,zmail.mailObj[a].TM=!0;break;case"3":zmail.mailObj[a].TI=!1,zmail.mailObj[a].TF=!0,zmail.mailObj[a].TM=!1}},p=function(a,b,c){if(zmail.mailObj[a]){zmail.mailObj[a].TTAGS=zmail.mailObj[a].TTAGS||[];var d,e,g,h=[],j=zmail.mailObj[a].TTAGS,k=zmail.mailObj[a].T;switch(c){case"add":for(d=0;d<b.length;d++)j.indexOf(b[d])===-1&&zmail.mailObj[a].TTAGS.push(b[d]);break;case"delete":for(d=0;d<b.length;d++)e=j.indexOf(b[d]),g=$.extend({},f),2!==i&&g.fId===zmail.folId.spId||(g.fId=""),g.label=b[d],h=zmList.getMailSummaryList(g,k),e!==-1&&h.length<=1&&j.splice(e,1);break;case"deleteall":zmail.mailObj[a].TTAGS=[]}}},q=function(a,b,c){var d=[];return zmail.listObj[b]?d=zmList.getViewBasedMsgList(b,c):d.push(a),d},r=function(a,b,c,d){var e,g,h,i,j=[];if(i=c.folId,"msg"===d){if(l({mode:"move",msgId:a,rFrom:b,addTo:i,type:d}),!zmail.mailObj[a].S&&!zmail.mailObj[a].AR){var k={action:"move",src:b,dest:i};zmmailAct.updateCount({fId:b,mode:"dec",actionObj:k}),zmmailAct.updateCount({fId:i,mode:"inc",actionObj:k})}}else if("thd"===d)for(l({mode:"move",msgId:a,rFrom:b,addTo:i,type:d}),e=zmail.mailObj[a].T,j=q(a,e,f),g=j.length,h=0;h<g;h++)l({mode:"upd",msgId:j[h],key:"FD",val:i});zmfolAction.isSharedFolder(i)&&zmContentCache.isCached(a)&&zmContentCache["delete"](a)},s=function(a,b){var c,d,e,g=[],h=zmail.mailObj[a],i=h.FD;if("msg"===b)l({mode:"upd",msgId:a,key:"AR",val:1}),$.publish("folder/archived",[zmail.mailObj[a].FD]),zmail.mailObj[a].S||zmmailAct.updateCount({fId:i,mode:"dec"});else if("thd"===b)for(e=h.T,g=q(a,e,f),d=g.length,c=0;c<d;c++)l({mode:"upd",msgId:g[c],key:"AR",val:1}),$.publish("folder/archived",[zmail.mailObj[g[c]].FD]);(f.fId&&"archive"!==f.view||!f.fId&&"unread"===f.view)&&zmCache.updateCacheForViews(a)},t=function(a,b){var c,d,e,g=[],h=zmail.mailObj[a],i=h.FD;if("msg"===b)l({mode:"upd",msgId:a,key:"AR",val:0}),zmail.mailObj[a].S||zmmailAct.updateCount({fId:i,mode:"inc"});else if("thd"===b)for(e=h.T,g=q(a,e,f),d=g.length,c=0;c<d;c++)l({mode:"upd",msgId:g[c],key:"AR",val:0});f.fId&&"archive"===f.view&&zmCache.updateCacheForViews(a)},u=function(b,c){var d,e,h,i=0,j=[],k=[],n=[];if("msg"===c)zmail.mailObj[b].S||(d=zmail.mailObj[b].FD,l({mode:"upd",msgId:b,key:"S",val:1}),zmail.mailObj[b].AR||zmmailAct.updateCount({fId:d,mode:"dec"}),k.push(b));else if("thd"===c){h=zmail.mailObj[b].T;var o=$.extend({},f);for("unread"===f.view&&(""===f.fId?o.view="all":o.view=""),zmail.listObj[h]?j=zmList.getViewBasedMsgList(zmail.mailObj[b].T,o):j.push(b),e=j.length,i=0;i<e;i++)zmail.mailObj[j[i]].S||l({mode:"upd",msgId:j[i],key:"S",val:1});n.push(b),m(b,1)}if("unread"===f.view&&"mail_preview"!==a){var p=!1;if("zm_Container"!==zmTab.currentTab){var q=zmsuite.getCenterOuter().$el.data("row-detail")?zmsuite.getCenterOuter().$el.data("row-detail").rowId:"";q.indexOf("t")||(b=q.substring(1)),p=!0}else!zmail.mailObj[b].TH&&$(g.prevElem).attr("data-mid")!==b||zmail.mailObj[b].TH&&$(g.prevElem).attr("data-mid")&&zmail.mailObj[$(g.prevElem).attr("data-mid")].T!==zmail.mailObj[b].T?p=!0:"dropdown"===a&&(p=!0);p&&(!zmail.mailObj[b].TH||zmail.mailObj[b].TH&&zmInit.checkThreadRead(zmail.mailObj[b].T))&&zmCache.updateCacheForViews(b)}},v=function(a,b){var c,d,e,g=0,h=[];if("msg"===b)zmail.mailObj[a].S&&(c=zmail.mailObj[a].FD,l({mode:"upd",msgId:a,key:"S",val:0}),zmail.mailObj[a].AR||zmmailAct.updateCount({fId:c,mode:"inc"}));else if("thd"===b){e=zmail.mailObj[a].T;var i=$.extend({},f);for("unread"===f.view&&(""===f.fId?i.view="all":i.view=""),zmail.listObj[e]?h=zmList.getViewBasedMsgList(zmail.mailObj[a].T,i):h.push(a),d=h.length,g=0;g<d;g++)zmail.mailObj[h[g]].S&&l({mode:"upd",msgId:h[g],key:"S",val:0});m(a,0)}},w=function(a,b,c){var d,e,g,h=[];if("msg"===b){if(0===zmail.mailObj[a].S&&!zmail.mailObj[a].AR){var i={action:"delete",src:zmail.mailObj[a].FD,dest:zmail.folId.tId};zmmailAct.updateCount({fId:zmail.mailObj[a].FD,mode:"dec",actionObj:i}),0===c&&zmmailAct.updateCount({fId:zmail.folId.tId,mode:"inc",actionObj:i})}l({mode:"delete",msgId:a,folId:zmail.mailObj[a].FD,type:b})}else if("thd"===b&&(d=zmail.mailObj[a].T,zmail.listObj[d]?h=zmList.getViewBasedMsgList(d,f):h.push(a),g=h.length,0===c))for(e=0;e<g;e++)l({mode:"delete",msgId:h[e],folId:zmail.mailObj[h[e]].FD,type:b});!f.fId&&(f.view||f.flag||f.label)&&zmCache.updateCacheForViews(a)},x=function(a,b){var c=$("#"+a),d=a;if(b=b||"zm_Container",zmTab.currentTab.indexOf("zm_tabt"))if(zmail.mailObj[a]&&zmail.listObj[zmail.mailObj[a].T]){var e=zmCenterListing.mailObjectAPI.getViewParentOf("c"+d,b);e&&(c=e.$element)}else d=zmList.getDupThdRowId(a,zmUtil.getFolId()),d&&(c=$(zmail.mailCenter.listElem).find("#t"+d));else d=zmsuite.getCenterOuter().$el.data("row-detail").rowId,c=$(zmail.mailCenter.listElem).find("#"+d);return c},y=function(a,b){zmail.folCount[f.fId]&&zmail.mailObj[a].TH&&(f.fId!==b?($("#zmHdrP"+a).parent().addClass("SC_Tfdr"),$("#zmHdrT"+a).parent().addClass("SC_Tfdr")):($("#zmHdrP"+a).parent().removeClass("SC_Tfdr"),$("#zmHdrT"+a).parent().removeClass("SC_Tfdr")))},z=function(a,b){var c=zmInit.findFolName(b),d="";d=zmail.mailObj[a].AR?c+" ("+e.contentOptions.archived+")":c,$(zmail.mailCenter.listElem).find("#"+a+" .zmFdr span").html(c),$("#zmHdrP"+a+" .zm_folname").html(d),$("#zmHdrT"+a+" .zm_folname").html(d),$("#zmHdrS"+a+" .zm_folname").html(d);var f=$(zmail.mailCenter.listElem).find("#t"+a);f.length&&f.find(".zmFdr span").html(c)},A=function(a){var b=!1;return f.fId&&!f.flag&&!f.label||"all"===f.view?b=!0:0!==zmail.mailObj[a].NFG&&f.flag?"-1"!==f.flag&&f.flag!==zmail.mailObj[a].NFG||(b=!0):zmail.mailObj[a].TAG&&f.label&&("-1"!==f.label&&"-1"===$.inArray(f.label,zmail.mailObj[a].TAG)||(b=!0)),b},B=function(a,b){a.length<99?b.text(a.length+1):b.text("99+")},C=function(a,b){1!==a.length&&(a.length<=100?b.text(a.length-1):b.text("99+"))},D=function(a){var b=a.parent(".zmTV");b.prev().find(".zm_td").remove(),b.prev().removeClass("zmTLst"),b.remove()},E=function(){var a="";return a+='<div class="zm_td"><div class="zm_tlb"></div></div>'},F=function(a,b,c){var d,e=A(a),h=$("#"+a),i=zmList.getViewBasedMsgList(zmail.mailObj[a].T,f);if("zm_Container"!==zmTab.currentTab){if(i.length>1&&e){var j=$("#"+i[0]);d=j.parent().prev().find(".zmtCt"),f.fId===b?B(i,d):f.fId===c&&(C(i,d),"1"===d.text()&&D(j))}else if(1===i.length)if(f.fId===zmail.mailObj[a].FD){if(zmPrev.clsPreview(),$("#t"+i[0]).remove(),k("t"+zmail.mailObj[a].T),zmail.listObj[f.fId]){var l=zmail.listObj[f.fId];for(var m in l)l[m]===f.fId&&zmail.listObj[f.fId].MO.splice(m,1)}}else e&&(d=$("#t"+i[0]).find(".zmtCt"),d.text(parseInt(d.text())+1),"2"===d.text()&&d.before(E()));h.remove()}else if(h.length&&e){d=h.parent().prev().find(".zmtCt");var n=0;C(i,d),n=parseInt(d.text()),1===n?D(h):n<1&&(h.parent().prev().remove(),h.parent().remove(),$(g.prevElem).hasClass("shw")&&zmail.mailObj[a].T===zmail.mailObj[zmPrev.prevDetails().msgId].T&&zmPrev.clsPreview()),h.remove()}else if(zmPrev.prevDetails().msgId&&zmail.mailObj[a].T===zmail.mailObj[zmPrev.prevDetails().msgId].T)if(d=$(zmail.mailCenter.listElem).find(".zmSLst .zmtCt"),i.length>1&&e)f.fId===b?B(i,d):f.fId===c&&C(i,d);else if(i.length<=1)if(f.fId===zmail.mailObj[a].FD){if($(zmail.mailCenter.listElem).find(".zmSLst").remove(),zmPrev.clsPreview(),k("t"+zmail.mailObj[a].T),zmail.listObj[f.fId]){var o=zmail.listObj[f.fId];for(var p in o)o[p]===f.fId&&zmail.listObj[f.fId].MO.splice(p,1)}}else e&&(d.text(parseInt(d.text())+1),"2"===d.text()&&d.before(E()))},G=function(a,b){var c=$("#"+a),d=a,e=c.parent(".zmTV");if("msg"===b&&zmail.mailObj[a].T&&zmInit.checkThreadRead(zmail.mailObj[a].T)&&(c=x(a),c.length)){d=c[0].id,0===d.indexOf("t")&&(d=d.substring(1)),c.removeClass("zm_urd"),zmTab.currentTab.indexOf("zm_tabt")||"unread"!==f.view||zmPrev.isEntityOpenedInPreview(d)||(c.remove(),e=$("#thd"+d),e.remove());var g=zmUtil.getFolId();if(zmail.listObj[g]){var h=zmUtil.getFirstMsgId(zmail.mailObj[a].T,f);h&&(d=h)}m(d,1)}},H=function(a,b){var c,d=0,e=[],h=0;for(0===zmail.mailObj[a].TC&&(zmail.mailObj[a].TC=1),zmUtil.isFolderId(b)&&(zmail.mailObj[a].FD=b),c=zmList.constructThreadChildRow(a),e=zmList.getMailSummaryList(f,zmail.mailObj[a].T),h=0;h<e.length;h++){var i=zmail.mailObj[e[h]];if(i.R<zmail.mailObj[a].R){d=h;break}}$(g.listElem).find("#"+e[d]).before(c)},I=function(a,b){var c=$("#"+a),d=a;if("msg"===b&&zmail.mailObj[a].T&&!zmInit.checkThreadRead(zmail.mailObj[a].T)&&(c=x(a),c.length)){d=c[0].id,0===d.indexOf("t")&&(d=d.substring(1)),c.addClass("zm_urd");var e=zmUtil.getFolId();if(zmail.listObj[e]){var g=zmUtil.getFirstMsgId(zmail.mailObj[a].T,f);g&&(d=g)}m(d,0)}},J=function(a,b,c){if(!b.preAction){var d,e,h,j,l,m;if(zmail.mailObj[a].AR&&t(a,c),d=zmail.mailObj[a].FD,e=b.folId,"notifier"!==b.from||d!==e||zmUtil.getFolId()!==e){if("msg"===c){if(j=$(zmail.mailCenter.listElem).find("#"+a),z(a,e),y(a,e),f.fId===zmail.folId.spId||d===zmail.folId.tId||zmfolAction.isDeletedFolder(d)||d===zmail.folId.spId||e===zmail.folId.tId||zmfolAction.isDeletedFolder(e)||e===zmail.folId.spId)l=!0;else if(m=zmail.mailObj[a].T,m&&zmail.listObj[m]){var n=zmList.getMailSummaryList(f,m);if(n.length<=1&&b.mailId.indexOf(n[0])!==-1){var o=x(a);o.length&&o.remove(),D(j),$(g.prevElem).attr("data-mid")&&zmPrev.updatePrevOnDeletion(a)}}zmail.mailObj[a].T&&(1===i||2===i&&l)?F(a,e,zmail.mailObj[a].FD):(h=zmUtil.getFolId(),("unread"!==h&&"all"!==h&&"flag"!==h&&!zmUtil.isLabelId(h)&&"search"!==h||h!==zmail.folId.tId&&(e===zmail.folId.tId||zmfolAction.isDeletedFolder(e)))&&(zmail.mailObj[a].T&&0!==i||j.remove())),zmail.mailObj[a].T&&(""===f.fId||f.fId===e)&&A(a)&&H(a,e)}else if("thd"===c){j=$(zmail.mailCenter.listElem).find("#t"+a),j.length||(j=$(zmail.mailCenter.listElem).find("#"+a));var p,q,s=[],u=zmInit.findFolName(e);if(m=zmail.mailObj[a].T,zmail.listObj[m]&&(s=zmList.getViewBasedMsgList(m,f)),p=s.length,2===i&&f.fId&&f.fId!==e||1===i&&f.fId===d&&d!==e||e===zmail.folId.tId||"archive"===f.view)j.remove(),$(zmail.mailCenter.listElem).find("#thd"+a).remove();else if(j.find(".zmFdr span").html(u),2===i||!f.fId)for(q=0;q<p;q++)$(zmail.mailCenter.listElem).find("#"+s[q]+" .zmFdr span").html(u),$.publish("mail/move",[s[q],"msg",b]);k(a,c)}$.publish("mail/move",[a,"msg",b]),r(a,d,b,c),"msg"===c&&zmPreviewTemplate.updateMailHeaderView(a),0!==i&&f.fId!==zmail.folId.tId&&f.fId!==zmail.folId.dId&&(zmInit.checkThreadRead(zmail.mailObj[a].T)?G(a,c):I(a,c))}}},K=function(a){var b=$(zmail.mailCenter.listElem).find("#"+a);b.remove()},L=function(b,c,d){if(d){if(d.preAction)return;d.from&&(a=d.from)}var e,h,j,k,l=zmail.mailObj[b].FD;if(f=zmInit.getListingDetObj(),l&&$("#"+l+" .SC_ct").hasClass("SC_new")){var m="zmlTreeH",n={};n=zmail.mailLeft.getNodes()[0].getLayer(m),n.clearNew(l)}if("msg"===c){if(e=$(zmail.mailCenter.listElem).find("#"+b),e.removeClass("zm_urd"),h=e.parent(".zmTV"),"mail_preview"!==a||"mail_preview"===a&&!zmTab.currentTab.indexOf("zm_srch"))if("unread"===f.view&&("zm_Container"!==zmTab.currentTab||!$(g.prevElem).attr("data-mid")||$(g.prevElem).attr("data-mid")&&$(g.prevElem).attr("data-mid")!==b&&(!zmail.mailObj[b].TH||zmail.mailObj[b].TH&&zmail.mailObj[b].T!==zmail.mailObj[$(g.prevElem).attr("data-mid")].T))){var o=zmail.mailObj[b].T;if(o&&0!==i){if(1===zmList.getMailSummaryList(f,o).length&&!zmPrev.isEntityOpenedInPreview(b)){D(e);var p=zmCenterListing.mailObjectAPI.getViewParentOf("c"+b,"zm_Container");if(p){var q="t"+p.id;K(q)}}}else e.remove()}else h.hasClass("zmTV")&&(h.children("div").hasClass("zm_urd")||h.prev().removeClass("zm_urd"));$("#zmHdrP"+b).find(".zmPT").removeClass("zm_urd"),$("#zmHdrT"+b).find(".zmPT").removeClass("zm_urd"),$("#zmHdrS"+b).find(".zmPT").removeClass("zm_urd")}else if("thd"===c)if(e=$(zmail.mailCenter.listElem).find("#t"+b),e.length||(e=$(zmail.mailCenter.listElem).find("#"+b)),h=$(zmail.mailCenter.listElem).find("#thd"+b),e.removeClass("zm_urd"),h.children("div").removeClass("zm_urd"),"unread"!==f.view||"click"===a||"zm_Container"===zmTab.currentTab&&$(g.prevElem).attr("data-mid")===b)for(j=zmList.getViewBasedMsgList(zmail.mailObj[b].T,f),k=0;k<j.length;k++)$("#zmHdrP"+j[k]).find(".zmPT").removeClass("zm_urd"),$("#zmHdrT"+j[k]).find(".zmPT").removeClass("zm_urd"),$("#zmHdrS"+j[k]).find(".zmPT").removeClass("zm_urd"),$.publish("mail/read",[j[k],"msg"]);else e.remove(),h.remove();$.publish("mail/read",[b,"msg"]),u(b,c),0!==i&&f.fId!==zmail.folId.tId&&f.fId!==zmail.folId.dId&&G(b,c)},M=function(a,b,c){if(!c){var d,e,g,h;if("msg"===b){if(d=$(zmail.mailCenter.listElem).find("#"+a),d.addClass("zm_urd"),e=d.parent(".zmTV").length?d.parent(".zmTV"):$(zmail.mailCenter.listElem).find(".zmSLst").next(),zmail.mailObj[a].T&&0!==i&&e.children("div").hasClass("zm_urd")&&(""===f.fId||""!==f.fId&&f.fId===zmail.mailObj[a].FD)){var j,k;j=e.prev(),j.addClass("zm_urd"),j.length&&(k=j[0].id,0===k.indexOf("t")&&(k=k.substring(1)),m(k,0))}$("#zmHdrP"+a).find(".zmPT").addClass("zm_urd"),$("#zmHdrT"+a).find(".zmPT").addClass("zm_urd"),$("#zmHdrS"+a).find(".zmPT").addClass("zm_urd")}else if("thd"===b)for(d=$(zmail.mailCenter.listElem).find("#t"+a),d.length||(d=$(zmail.mailCenter.listElem).find("#"+a)),d.addClass("zm_urd"),$(zmail.mailCenter.listElem).find("#thd"+a).children("div").addClass("zm_urd"),g=zmList.getViewBasedMsgList(zmail.mailObj[a].T,f),h=0;h<g.length;h++)$("#zmHdrP"+g[h]).find(".zmPT").addClass("zm_urd"),$("#zmHdrT"+g[h]).find(".zmPT").addClass("zm_urd"),$("#zmHdrS"+g[h]).find(".zmPT").addClass("zm_urd"),$.publish("mail/unread",[g[h],"msg"]);$.publish("mail/unread",[a,"msg"]),v(a,b),0!==i&&f.fId!==zmail.folId.tId&&f.fId!==zmail.folId.dId&&I(a,b)}},N=function(a,b){var c,d=zmList.getMailSummaryList(f,zmail.mailObj[a].T),e=0,g=$("#"+a);f.flag?e="-1"===f.flag&&"0"===b||"-1"!==f.flag&&f.flag!==b?0:1:f.label&&(e=b),0===e?g.length?(c=g.parent().prev().find(".zmtCt"),C(d,c),"1"===c.text()&&D(g)):(c=$(zmail.mailCenter.listElem).find(".zmSLst .zmtCt"),C(d,c)):g.length?(c=g.parent().prev().find(".zmtCt"),B(d,c)):(c=$(zmail.mailCenter.listElem).find(".zmSLst .zmtCt"),B(d,c),"2"===c.text()&&c.before(E()))},O=function(a,b,c,d){if(!d){var e,h,j,k,m,p=zmInit.flgClass(b),q="";if("msg"===c){if(e=$(zmail.mailCenter.listElem).find("#"+a),zmail.mailObj[a].TH&&0!==i){if(h=x(a),h.length){q=h[0].id,q.indexOf("t")!==-1&&(q=q.substring(1));var r=zmUtil.getFolId();if(zmail.listObj[r]){var s=zmUtil.getFirstMsgId(zmail.mailObj[a].T,f);s&&(q=s)}}n(q,zmail.mailObj[a].NFG,b),k=zmInit.getThdFlagvalue(q),j=zmInit.flgClass(k),h.find(".zmflg").removeClass().addClass(j)}if($("#zmHdrP"+a+" .zmflg").removeClass().addClass(p),$("#zmHdrT"+a+" .zmflg").removeClass().addClass(p),$("#zmHdrS"+a+" .zmflg").removeClass().addClass(p),f.flag&&"0"===b)zmail.mailObj[a].T?"-1"!==f.flag&&f.flag!==zmail.mailObj[a].NFG||0===zmail.mailObj[a].NFG||(m=zmList.getMailSummaryList(f,zmail.mailObj[a].T),1===i||2===i&&f.fId===zmail.folId.spId?(N(a,b),2===m.length?D(e):1===m.length&&h.length&&(h.remove(),$(g.prevElem).attr("data-mid")===q&&"lt"===$(g.prevElem).attr("data-ty")&&zmPrev.clsPreview()),e.remove()):2===i&&1===m.length&&(D(e),h.length&&(h.remove(),$(g.prevElem).attr("data-mid")===q&&"lt"===$(g.prevElem).attr("data-ty")&&zmPrev.clsPreview()))):(e.remove(),$(g.prevElem).attr("data-mid")===a&&zmPrev.clsPreview()),e.find(".zmflg").removeClass().addClass(p);else if(0===b)e.find(".zmflg").removeClass().addClass(p);else{if(zmail.mailObj[a].T){if(f.flag)if(m=zmList.getMailSummaryList(f,zmail.mailObj[a].T),1===i||2===i&&f.fId===zmail.folId.spId)if(""===f.fId)if("-1"===f.flag&&"0"===zmail.mailObj[a].NFG||f.flag===b&&zmail.mailObj[a].NFG!==b){if(H(a,""),1===m.length)if($("#t"+m[0]).length)$("#t"+m[0]).find(".zmtCt").before(E());else if($(zmail.mailCenter.listElem).find(".zmSLst").length){var t=zmail.mailCenter.listElem;$(t).find(".zmSLst .zmtCt").before(E())}N(a,b)}else"-1"!==f.flag&&zmail.mailObj[a].NFG!==b&&(2===m.length?D(e):1===m.length&&(e.parent().prev().remove(),e.parent().remove(),zmPrev.clsPreview()),N(a,b),e.remove());else f.fId===zmail.mailObj[a].FD&&("-1"===f.flag&&"0"===zmail.mailObj[a].NFG||f.flag===b&&zmail.mailObj[a].NFG!==b?(H(a,""),N(a,b)):"-1"!==f.flag&&zmail.mailObj[a].NFG===f.flag&&zmail.mailObj[a].NFG!==b&&(N(a,b),e.remove()));else 2===i&&1===m.length&&(""===f.fId&&"-1"!==f.flag&&zmail.mailObj[a].NFG!==b||f.fId===zmail.mailObj[a].FD&&"-1"!==f.flag&&zmail.mailObj[a].NFG===f.flag&&zmail.mailObj[a].NFG!==b)&&(D(e),h.length&&(h.remove(),$(g.prevElem).attr("data-mid")===q&&"lt"===$(g.prevElem).attr("data-ty")&&zmPrev.clsPreview()))}else f.flag&&"-1"!==f.flag&&zmail.mailObj[a].NFG!==b&&e.remove();e.find(".zmflg").removeClass().addClass(p)}l({mode:"upd",msgId:a,key:"NFG",val:b})}else if("thd"===c){var u,v,w;for(m=[],w=zmail.mailObj[a].T,m=zmList.getViewBasedMsgList(w,f),u=m.length,v=0;v<u;v++)O(m[v],b,"msg",d);e=$(zmail.mailCenter.listElem).find("#t"+a),e.length||(e=$(zmail.mailCenter.listElem).find("#"+a)),o(a,b),f.flag&&"0"===b?(e.remove(),$(zmail.mailCenter.listElem).find("#thd"+a).remove(),$(g.prevElem).attr("data-mid")===a&&zmPrev.clsPreview()):"0"===b?e.find(".zmflg").removeClass().addClass(p):f.flag&&"-1"!==f.flag&&f.flag!==b?($(zmail.mailCenter.listElem).find("#thd"+a).remove(),e.remove(),$(g.prevElem).attr("data-mid")===a&&zmPrev.clsPreview()):e.find(".zmflg").removeClass().addClass(p)}$.publish("mail/flag",[a,"msg",b]),f.flag&&("-1"===f.flag&&"0"===b||"-1"!==f.flag&&b!==f.flag)&&zmCache.updateCacheForViews(a),0!==i&&f.fId!==zmail.folId.tId&&f.fId!==zmail.folId.dId&&(zmInit.checkThreadRead(zmail.mailObj[a].T)?G(a,c):I(a,c))}},P=function(a,b,c){if(!b.preAction){var d,e,h,j,k,m,n=!1;if("msg"===c){d=$(zmail.mailCenter.listElem).find("#"+a);var o;if(zmail.mailObj[a].TH&&0!==i){if(e=x(a),e.length){h=e[0].id,h.indexOf("t")!==-1&&(h=h.substring(1));var q=zmUtil.getFolId();if(zmail.listObj[q]){var r=zmUtil.getFirstMsgId(zmail.mailObj[a].T,f);r&&(h=r)}}p(h,[b.lId],b.lA)}if("add"===b.lA){if(zmail.mailObj[a].TAG=zmail.mailObj[a].TAG||[],k=zmail.mailObj[a].TAG,zmail.mailObj[a].T&&(1===i||2===i&&f.fId===zmail.folId.spId)&&f.label)if(o=$.inArray(b.lId,zmail.mailObj[a].TAG),""===f.fId){if(f.label===b.lId&&o===-1){if(H(a,""),j=zmList.getMailSummaryList(f,zmail.mailObj[a].T),1===j.length)if($("#t"+j[0]).length)$("#t"+j[0]).find(".zmtCt").before(E());else if($(zmail.mailCenter.listElem).find(".zmSLst").length){var s=$(zmail.mailCenter.listElem).find(".zmSLst .zmtCt");s.before(E())}N(a,1)}}else f.fId===zmail.mailObj[a].FD&&("-1"===f.label&&0===zmail.mailObj[a].TAG.length||f.label===b.lId&&o===-1)&&(H(a,""),N(a,1));o=$.inArray(b.lId,k),o===-1&&zmail.mailObj[a].TAG.push(b.lId)}else if("delete"===b.lA&&zmail.mailObj[a].TAG){var t=zmail.mailObj[a].TAG,u=t.length;zmail.mailObj[a].T?1!==i&&(2!==i||f.fId!==zmail.folId.spId&&f.fId!==zmail.folId.tId)||("-1"!==f.label||1!==zmail.mailObj[a].TAG.length)&&f.label!==b.lId||(N(a,0),j=zmList.getMailSummaryList(f,zmail.mailObj[a].T),2===j.length?D(d):1===j.length&&(e.length&&(e.remove(),$(zmail.mailCenter.listElem).find("#thd"+h).remove(),$(g.prevElem).attr("data-mid")===h&&"lt"===$(g.prevElem).attr("data-ty")&&("zm_Container"===zmTab.currentTab?zmPrev.clsPreview():zmTab.currentTab.indexOf("zm_tab")||$.publish("mail/listing/viewchanged",[]))),n=!0,m=h)):(n=!0,m=a);var v;for(v=0;v<u;v++)if(b.lId===t[v]){zmail.mailObj[a].TAG.splice(v,1);break}}else"deleteall"===b.lA&&zmail.mailObj[a].TAG&&(zmail.mailObj[a].T?(N(a,"0"),f.label&&(j=zmList.getMailSummaryList(f,zmail.mailObj[a].T),2===j.length?D(d):1===j.length&&(e=x(a),e.length&&(e.remove(),$(zmail.mailCenter.listElem).find("#thd"+h).remove(),$(g.prevElem).attr("data-mid")===h&&"lt"===$(g.prevElem).attr("data-ty")&&("zm_Container"===zmTab.currentTab?zmPrev.clsPreview():zmTab.currentTab.indexOf("zm_tab")||$.publish("mail/listing/viewchanged",[]))),n=!0,m=h))):(n=!0,m=a),zmail.mailObj[a].TAG=[]);(f.label&&"deleteall"===b.lA||(f.label===b.lId||"-1"===f.label)&&"delete"===b.lA)&&(d.remove(),$(g.prevElem).attr("data-mid")!==a||zmail.mailObj[a].T&&"th"!==$(g.prevElem).attr("data-ty")||("zm_Container"===zmTab.currentTab?zmPrev.clsPreview():zmTab.currentTab.indexOf("zm_tab")||$.publish("mail/listing/viewchanged",[])))}else if("thd"===c){var w,y,z=zmail.mailObj[a].T;for(j=[],j=zmList.getViewBasedMsgList(z,f),y=0,w=j.length;y<w;y++)("deleteall"===b.lA&&zmail.mailObj[j[y]].TAG||"add"===b.lA&&(!zmail.mailObj[j[y]].TAG||$.inArray(b.lId,zmail.mailObj[j[y]].TAG)===-1)||"delete"===b.lA&&$.inArray(b.lId,zmail.mailObj[j[y]].TAG>=0))&&P(j[y],b,"msg");if(d=e=$(zmail.mailCenter.listElem).find("#t"+a),d.length||(d=e=$(zmail.mailCenter.listElem).find("#"+a)),p(a,[b.lId],b.lA),"add"===b.lA)zmail.mailObj[a].TAG||(zmail.mailObj[a].TAG=[]),k=zmail.mailObj[a].TAG,$.inArray(b.lId,zmail.mailObj[a].TAG)===-1&&k.push(b.lId);else if("delete"===b.lA&&zmail.mailObj[a].TAG){var A,B=zmail.mailObj[a].TAG,C=B.length;for(A=0;A<C;A++)if(b.lId===B[A]){zmail.mailObj[a].TAG.splice(A,1);break}("-1"===f.label&&0===zmail.mailObj[a].TAG.length||f.label===b.lId)&&($(zmail.mailCenter.listElem).find("#thd"+a).remove(),d.remove(),$(g.prevElem).attr("data-mid")===a&&zmPrev.clsPreview(),n=!0,m=a)}else"deleteall"===b.lA&&zmail.mailObj[a].TAG&&($(zmail.mailCenter.listElem).find("#t"+a+" p").remove(),zmail.mailObj[a].TAG=[]);f.label&&"deleteall"===b.lA&&(d.remove(),l({mode:"upd",msgId:a,key:"TAG",val:""}),$(g.prevElem).attr("data-mid")===a&&zmPrev.clsPreview(),n=!0,m=a)}n&&m&&zmCache.updateCacheForViews(m),zmPreviewTemplate.refreshLabelsForMail(a,e),$.publish("mail/label",[a,"msg",b]),0!==i&&f.fId!==zmail.folId.tId&&f.fId!==zmail.folId.dId&&(zmInit.checkThreadRead(zmail.mailObj[a].T)?G(a,c):I(a,c))}},Q=function(a,b,c,d){if(!d){var e,g;if("msg"===c)g=$(zmail.mailCenter.listElem).find("#"+a),z(a,zmail.folId.tId),y(a,zmail.folId.tId),zmail.mailObj[a].T&&(zmail.mailObj[a].FD===zmail.folId.dId&&zmUtil.removeDraftMapping(a),F(a,zmail.folId.tId,zmail.mailObj[a].FD)),5!==b&&zmail.mailObj[a].FD===zmail.folId.tId&&(b=5),f.fId===zmail.folId.tId&&zmail.mailObj[a].FD!==zmail.folId.tId&&A(a)&&H(a,zmail.folId.tId),zmail.mailObj[a].TH&&0!==i||g.remove(),$.publish("/mail/msgDiscarded",[{draftId:a,actionType:"discard_draft"}]),zmContentCache.remove(a);else if("thd"===c){var h,j,l=[];for(g=$(zmail.mailCenter.listElem).find("#t"+a),g.length||(g=$(zmail.mailCenter.listElem).find("#"+a)),l=zmList.getViewBasedMsgList(e,f),j=l.length,h=0;h<j;h++)$.publish("mail/delete",[l[h],"msg",b]);g.remove(),$(zmail.mailCenter.listElem).find("#thd"+a).remove()}k(a,c),$.publish("mail/delete",[a,"msg",b]),w(a,c,b),"msg"===c&&zmPreviewTemplate.updateMailHeaderView(a),0!==i&&f.fId!==zmail.folId.tId&&f.fId!==zmail.folId.dId&&(zmInit.checkThreadRead(zmail.mailObj[a].T)?G(a,c):I(a,c))}},R=function(a,b){var c,d,e,g,h=zmail.mailObj[a];c=q(a,h.T,f),e=$(zmail.mailCenter.listElem).find("#"+a),g=Boolean(f.fId),d=e.length?e.parent().prev().find(".zmtCt"):$(zmail.mailCenter.listElem).find(".zmSLst .zmtCt"),g&&("unarchive"===b&&1===h.AR||"archive"===b&&0===h.AR)&&(C(c,d),"1"===d.text()&&D(e))},S=function(a,b,c){if(!c){var d,e,h=!0,j=zmail.mailObj[a],k=j.T;if("msg"===b){if(d=$(zmail.mailCenter.listElem).find("#"+a),d.addClass("zmarch"),k&&zmail.listObj[k]){var l=zmList.getMailSummaryList(f,k);if(l.length<=1&&a===l[0]){var m=x(a);m.length&&m.remove(),D(d),$(g.prevElem).attr("data-mid")&&zmPrev.updatePrevOnDeletion(a),h=!1}}h&&j.TH&&0!==i&&R(a,"archive"),("archive"!==f.view&&f.fId||!f.fId&&"unread"===f.view)&&d.remove()}else"thd"===b&&(d=$(zmail.mailCenter.listElem).find("#t"+a),e=$(zmail.mailCenter.listElem).find("#thd"+a),d.addClass("zmarch"),"archive"!==f.view&&""!==f.fId&&(d.remove(),e.remove()));$.publish("mail/archive",[a,"msg"]),s(a,b),z(a,j.FD),0!==i&&f.fId!==zmail.folId.tId&&f.fId!==zmail.folId.dId&&(zmInit.checkThreadRead(zmail.mailObj[a].T)?G(a,b):I(a,b))}},T=function(a,b,c){if(!c){var d,e,h=!0,j=zmail.mailObj[a],k=j.T;if("msg"===b){if(d=$(zmail.mailCenter.listElem).find("#"+a),d.removeClass("zmarch"),k&&zmail.listObj[k]){var l=zmList.getMailSummaryList(f,k);if(l.length<=1&&a===l[0]){var m=x(a);m.length&&m.remove(),D(d),$(g.prevElem).attr("data-mid")&&zmPrev.updatePrevOnDeletion(a),h=!1}}h&&j.TH&&0!==i&&R(a,"unarchive"),"archive"===f.view&&d.remove()}else d=$(zmail.mailCenter.listElem).find("#t"+a),e=$(zmail.mailCenter.listElem).find("#thd"+a),d.removeClass("zmarch"),"archive"===f.view&&(d.remove(),e.remove());$.publish("mail/unarchive",[a,"msg"]),t(a,b),z(a,j.FD),0!==i&&f.fId!==zmail.folId.tId&&f.fId!==zmail.folId.dId&&(zmInit.checkThreadRead(zmail.mailObj[a].T)?G(a,b):I(a,b))}},U=function(a,b,c){if(!c){var d,e;if("msg"===b){if(d=zmail.mailObj[a].FD,e=zmail.folId.spId,z(a,e),y(a,e),zmail.mailObj[a].T&&0!==i&&F(a,e,d),zmail.mailObj[a].TH&&0!==i||$(zmail.mailCenter.listElem).find("#"+a).remove(),l({mode:"move",msgId:a,rFrom:d,addTo:e,type:b}),0===zmail.mailObj[a].S&&!zmail.mailObj[a].AR){var g={action:"spam",src:d,dest:e};zmmailAct.updateCount({fId:d,mode:"dec",actionObj:g}),zmmailAct.updateCount({fId:e,mode:"inc",actionObj:g})}}else if("thd"===b){var h,j,m,n=[];for(d=zmail.mailObj[a].FD,e=zmail.folId.spId,m=zmail.mailObj[a].T,$("#t"+a).remove(),$("#thd"+a).remove(),zmPrev.clsPreview(),l({mode:"move",msgId:a,rFrom:d,addTo:e,type:b}),n=q(a,m,f),h=n.length,j=0;j<h;j++)l({mode:"upd",msgId:n[j],key:"FD",val:zmail.folId.spId})}k(a,b),"msg"===b&&zmPreviewTemplate.updateMailHeaderView(a),$.publish("mail/spam",[a,"msg"]),0!==i&&f.fId!==zmail.folId.tId&&f.fId!==zmail.folId.dId&&(zmInit.checkThreadRead(zmail.mailObj[a].T)?G(a,b):I(a,b))}},V=function(a,b,c){var d,e,h,j,k,m;if(d=zmail.folId.spId,b){if(e=b.length,"msg"===c){if(h=b[0].folId,j=b[0].detail.m,z(a,h),y(a,h),(1===i||2===i&&f.fId===zmail.folId.spId)&&zmail.mailObj[a].T&&f.fId===d&&F(a,h,d),$(g.prevElem).attr("data-mid")!==a||0!==i&&zmail.mailObj[a].T&&"th"!==$(g.prevElem).attr("data-ty")||zmPrev.clsPreview(),(0===i||!zmail.mailObj[a].TH||zmail.mailObj[a].TH&&"unread"!==f.view)&&$(zmail.mailCenter.listElem).find("#"+a).remove(),l({mode:"move",msgId:a,rFrom:zmail.folId.spId,addTo:h,type:c}),0===zmail.mailObj[a].S&&!zmail.mailObj[a].AR){var n={action:"notspam",src:d,dest:h};zmmailAct.updateCount({fId:d,mode:"dec",actionObj:n}),zmmailAct.updateCount({fId:h,mode:"inc",actionObj:n})}}else for($("#t"+a).remove(),$("#thd"+a).remove(),zmPrev.clsPreview(),k=0;k<e;k++)for(h=b[0].folId,j=b[0].detail.m,l({mode:"insert",msgId:a,rt:zmail.mailObj[a].R,folId:h,type:c}),m=0;m<j.length;m++)if(zmail.mailObj[j[m]]&&(l({mode:"upd",msgId:j[m],key:"FD",val:h}),0===zmail.mailObj[j[m]].S&&!zmail.mailObj[j[m]].AR)){var o={action:"notspam",src:d,dest:h};zmmailAct.updateCount({fId:d,mode:"dec",actionObj:o}),zmmailAct.updateCount({fId:h,mode:"inc",actionObj:o})}"msg"===c&&zmPreviewTemplate.updateMailHeaderView(a),$.publish("mail/notspam",[a,"msg",b]),0!==i&&f.fId!==zmail.folId.tId&&f.fId!==zmail.folId.dId&&(zmInit.checkThreadRead(zmail.mailObj[a].T)?G(a,c):I(a,c))}},W=function(a,b){zmUtil.hideMenu();var e={read:c.maillistopt.markread,unread:c.maillistopt.markunread,flag:d.common.flag,label:d.common.label,move:d.common.move,"delete":d.common["delete"],spam:c.maillistopt.markspam,notspam:c.maillistopt.notspam,archive:c.maillistopt.archive,unarchive:c.maillistopt.unarchive};if("success"===a.result)return zmUtil.succErrMsg("s",zmText.applyArgs(d.bulkaction.common.info,{actionname:e[b.action]})),void zmList.unchkAll()},X=function(a,b){var c,d,e,f,g,h,j=a.length,k=b.length,l=zmPrev.prevDetails().msgId,m=zmail.mailObj[l]&&zmail.mailObj[l].TH&&i||0,n=!1,o=!1,p=!0;if((1===j&&0===k||0===j&&1===k)&&(d=j?a[0]:b[0],l===d&&(n=!0)),m&&j>0&&0===k){var q=zmail.mailObj[l].T;for(g=0;g<j;g++)if(zmail.mailObj[a[g]].T!==q){p=!1;break}if(p)return}if(!n&&!o)for(g=0,e=j;g<e;g++)if(l===a[g]){o=!0;break}if(!n&&!o)for(c=zmInit.getListingDetObj(),g=0,e=k;!o&&g<e;g++){if(l===b[g]){o=!0;break}for(a=zmList.getMailSummaryList(c,zmail.mailObj[b[g]].T),h=0,f=a.length;h<f;h++)if(l===a[h]){o=!0;break}}n?zmPrev.updatePrevOnDeletion(d):o&&zmPrev.clsPreview()},Y=function(){var a=zmUtil.getFolId();if(a&&zmail.listObj[a]){var b=parseInt(zmail.mailOpt.range)||50,c=zmail.listObj[a].MO&&zmail.listObj[a].MO.length;c<b&&zmInit.fillMails(b)}},Z=function(){var a,b=[{id:"zm_Container",view:zmUtil.getFolId()},{id:"zm_srch1",view:"search"}],c=b.length,d=0;for(d=0;d<c;d++){var e,f,g,h=b[d].id,i=b[d].view;zmsuite.isWorkspaceAvailable(h)&&(g=zmsuite.getCenter(h)[0].getNodes()[2].$el,f=zmPrev.prevDetails(h),e=f.msgId,e&&0===g.find(".zmL.zmSLst").length&&(a=zmList.getDupThdRowId(e,i),a&&zmList.setMailSelection(a,"lt",g)))}},_=function(a,b){var c,e,h,j,k,l,m,n=[];if(g=zmList.getElemObj(),"success"===a.result){var o=zmUtil.getMLConversionValue();if(zmUtil.hideMenu(),f=zmTab.currentTab.indexOf("zm_tab")?zmTab.currentTab.indexOf("zm_srch")?zmInit.getListingDetObj():zmSearchUtil.getSearchViewDetails():zmsuite.getCenterOuter().$el.data("data-detail"),i=f.fId===zmail.folId.sId&&0!==o?1:o,n.push(b.mailId),"unarchive"===b.action&&n.push(b.amailId),n.push(b.tmailId),h=n.length,b.source&&"popup"===b.source&&("move"===b.action||"delete"===b.action||"archive"===b.action&&("archive"!==f.view&&f.fId||!f.fId&&"unread"===f.view)||"unarchive"===b.action&&"archive"===f.view||"spam"===b.action)&&""!==zmPrev.prevDetails().msgId){var p=b.mailId||[],q=b.tmailId||[];X(p,q)}for(j=0;j<h;j++)for(c=n[j],k=0===j?"msg":"thd",e=c?c.length:0,l=0;l<e;l++)if(m=c[l],zmUtil.isMetaDataAvailable(m)){switch(b.action){case"move":J(m,b,k);break;case"delete":Q(m,b.fT,k,b.preAction);break;case"archive":S(m,k,b.preAction);break;case"unarchive":T(m,k,b.preAction);break;case"spam":U(m,k,b.preAction);break;case"notspam":V(m,a.desFol||b.resp.desFol,k)}"delete"!==b.action&&"spam"!==b.action&&zmList.stimulateToTabView(m,k,b)}if(a.count)for(var r in a.count){var s=a.count[r];for(var t in s)zmmailAct.updateCount({fId:t,mode:"binc",count:parseInt(s[t])})}"mail"===b.from||zmTab.currentTab.indexOf("zm_tab")!==-1||!f.fId&&((f.fId||"unread"!==f.view)&&"search"!==f.view||"delete"!==b.action&&"move"!==b.action&&"archive"!==b.action&&"spam"!==b.action&&"notspam"!==b.action)||("notifier"!==b.from&&(zmList.unchkAll(),"move"===b.action&&zmUtil.succErrMsg("s",d.info.moveSuccess)),$(g.prevElem).attr("data-mid")&&$(".SC_Popn").length&&zmPrev.removeCountinPreview(g)),Z(),Y()}else{var u=d.common.errorprocessing;a.result?u=a.result:a.error&&(u=a.error),zmsDialog.alert(u)}$.publish("/maction/"+b.action)},aa=function(a,b){var c,e,h,j,k,l,m,n=[];if(g=zmList.getElemObj(),"success"===a.result){var o=zmUtil.getMLConversionValue();for(f=zmTab.currentTab.indexOf("zm_tab")?zmTab.currentTab.indexOf("zm_srch")?zmInit.getListingDetObj():zmSearchUtil.getSearchViewDetails():zmsuite.getCenterOuter().$el.data("data-detail"),
i=f.fId===zmail.folId.sId&&0!==o?0:o,n.push(b.mailId),n.push(b.tmailId),k=n.length,j=0;j<k;j++)for(e=0===j?"msg":"thd",h=0,l=n[j],l&&(h=l.length),m=0;m<h;m++)if(c=l[m],zmUtil.isMetaDataAvailable(c))switch(b.action){case"read":L(c,e,b);break;case"unread":M(c,e,b.preAction);break;case"flag":O(c,b.fVal,e,b.preAction);break;case"label":P(c,b,e);break;case"spam":U(c,e)}if("notifier"!==b.from&&0===zmPreviewTemplate.currentWorkSpace&&("read"===b.action&&"unread"===f.view||"flag"===b.action&&f.flag||"label"===b.action&&f.label)&&zmList.unchkAll(),a.count)for(var p in a.count){var q=a.count[p];for(var r in q)zmmailAct.updateCount({fId:r,mode:"binc",count:parseInt(q[r])})}$(g.prevElem).attr("data-mid")&&$(".SC_Popn").length&&zmPrev.removeCountinPreview(g),Z(),Y()}else{var s=d.common.errorprocessing;a.result?s=a.result:a.error&&(s=a.error),zmsDialog.alert(s)}},ba=function(a,b,c){var d,e,h,i,j,k,l,m=[],n=[],o=[];for(n=c.mailId||c.amailId,o=c.tmailId,m.push(n),m.push(o),d=m.length,g=zmList.getElemObj(),("move"===a||"delete"===a||"archive"===a&&("archive"!==f.view&&f.fId||!f.fId&&"unread"===f.view)||"unarchive"===a&&"archive"===f.view||"spam"===a)&&""!==zmPrev.prevDetails("zm_Container").msgId&&X(n,o),e=0;e<d;e++)for(k=0===e?"msg":"thd",i=0,j=m[e],j&&(i=j.length),h=0;h<i;h++)switch(l=j[h],a){case"read":L(l,k);break;case"unread":M(l,k);break;case"flag":O(l,b.fA,k);break;case"label":c.preAction=!1,P(l,c,k);break;case"move":c.preAction=!1,J(l,c,k);break;case"delete":Q(l,c.fT,k);break;case"archive":S(l,k);break;case"unarchive":T(l,k);break;case"spam":U(l,k)}},ca=function(a,b,c,e){if(b<2||e.fId===zmail.folId.spId&&"delete"===a)return void c();var f,g={msg_dontshow:d.convDialog.suppresstext,msg_mvact:d.convDialog.movefullthreadtotrash,msg_delact:d.convDialog.deletefullthread,msg_spamact:d.convDialog.markfullthreadspam,msg_mfwdact:d.info.fwdConversations,msg_cont:d.common["continue"],msg_multiplemail:d.convDialog.selectionThread,txt_ok:d.common.ok,txt_cancel:d.common.cancel,msg_folspec:d.convDialog.note,msg_selectiontext:d.convDialog.selectiontext,msg_actiontext:d.convDialog.actiontext.doyou,mail_folderspec:d.convDialog.folderwise,mail_acrossfolders:d.convDialog.acrossfolders,msg_rememberaction:d.convDialog.rememberselection,1:{msg_mvtotrashact:d.convDialog.movefullthreadtotrash,msg_delact:d.convDialog.deletefullthread,msg_spamact:d.convDialog.markfullthreadspam,msg_mvact:d.convDialog.markentireconv},2:{msg_mvtotrashact:d.convDialog.actiontext.movetotrash,msg_delact:d.convDialog.actiontext["delete"],msg_spamact:d.convDialog.actiontext.markasspam,msg_mvact:d.convDialog.actiontext.move}};switch(a){case"delete":f=g[i].msg_delact;break;case"trash":f=g[i].msg_mvtotrashact;break;case"spam":f=g[i].msg_spamact;break;case"multipleforward":f=g.msg_mfwdact;break;case"move":f=g[i].msg_mvact}var h,j,k,l,m,n,o;if(1===i){var p=zmText.applyArgs(d.convDialog.convcount,{count:b}),q=f+". "+g.msg_cont+"?",r=g.msg_multiplemail+". "+p+". "+f+"?",s=1===b?q:r,t=e.fId===zmail.folId.spId||e.fId===zmail.folId.tId;n="conv_conf",o=["DIV",{attrs:{id:n,style:"display: none;"},child:[["DIV",{attrs:{"class":"paraDiv"},child:[["text",s],["DIV",{child:[["text",t?g.msg_folspec:""]]}],["DIV",{child:[["SPAN",{child:[["I",{attrs:{"class":"msi-uncheck"}}],["text",g.msg_dontshow]]}]]}]]}]]}],h=_zm.getDOM(o)}else 2===i&&(n="conv_conf",o=["DIV",{attrs:{id:n,style:"display:none;"},child:[["DIV",{attrs:{"class":"paraDiv"},child:[["text",g.msg_selectiontext],["BR",{}],["BR",{}],["text",f],["DIV",{attrs:{"class":"mail_opt"},child:[["I",{attrs:{"class":"msi-option",value:"1"}}],["SPAN",{child:[["text",g.mail_folderspec]]}]]}],["DIV",{attrs:{"class":"mail_opt"},child:[["I",{attrs:{"class":"msi-unoption",value:"2"}}],["SPAN",{child:[["text",g.mail_acrossfolders]]}]]}],["BR",{}],["DIV",{child:[["SPAN",{child:[["I",{attrs:{"class":"msi-uncheck"}}],["text",g.msg_rememberaction]]}]]}]]}]]}],h=_zm.getDOM(o),l=$("div.mail_opt",h),m=$("i",l),l.on("click",function(){m.removeClass().addClass("msi-unoption"),$(this).closest("div").find("i").removeClass().addClass("msi-option")}));j=$("i.msi-uncheck",h).closest("span").eq(0),k=$("i.msi-uncheck",h).eq(0),j.on("click",function(){k.toggleClass("msi-uncheck"),k.toggleClass("msi-check")});var u=function(){zmsDialog.remove()},v=function(){var a=$("i.msi-option",l).attr("value");if(k.hasClass("msi-check")){var b=zmAdHocSettings.getSuppressedMessagesState();b.conversationAction="off",zmAdHocSettings.setSuppressedMessagesState(b),2===i&&zmAdHocSettings.setConversationActionType(a)}setTimeout(function(){c(a)},0),u()},w={style:{width:"500px"},buttons:[{txt:g.txt_ok,callback:v,selected:!0},{txt:g.txt_cancel,callback:u,isCancel:!0}],mask:!0,hideclose:!1,pos:"center",title:d.convDialog.title,closeaction:function(){$("#"+n).remove()}};document.body.appendChild(h),zmsDialog.create(n,w)},da=function(){var a,b=[],c=[],d=[],e="",f=[],g=[],h=zmail.mailObj;for(d=zmUtil.getCheckedMailList(),f=d[0],g=d[1],f.length&&g.length?e=parseInt(h[f[0]].R)>=parseInt(h[g[0]].R)?parseInt(h[f[0]].R):parseInt(h[g[0]].R):f.length?e=parseInt(h[f[0]].R):g.length&&(e=parseInt(h[g[0]].R)),a=0;a<f.length&&parseInt(h[f[a]].R)===e;a++)b.push(f[a]);for(a=0;a<g.length&&parseInt(h[g[a]].R)===e;a++)b.push(g[a]);return{receivedTime:e,list:[b,c]}},ea=function(){$.subscribe("/mail/draftsaved",function(a,b){b=b||{},zmUtil.isInlineCompose()&&zmUtil.getMailContent(String(b.draftId),{reload:!0}),zmmailAct.updateDraftCountInUI(b.msgId,"save_draft","","zm_Container")})},fa=function(){var a={lbl_dontshow:b.sharemailtipdialog.dontshow,lbl_diagtitle:b.sharemailtipdialog.didyouknow,txt_tipmessage:b.sharemailtipdialog.tipmessage,lbl_dialog_ok:b.sharemailtipdialog.gotit},c="share-mail-tip-dialog",d=['<div id="'+c+'" style="">','<div class="paraDiv">','<span x-id="message">'+a.txt_tipmessage+"</span>","<div>",'<span x-id="checkbox-holder" style="margin-left: 5px; cursor: pointer;">','<i x-id="checkbox" class="msi-uncheck" style="margin-right: 5px;"></i>',a.lbl_dontshow,"</span>","</div>","</div>","</div>"].join(""),e=$(d),f=e.find("[x-id=checkbox]"),g=e.find("[x-id=checkbox-holder]");e.find("[x-id]").removeAttr("x-id");var h=!1,i=function(){f.toggleClass("msi-check").toggleClass("msi-uncheck"),h=f.hasClass("msi-check")},j=function(){zmsDialog.remove(),$("#"+c).remove()},k=function(){if(h){var a=zmAdHocSettings.getSuppressedMessagesState();a.mailShareTip="off",zmAdHocSettings.setSuppressedMessagesState(a),h=!1,f.removeClass("msi-check").addClass("msi-uncheck")}j()},l={style:{width:"500px"},buttons:[{txt:a.lbl_dialog_ok,callback:k,selected:!0}],mask:!0,hideclose:!1,pos:"center",title:a.lbl_diagtitle,closeaction:function(){$("#"+c).remove()}},m=function(){e.hide(),e.appendTo(document.body),zmsDialog.create(c,l),e.show(),g.off().on("click",i)};return{show:function(){zmUtil.isZohoAccount(zmail.accId)&&zmail.isOrg&&m()}}}(),ga={applyActions:function(b,c,e){var g,k,l,m,n,o,p,q,r=!0,s=[],t=zmUtil.getMLConversionValue(),u={};if(a=c,k={accId:zmail.accId,mode:"markas"},l={action:b},zmInit.listingBand.isBulkActionSet){var v=da();o=v.list,k.mode="bulkaction",k.receivetime=v.receivedTime,zmTab.currentTab.indexOf("zm_srch")||(k=$.extend(k,zmSearchUtil.getRequestParams()))}else{var w=zmUtil.getCheckedMailCount(),x=300;if(o=zmUtil.getSelectedMails(),w>x)return}if(l.mailId=g=e&&e.msgId?e.msgId:o[0],n=e&&e.thd?e.thd:o[1],l.tmailId=n,zmTab.currentTab.indexOf("zm_tab")?zmTab.currentTab.indexOf("zm_srch")?(f=zmInit.getListingDetObj(),u=zmList.selDetails.mListing||{}):(f=zmSearchUtil.getSearchViewDetails(),u=zmList.selDetails.sListing||{}):f=zmsuite.getCenterOuter().$el.data("data-detail"),i=f.fId===zmail.folId.spId&&2===t?1:f.fId===zmail.folId.sId||f.fId===zmail.folId.tId?0:t,f.fId&&(k.viewfolId=f.fId,q=f.fId),(f.view||zmInit.listingBand.isBulkActionSet&&u.view)&&(k.view=f.view||u.view,q=f.view),(f.flag||zmInit.listingBand.isBulkActionSet&&u.flag)&&(k.flag=f.flag||u.flag,q="flag"),(f.label||zmInit.listingBand.isBulkActionSet&&u.label)&&(k.label=f.label||u.label,q=f.label),(f.attach||zmInit.listingBand.isBulkActionSet&&u.attach)&&(k.attach=f.attach||u.attach,q=f.attach),zmInit.listingBand.isBulkActionSet||(1===i||2===i&&(q===zmail.folId.spId||q===zmail.folId.tId)?k.folderSpec=1:k.folderSpec=i),n&&n.length&&(s=zmUtil.getThreadIdArr(n)),"zm_Container"===zmTab.currentTab&&"unread"===q&&$(zmail.mailCenter.prevElem).hasClass("shw")&&s.length){var y,z=zmPrev.prevDetails(),A=z.msgId,B=-1,C=$.extend({},f);if(y=zmail.mailObj[A].T,B=s.indexOf(y),zmail.mailObj[A].TH&&B!==-1){""===f.fId?C.view="all":C.view="";var D=zmList.getMailSummaryList(f,zmail.mailObj[A].T);0===D.length&&(D=zmList.getMailSummaryList(C,zmail.mailObj[A].T),g=g.concat(zmail.listObj[zmail.mailObj[A].T].MO),l.mailId=g,n.splice(B,1),l.tmailId=n)}}if((f.fId===zmail.folId.tId||f.fId===zmail.folId.dId||0===i)&&n&&n.length&&(g=g.concat(n),n=[],l.mailId=g,l.tmailId=[]),g&&g.length){if(m=zmmailAct.separateArchive(g),m[0].length>200)return void zmUtil.succErrMsg("e",d.info.maxmailselection);k.mailId=m[0].join(),k.mailId.length||(delete k.mailId,delete l.mailId),m[0].length>0&&zmUtil.isSharedFolder(f.fId)&&(k.shId=l.shId=zmUtil.getShareId(f.fId),zmail.opType[b]?k.opType=zmail.opType[b]:k.opType=0)}if(m&&m[1].length>0){if(m[1].length>200)return void zmUtil.succErrMsg("e",d.info.maxarchivemails);l.amailId=m[1],k.amailId=m[1].join(),zmUtil.isSharedFolder(f.fId)&&(k.shId=l.shId=zmUtil.getShareId(f.fId),zmail.opType[b]?k.opType=zmail.opType[b]:k.opType=0)}if(n&&n.length){if(s.length>200)return void zmUtil.succErrMsg("e",d.info.maxconvselection);k.tmailId=s.join(),zmUtil.isSharedFolder(f.fId)&&(k.shId=l.shId=zmUtil.getShareId(f.fId),zmail.opType[b]?k.opType=zmail.opType[b]:k.opType=0)}if(k.todo=$.inArray(b,h),"flag"===b?(k.fA=e.fVal,l.fVal=e.fVal):"label"===b?(l.lA=e.lA,e.lId&&(k.lId=l.lId=e.lId),"add"===e.lA?(k.mailId&&k.mailId.length?p=zmmailAct.rmDuplicateLabel(k.mailId,e.lId,"msg"):(delete k.mailId,delete l.mailId),p&&p.length>0?(k.mailId=p.join(),k.lA=0):n&&n.length?(k.lA=0,r=!0):k.amailId&&k.amailId.length?(p=zmmailAct.rmDuplicateLabel(k.amailId,e.lId,"msg"),p&&p.length>0&&(k.amailId=p.join()),k.lA=0):(zmUtil.hideMenu(),r=!1)):"delete"===e.lA?k.lA=2:k.lA=3,"default"===e.accType&&(k.accId=zmail.defAccId)):k.todo===-1&&(r=!1),r&&"zmStreamsApp"!==zmTab.currentTab){var E=aa;if(l.suppressWSNoti=!0,zmInit.listingBand.isBulkActionSet?(l.suppressWSNoti=!1,l.preAction=!1,E=W):k.shId?l.preAction=!1:l.preAction=!0,j(k,l,E),l.preAction){var F=$.extend({},k),G=$.extend({},l);ba(b,F,G)}}},doActions:function(b,c,e){var g,k,l,m,n,o,p={accId:zmail.accId,mode:"moveto"},q={action:b,from:c},r=!0,s=[],t=zmUtil.getMLConversionValue(),u={};if(a=c,zmTab.currentTab.indexOf("zm_tab")?zmTab.currentTab.indexOf("zm_srch")?(f=zmInit.getListingDetObj(),u=zmList.selDetails.mListing||{}):(f=zmSearchUtil.getSearchViewDetails(),u=zmList.selDetails.sListing||{}):f=zmsuite.getCenterOuter().$el.data("data-detail"),i=f.fId===zmail.folId.spId&&2===t?1:f.fId===zmail.folId.sId||f.fId===zmail.folId.tId?0:t,"newm"!==b){if("sweep"===b){p.mode="bulkaction";var v=zmUtil.createSearchParams(e.senderList,f);p=$.extend(p,v),l=zmUtil.getSelectedMails(),l[0]=l[0].concat(l[1])||[];var w=zmUtil.getFolId(f);zmail.listObj[w]&&zmail.listObj[w].MO.length?p.receivetime=zmail.mailObj[zmail.listObj[w].MO[0]].R:p.receivetime=zmail.mailObj[l[0][0]].R,"delete"===e.actionType?p.sA=0:"archive"===e.actionType&&(p.sA=1,$.publish("folder/archived",[f.fId])),q.action=e.actionType}else if(zmInit.listingBand.isBulkActionSet){var x=da();l=x.list,p.mode="bulkaction",p.receivetime=x.receivedTime,zmTab.currentTab.indexOf("zm_srch")||(p=$.extend(p,zmSearchUtil.getRequestParams()))}else{var y=zmUtil.getCheckedMailCount(),z=300;if(l=zmUtil.getSelectedMails(),y>z)return}if(q.mailId=g=e&&e.msgId?e.msgId:l[0],m=e&&e.thd?e.thd:l[1],q.tmailId=m,"sweep"!==b){if(f.fId&&(p.viewfolId=f.fId,n=f.fId),(f.view||zmInit.listingBand.isBulkActionSet&&u.view)&&(p.view=f.view||u.view,n=f.view,"bulkaction"===p.mode&&!f.fId&&"search"===f.view)){var A=zmSearchUtil.getSearchedFolders()[0]||"";A&&(p.viewfolId=A)}(f.flag||zmInit.listingBand.isBulkActionSet&&u.flag)&&(p.flag=f.flag||u.flag,n="flag"),(f.label||zmInit.listingBand.isBulkActionSet&&u.label)&&(p.label=f.label||u.label,n=f.label),(f.attach||zmInit.listingBand.isBulkActionSet&&u.attach)&&(p.attach=f.attach||u.attach,n=f.attach)}if(m&&m.length&&(s=zmUtil.getThreadIdArr(m)),"zm_Container"===zmTab.currentTab&&"unread"===n&&$(zmail.mailCenter.prevElem).hasClass("shw")&&s.length){var B,C=zmPrev.prevDetails(),D=C.msgId,E=-1,F=$.extend({},f);if(B=zmail.mailObj[D].T,E=s.indexOf(B),zmail.mailObj[D].TH&&E!==-1){""===f.fId?F.view="all":F.view="";var G=zmList.getMailSummaryList(f,zmail.mailObj[D].T);0===G.length&&(G=zmList.getMailSummaryList(F,zmail.mailObj[D].T),g=g.concat(G),q.mailId=g,m.splice(E,1),q.tmailId=m)}}if((f.fId===zmail.folId.dId||f.fId===zmail.folId.tId||0===i)&&m&&m.length&&(g=g.concat(m),m=[],q.mailId=g,q.tmailId=[]),g&&g.length){if(k=zmmailAct.separateArchive(g),k[0].length>200)return void zmUtil.succErrMsg("e",d.info.maxmailselection);p.mailId=k[0].join(),p.mailId.length||(delete p.mailId,delete q.mailId),k[0].length>0&&zmUtil.isSharedFolder(f.fId)&&(p.shId=q.shId=zmUtil.getShareId(f.fId),zmail.opType[b]?p.opType=zmail.opType[b]:p.opType=0)}if(k&&k[1].length>0){if(k[1].length>200)return void zmUtil.succErrMsg("e",d.info.maxarchivemails);q.amailId=k[1],p.amailId=k[1].join(),zmUtil.isSharedFolder(f.fId)&&(p.shId=q.shId=zmUtil.getShareId(f.fId),zmail.opType[b]?p.opType=zmail.opType[b]:p.opType=0)}if(m&&m.length){if(s.length>200)return void zmUtil.succErrMsg("e",d.info.maxconvselection);p.tmailId=s.join(),zmUtil.isSharedFolder(f.fId)&&(p.shId=q.shId=zmUtil.getShareId(f.fId),zmail.opType[b]?p.opType=zmail.opType[b]:p.opType=0)}}if(p.todo=$.inArray(b,h),"move"===b){var H,I;if(p.folId=q.folId=e.folId,p.mailId){for(H=p.mailId.toString().split(","),p.mailId="",I=0;I<H.length;I++)e.folId!==zmail.mailObj[H[I]].FD&&(0!==I&&""!==p.mailId&&(p.mailId+=","),p.mailId+=H[I]);p.mailId||delete p.mailId}if(p.tmailId&&1===i&&zmail.folCount[f.fId])for(H=m.toString().split(","),p.tmailId="",I=0;I<H.length;I++)e.folId!==zmail.mailObj[H[I]].FD&&(0!==I&&""!==p.tmailId&&(p.tmailId+=","),p.tmailId+=zmail.mailObj[H[I]].T)}else if("delete"===b){var J=f.fId;"search"===f.view&&(J=zmSearchUtil.getSearchedFolders()[0]||""),J===zmail.folId.dId?p.fT=q.fT=1:J===zmail.folId.teId?p.fT=q.fT=2:J===zmail.folId.spId?p.fT=q.fT=4:J===zmail.folId.tId?p.fT=q.fT=5:J===zmail.folId.oId?p.fT=q.fT=6:p.fT=q.fT=0,p.mailId&&zmail.mailObj[p.mailId]&&zmail.mailObj[p.mailId].FD===zmail.folId.dId&&(p.fT=q.fT=1)}else if("notspam"===b){var K,L;if(p.mailId){for(K=p.mailId.toString().split(","),L=0;L<K.length;L++)zmail.mailObj[K[L]].FD!==zmail.folId.spId&&K.splice(L,1);p.mailId=K.join()}}else if("newm"===b){var M,N;if("NEW_MAIL"===e.act?(M=e.AID,N=[e.data]):(M=e.accId,N=$.parseJSON(e.cs)),r=!1,N)if(zmail.accId===M)for(var O in N){var P=N[O];if(zmail.mailObj[P.M]&&zmail.mailObj[P.M].FD===zmail.folId.dId&&(P.PA=zmail.mailObj[P.M].PA),zmail.mailObj[P.M]=P,P.DT=P.RDT||P.DT,P.SN=P.NSN||P.SN,P.SHID&&zmUtil.isSharedFolder(P.SHID))zmail.mailObj[P.M].FD=P.SHID;else{var Q=P.FD;P.S||(P.FD===zmail.folId.spId||P.FD===zmail.folId.tId?zmmailAct.updateCount({fId:Q,mode:"inc",count:1,isHighlight:!1}):zmmailAct.updateCount({fId:Q,mode:"inc",count:1,isHighlight:!0}))}$.publish("/maction/newm",[[P]])}else zmUtil.updateCountForAcc(M,"inc",1)}else p.todo===-1&&(p.todo=-1);var R=zmAdHocSettings.getSuppressedMessagesState();if(f.fId!==zmail.folId.dId&&f.fId!==zmail.folId.tId&&q.tmailId&&q.tmailId.length&&"on"===R.conversationAction&&(!e||!e.scac)){var S,T;switch(b){case"delete":S=f.fId===zmail.folId.tId||f.fId===zmail.folId.spId?"delete":"trash";break;case"spam":case"move":S=b}if(e=e||{},e.scac=!0,S)return T=(q.mailId&&q.mailId.length||0)+zmUtil.getTotalMailCountInThreads(q.tmailId)+(q.amailId&&q.amailId.length||0),void ca(S,T,function(c){e.listingType=c,zmmailAct.doActions(b,a,e)},f)}if(p.mailId||p.tmailId||p.amailId||"newm"===b||(zmUtil.hideMenu(),r=!1),"bulkaction"!==p.mode&&(1===i||2===i&&(n===zmail.folId.spId||n===zmail.folId.tId)||n===zmail.folId.dId?p.folderSpec=1:p.folderSpec=i,o=e&&e.listingType?e.listingType:zmAdHocSettings.getConversationActionType(),2!==p.folderSpec||"delete"!==b&&"spam"!==b&&"move"!==b||(p.folderSpec=parseInt(o))),r){var U=_;if(q.suppressWSNoti=!0,"bulkaction"===p.mode?(q.preAction=!1,U=W,q.suppressWSNoti=!1):p.shId||"notspam"===b?q.preAction=!1:q.preAction=!0,e&&e.actionSrc&&(p.actionSrc=e.actionSrc),j(p,q,U),q.preAction){var V=$.extend({},p),X=$.extend({},q);ba(b,V,X)}}},rmDuplicateLabel:function(a,b){for(var c,d,e,f=a.toString().split(","),g=f.length,h=[],i=0;i<g;i++){if(e=f[i],d=zmail.mailObj[e].TAG,c=!1,d){var j;for(j=0;j<d.length;j++)if(d[j]===b){c=!0;break}}c||h.push(e)}return h},separateArchive:function(a){for(var b=[],c=[],d=a.length,e=zmail.mailObj,f=0;f<d;f++)1===e[a[f]].AR?c.push(a[f]):b.push(a[f]);return[b,c]},updateCount:function(a){var b=a.fId,c=a.mode,d=a.count,e=a.actionObj,g=a.isHighlight,h=!1;if(!zmUtil.isSharedFolder(b)&&b!==zmail.folId.sId&&b!==zmail.folId.dId){if(e){var i=e.src,j=e.dest,k=e.action,l=["move","spam","notspam","delete"],m=[zmail.folId.spId,zmail.folId.tId,zmail.folId.sId];k&&l.indexOf(k)!==-1&&(m.indexOf(b)===-1||b!==i&&b!==j||(h=!0))}else h=!0;var n,o="zmlTreeH",p={};p=zmail.mailLeft.getNodes()[0].getLayer(o),p.updateCount(b,c,d,g,!0),h&&(n=zmInit.getUnreadViewCount(),o="zmlviewH",p=zmail.mailLeft.getNodes()[0].getLayer(o),p.updateCount("zm_unread","upd",n),zmUtil.updateCountForAcc(zmail.accId,"upd",n)),f=zmInit.getListingDetObj(),(f.fId||"unread"===f.view&&h)&&zmInit.updateHeaderBand("notification"),zmWinTitle.updateTitle()}},handleWMSEvents:function(a,b,c){var d,e,f,g,h,i,j;if(j=c.AID||b.AID,d=zmail.isWSEnabled?["MOVE_MAIL","MARK_FLAGGED"]:["moveMail","markFlagged"],d.indexOf(a)!==-1&&j===zmail.accId)if("moveMail"===a||"MOVE_MAIL"===a){var k=c.FD&&"null"!==c.FD?c.FD:"",l="move";if(f=c.MLIST||[],e=[],!f.length)return;var m=f[0].SFID;if(m&&!k&&(k=m,l="archive"),k===zmail.folId.tId&&""!==zmfolAction.getEmptyFolderStatus(m))return;for(g in f)h=f[g].M||"",i=zmail.mailObj[h],h&&"null"!==h&&i&&("move"===l&&i.FD!==k||"archive"===l&&i.FD===k&&!i.AR)&&e.push(String(h));if(!e.length)return;_({result:"success"},{action:l,mailId:e,folId:k,from:"notifier"})}else if("markFlagged"===a||"MARK_FLAGGED"===a){f=c.MLIST,e=[];var n="1"===c.S?"read":"unread",o=c.S;if("string"==typeof f&&(f=f.split(",")),f=f||[],!f.length)return;for(g in f)h=f[g]||"",i=zmail.mailObj[h],h&&"null"!==h&&i&&o!==String(i.S)&&e.push(String(f[g]));if(!e.length)return;aa({result:"success"},{action:n,mailId:e})}},createCommentEntity:function(){var a={no_data:{code:0,message:b.publishcomment.error.maildatanotavlbl},no_mention:{code:1,message:b.publishcomment.error.userorgrouprequire},req_fail:{code:2,message:b.publishcomment.error.requestfail}};return function(b,c,d){var e=$.Deferred();return b=String(b||""),c=c||"",b?c&&c.length?zmAjq.XHR({u:zmail.conPath+"/mA.do",t:"POST",fn:function(){e.resolve()},p:{mode:"createCommentEntity",messageID:b,shareWith:c,shareConversation:d},csr:"s",efn:function(){e.reject({error:a.req_fail})}}).fail(function(){e.reject({error:a.req_fail})}):e.reject({error:a.no_mention}):e.reject({error:a.no_data}),e.promise()}}(),retrieveComments:function(){var a={};return function(b){var c=$.Deferred();b||c.reject();var d="comments_"+b;return a[d]?c=a[d]:(a[d]=c,c.always(function(){a[d]=void 0,delete a[d]}),zmAjq.XHR({u:zmail.conPath+"/mailComments.do",p:{accId:zmail.accId,entityId:b,groupId:zmail.zuid,comments:!0,entityType:1},t:"post",fn:function(a){c.resolve(a)},efn:function(){c.reject()}})),c.promise()}}(),notifyBulkAction:function(a){var c,e=a.bulk,f="",g="",h="",i=zmUtil.getFolId(),j="";if(e){zmInit.getFolderTreeCount(),e.indexOf("'")!==-1&&(e=e.replace(/'/gi,'"')),e=$.parseJSON(e);var k={SEARCH:{text:b.filterview.search,id:"search"},FOLDER:{text:zmInit.findFolName(e.fId)+" "+b.filterview.folder,id:e.fId},LABEL:{text:zmUtil.findTagName(e.label)+" "+b.filterview.tagview,id:e.label},UNREAD:{text:b.filterview.unreadview,id:"unread"},ALLMESSAGE:{text:b.filterview.allmsgview,id:"all"},FLAGED:{text:b.filterview.flagview,id:"flag"}};switch(c=e.action,g=e.view,h=k[g].text,j=k[g].id,"SEARCH"===g||zmPrev.prevDetails("zm_Container").msgId||i===j&&$.publish("/mail/listMails",{}),c){case"READ":f=zmText.applyArgs(d.bulkaction.view.readcomplete,{viewtype:h});break;case"UNREAD":f=zmText.applyArgs(d.bulkaction.view.unreadcomplete,{viewtype:h});break;case"MOVE_TO":var l=e.actionList,m=zmInit.findFolName(l);f=zmText.applyArgs(d.bulkaction.view.movecomplete,{destinationfolder:m,viewtype:h});break;case"SPAM":f=zmText.applyArgs(d.bulkaction.view.spamcomplete,{viewtype:h});break;case"NOTSPAM":f=zmText.applyArgs(d.bulkaction.view.notspamcomplete,{viewtype:h});break;case"LABEL":var n=e.actionList,o=zmUtil.findTagName(n);f=zmText.applyArgs(d.bulkaction.view.tagadded,{tagname:o,viewtype:h});break;case"UNLABEL":n=e.actionList,o=zmUtil.findTagName(n),f=zmText.applyArgs(d.bulkaction.view.tagremoved,{tagname:o,viewtype:h});break;case"FLAG":case"CLEAR_FLAG":var p=parseInt(e.actionList);switch(p){case 0:f=zmText.applyArgs(d.bulkaction.view.clearflag,{viewtype:h});break;case 1:f=zmText.applyArgs(d.bulkaction.view.infoflag,{viewtype:h});break;case 2:f=zmText.applyArgs(d.bulkaction.view.impflag,{viewtype:h});break;case 3:f=zmText.applyArgs(d.bulkaction.view.followupflag,{viewtype:h})}break;case"DELETE":case"DELETE_FROM_SPAM":case"DELETE_FROM_TEMPLATE":case"DELETE_FROM_DRAFT":case"DELETE_FROM_TRASH":f=zmText.applyArgs(d.bulkaction.view.deletecomplete,{viewtype:h});break;case"ARCHIVE":f=zmText.applyArgs(d.bulkaction.view.archivecomplete,{viewtype:h});break;case"UNARCHIVE":f=zmText.applyArgs(d.bulkaction.view.unarchivecomplete,{viewtype:h})}zmUtil.succErrMsg("s",f)}else if(a.sweep){switch(e=a.sweep,zmInit.getFolderTreeCount(),e.indexOf("'")!==-1&&(e=e.replace(/'/gi,'"')),e=$.parseJSON(e),c=e.action){case"DELETE":f=d.bulkaction.sweep.deletecomplete;break;case"ARCHIVE":f=d.bulkaction.sweep.archivecomplete}zmUtil.succErrMsg("s",f)}},updateDraftCountInUI:function(a,b,d,e){var f,g;if(""!==b&&void 0!==b){var h=zmUtil.getMLConversionValue()||i;f=0===h?$(zmail.mailCenter.listElem).find("#"+a):x(a,e),"discard_draft"===b?d?(g=d>1?d+" "+c.common.draftPlural:d+" "+c.common.draft,f.find(".SC_dft span").html(g)):f.find(".SC_dft span").html(""):"save_draft"===b&&zmail.mailObj[a]&&!zmail.mailObj[a].DMID&&(f.length&&(a=f.attr("id"),0===a.indexOf("t")&&(a=a.substring(1))),d=zmail.mailObj[a].DC?zmail.mailObj[a].DC+1:1,g=d>1?d+" "+c.common.draftPlural:d+" "+c.common.draft,f.find(".SC_dft span").html(g))}},rapplyAction:aa,rdoAction:_,confThreadAction:ca,mailShareTip:fa,updateUnreadStatusforThd:m,updateFlagStatusforThd:n,setFlagStatusforThd:o,updateLabelsforThd:p};return ea(),ga}(),window.zmUrlAct=function(){"use strict";var a={},b=["folder","share","tags","views","all"],c=["view_unread","view_archive","view_all","flag_all","flag_1","flag_2","flag_3","label_all","label","view_attach","attach_1"],d={},e={},f={prev:[],curr:[]},g=function(){zmInit.lPageType()?f.curr=["folder","inbox"]:f.curr=["views","unread"]},h=function(a){f.curr.length&&(f.prev=f.curr),f.curr=a},i=function(a){var b=[];if(a.viewId)if(a.viewId&&"-1"===a.viewId)"label"===a.view?b.push("tags"):b.push(a.view),b.push("all");else{if(!a.viewId||"-1"===a.viewId)return!1;"label"===a.view?b.push("tags"):"attach"===a.view?b.push("attach"):b.push(a.view),b.push(a.viewId)}else"all"===a.view?b=[]:(b.push("view"),b.push(a.view));return b},j=function(a,b){a.length||(a=f.curr());for(var c=b.length,d=0;d<c;d++)if(a.indexOf(b[d])!==-1){a=a.slice(0,a.indexOf(b[d]));break}return a},k=function(){var a=zmail.mailLeft.selLayerId,c="";return"zmlTreeH"===a?c=b[0]:"zmlSTreeH"===a?c=b[1]:"zmllabelH"===a?c=b[2]:"zmlviewH"===a&&(c=b[3]),c},l=function(a){var b="",c="";if(a===zmail.folId.iId||"inbox"===a)b+="inbox",c=zmail.folId.iId;else if(a===zmail.folId.dId||"drafts"===a)b+="drafts",c=zmail.folId.dId;else if(a===zmail.folId.spId||"spam"===a)b+="spam",c=zmail.folId.spId;else if(a===zmail.folId.teId||"templates"===a)b+="templates",c=zmail.folId.teId;else if(a===zmail.folId.sId||"sent"===a)b+="sent",c=zmail.folId.sId;else if(a===zmail.folId.tId||"trash"===a)b+="trash",c=zmail.folId.tId;else if(a===zmail.folId.oId||"outbox"===a)b+="outbox",c=zmail.folId.oId;else if("unread"===a||"zm_unread"===a)b+="unread",c="zm_unread";else if("all"===a||"zm_all"===a)b+="all",c="zm_all";else if("flag"===a||"flagged"===a||"zm_flag"===a)b+="flagged",c="zm_flag";else if(/^\+?(0|[1-9]\d*)$/.test(a)){if(!(zmUtil.isFolderId(a)||zmUtil.isSharedFolder(a)||zmUtil.isLabelId(a)||zmUtil.isViewId(a)))return{folId:!1};b+=a,c=a}return{hashTxt:b,folId:c}},m=function(a){var b=[],c="",d="";return c=k(),d=l(a),b.push(c),b.push(d.hashTxt),{hashTxt:b,folId:d.folId}};a.update=function(a){var b,c,d,e=zmsuite.getAppRouter("zm_Container");if(b=a.from?a.from:a.folId&&!a.view||a.view&&a.folId===a.viewId||a.folId&&"zm"===a.folId.substring(0,2)?"zmLeft":"dropMenu","zmLeft"===b){var g=m(a.folId);c=g.hashTxt}else if("dropMenu"===b){var k=i(a);d=f.curr;var l=["view","tags","flag","attach","p"];d.length>2&&(d=j(d,l)),c=d.concat(k)}else{if("zmCenter"!==b)return;var n=function(){var b=zmail.folId,c=zmUtil.getFolId();if(c!==b.teId&&c!==b.oId&&c!==b.dId&&0===a.opentype){var d=a.msgId;return"t"===d.charAt(0)&&(d=d.substring(1)),"th"===a.type&&(d=zmCenterListing.mailObjectAPI.getViewParentOf("c"+a.msgId).id),d}};if(d=f.curr,d.length>2&&(d=j(d,["p"])),a.remove)c=d;else{var o=n();c=o?d.concat(["p",o]):d}}c.toString()!==f.curr.toString()&&(h(c),e.setParams(c),e.update())};var n=function(a){var f,g,h={};h[0]=function(a){if(!a[0]||!a[1])return!1;if(b.indexOf(a[0])!==-1){var c=l(a[1]);return!!c.folId&&(d.fId=c.folId,!0)}return!1},h[1]=function(a){var b;return"tags"===a[0]&&(a[0]="label"),b="label"===a[0]&&"all"!==a[1]?a[0]:a[0]+"_"+a[1],c.indexOf(b)!==-1&&("view"===a[0]?"all"!==a[1]&&(d.view=a[1]):(d.view=a[0],"all"!==a[1]?d.viewId=a[1]:d.viewId=-1),!0)},h[2]=function(a){var b;return"p"===a[0]&&(b="t"===a[1].charAt(0)?a[1].substring(1):a[1],!!/^\+?(0|[1-9]\d*)$/.test(b)&&(e.msgId=a[1],e.type="lt",e.opentype=0,!0))};for(var i=0;i<a.length;i+=2)if(g=i/2,2===i&&"p"===a[i]&&(g=i),f=h[g]([a[i],a[i+1]]),!f)return!1;return!0},o=function(a){d={},e={};var b=function(b){var c=a.toString();return b=c.toLowerCase(),b=b.split(",")},c=function(){var b,c,d,e;return!f.curr.length||(d=f.curr.indexOf("p")===-1?f.curr.length:f.curr.indexOf("p"),e=a.indexOf("p")===-1?a.length:a.indexOf("p"),b=f.curr.slice(0,d),c=a.slice(0,e),b.toString()!==c.toString())},g=function(){var b;b="t"===e.msgId.charAt(0)?e.msgId.substring(1):e.msgId,zmail.mailObj[b]&&($(zmail.mailCenter.listElem).find("#"+b).length||$(zmail.mailCenter.listElem).find("#t"+b).length)?zmList.showMailPreview(e):(zmsuite.isMaxLimitReached()||zmList.getMailData({msgId:e.msgId,opentype:2,type:"lt",src:"external"}),a=f.curr.length?f.curr:a.slice(0,a.indexOf("p")))};if(a=b(a),n(a)){if(d.fId)if("m"!==zmApp.currentApp&&zmApp.showApp("m"),"zm_Container"!==zmTab.currentTab&&zmsuite.showExistingApp("zm_Container"),c()||zmail.onDemandListing&&!zmail.initialListingLoaded)if(zmail.initialListingLoaded=!0,e.msgId){var h=$.Deferred();zmList.showMailListing(d,{retainPreview:!1,sortAscending:void 0,mlDefObj:h}),$.when(h).done(function(){g()})}else zmList.showMailListing(d);else e.msgId?g():zmPrev.prevDetails().msgId&&zmPrev.clsPreview();return!0}return!1},p=function(a){var b="lt",c=function(){var c=zmail.mailObj[a];c&&c.TH&&(b="th"),zmList.getMailData({msgId:a,opentype:2,type:b,src:"external"})},d=function(){a=a.substring(1),zmList.getMailData({msgId:a,opentype:2,type:b,src:"external",tId:a})};"t"!==a.charAt(0)?c():d()},q=function(a){return a.length?1===a.length&&("inbox"===a[0]?a.unshift("folder"):"unread"===a[0]&&a.unshift("views")):1===zmInit.lPageType()?(a.push("folder"),a.push("inbox")):(a.push("views"),a.push("unread")),a};return a.manualHandler=function(a){var b=!1;a=q(a);var c={tab:{handler:function(a){zmsuite.isMaxLimitReached()||(p(a[1]),b=!0)}},"switch":{handler:function(a){var c=a[1];c&&zmail.aInfo[c]&&(zmUtil.switchAccount(c),b=!0)}}};return a[0]in c?(c[a[0]].handler(a),{updateParams:b,defaultAction:!1}):{updateParams:o(a)}},a.getZmLayers=function(){return b},a.init=g,a}(),window.zmRestore=function(){"use strict";var a={},b="zm_Container",c=["listing","expandThd","preview","tab"],d=function(){return"restore"===zmAdHocSettings.getLPageType()};a.saveState=function(a,e){if(d()){if(c.indexOf(a)===-1)return;var f=zmsuite.getAppObj(b).obj.stateData.data;"listing"===a?f.listing.view=e:"expandThd"===a?f.listing.expand=e:"preview"===a&&(f.preview=e),zmState.sendRequestToSaveState()}},a.restoreTabs=function(a){a.app&&a.category&&$.publish(a.app+"/"+a.category,[a])};var e=function(a){if(a){var c=zmail.mailObj[a];if(c){var d;c.TH&&(d=zmCenterListing.mailObjectAPI.getViewParentOf("c"+a)),c.TH&&zmUtil.getFolId()!==zmail.folId.sId&&zmUtil.getMLConversionValue()&&d&&d.id===a?zmUtil.initScroll(zmsuite.getCenter(b)[0].getNodes()[2].$el,"t"+a,"t"+a):zmUtil.initScroll(zmsuite.getCenter(b)[0].getNodes()[2].$el,a,a)}}},f=function(a,c){if(a){var d=$.Deferred();if($.when(d).done(function(){zmPrev.prevDetails(b).msgId&&e(a),c&&c.deferred.resolve()}),zmail.mailObj[a]&&($(zmail.mailCenter.listElem).find("#"+a).length||$(zmail.mailCenter.listElem).find("#t"+a).length)){var f=$("#"+a).attr("data-ty")||$("#t"+a).attr("data-ty"),g={msgId:a,type:f,opentype:zmail.mailOpt.isPopup},h=zmList.getListingElemObj(g);zmList.showMailPreview({msgId:a,opentype:0,type:f,tabId:b},h,void 0,d)}else zmsuite.isMaxLimitReached()||zmList.getMailData({msgId:a,opentype:2,type:"lt",src:"external"},void 0,d)}},g=function(a,b){var c=$(zmail.mailCenter.listElem).find("#t"+a);if(!c.length)return void(b&&b.resolve());var d=$("#t"+a).attr("data-ty"),e={msgId:a,type:d,opentype:zmail.mailOpt.isPopup},f=zmList.getListingElemObj(e),g=$(c).find(".zmtCt"),h=$(g);f.rowElem=$(g).closest(".zmL"),zmList.showHideThread(h,f,void 0,b)},h=function(a){var b=a.listing.view.fId,c=a.listing.view.view,d=a.listing.view.viewId;return!(b===zmail.folId.iId&&zmInit.lPageType()&&""===c&&""===d||"zm_unread"===b&&!zmInit.lPageType()&&"unread"===c&&""===d)};return $.subscribe("/mail/switchAccount",function(a,c){var d=zmsuite.getAppObj(b).obj.stateData.data;d.accId=c}),a.restoreMailApp=function(a,b){try{var c=a.accId;if(zmail.accId!==c||zmail.onDemandListing)b.deferred.resolve();else{var d=$.Deferred();$.when(d).done(function(){var c=$.Deferred();a.listing.expand.mId?g(a.listing.expand.mId,c):c.resolve(),$.when(c).done(function(){window.setTimeout(function(){a.preview.p?f(a.preview.p,b):b.deferred.resolve()},400)})}),h(a)?zmList.showMailListing(a.listing.view,{retainPreview:!1,sortAscending:void 0,mlDefObj:d}):d.resolve()}}catch(e){b.deferred.resolve()}},a.expandThread=g,a.restorePreview=f,a}(),function(){"use strict";var a,b=zmail.Core.Namespaces,c=b.create("zmContentCache"),d=function(){var b={type:"MFU",keyParam:"msgId",requestURI:"md.do",requestType:"POST",beforeAdd:zmContentCache.processResponse,maxSize:200};a=new zmail.Components.ContentCache.ContentCacheComp(b)},e=function(a,b){return zmUtil.isChildWindow()?zmWindow.addinList(a,b):zmCache.dolistObj(a,b)};c.get=function(b){return zmail.prevMails[b]?zmail.prevMails[b].data.mdata:a.getCacheLib().get(b)||{}},c.fetch=function(b){if(b.p&&!b.p.msgId)zmAjq.XHR(b);else{var c=!!b.ep&&b.ep.avoidCache,d=!!b.ep&&b.ep.forceFetch;b.avoidCache=c,b.forceFetch=d,$.when(a.get(b)).then(function(a){b.fn&&b.fn(a,b.ep)})}},c.remove=function(a){zmail.mailContainer&&zmail.mailContainer.getObject(a)&&zmail.mailContainer.removeObject(a)},c.isCached=function(b){return!!zmail.prevMails[b]||!!a.getCacheLib().hasKey(b)},c.processResponse=function(a,b,c){var d;if(a.mdata?(d=a.mdata.MSGID,b&&b!==d&&c&&c.updateKey&&(b=d,c.updateKey(d))):(d=b,a=a[d]?{
mdata:a[d]}:{mdata:a},a.mdata.MSGID=d),a.mdata&&(a.comment&&(a.mdata.comment=a.comment,a.mdata.sharedUsers=a.sharedUsers,a.mdata.metadata=a.metadata),zmContentCache.remove(d),zmUtil.prevCache(d,a)),a.tdata&&a.tdata.length){var f=a.tdata[0].T;f&&(!zmail.listObj[f]||zmUtil.isInlineCompose()||a.streamsMail)&&(zmail.listObj[f]=e(f,a.tdata),zmUtil.isInlineCompose()&&zmUtil.mapDraftId(f))}if(a.ddata){var g,h,i=a.ddata,j=i.length,k=0;for(k=0;k<j;k++)g=i[k].draftId,h=i[k].content,zmContentCache.isCached(g)&&zmContentCache.remove(g),zmUtil.prevCache(g,{mdata:h})}return a.mdata},c.getCacheStore=function(){return a},c.getCacheLib=function(){return a.getCacheLib()},c.populateMailData=function(a,b){var c=b.msgId,d=b.thId;if(c&&!a.mdata&&(a.mdata=zmContentCache.get(c),a.mdata.comment&&(a.comment=a.mdata.comment),a.mdata.sharedUsers&&(a.sharedUsers=a.mdata.sharedUsers)),d&&!a.tdata&&zmail.listObj[d]){var e=zmail.listObj[d],f=e.MO?e.MO.length:0,g=0;for(g=0;g<f;g++)zmail.mailObj[e.MO[g]]&&a.tdata.push(zmail.mailObj[e.MO[g]])}},c["delete"]=function(b){a.remove(b)},d()}();