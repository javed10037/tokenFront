"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}!function(){window.zNote=window.zNote||{},zNote.CONSTANTS=zNote.CONSTANTS||{},zNote.CONSTANTS.entityType="2",zNote.CONSTANTS.actionType={addEntity:"addEntity"},zNote.CONSTANTS.COLOR={zn_clr1:"0",zn_clr2:"1",zn_clr3:"2",zn_clr4:"3"},zNote.CONSTANTS.MAXCHARACTER={TITLE:100},zNote.CONSTANTS.COLORCODE={0:"zn_clr1",1:"zn_clr2",2:"zn_clr3",3:"zn_clr4"},zNote.CONSTANTS.actionType={self:"viewSelfData",group:"viewGroupEntity"},zNote.CONSTANTS.COLORNAME={0:"Blue",1:"Green",2:"Yellow",3:"Red"},zNote.CONSTANTS.viewType={grid:1,list:2},zNote.CONSTANTS.viewName={1:"grid",2:"list"},zNote.CONSTANTS.NOTECOLOR=[{value:"0",dispname:"Blue"},{value:"1",dispname:"Green"},{value:"2",dispname:"Yellow"},{value:"3",dispname:"Red"}],zNote.CONSTANTS.listTypeClass={1:"msi-thumbview",2:"msi-listview"},zNote.CONSTANTS.hashUrl={},zNote.CONSTANTS.hashUrl.type={c:"group",l:"tags",fav:"views",sharedtome:"views"},zNote.CONSTANTS.hashUrl.typeCode={group:"c",tags:"l",favourites:"views",sharedtome:"views"},zNote.CONSTANTS.hashUrl.folId={fav:"favourites",sharedtome:"sharedtome"},zNote.CONSTANTS.hashUrl.folIdCode={favourites:"fav",sharedtome:"sharedtome"}}(),window.znBox=function(){var a;return a={storeId:"",savedSelection:{},savedSel:[],isPaste:!1,getSummary:function(a){var b=a.slice(0,255),c=b.lastIndexOf("<"),d=b.lastIndexOf(">");return d<c&&(b=a.slice(0,c)),b},spCharRep:function(a){return a?a=a.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&#39;/g,"'").replace(/&amp;/g,"&"):""},revSpCharRep:function(a){return a?a=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/'/g,"&#39;"):""},saveSelection:function(a){znBox.storeNode=a;var b=window.getSelection(),c=[];if(b.rangeCount)for(var d=0,e=b.rangeCount;d<e;++d)c.push(b.getRangeAt(d));return c},restoreSelection:function(a){if(znBox.storeNode&&znBox.savedSel.length&&(znBox.storeNode[0]===a[0]||znBox.storeNode[0].isSameNode&&znBox.storeNode[0].isSameNode(a[0]))){var b=window.getSelection();b.removeAllRanges();for(var c=0,d=znBox.savedSel.length;c<d;++c)b.addRange(znBox.savedSel[c]);return!0}return!1},saveSelectionNew:function(a){var b=window.getSelection();if(b.rangeCount){var c=window.getSelection().getRangeAt(0),d=c.cloneRange();d.selectNodeContents(a),d.setEnd(c.startContainer,c.startOffset);var e=d.toString().length;return{start:e,end:e+c.toString().length}}return{start:0,end:0}},saveSelectionNew1:function(){if(window.getSelection){var a=window.getSelection();if(a.getRangeAt&&a.rangeCount)return a.getRangeAt(0)}else if(document.selection&&document.selection.createRange)return document.selection.createRange();return null},restoreSelectionNew1:function(a,b){if(b)if(window.getSelection){var c=window.getSelection();c.removeAllRanges(),c.addRange(b)}else document.selection&&b.select&&b.select()},restoreSelectionNew:function(a,b){if(b){var c=0,d=document.createRange();d.setStart(a,0),d.collapse(!0);for(var e,f=[a],g=!1,h=!1;!h&&(e=f.pop());)if(3===e.nodeType){var i=c+e.length;!g&&b.start>=c&&b.start<=i&&(d.setStart(e,b.start-c),g=!0),g&&b.end>=c&&b.end<=i&&(d.setEnd(e,b.end-c),h=!0),c=i}else for(var j=e.childNodes.length;j--;)f.push(e.childNodes[j]);var k=window.getSelection();return k.removeAllRanges(),k.addRange(d),!0}return!1},insertHtmlAtCaret:function(a){var b,c;if(window.getSelection&&(b=window.getSelection(),b.getRangeAt&&b.rangeCount)){c=b.getRangeAt(0),c.deleteContents();var d=document.createElement("div");d.innerHTML=a;for(var e,f,g=document.createDocumentFragment();e=d.firstChild;)f=g.appendChild(e);c.insertNode(g),f&&(c=c.cloneRange(),c.setStartAfter(f),c.collapse(!0),b.removeAllRanges(),b.addRange(c))}},isIE:function(){var a=window.navigator.userAgent,b=a.indexOf("MSIE ");return!!(b>0||Boolean(navigator.userAgent.match(/Trident.*rv:11\./)))},getLabelArray:function(a){var b=[],c=zmUtil.getTagList("default");for(var d in c)if(a.indexOf(d)===-1){var e={};e.id=c[d].id,e.name=c[d].dispName,e.hashname="#"+c[d].dispName,b.push(e)}return b},handlePaste:function(a,b,c){znBox.savedSel=znBox.saveSelection(a),$("body").append("<div id='d1' contenteditable=true style=left:-500px;word-wrap:break-word;max-height:300px;max-width:300px;overflow:hidden;position:relative></div>"),$("#d1").focus();var d;setTimeout(function(){d=znBox.getContentEditableText($(document.getElementById("d1"))),$("#d1").remove(),d=d.replace(/\n/g,"<br>");var e=znBox.pasteSanitize(d);c&&(e=e.replace(/<br>/g," ").slice(0,c)),$(a).trigger("focus",!0),znBox.restoreSelection(a),znBox.isIE()?znBox.insertHtmlAtCaret(e):document.execCommand("insertHTML",!1,e),b&&znNote.setTopLeft(znNote.getCurNoteParam(b)),znBox.savedSel=znBox.saveSelection(a)},100)},handleFileInputOnChange:function(a){var b=$.Deferred(),c=[],d={};try{c.push({name:"accId",value:zmail.accId},{name:"zmrcsr",value:zmAjq.getCookie("zmcsr")},{name:"fileName",value:"inline.png"},{name:"type",value:"f"},{name:"tSize",value:0},{name:"attach",value:a}),zmail.fileUploader.flags.isAjaxable||c.push({name:"browser",value:"ie9"}),d.payloads=c,d.url=zmail.conPath+"/attach.do?mode=temp",zmail.fileUploader.upload(d).progress(function(a,b){window.console.info("total: "+a+"  ,loaded: "+b)}).done(function(a){var c=$.parseJSON(a);b.resolve(c)}).fail(function(){})}catch(e){return}return b.promise()},getBlobFromImageUrl:function(a){var b=$.Deferred(),c=new XMLHttpRequest;return c.onreadystatechange=function(){4===this.readyState&&200===this.status&&b.resolve(this.response)},c.open("GET",a),c.responseType="blob",c.send(),b.promise()},convertImageToInlineImages:function(a){var b=znBox.InlineImageSanitize(a),c=[],d=$.Deferred(),e=$("<div>").html(b);return e.find("img").each(function(){var a=this,b=$.Deferred();znBox.getBlobFromImageUrl(this.src).done(function(c){znBox.handleFileInputOnChange(c).done(function(c){a.src=zmail.conPath+"/FileDownload?mode=tmpview&entityType=1&accId="+zmail.accId+"&fpath="+c.fP+"&fstorename="+c.sN,b.resolve()})}),c.push(b)}),$.when.apply($,c).then(function(){var a=znBox.domParser(znBox.getContentEditableText(e));d.resolve(a)}),d.promise()},InlineImageSanitize:function(a){try{var b=a,c=$("<div>").html(b),d="";return $.each($(c),function(a,b){for(var c=znBox.walkDom(b),e=0;e<c.length;e++)if(3===c[e].nodeType)c[e].nodeValue=c[e].nodeValue.replace(/&/g,"&amp;"),c[e].nodeValue=c[e].nodeValue.replace(/</g,"&lt;"),c[e].nodeValue=c[e].nodeValue.replace(/>/g,"&gt;"),d+=c[e].nodeValue;else if(1!==c[e].nodeType||"BR"!==c[e].nodeName&&"TR"!==c[e].nodeName&&"P"!==c[e].nodeName){if(1===c[e].nodeType&&"TD"===c[e].nodeName)d+="&nbsp;";else if(1===c[e].nodeType&&"IMG"===c[e].nodeName){var f=c[e].getAttribute("src");/\/ImageDisplay\?na=[0-9]+&nmsgId=[0-9]+&f=[0-9a-zA-Z]+.[a-z]+&mode=inline&/.test(f)&&(d+="<img src="+f+"></img>")}}else d+="<br>"}),d}catch(e){}},pasteSanitize:function(a,b){try{var c=a,d=$("<div>").html(c),e="";return $.each($(d),function(a,c){for(var d=znBox.walkDomPaste(c),f=0;f<d.length;f++)if(3===d[f].nodeType)d[f].nodeValue=d[f].nodeValue.replace(/&/g,"&amp;"),d[f].nodeValue=d[f].nodeValue.replace(/</g,"&lt;"),d[f].nodeValue=d[f].nodeValue.replace(/>/g,"&gt;"),e+=d[f].nodeValue;else if(1!==d[f].nodeType||"BR"!==d[f].nodeName&&"TR"!==d[f].nodeName&&"P"!==d[f].nodeName){if(1===d[f].nodeType&&"TD"===d[f].nodeName)e+="&nbsp;";else if(1===d[f].nodeType&&"IMG"===d[f].nodeName&&!b){var g=d[f].getAttribute("src");e+="<img src="+g+"></img>"}}else e+="<br>"}),e}catch(f){}},walkDomPaste:function(a){var b=[],c=function(a){do 3!==a.nodeType&&(1!==a.nodeType||"BR"!==a.nodeName&&"DIV"!==a.nodeName&&"TR"!==a.nodeName&&"TD"!==a.nodeName&&"P"!==a.nodeName)||b.push(a),a.hasChildNodes()&&"STYLE"!==a.nodeName&&c(a.firstChild),a=a.nextSibling;while(a)};return c(a),b},walkDom:function(a){var b=[],c=function(a){do 3!==a.nodeType&&(1!==a.nodeType||"BR"!==a.nodeName&&"IMG"!==a.nodeName)||b.push(a),a.hasChildNodes()&&c(a.firstChild),a=a.nextSibling;while(a)};return c(a),b},domParserforImgReplace:function(a){try{var b=a,c=$("<div>").html(b),d="";return $.each($(c),function(a,b){for(var c=znBox.walkDom(b),e=0;e<c.length;e++)3===c[e].nodeType?(c[e].nodeValue=c[e].nodeValue.replace(/&/g,"&amp;"),c[e].nodeValue=c[e].nodeValue.replace(/</g,"&lt;"),c[e].nodeValue=c[e].nodeValue.replace(/>/g,"&gt;"),d+=c[e].nodeValue):1===c[e].nodeType&&"BR"===c[e].nodeName&&(d+="<br/>")}),d}catch(e){}},domParser:function(a){try{var b=a,c=$("<div>").html(b),d="";return $.each($(c),function(a,b){for(var c=znBox.walkDom(b),e=0;e<c.length;e++)if(3===c[e].nodeType)c[e].nodeValue=c[e].nodeValue.replace(/&/g,"&amp;"),c[e].nodeValue=c[e].nodeValue.replace(/</g,"&lt;"),c[e].nodeValue=c[e].nodeValue.replace(/>/g,"&gt;"),d+=c[e].nodeValue;else if(1===c[e].nodeType&&"BR"===c[e].nodeName)d+="\n";else if(1===c[e].nodeType&&"IMG"===c[e].nodeName){var f=c[e].getAttribute("id"),g=c[e].getAttribute("src");d+=f?"<img id='"+f+"' src='"+g+"'></img>":'<img src="'+g+'" ></img>'}}),d}catch(e){}},getContentEditableText:function(a){var b=$("<pre />").html(a.html());return $.browser.webkit&&(b.html(b.html().replace(/<div><br><\/div>/g,"<br>")),b.find("div").replaceWith(function(){return"<br>"+this.innerHTML}),b.html(b.html().replace(/<br>$/,""))),$.browser.msie&&b.find("p").replaceWith(function(){return this.innerHTML+"<br>"}),($.browser.webkit||$.browser.mozilla||$.browser.opera||$.browser.msie)&&b.find("br").replaceWith("\n"),b.html()},getContentEditableTextFromHTML:function(a){var b=$("<pre />").html(a);return $.browser.webkit&&(b.html(b.html().replace(/<div><br><\/div>/g,"<br>")),b.find("div").replaceWith(function(){return"<br>"+this.innerHTML}),b.html(b.html().replace(/<br>$/,""))),$.browser.msie&&b.find("p").replaceWith(function(){return this.innerHTML+"<br>"}),($.browser.webkit||$.browser.mozilla||$.browser.opera||$.browser.msie)&&b.find("br").replaceWith("\n"),b.html()},getConstantsValues:function(a,b){return"color"===b?zNote.CONSTANTS.COLORNAME[a]:""},getTextContentFromHTML:function(a){var b=a?a:"";b=b.replace(/\n/g,"<br>");var c=znBox.pasteSanitize(b).replace(/<br>/g,"\n");return c},getNoteListForGivenIds:function(a){var b={entityIds:a.id,groupIds:a.groupId,mode:"getNotes"};return zmAjq.XHR({u:zmail.conPath+"/NotesAction.do",t:"POST",p:b})},invokeChatlet:function(a,b){if(!$(a).hasClass("zm_snd")){var c="";$(a).addClass("zm_snd");var d=zmail.ContactBook.get({zuid:b.ownerZUID,promise:!1}),e=d[0];e&&e.attrs&&e.attrs.fn&&(c=b.ownerZUID===zmail.zuid?e.attrs.fn+" "+zNote.notei18n.preview.personalCreatedNote:e.attrs.fn+" "+zNote.notei18n.preview.createdNote+" "+znBox.getGroupName(b.namespaceId)),zmAjq.XHR({u:zmail.conPath+"/post.do",p:{mode:"participants",entityType:"2",entityId:b.id,groupId:b.namespaceId,streamsView:!0,data:c},t:"POST"}).done(function(c){c=c[1];var d=[];$.isEmptyObject(c)||(d=c.participants),a=$(a).parents("b");var e={zuids:d,id:b.id,etype:"3",groupId:b.namespaceId,elm:a};zmAppLoader.load("chatlet").done(function(){zmail.Components.Chatlet.core.init(e)})})}},isArchiveOpen:function(){return!0},isRichTextOpen:function(){return!0},copyNote:function(a,b){var c,d,e=znBox.noteModel(a),f=znBox.getGroupArray(),g={"true":"msi-check","false":"msi-uncheck"},h=$('<div class="zm_formArea zm_postNew"><div class="zm_formFld"><div class="zm_formCell"><label>Note Title</label><input placeholder="Enter the title" id="zcpTitle"class="SC_tiput"></div></div><div class="zm_formFld zm_formDC"><div class="zm_formCell"><label>Group</label><input placeholder="Select Group" id="zncpGroup"class="SC_tiput"readonly="readonly"></div><div class="zm_formCell"><label>Book</label><input placeholder="Select Book" id="zncpBook"" class="SC_tiput" readonly="readonly"></div></div><div class="zm_formLne"><div class="SC_lne"></div></div><div class="zm_formFld"><div class="zm_formCell"><i id="attIn" class="'+g[e.get("attachments")]+'"></i><span>Include attachments</span></div></div></div>');e.onChanged("title",function(a){h.find("#zcpTitle").val(a.get("title"))}),e.onChanged("namespaceId",function(a){h.find("#zncpGroup").val(znBox.getGroupName(a.get("namespaceId")))}),e.onChanged("catId",function(a){h.find("#zncpBook").val(zNote.getNamefrmCatObj(a.get("catId"),a.get("namespaceId")))}),e.onChanged("attachments",function(a){h.find("#attIn").removeClass(g[!e.get("attachments")]).addClass(g[e.get("attachments")])}),e.set({title:e.get("title"),namespaceId:e.get("namespaceId"),catId:e.get("catId")}),h.find("#zcpTitle").on("blur",function(){e.set({title:this.value})}),h.find("#attIn").on("click",function(){e.set({attachments:!e.get("attachments")})}),h.find("#zncpGroup").on("click",function(){var a={};a.parentDOM=$(h).find("#zncpGroup")[0],a.displayAs="dropdown",a.onSelect=function(a){e.set({namespaceId:a}),e.set({catId:znBox.getGeneralCatId(a)}),c.hide()},a.onHide=function(){$("#zm_dropDown").remove()},a.dataCallback=function(){return f},c=zmUtil.createFLComp("category",a),c.show()}),h.find("#zncpBook").on("click",function(){var a={},b=znBox.getCategoryArray(e.get("namespaceId"));a.parentDOM=$(h).find("#zncpBook")[0],a.displayAs="dropdown",a.onSelect=function(a){e.set({catId:a}),d.hide()},(e.get("namespaceId")===zmail.zuid||zmCont.getGroup()[e.get("namespaceId")]&&zmCont.getGroup()[e.get("namespaceId")].isOwner)&&(a.onCreate=function(a){znNote.sendNewCatReq(a,{},e.get("namespaceId")).done(function(a){e.set({catId:a[1][0].catId}),d.hide()})}),a.onHide=function(){$("#zm_dropDown").remove()},a.dataCallback=function(){return b},d=zmUtil.createFLComp("category",a),d.show()});var i=function(){c&&c.hide(),d&&d.hide()},j={title:"Copy note",mask:"black",defaultCloseIcon:!0,contentWrapperClass:"SC_PU",maskWrapperClass:"SC_Pop",$content:h,buttons:[{name:zNote.notei18n.ok,callback:function(a){b({catId:e.get("catId"),namespaceId:e.get("namespaceId"),title:e.get("title"),attachments:e.get("attachments")}).done(function(){a.remove()})}},{name:zNote.notei18n.cancel,isCancel:!0,callback:function(a){a.remove()}}],dialogDidMount:function(a){a.$els.$maskWrapper.on("mousedown",function(){i()});var b=$('<div class="SC_frt"><i class="msi-info zm_tooltipIco">i</i></div>');a.$els.$buttonContainer.append(b),zmComponent.tooltip({elm:b[0],text:zNote.notei18n.info.copyNote,arrow:"top"})}};Dialog["new"](j)},checkForQuickAdd:function(a){return"c"===a.mode&&!znBox.checkForGroupDisabled({groupId:a.groupId})},checkForGroupDisabled:function(a){return!!(zmUtil.isNewGroupUser()&&zNote.groupObj[a.groupId]&&zNote.groupObj[a.groupId].disabled)},checkForGroupHidden:function(a){return!!(zmUtil.isNewGroupUser()&&zNote.groupObj[a.groupId]&&zNote.groupObj[a.groupId].hidden)},noteModel:function(a){function b(a){this.attr=$.extend(!0,{},a),this.emitChange={},this.changed={}}return b.prototype.set=function(a){for(var b=this,c=Object.keys(a),d=0;d<c.length;d++)this.attr[c[d]]=a[c[d]],this.changed[c[d]]=this.attr[c[d]],this.emitChange[c[d]](b)},b.prototype.onChanged=function(a,b){this.emitChange[a]=b},b.prototype.get=function(a){return this.attr[a]},new b(a)},hideMenu:function(){zmUtil.hideMenu(),$(".zn_note.sel").removeClass("sel"),$(".zmL.sel").removeClass("sel"),$("[data-visible='true']").not($("[data-current='true']")).attr("data-visible","false"),$("#znLTMenu").hide(),$("#znCntxtMenu").remove(),$("#zn_foltagpopup").remove(),$("#zm_dropDown").remove(),$("#zmcDrpDwnMnu").remove(),$(".SC_ddnB").removeClass("SC_ddnB")},getCategoryArray:function(a){for(var b=[],c=0;c<zNote.catCacheObj[a].length;c++)b.push({id:zNote.catCacheObj[a][c].catId,display_text:zNote.catCacheObj[a][c].category,name:zNote.catCacheObj[a][c].category});return b},getGroupArray:function(){var a=[],b=zmCont.getGroupOrder();a.push({id:zmail.zuid,name:zNote.notei18n.myNotes,display_text:zNote.notei18n.myNotes,tooltip:zNote.notei18n.myNotes});for(var c=0,d=b.length;c<d;c++)if(!znBox.checkForGroupDisabled({groupId:b[c]})&&!znBox.checkForGroupHidden({groupId:b[c]})){var e={};e.id=b[c],e.name=znBox.getGroupName(b[c]),e.display_text=znBox.getGroupName(b[c]),e.tooltip=znBox.getGroupName(b[c]),a.push(e)}return a},getGeneralCatId:function(a){for(var b in zNote.catCacheObj)if(b===String(a))return zNote.catCacheObj[b]&&zNote.catCacheObj[b][0]&&zNote.catCacheObj[b][0].catId},getGenCat:function(a){var b={mode:"getGeneralCat",groupId:a.gid,streamsView:"Notes",actionType:"appView"},c={id:a.gid,mode:"getGeneralCat"},d=function(a,b){zNote.catCacheObj[b.id]=a,zNote.catIdGen[b.id]=a[0].catId},e=a.fn?a.fn:d;return zmAjq.XHR({u:zmail.conPath+"/NotesAction.do",t:"POST",fn:e,p:b,ep:c})},getGroupName:function(a){return String(a)===zmail.zuid?zNote.notei18n.myNotes:zNote.groupObj[a]?zNote.groupObj[a].name:""},CONTS:{ntWid:300,ntBorPad:57,defaultTitle:"Title",nColClsArr:{zn_clr1:"0",zn_clr2:"1",zn_clr3:"2",zn_clr4:"3"},nColArr:["zn_clr1","zn_clr2","zn_clr3","zn_clr4"]}}}(),window.noteHashtag=function(){var a=[],b={checkForTrigger:function(a,c,d){(a.which&&35===a.which||a.keyCode&&35===a.keyCode)&&(d.initialCallback&&d.initialCallback(),a.preventDefault(),znBox.insertHtmlAtCaret("<input id=s1 value=# style='background-color:transparent;border:0px;outline:none'></input>"),$("#s1")[0].style.width="200px",$("#s1").trigger("focus",!0),zmMention.setCaretPosition(document.getElementById("s1"),document.getElementById("s1").value.length),zmMention.isAtPressed=!0,$("#s1").off("keyup").keyup(function(a){b.handleNoteTagFill(a,this,d)}),$("#s1").off("keypress").keypress(function(a){a.stopPropagation()}))},setContent:function(b,c,d){d=$(d).closest("li")[0],d||(d=$("#zm_afill .SC_Psli")[0]);var e=d.id,f=e.slice(3,e.length);c.callback(a[f]);var g=b.parentNode,h=document.createTextNode(a[f].hashname+" ");document.getElementById("s1").parentNode.replaceChild(h,document.getElementById("s1")),g.contentEditable=!0,setTimeout(function(){zmMention.placeCaretAfterNode(h),c.finallyCallback&&c.finallyCallback()},100),$("#zm_afill").remove()},handleKey:function(a,c,d){var e,f,g,h,i,j,k;return 40===c.keyCode?(e=$("#zm_afill li.SC_Psli"),e.removeClass("SC_Psli"),e.next().length?e.next().addClass("SC_Psli"):$("#zm_afill li").first().addClass("SC_Psli"),!0):38===c.keyCode?(e=$("#zm_afill li.SC_Psli"),e.removeClass("SC_Psli"),e.prev().length?e.prev().addClass("SC_Psli"):$("#zm_afill li").last().addClass("SC_Psli"),!0):13===c.keyCode?(c.stopImmediatePropagation(),b.setContent(c.target,d),!0):8===c.keyCode?(zmMention.getCaretPosition(a)||(f=a.parentNode,g=document.createTextNode(a.value),document.getElementById("s1").parentNode.replaceChild(g,document.getElementById("s1")),f.contentEditable=!0,f.focus(),setTimeout(function(){zmMention.placeCaretBeforeNode(g),d.finallyCallback&&d.finallyCallback()},100),$("#zm_afill").remove()),!0):37===c.keyCode?(zmMention.getCaretPosition(a)||(f=a.parentNode,g=document.createTextNode(a.value),document.getElementById("s1").parentNode.replaceChild(g,document.getElementById("s1")),f.contentEditable=!0,f.focus(),setTimeout(function(){zmMention.placeCaretBeforeNode(g),d.finallyCallback&&d.finallyCallback()},100),$("#zm_afill").remove()),!0):39===c.keyCode?(zmMention.getCaretPosition(a)===a.value.trim().length&&(f=a.parentNode,g=document.createTextNode(a.value),document.getElementById("s1").parentNode.replaceChild(g,document.getElementById("s1")),f.contentEditable=!0,f.focus(),setTimeout(function(){zmMention.placeCaretAfterNode(g),d.finallyCallback&&d.finallyCallback()},100),$("#zm_afill").remove()),!0):32===c.keyCode&&(h=zmMention.getCaretPosition(a),f=a.parentNode,i=a.value.substring(0,h),j=a.value.substring(h),k=document.createTextNode(i),document.getElementById("s1").parentNode.replaceChild(k,document.getElementById("s1")),f.contentEditable=!0,f.focus(),setTimeout(function(){zmMention.placeCaretAfterNode(k);var a=document.createTextNode(j);zmMention.insertNodeAtCaret(a),setTimeout(function(){zmMention.placeCaretAfterNode(k),d.finallyCallback&&d.finallyCallback()},100)},100),!0)},handleNoteTagFill:function(a,c,d){var e=b.handleKey(c,a,d),f=_zm("#","zm_afill");c.value.length?e||($("#zm_afill").remove(),b.constructListView(a,c,d)):_zm.remove(f),$(c).off("focusout.autofill").on("focusout.autofill",function(){_zm.remove(_zm("#","zm_afill")),d.finallyCallback&&d.finallyCallback()})},constructListView:function(a,c,d){var e=b.patternMatch1(d,c.value,!0);b.listSuggestions(c,d,e)},createAutoFillDiv:function(a,c,d,e,f){var g,h=$(a).offset().top+$(a).height()+5,i=$(a).offset().left,j=_zm("<","body")[0].getBoundingClientRect(),k=i+90>j.width?j.width-90-40:i,l=35*c.length;if(h+l+30>j.height){var m,n,o=_zm("#","ztb-topband"),p=h-l;g=o?o.getBoundingClientRect().height:0,m=p>0?g:zmUtil.wmsBarHeight(),n=Math.round((l+m+100-j.height)/35),n>0&&c.splice(c.length-n,n),h=h-l>0?$(a).offset().top-l-20:h}var q=_zm.getDOM(["DIV",{attrs:{id:"zm_afill",style:"top:"+h+"px;left:"+k+"px;","class":"SC_dd shw  SC_zi900",onmousedown:"zmUtil.stopEvents(event,true);"},child:[["DIV",{child:[["UL",{attrs:{"class":d}}]]}]]}]);return _zm("<","body")[0].appendChild(q),_zm.bind(q,"mousedown",function(c){b.setContent(a,f,c.target)},[]),_zm.show(q),_zm("#","zm_afill")},listSuggestions:function(b,c,d){a=d;var e,f,g,h="",i=_zm("#","zm_afill").querySelector("ul"),j=d.length;for(j||$("#zm_afill").remove(),e=0;e<j;e++)h=0===e?"SC_Psli":"",g="name",f=_zm.getDOM(["LI",{attrs:{id:"pos"+e,"class":h},child:[["text",d[e][g]]]}]),i.appendChild(f)},patternMatch1:function(a,b,c){var d,e,f=[],g=a.getContentArray(),h=g.length,i=a.compare,j=i.length,k=-1;for(d=0;d<h;d++){for(e=0;e<j;e++)if(k=i[e]&&g[d][i[e]]&&g[d][i[e]].toLowerCase().indexOf(b.toLowerCase()),k!==-1&&!c||c&&0===k){f.push(g[d]);break}if(f.length>10)break}return f}},c={setHashtag:function(a,c){$(c).off("keypress").keypress(function(c){b.checkForTrigger(c,this,a)})}};return c}(),window.znNote=function(){var a,b,c,d,e,f,g,h;h={appid:"zm_notes",appicon:"msi-notes",modulename:"notes"},g=zmText.get(h.modulename);var i={fav:g.fav,sharedtome:g.left.sharedtome};return a={updateCatCache:function(a,b,c){var d,e,f=zNote.catCacheObj[b],g=f.length;if("addCat"===a)f.push(c);else if("editCat"===a)for(d=0;d<g;d++)f[d].catId===c.catId&&(f[d].category=c.category);else if("delCat"===a){for(g=f.length,d=0;d<g;d++)if(f[d].catId===c.catId){e=d;break}f.splice(e,1)}}},b={getCat:function(){var a={mode:"getCategories",groupId:zmail.zuid,streamsView:"Notes",actionType:"appView"};return zmAjq.XHR({u:zmail.conPath+"/NotesAction.do",t:"POST",p:a})},getGroupCat:function(){var a,b,c=$.Deferred();return zmail.ContactBook.groupsFetched.done(function(){if(a=zmCont.getGroupOrder(),!a.length)return c.reject({msg:"no group"});b=a.join();var d={mode:"getGrpCategories",groupId:zmail.zuid,groupIds:b,streamsView:"Notes",actionType:"appView"};zmAjq.XHR({u:zmail.conPath+"/NotesAction.do",t:"POST",p:d}).done(function(a){c.resolve(a)})}).fail(function(){c.reject({msg:"group categories get failed"})}),c.promise()},switchView:function(){var a,c,d=$.extend(!0,{},znNote.noteListing.props.noteList);if(d.unmountCalled!==!0)if(znNote.lstDetails().type===d.listInfo.mode&&znNote.lstDetails().fId===d.listInfo.id){var e=[{}];e[0].Notes=d.toJSON(),e[0].page=d.options.page;var f={mode:d.listInfo.mode,id:d.listInfo.id,groupId:d.listInfo.groupId};f.noteView=znNote.noteView,f.isnew=!0;var g=function(d){d&&(znNote.noteListing=d,znNote.noteListing.props.noteList.on("remove",function(){if(this.length<25){var d=this.options.page;if(d&&"1"===d.showNextPage){var e=znNote.lstDetails();a=e.fId,c=e.type;var f=zmail.streamsHbaseReadEnabled?this.length+1:d.end,g={start:f};b.getNotes(c,a,g)}}}))};znNote.noteListing&&ReactDOM.unmountComponentAtNode(znNote.noteListing.props.noteList.mountingElem[0]),zNote.listRowNotes(e,f,d.mountingElem,g)}else b.getNotes(znNote.lstDetails().type,znNote.lstDetails().fId)},getNotes:function(a,c,e){znNote.currNoteId="";var f,g,h={limit:"25"},i={},j=znNote.lstDetails().groupId;if(e)e.start&&(h.start=e.start,i.isnew=!1),f=function(a,b){d.scrolling=!1,d.destroyLoadingDiv(),d.containerDiv&&d.containerDiv.remove(),i.groupId=j,b.currentObj=znNote.noteListing,i.noteView=znNote.noteView,zNote.listRowNotes(a,b,document.getElementsByClassName("SC_mclst SC_notes"))};else{i.isnew=!0,i.groupId=j;var k=function(d){d&&(znNote.noteListing=d,znNote.noteListing.props.noteList.on("remove",function(){if(this.length<25){var d=this.options.page;if(d&&"1"===d.showNextPage){var e=znNote.lstDetails();c=e.fId,a=e.type;var f=zmail.streamsHbaseReadEnabled?this.length+1:d.end,g={start:f};b.getNotes(a,c,g)}}}))};znNote.previousListingAjax&&"pending"===znNote.previousListingAjax.state()&&znNote.previousListingAjax.abort(),znNote.noteListing&&ReactDOM.unmountComponentAtNode(znNote.noteListing.props.noteList.mountingElem[0]),d.destroyLoadingDiv=zmComponent.loadingBand({container:znNote.listingDiv[0],type:"listing"}),f=function(a,b){d.scrolling=!1,d.destroyLoadingDiv(),i.noteView=znNote.noteView,znNote.noteListing?zNote.listRowNotes(a,b,znNote.noteListing.props.noteList.mountingElem,k):zNote.listRowNotes(a,b,document.getElementsByClassName("SC_mclst SC_notes"),k)}}"c"===a?("zn_catAll"===c?h.mode="getAllNotes":(h.mode="getCatNotes",h.catId=c),h.groupId=znNote.groupId,h.streamsView="Notes",h.actionType="appView",h.entityType=zNote.CONSTANTS.entityType):"l"===a?(h.mode="getTagNotes",h.tagId=c,h.groupId=zmail.zuid,h.streamsView="Notes",h.actionType="appView",h.entityType=zNote.CONSTANTS.entityType):"fav"===a?(h.mode="getAllFavNotes",h.groupId=zmail.zuid,h.streamsView="Notes",h.actionType="appView",h.entityType=zNote.CONSTANTS.entityType):"sharedtome"===a?(h.mode="getNotesToMe",h.groupId=zmail.zuid,h.streamsView="Notes",h.actionType="appView",h.entityType=zNote.CONSTANTS.entityType):"sharedbyme"===a?(h.mode="getMyNotes",h.groupId=zmail.zuid,h.streamsView="Notes",h.actionType="appView",h.entityType=zNote.CONSTANTS.entityType):"byuser"===a?(h.mode="getAllNotes",h.userId=c,h.groupId=znNote.groupId,h.streamsView="Notes",h.actionType="appView",h.entityType=zNote.CONSTANTS.entityType):"archive"===a&&(h.mode="getArchiveNotes",h.groupId=znNote.groupId,g="GET",h.streamsView="Notes"),i.mode=a,i.id=c;var l={};return l.prm=h,l.eprm=i,l.t=g,znNote.previousListingAjax=b.sendListingRequest(l,f),znNote.previousListingAjax},sendListingRequest:function(a,b){return zmAjq.XHR({u:zmail.conPath+"/NotesAction.do",t:a.t||"POST",fn:b,p:a.prm,ep:a.eprm})},sendNewCatReq:function(a,b,e){var f,g,h;return h=e?e:d.currLayId,b.fn=void 0===b.fn?c.left.cateResult:b.fn,f={mode:"addCat",catName:a,groupId:h,streamsView:"Notes",actionType:"addCommonLabel"},g={mode:"addCat",groupId:h},zmAjq.XHR({u:zmail.conPath+"/NotesAction.do",fn:b.fn,t:"POST",p:f,ep:g})},sendEditCatReq:function(a,b){var e,f,g;g=d.currLayId,e={mode:"editCat",catName:a,catId:b,groupId:g,streamsView:"Notes",actionType:"editCommonLabel"},f={mode:"editCat",groupId:g},zmAjq.XHR({u:zmail.conPath+"/NotesAction.do",fn:c.left.cateResult,t:"POST",p:e,ep:f})},sendNewLabReq:function(a,b,d){var e,f={};f={name:a,color:b||"#FFD700",accId:zmail.defAccId,mode:"a"},e={name:a,mode:"a"};var g=d&&d.fn?d.fn:c.left.tagResult;return zmAjq.XHR({u:zmail.conPath+"/lA.do",t:"POST",fn:g,p:f,ep:e})},sendEditLabReq:function(a,b,c){var d,e={};a=$.trim(a),e={name:a,color:b,accId:zmail.defAccId,labId:znNote.labelId,mode:"e"},d={name:a,color:b,labId:znNote.labelId,mode:"e"},zmAjq.XHR({u:zmail.conPath+"/lA.do",t:"POST",fn:c.fn,p:e,ep:d})},sendDelLabReq:function(a){var b={labId:znNote.labelId,mode:"d",accId:zmail.defAccId},c={labId:znNote.labelId,mode:"d"};zmAjq.XHR({u:zmail.conPath+"/lA.do",t:"POST",fn:a.fn,p:b,ep:c})},delNoteCat:function(a){var b={mode:"delCat",catId:a,groupId:d.currLayId,streamsView:"Notes",actionType:"deleteCommonLabel"},e={catId:a,mode:"delCat",groupId:d.currLayId};zmAjq.XHR({u:zmail.conPath+"/NotesAction.do",t:"POST",fn:c.left.cateResult,p:b,ep:e})}},c={left:{cateResult:function(b,c){var e,f,g,i,j=c.mode;if(b&&b[0]&&(b[0].catId||"success"===b[0].response)){if(i=c.groupId===zmail.zuid?"nviews":d.getGroupLayerName({groupId:c.groupId}),!zmsuite.isWorkspaceAvailable(h.appid))return void("addCat"===j&&(b[0].count=0,a.updateCatCache(j,c.groupId,b[0])));if(e=b[0],f=zmsuite.getAppObj().zm_notes.left.getNodes()[0].getLayer(i),"addCat"===j){g={},g[e.catId]={},g[e.catId].name=e.category,g[e.catId].id=e.catId,g[e.catId].groupId=c.groupId,e.count=0;var k=zNote.catCacheObj[c.groupId].length;if(k>1){var l=zNote.catCacheObj[c.groupId][k-1].catId;f.insertNodeAfter(g,f.mapObject,l,c.groupId)}else f.appendNode(g,f.mapObject,c.groupId);a.updateCatCache(j,c.groupId,e)}else"editCat"===j?(g=f.getRowObjfromId(e.catId),g[e.catId].name=e.category,f.editNode(g,f.mapObject),a.updateCatCache(j,c.groupId,e),$.publish("/rename/notescat",[e])):"delCat"===j&&(g=f.getRowObjfromId(c.catId),f.deleteNode(g,c.groupId),a.updateCatCache(j,c.groupId,c),$.publish("/delete/notescat",[c.catId]))}},tagResult:function(a,b){var c,d=a.labelId,e={};if(e[d]={color:a.color,id:a.labelId,label:a.displayName,dispName:a.displayName,fav:"true",se:a.sequence},!zmsuite.isWorkspaceAvailable(h.appid))return void("a"===b.mode&&(zmUtil.getTagList("default")[d]=e[d]));var f=zmsuite.getAppObj().zm_notes.left.getNodes()[0].getLayer("zmllabelH");if("a"===b.mode){var g=_.findWhere(zmail.labInfo,{se:e[d].seq});g?f.insertNodeBefore(e,f.mapObject,g.id):f.appendNode(e,f.mapObject)}else"e"===b.mode?(c=f.getRowObjfromId(d),c[d].dispName=c[d].label=e[d].dispName,c[d].color=e[d].color,f.editNode(c,f.mapObject),$.publish("/rename/noteslabel",[b])):"d"===b.mode&&(c=f.getRowObjfromId(b.labId),f.deleteNode(c),$.publish("/delete/noteslabel",[b]));zmail.zohoAccLabInfo=$.extend({},f.getListObject()),zmail.accId===zmail.defAccId&&(zmail.labInfo=f.getListObject())}},setGrpCat:function(a){$.each(a[0],function(a,b){zNote.catCacheObj[a]=b}),znNote.noteGroupOrderAndCount=a[1]}},f={cmenuItemClick:function(a){var e,f;switch(a.action){case"EditLabel":e=d.rgtMenuId,zmlab.labelId=e,zmlab.showCreateTagPopUp({mode:"rename",accType:"default",callback:function(a,e,g){d.isValidLabel($("#zm_createlabelpopup").find("input").val(),"e")&&(f={fn:c.left.tagResult},b.sendEditLabReq($("#zm_createlabelpopup").find("input").val(),g,f),zmsDialog.remove())}}),$("#znCntxtMenu").hide();break;case"DelLabel":if(e=d.rgtMenuId,!e)return!1;var h={};h.onOk=function(){f={fn:c.left.tagResult
},b.sendDelLabReq(f)},h.stopPropagation=!0,zmsDialog.confirm(g.deltag,h),$("#znCntxtMenu").hide();break;case"CreateCat":e=d.rgtMenuId,zmUtil.setEditable({ele:$("#znLTMenu_Nc"),target:$("#"+e),callback:d.cmenuActions,allowCondition:function(){if(!e)return!0},parentdiv:$("#znCntxtMenu")});break;case"EditCat":e=d.rgtMenuId;var i=!0,j=zNote.getNamefrmCatObj(e,d.currLayId);if(""===e||"zn_catAll"===e||"General"===j||!j)return!1;zmUtil.setEditable({ele:$("#znLTMenu_Rc"),target:$("#"+e),callback:d.cmenuActions,initialize:!0,allowCondition:function(){return!!e&&i},parentdiv:$("#znCntxtMenu")});break;case"DelCat":if(e=d.rgtMenuId,h={},j=zNote.getNamefrmCatObj(e,d.currLayId),""===e||"zn_catAll"===e||"General"===j||!j)return znBox.hideMenu(),!1;h.onOk=function(){znBox.hideMenu(),b.delNoteCat(e)},h.stopPropagation=!0,zmsDialog.confirm(g.delbook,h)}}},d={currLayId:"",rgtMenuId:"",pageDivTop:0,destroyLoadingDiv:"",scrolling:!1,nCMenuCatArr:[{htm:g.left.createBook,id:"znLTMenu_Nc",cEdit:!0,data:{action:"CreateCat"}},{sep:!0},{htm:g.left.renameBook,id:"znLTMenu_Rc",cEdit:!0,data:{action:"EditCat"}},{htm:g.left.deleteBook,id:"znLTMenu_Dc",data:{action:"DelCat"}}],nCMenuTagArr:[{htm:g.left.editTag,id:"znLTMenu_Rl",data:{action:"EditLabel"}},{htm:g.left.deleteTag,id:"znLTMenu_Dl",data:{action:"DelLabel"}}],nCMenuTagArr1:[{htm:g.left.createTag,id:"znLTMenu_Cl",cEdit:!0,data:{action:"CreateLabel"}},{htm:g.left.deleteTag,id:"znLTMenu_Dl",data:{action:"DelLabel"}}],actIconObj:{list:{left:{leftHTML:"",centerAlign:!0},right:[]}},actIconObj1:{list:{left:[],right:[{actionArr:[{iconList:["msi-thumbview"],data:"thumb",tooltip:g.tooltips.gridView},{iconList:["msi-listview"],data:"list",tooltip:g.tooltips.listView}]}]},clk:function(a,c){var e;"msi-filter"===c?($(a.target).closest("li").find("b").addClass("SC_ddn"),zmsuite.showMenu({par:$(a.target).closest("li"),list:d.filterOptions(),align:"pleft",clk:function(a){var c="archive";b.getNotes(c);var d='{"fId":"'+c+'","type":"'+c+'","groupId":"'+znNote.groupId+'"}';znNote.listingDiv.attr("data-detail",d),znNote.updateHeaderBandWithObj({groupId:znNote.groupId,mode:"archive"}),$("#zm_dropDown").remove(),$("[data-drop='1']").removeAttr("data-drop"),$(".SC_ddn").removeClass("SC_ddn")}})):"msi-thumbview"===c?(zmsuite.getCenter()[0].getNodes()[2].$el.removeClass("SC_cmptNotes"),zmsuite.getCenter()[0].$el.find(".SC_frt").find("li").find("b").removeClass("SC_sel"),$(a.target).closest("b").addClass("SC_sel"),znNote.noteView=1,e=zmAdHocSettings.getNotes(),zmAdHocSettings.setNotes({stickyNotes:e.stickyNotes,listingType:zNote.CONSTANTS.viewName[znNote.noteView]}),b.switchView()):"msi-listview"===c&&(zmsuite.getCenter()[0].getNodes()[2].$el.addClass("SC_cmptNotes"),zmsuite.getCenter()[0].$el.find(".SC_frt").find("li").find("b").removeClass("SC_sel"),$(a.target).closest("b").addClass("SC_sel"),znNote.noteView=2,e=zmAdHocSettings.getNotes(),zmAdHocSettings.setNotes({stickyNotes:e.stickyNotes,listingType:zNote.CONSTANTS.viewName[znNote.noteView]}),b.switchView())}},actIconObj2:{list:{left:[{groupId:"filter",actionArr:[{iconList:["msi-filter"],dropAction:!0}]}],right:[{actionArr:[{iconList:["msi-thumbview"],data:"thumb",tooltip:g.tooltips.gridView},{iconList:["msi-listview"],data:"list",tooltip:g.tooltips.listView}]}]},clk:function(a,c){var e;"msi-filter"===c?($(a.target).closest("li").find("b").addClass("SC_ddn"),zmsuite.showMenu({par:$(a.target).closest("li"),list:d.filterOptions(),align:"pleft",clk:function(a){var c="archive";b.getNotes(c);var d='{"fId":"'+c+'","type":"'+c+'","groupId":"'+znNote.groupId+'"}';znNote.listingDiv.attr("data-detail",d),znNote.updateHeaderBandWithObj({groupId:znNote.groupId,mode:"archive"}),$("#zm_dropDown").remove(),$("[data-drop='1']").removeAttr("data-drop"),$(".SC_ddn").removeClass("SC_ddn")}})):"msi-thumbview"===c?(zmsuite.getCenter()[0].getNodes()[2].$el.removeClass("SC_cmptNotes"),zmsuite.getCenter()[0].$el.find(".SC_frt").find("li").find("b").removeClass("SC_sel"),$(a.target).closest("b").addClass("SC_sel"),znNote.noteView=1,e=zmAdHocSettings.getNotes(),zmAdHocSettings.setNotes({stickyNotes:e.stickyNotes,listingType:zNote.CONSTANTS.viewName[znNote.noteView]}),b.switchView()):"msi-listview"===c&&(zmsuite.getCenter()[0].getNodes()[2].$el.addClass("SC_cmptNotes"),zmsuite.getCenter()[0].$el.find(".SC_frt").find("li").find("b").removeClass("SC_sel"),$(a.target).closest("b").addClass("SC_sel"),znNote.noteView=2,e=zmAdHocSettings.getNotes(),zmAdHocSettings.setNotes({stickyNotes:e.stickyNotes,listingType:zNote.CONSTANTS.viewName[znNote.noteView]}),b.switchView())}},filterOptions:function(){var a=[{htm:"Archived Notes",data:{key:"archived"}}];return a},pageDetails:function(){var a=znNote.listingDiv.attr("page-detail");if(a=$.parseJSON(a))return a},getFrameworkObject:function(){var a,b,c,d,e=$.extend(!0,{},zNote.catCacheObj),f={},g={},h={},i={};delete e[zmail.zuid];var j=[],k=[];for(var l in e)e.hasOwnProperty(l)&&(znBox.checkForGroupDisabled({groupId:l})?j.push(l):znBox.checkForGroupHidden({groupId:l})||k.push(l));d=k.length;var m=function(a){return function(c){if(k[a]!==zmail.zuid){if(c.id=c.catId,c.name=c.category,"General"!==c.category)return c.seq=b++,c.name=c.category,c.SE=c.seq,c.groupId=k[a],i[c.catId]={},i[c.catId].c=c.count,i[c.catId].p=k[a],c.catId;zNote.catIdGen[k[a]]=c.catId}}};for(a=0;a<d;a++)b=1,c=_.map(e[k[a]],m(a)),f[k[a]]={},f[k[a]].CH=_.object(c.slice(1,c.length),e[k[a]].slice(1,e[k[a]].length));var n=j.length,o=function(a){return function(c){if(j[a]!==zmail.zuid){if(c.id=c.catId,c.name=c.category,"General"!==c.category)return c.seq=b++,c.name=c.category,c.SE=c.seq,c.groupId=j[a],h[c.catId]={},h[c.catId].c=c.count,h[c.catId].p=j[a],c.catId;zNote.catIdGen[j[a]]=c.catId}}};for(a=0;a<n;a++)b=1,c=_.map(e[j[a]],o(a)),g[j[a]]={},g[j[a]].CH=_.object(c.slice(1,c.length),e[j[a]].slice(1,e[j[a]].length));return{newObject:f,countObject:i,disabledNewObject:g,disabledCountObject:h}},getCountAndChildObject:function(){var a,b=$.extend(!0,{},zNote.catCacheObj),c={};c[zmail.zuid]={},c[zmail.zuid].c=znNote.myNotesCount,c[zmail.zuid].p="-1";var d={},e=1;return d[zmail.zuid]={},a=_.map(b[zmail.zuid],function(a){return a.id=a.catId,a.name=a.category,"General"!==a.category?(a.seq=e++,a.name=a.category,a.SE=a.seq,a.groupId=zmail.zuid,c[a.catId]={},c[a.catId].c=a.count,c[a.catId].p=zmail.zuid,a.catId):void(zNote.catIdGen[zmail.zuid]=a.catId)}),d[zmail.zuid].CH=_.object(a.slice(1,a.length),b[zmail.zuid].slice(1,b[zmail.zuid].length)),{childObject:d,countObject:c}},getGroupLayerName:function(a){return znBox.checkForGroupDisabled({groupId:a.groupId})?"dgroups":"ngroups"},setChildToggle:function(){zmsuite.getLeft("zm_notes").setListener("click",znNote.znLeftClbk),zmsuite.getLeft("zm_notes").setListener("contextmenu",znNote.znLeftClbk),zmsuite.getLeft("zm_notes").getNodes()[0].getLayer("ngroups").setChildToggle(function(a,b,c){var d;if(a&&a.zmsData)for(var e in a.zmsData.rowObject)d=a.zmsData.rowObject[e];else d=a;d.E=c?1:0}),zmsuite.getLeft("zm_notes").getNodes()[0].getLayer("dgroups")&&zmsuite.getLeft("zm_notes").getNodes()[0].getLayer("dgroups").setChildToggle(function(a,b,c){var d;if(a&&a.zmsData)for(var e in a.zmsData.rowObject)d=a.zmsData.rowObject[e];else d=a;d.E=c?1:0}),zmsuite.getLeft("zm_notes").getNodes()[0].getLayer("nviews").setChildToggle(function(a,b,c){var d;if(a&&a.zmsData)for(var e in a.zmsData.rowObject)d=a.zmsData.rowObject[e];else d=a;d.E=c?1:0})},getDisabledLayer:function(a){var b,c=a.disabledNewObject,d=a.disabledCountObject;if(!$.isEmptyObject(c)){var e=new ZMLayer,f=[],h={id:"hdgroups",showList:!1,name:"Disabled Groups"},i=$.extend(!0,{},zNote.groupObj);delete i[zmail.zuid];var j={name:"name",id:"id",groupId:zmail.zuid,count:"c",parentId:"p",notBold:!0,infoObject:"c",sequence:"SE",hasChild:"HC",expChild:"E"};f=_.omit(i,function(a,b,d){return _.indexOf(_.keys(c),b)===-1}),b=1,_.each(znNote.noteGroupOrderAndCount,function(a,e){if(c[a.groupId]){7===b&&_.keys(c).length>7&&(f.more={showNode:!0,id:"more",name:g.left.more,SE:b++,rowTitle:g.tooltips.viewallgroups,txtNodeClass:"SC_thm"},d.more={},d.more.c=0,d.more.p="-1");var h=f[a.groupId];zNote.catCacheObj[a.groupId]&&zNote.catCacheObj[a.groupId].length?h.HC=_.keys(c[a.groupId].CH).length:h.HC=0,d[a.groupId]={},d[a.groupId].c="-"===a.count?0:a.count,d[a.groupId].p="-1",h.E=0,h.id=a.groupId,h.SE=b++,b>=7&&(h.hideNode=!0),f[a.groupId].shouldshow=f[a.groupId].hideNode}}),f.more&&(f.less={hideNode:!0,id:"less",name:g.left.less,SE:b++,rowTitle:g.tooltips.hidegroups,txtNodeClass:"SC_thm"},d.less={},d.less.c=0,d.less.p="-1");var k={type:"1",hasChild:!0,hasCountObject:!0,mapObject:j,id:"dgroups",isHeaderSel:!1,avoidStateSave:!0,showList:!1,dataObject:{headerObject:h,listObject:f,childObject:c,countObject:d}};return e.push(k),e}},promoteGroup:function(a){var b=d.getGroupLayerName({groupId:a.group.id}),c=zmsuite.getAppObj().zm_notes.left.getNodes()[0].getLayer(b),e=c.getRowObjfromId(a.group.id);if(c.getListObject()[a.group.id].shouldshow=!1,c.moveNode(e,c.mapObject),c.getListObject().more&&c.getListObject().more.SE>8){var f=_.findWhere(c.getListObject(),{SE:7});e=c.getRowObjfromId(f.id),c.moveNode(e,c.mapObject,"more"),c.getListObject()[f.id].shouldshow=!0,c.getListObject().more.hideNode||c.hideNode(f.id)}},showMoreOrLess:function(a,b){var c,d,e=Object.keys(a.rowObject)[0];"more"===a.rowObject[e].id?(c=zmsuite.getAppObj().zm_notes.left.getNodes()[0].getLayer(a.rowInfo.layerId),d=c.listObject,Object.keys(d).forEach(function(a){c.showNode(a,b)}),c.showNode("less",b),c.hideNode("more",b)):"less"===a.rowObject[e].id&&(c=zmsuite.getAppObj().zm_notes.left.getNodes()[0].getLayer(a.rowInfo.layerId),d=c.listObject,Object.keys(d).forEach(function(a){d[a].shouldshow?c.hideNode(a,b):c.showNode(a,b)}),c.showNode("more",b),c.hideNode("less",b),$("#"+a.rowInfo.layerId)[0].children[0].firstElementChild.scrollIntoView(),"function"==typeof b&&b())},constructLeft:function(){var a,e=[],f=zmsuite.getLeft("zm_notes"),i=f.getNodes();if("n"!==zmApp.selectedApp)return void zmsuite.deleteAppInfo(h.appid);var j={},k={},l={},m=d.getCountAndChildObject();k=m.childObject,l=m.countObject,j.fav={id:"fav",name:g.fav,SE:1,groupId:zmail.zuid},j.sharedtome={id:"sharedtome",name:g.left.sharedtome,SE:2,groupId:zmail.zuid},j[zmail.zuid]={id:zmail.zuid,name:g.myNotes,SE:3,groupId:zmail.zuid,HC:_.keys(k[zmail.zuid].CH).length,E:1};var n={dropdown:"min",id:"hviews",name:g.left.views},o=new ZMLayer,p={id:"id",name:"name",infoObject:"views",count:"c",parentId:"p",notBold:!0,sequence:"SE",hasChild:"HC",expChild:"E"},q={type:"1",mapObject:p,id:"nviews",isHeaderSel:!1,hasChild:!0,hasCountObject:!0,dataObject:{headerObject:n,listObject:j,childObject:k,countObject:l}};o.push(q),e.push(o),zNote.groupObj=zmCont.getGroup(),zNote.groupObj[zmail.zuid]={name:g.myNotes,id:zmail.zuid};var r=new ZMLayer,s=[],t={id:"hgroups",name:g.left.groups},u=$.extend(!0,{},zNote.groupObj);delete u[zmail.zuid],zmUtil.isNewGroupUser()&&(t.settingsOption=!0,t.settingsObject={className:"msi-manageGroup",onClick:function(){zmAppLoader.load("streamsGroupManagement").done(function(){zmStreamsApp.GroupManageApp.init({groupManage:!0})})}},t.c="<i class='msi-plus'></i>",t.onAdd=function(){zmAppLoader.load("streamsGroupManagement").done(function(){zmStreamsApp.GroupManageApp.init({createGroup:!0})})});var v={name:"name",id:"id",groupId:zmail.zuid,count:"c",parentId:"p",notBold:!0,infoObject:"c",sequence:"SE",hasChild:"HC",expChild:"E"},w=d.getFrameworkObject(),x=w.newObject,y=_.keys(x),z=w.countObject,A=1;s=_.omit(u,function(a,b,c){return _.indexOf(y,b)===-1}),_.each(znNote.noteGroupOrderAndCount,function(a,b){if(x[a.groupId]){7===A&&_.keys(x).length>7&&(s.more={showNode:!0,id:"more",name:g.left.more,SE:A++,rowTitle:g.tooltips.viewallgroups,txtNodeClass:"SC_thm"},z.more={},z.more.c=0,z.more.p="-1");var c=s[a.groupId];zNote.catCacheObj[a.groupId]&&zNote.catCacheObj[a.groupId].length?c.HC=_.keys(x[a.groupId].CH).length:c.HC=0,z[a.groupId]={},z[a.groupId].c="-"===a.count?0:a.count,z[a.groupId].p="-1",c.E=0,c.id=a.groupId,c.SE=A++,A>=8&&(c.hideNode=!0),s[a.groupId].shouldshow=s[a.groupId].hideNode}}),s.more&&(s.less={hideNode:!0,id:"less",name:g.left.less,SE:A++,rowTitle:g.tooltips.hidegroups,txtNodeClass:"SC_thm"},z.less={},z.less.c=0,z.less.p="-1");var B={type:"1",hasChild:!0,hasCountObject:!0,mapObject:v,showList:!0,id:"ngroups",isHeaderSel:!1,dataObject:{headerObject:t,listObject:s,childObject:x,countObject:z}};r.push(B),e.push(r);var C={dropdown:"min",id:"header2",name:g.left.tags,showList:!0,c:"<i class='msi-plus'></i>",onAdd:function(){$("div#zmCntxtMenu").remove(),zmlab.showCreateTagPopUp({mode:"new",accType:"default",callback:function(e,f,g){d.isValidLabel($("#zm_createlabelpopup").find("input").val(),"e")&&(a={fn:c.left.tagResult},b.sendNewLabReq(f,g,a),zmsDialog.remove())}})}},D=new ZMLayer,E=zmail.labInfo,F={name:"dispName",id:"id",count:"c",parentId:"p",color:"color",sequence:"se",infoObject:"l"},G={type:"2",mapObject:F,listId:"zmllabel",id:"zmllabelH",showList:!0,dataObject:{headerObject:C,listObject:E}};D.setHeaderObject(C),D.push(G),e.push(D);var H=d.getDisabledLayer(w);H&&e.push(H),i[0].push({layerArr:e}),f.render(),zmComponent.notifier.addHandler("streams",function(a,b){b.data.etype===zNote.CONSTANTS.entityType&&"true"===b.data.grp&&"30"===b.data.ntype&&d.promoteGroup(b.data)})},constructCenter:function(a){var b=zmsuite.getCenter(h.appid),c=b[0].getNodes();znBox.isArchiveOpen()?(c[0].push(d.actIconObj2.list),c[0].setListener("click",d.actIconObj2.clk),d.actIconObj.list.left.centerAlign=!1):(c[0].push(d.actIconObj1.list),c[0].setListener("click",d.actIconObj1.clk)),znNote.noteView=zNote.CONSTANTS.viewType[zmAdHocSettings.getNotes().listingType]||1,"list"===zNote.CONSTANTS.viewName[znNote.noteView]&&zmsuite.getCenter()[0].getNodes()[2].$el.addClass("SC_cmptNotes"),c[1].push(d.actIconObj.list),znNote.listingDiv=zmsuite.getCenter(h.appid)[0].getNodes()[2].getListElem(),znNote.listingDiv.addClass("SC_notes"),"zm_notes"===zmTab.currentTab?zmsuite.renderCenter():zmsuite.renderCenter(zmsuite.getAppObj("zm_notes").centerObj),zmsuite.showApp(h.appid),zmsuite.getCenter(h.appid)[0].getNodes()[2].setListener("scroll",function(a){a.stopPropagation(),d.fillNotes()}),zmsuite.getCenter(h.appid)[0].$el.find(".SC_frt").find("."+zNote.CONSTANTS.listTypeClass[znNote.noteView]).closest("b").addClass("SC_sel"),d.setChildToggle()},popup:function(a,b){if("options"===a){var c,d,e=[],f=b.length;for(d=0;d<f;d++)c=b[d]?["LI",{child:[["text",b[d]]]}]:["LI",{attrs:{"class":"SC_lne"}}],e.push(_zm.getDOM(c));return e}},isValidCategory:function(a,b){var c,e,f=a;if(e=b?b:d.currLayId,f=f.trim(),c=f.toLowerCase(),zmUtil.hasSpecialChars(f,"labelName"))return zmUtil.succErrMsg("e",g.nosp),!1;if(!c)return zmUtil.succErrMsg("e",g.nonull),!1;for(var h=zNote.catCacheObj[e],i=h.length,j=0;j<i;j++)if(h[j].category===f)return zmUtil.succErrMsg("e",g.bookexist),!1;return!0},isValidLabel:function(a,b){var c=$.trim(a.toLowerCase());if(zmUtil.hasSpecialChars(c,"labelName"))return zmUtil.succErrMsg("e",g.tagdata.errors.specialCharacters),!1;if(c.length>25)return zmUtil.succErrMsg("e",g.tagdata.errors.lengthExceeded),!1;if("info"===c||"important"===c||"follow-up"===c)return zmUtil.succErrMsg("e",g.tagdata.errors.retrictedWord),!1;if(!c)return zmUtil.succErrMsg("e",g.tagdata.errors.empty),!1;var d=zmUtil.getTagList("default");for(var e in d)if(("e"!==b||znNote.labelId!==e)&&d[e].label.toLowerCase()===c)return zmUtil.succErrMsg("e",g.tagdata.errors.exists),!1;return!0},cmenuActions:function(){var a,e,f;$("#znActionNewCategory[contentEditable='true']").length||$("#znLTMenu_Nc[contentEditable='true']").length?($("#znActionNewCategory[contentEditable='true']").length?(a=$("#znActionNewCategory").text(),e=d.currLayId?d.currLayId:zmail.zuid):a=$("#znLTMenu_Nc").text(),a=a.trim(),d.isValidCategory(a,e)&&(f={fn:c.left.cateResult},b.sendNewCatReq(a,f,e),$("#znLTMenu").hide(),$("#znCntxtMenu").remove()),znNote.currNoteId=""):$("#znLTMenu_Rc[contentEditable='true']").length&&(a=$("#znLTMenu_Rc").text(),d.isValidCategory(a)&&(b.sendEditCatReq(a,d.rgtMenuId),$("#znLTMenu").hide(),$("#znCntxtMenu").remove()),znNote.currNoteId="")},dimUtility:function(a){for(var b=a.length,c=0;c<b;c++)"znLTMenu_Rc"===a[c]||"znLTMenu_Rl"===a[c]||"znLTMenu_Nc"===a[c]?$("#"+a[c]).parent().addClass("SC_op3"):$("#"+a[c]).addClass("SC_op3")},updateCountReact:function(a,b){"addNote"===b.mode?(d.updateCatCount(b.cat,"inc",b.namespaceId),d.updateCatCount(b.namespaceId,"inc",b.namespaceId)):"delNote"===b.mode?(d.updateCatCount(b.cat,"dec",b.groupId),d.updateCatCount(b.groupId,"dec",b.groupId)):"moveNote"===b.mode&&(d.updateCatCount(b.pCatId,"dec",b.groupId),d.updateCatCount(b.catId,"inc",b.groupId))},updateCatCount:function(a,b,c){if(zmsuite.isWorkspaceAvailable(h.appid)){var e,f=zNote.getNamefrmCatObj(a,c);if("General"!==f||a===c){e=c===zmail.zuid?"nviews":d.getGroupLayerName({groupId:c});var g=zmsuite.getAppObj().zm_notes.left.getNodes()[0].getLayer(e);g.updateCount(a,b)}}},showAdd:function(){var a,b,c=znNote.lstDetails();c&&"zn_catAll"!==c.fId&&"c"===c.type?(a=c.fId,b=znNote.groupId):"zn_catAll"===c.fId?(a=zNote.catIdGen[znNote.groupId],b=znNote.groupId):(a=zNote.catIdGen[zmail.zuid],b=zmail.zuid),znBox.checkForGroupDisabled({groupId:b})&&(a=zNote.catIdGen[zmail.zuid],b=zmail.zuid),zmail.showFeature?zNote.addNoteAutoSave({notes:{color:"0",notecont:"",catid:a},cntnt:{title:""},myact:{starred:!1},gnrl:{group:{id:b},by:zmail.zuid}}):zNote.addNote({catId:a,namespaceId:b})},fillNotes:function(){var a=znNote.listingDiv,c=a.scrollTop(),e=a.prop("scrollHeight")-a.height();if($("[data-drop='1']").removeAttr("data-drop"),znBox.hideMenu(),c&&Math.floor(c)>=.8*Math.floor(e)&&d.scrolling===!1){d.scrolling=!0;var f=znNote.noteListing.props.noteList.options.page;if(f&&"1"===f.showNextPage){var g=znNote.lstDetails(),h=zmail.streamsHbaseReadEnabled?znNote.noteListing.props.noteList.length+1:f.end,i=g.fId,j=g.type,k={start:h};znNote.listingDiv.append("<div id=pgdiv style=position:absolute;width:100%;top:"+d.pageDivTop+"px;left:0px></div>"),d.destroyLoadingDiv=zmComponent.loadingBand({container:$("#pgdiv")[0],type:"pagination"}),d.containerDiv=$("#pgdiv"),b.getNotes(j,i,k)}}},foldView:function(a,c){var e,f,g,i=a.rowInfo.info,j=!0;if("header"!==a.rowInfo.type&&i){if(zmTab.currentTab!==h.appid&&(zmsuite.showApp(h.appid),d.setChildToggle()),"c"===i){if(g=Object.keys(a.rowObject)[0],"more"===a.rowObject[g].id||"less"===a.rowObject[g].id)return void d.showMoreOrLess(a,c);void 0!==a.rowObject[g].HC?(e="zn_catAll",znNote.groupId=a.rowObject[g].id,f=a.rowObject[g].name,$.isEmptyObject(zNote.catCacheObj[znNote.groupId])&&(j=!1)):(e=a.rowObject[g].id,znNote.groupId=a.rowObject[g].groupId,f=a.rowObject[g].name)}else if("l"===i){for(var k in a.rowObject){e=a.rowObject[k].id,f=a.rowObject[k].dispName;break}znNote.groupId=zmail.zuid}else"views"===i&&(g=Object.keys(a.rowObject)[0],e=a.rowObject[g].id,znNote.groupId=a.rowObject[g].groupId,f=a.rowObject[g].name,"fav"===e||"sharedtome"===e||"trash"===e?i=e:(i="c",void 0!==a.rowObject[g].HC&&(e="zn_catAll")));d.currLayId=znNote.groupId,znNote.cacheObj={},znNote.noteObj={};var l='{"fId":"'+e+'","type":"'+i+'","groupId":"'+znNote.groupId+'"}';if(znNote.updateHeaderBand({name:f,mode:i,id:e,groupId:znNote.groupId}),d.updateRouter({type:i,folId:e,groupId:znNote.groupId}),notesRestore.saveState({type:i,folId:e,groupId:znNote.groupId}),j)znNote.listingDiv.attr("data-detail",l),b.getNotes(i,e);else{var m={};m.gid=znNote.groupId,m.fn=function(a,c){zNote.catCacheObj[c.id]=a,zNote.catIdGen[c.id]=a[0].catId,znNote.listingDiv.attr("data-detail",l),b.getNotes(i,e)},znBox.getGenCat(m)}}},updateRouter:function(a){var b=[];"c"===a.type?a.groupId===zmail.zuid?(b.push("views"),b.push("mynotes"),"zn_catAll"!==a.folId&&b.push(a.folId)):(b.push(zNote.CONSTANTS.hashUrl.type[a.type]),b.push(a.groupId),"zn_catAll"!==a.folId&&b.push(a.folId)):"l"===a.type?(b.push(zNote.CONSTANTS.hashUrl.type[a.type]),b.push(a.folId)):"fav"!==a.type&&"sharedtome"!==a.type||(b.push(zNote.CONSTANTS.hashUrl.type[a.type]),b.push(zNote.CONSTANTS.hashUrl.folId[a.folId])),zNote.RouteHelper.setParams(b),zNote.RouteHelper.update()},FLUtility:function(a){var b,c=a.rowInfo.info;if(c){var e;if("c"===c||"views"===c&&"fav"!==a.rowObject[Object.keys(a.rowObject)[0]].id&&"sharedtome"!==a.rowObject[Object.keys(a.rowObject)[0]].id){if("header"===a.rowInfo.type)return;var g=zmCont.getGroup();e={clk:function(a,b){f.cmenuItemClick(b)},divId:"znCntxtMenu",conArr:d.nCMenuCatArr};var h=Object.keys(a.rowObject)[0];d.rgtMenuId=void 0===a.rowObject[h].HC?a.rowObject[h].id:void 0,d.currLayId=a.rowObject[h].groupId||a.rowObject[h].id,zmsuite.showContextMenu(a.eventInfo,e),d.rgtMenuId?(b=["znLTMenu_Nc"],d.dimUtility(b)):(b=["znLTMenu_Rc","znLTMenu_Dc"],d.dimUtility(b)),(znBox.checkForGroupDisabled({groupId:d.currLayId})||g[d.currLayId]&&!g[d.currLayId].isOwner)&&d.dimUtility(["znLTMenu_Rc","znLTMenu_Dc"])}else if("l"===c){if("header"===a.rowInfo.type)return;var i;for(var j in a.rowObject){d.rgtMenuId=a.rowObject[j].id;break}d.currLayId=a.rowInfo.layerId,znNote.labelId=d.rgtMenuId,i=d.rgtMenuId?d.nCMenuTagArr:d.nCMenuTagArr1,e={clk:function(a,b){f.cmenuItemClick(b)},divId:"znCntxtMenu",conArr:i},zmsuite.showContextMenu(a.eventInfo,e),d.rgtMenuId&&!zmUtil.isSystemLabel(znNote.labelId)||(b=["znLTMenu_Rl","znLTMenu_Dl"],d.dimUtility(b))}}},findScroll:function(){var a=znNote.listingDiv,c=znNote.lstDetails(),e=c.fId,f=c.type;setTimeout(function(){var c=a.get(0).scrollHeight>a.get(0).clientHeight,g=d.pageDetails(),h={start:g.end};c||"1"!==g.showNextPage||b.getNotes(f,e,h)},100)},renameLabel:function(a,b){$(".listBoxNote").remove();var c=zmUtil.getTagList("default"),d=znNote.lstDetails(),e=d.fId;e===b.labId&&znNote.updateHeaderBand({name:c[znNote.labelId].dispName,mode:d.type,id:e,groupId:znNote.groupId})},deleteLabel:function(a,b){var c=znNote.lstDetails(),e=c.fId;if(e===b.labId)return void d.loadGroup()},deleteCat:function(a,b){var c=znNote.lstDetails(),e=c.fId;if(e===b)return void d.loadGroup()},loadGroup:function(){var a='{"fId":"zn_catAll","type":"c","groupId":"'+znNote.groupId+'"}';znNote.listingDiv.attr("data-detail",a),b.getNotes("c","zn_catAll");var c=znNote.groupId===zmail.zuid?"nviews":d.getGroupLayerName({groupId:znNote.groupId});zmsuite.getLeft("zm_notes").selRow(znNote.groupId,c),znNote.updateHeaderBand({name:zNote.groupObj[znNote.groupId].name,mode:"c",id:"zn_catAll",groupId:znNote.groupId})},renameCat:function(a,b){var c=znNote.lstDetails(),d=c.fId;d===b.catId&&znNote.updateHeaderBand({name:b.category,mode:c.type,id:d,groupId:znNote.groupId})},editGroup:function(a,b){var c,e,f;if(c=zmsuite.getAppObj().zm_notes.left.getNodes()[0].getLayer(d.getGroupLayerName({groupId:b.id})),b.props.name)zNote.groupObj[b.id].name=b.props.name,e=c.getRowObjfromId(b.id),e[b.id].name=b.props.name,c.editNode(e,c.mapObject);else if(b.props.disabled===!0||b.props.disabled===!1){var g=b.props.disabled===!0?"ngroups":"dgroups";if(c=zmsuite.getAppObj().zm_notes.left.getNodes()[0].getLayer(g),zNote.groupObj[b.id].disabled=b.props.disabled,e=c.getRowObjfromId(b.id),e[b.id].disabled=b.props.disabled,f=c.childObject[b.id],c.deleteNode(e),c=zmsuite.getAppObj().zm_notes.left.getNodes()[0].getLayer(d.getGroupLayerName({groupId:b.id}))){if(c.getChildObject()[b.id]={CH:{}},e[b.id].HC=0,e[b.id].E=0,c.getListObject().less?(e[b.id].hideNode=c.getListObject().less.hideNode,e[b.id].shouldshow=!0,c.insertNodeBefore(e,c.mapObject,"less")):(e[b.id].hideNode=!1,e[b.id].shouldshow=!1,c.appendNode(e,c.mapObject)),!$.isEmptyObject(f.CH))for(var h in f.CH){var i={};i[h]=f.CH[h],c.appendNode(i,c.mapObject,b.id)}}else{var j=d.getFrameworkObject(),k=d.getDisabledLayer(j);zmsuite.getLeft("zm_notes").getNodes()[0].appendLayer("dgroups",k),zmsuite.getLeft("zm_notes").getNodes()[0].getLayer("dgroups").setChildToggle(function(a,b,c){var d;if(a&&a.zmsData)for(var e in a.zmsData.rowObject)d=a.zmsData.rowObject[e];else d=a;d.E=c?1:0})}}else if(b.props.hidden===!0)c=zmsuite.getAppObj().zm_notes.left.getNodes()[0].getLayer("ngroups"),zNote.groupObj[b.id].hidden=b.props.hidden,e=c.getRowObjfromId(b.id),e[b.id].hidden=b.props.hidden,f=c.childObject[b.id],c.deleteNode(e);else if(b.props.hidden===!1){c=zmsuite.getAppObj().zm_notes.left.getNodes()[0].getLayer("ngroups"),e={};var l=_.filter(znNote.noteGroupOrderAndCount,function(a){return a.groupId===b.id});zNote.groupObj[b.id].hidden=b.props.hidden,e[b.id]=zNote.groupObj[b.id],e[b.id].HC=0,e[b.id].E=0,c.countObject[b.id]={},c.countObject[b.id].c=l[0].count,c.countObject[b.id].p="-1",c.getListObject().less?(e[b.id].hideNode=c.getListObject().less.hideNode,e[b.id].shouldshow=!0,c.insertNodeBefore(e,c.mapObject,"less")):(e[b.id].hideNode=!1,e[b.id].shouldshow=!1,c.appendNode(e,c.mapObject));var m=$.extend(!0,{},zNote.catCacheObj),n={},o={},p=1;n[b.id]={};for(var q=0;q<m[b.id].length;q++)o=m[b.id][q],"General"!==o.category?(o.seq=p++,o.name=o.category,o.SE=o.seq,o.id=o.catId,o.groupId=b.id,n[b.id][o.catId]=o,c.countObject[o.catId]={},c.countObject[o.catId].c=o.count,c.countObject[o.catId].p=b.id):zNote.catIdGen[b.id]=o.catId;if(!$.isEmptyObject(n[b.id]))for(var r in n[b.id]){var s={};s[r]=n[b.id][r],c.appendNode(s,c.mapObject,b.id)}}},getAttSlideArray:function(a,b,c){for(var d=[],e=0,f=a.length;e<f;e++)for(var g in a[e]){var h=$.extend(!0,{},a[e][g]);h.gId=c,c!==zmail.zuid&&(h.type="viewGroupData"),d.push(h)}return d}},e={cacheObj:{},noteObj:{},noteView:1,iSSubscribed:!1,currNoteId:"",listingDiv:"",labelId:"",groupObj:{},groupId:"",lstDetails:function(){if(znNote.listingDiv){var a=znNote.listingDiv.attr("data-detail");return a=$.parseJSON(a),a?a:void 0}},getCatId:function(a,b){for(var c=zNote.catCacheObj[b],d=c.length,e=0;e<d;e++)if(c[e].category===a)return c[e].catId},hideRgt:function(){1!==znNote.noteView||$("#nonotes").length||setTimeout(function(){znNote.setTopLeft()},100)},removeNote:function(a){var b,c=$("#"+a),e=znNote.listingDiv;if(1===znNote.noteView){znNote.listingDiv.addClass("zn_note_animation");var f=c.attr("data-sno"),g=c.attr("data-cno");g=parseInt(g);var h=c.css("top");h=h.replace("px",""),b=e.get(0).scrollHeight>e.get(0).clientHeight,c.remove();var i={sno:f,cno:g,top:h};znNote.setTopLeft(i),setTimeout(function(){znNote.listingDiv.removeClass("zn_note_animation")},500)}else b=e.get(0).scrollHeight>e.get(0).clientHeight,c.remove();b&&d.findScroll()},CheckForNoteOrganize:function(){return zmTab.currentTab===h.appid&&1===znNote.noteView||zmTab.currentTab.startsWith("zm_srch")===!0&&"n"!==zmSearch.getSearchAppType()},setTopLeft:function(a,b,c){function e(){b&&f.addClass("zn_note_animation");var a=Math.min.apply(Math,j),c=j.indexOf(a),g=k[m];if(j[c]===a){var i=c*(h+o)+"px",n=a+"px";$(g).attr({"data-cno":c,"data-sno":m}).css({top:n,left:i}),j[c]=parseInt($(g).outerHeight())+parseInt(a)+parseInt(19)}m+=1,m<l?setTimeout(e,0):(d.pageDivTop=Math.max.apply(Math,j),setTimeout(function(){b&&f.removeClass("zn_note_animation")},500))}if(znNote.CheckForNoteOrganize()){var f=c?$(c).children():znNote.listingDiv,g=c?$(c).width()-20:f.width()-20,h=znBox.CONTS.ntWid;if(!(a&&a.sno&&f.children().length<=a.sno)){a&&a.width&&(g=a.width-20);var i,j=[],k=f.children(),l=k.length,m=0,n=Math.floor(g/h);n=Math.max(n,1),i=n;var o=Math.floor((g-n*h)/n),p=h-znBox.CONTS.ntBorPad+o;for(k.each(function(){$(this).css({width:p+"px"})});i--;)j.push(0);if(a&&void 0!==a.sno&&void 0!==a.cno&&void 0!==a.top){var q=a.sno,r=a.cno,s=a.top,t=n,u=[];j[r]=parseInt(s),u.push(r);for(var v=1,w=1;w<=q;w++){var x=$(k[q-w]),y=x.attr("data-cno");if(0===j[y]){var z=x.css("top");z=z.replace("px",""),z=parseInt(z),j[y]=z+x.outerHeight()+parseInt(19),++v}if(v===t)break}m=parseInt(q)}setTimeout(e,0)}}},getCurNoteParam:function(a){var b=$("#"+a+".zn_note");if(b.length){var c=parseInt(b.attr("data-sno"))+1,d=b.attr("data-cno");d=parseInt(d);var e=b.css("top");e=e.replace("px",""),e=b.outerHeight()+parseInt(e)+parseInt(19);var f={sno:c,cno:d,top:e};return f}},loadNoteData:function(){var a=$.Deferred();return znNote.groupId=zmail.zuid,$.isEmptyObject(zNote.catCacheObj)?b.getCat().done(function(e){zNote.catCacheObj[zmail.zuid]=e[1][0].Category,znNote.myNotesCount=e[1][0].noteCount,b.getGroupCat().done(function(b){c.setGrpCat(b[1]),d.constructLeft(),a.resolve()}).fail(function(){d.constructLeft(),a.resolve()})}):(d.constructLeft(),a.resolve()),a.promise()},toggleChild:function(a,b,c){var d=zmsuite.getLeft("zm_notes").getNodes()[0].getLayer(b),e=d.getChildObject()[a];if(e)if("show"===c){var f=$("#"+a);d.showChild(f.find(".msi-rarrow"),a,f)}else d.hideChild($("#"+a).find(".msi-rarrow"),a)},validateHashParams:function(a){if("l"===a.type){if(a.groupId&&a.fId&&a.groupId===zmail.zuid&&zmail.labInfo[a.fId])return!0}else if("c"===a.type){if(a.groupId&&a.fId&&zNote.groupObj[a.groupId]&&("zn_catAll"===a.fId||zNote.getNamefrmCatObj(a.fId,a.groupId)))return!0}else if(("sharedtome"===a.type||"fav"===a.type)&&a.groupId===zmail.zuid)return!0;return!1},deduceHashParams:function(a){var b,c,d;if(a&&a.data&&a.data.router&&a.hashParams&&a.hashParams.length){"tags"===a.hashParams[0]?(c=zmail.zuid,b=a.hashParams[1],d=zNote.CONSTANTS.hashUrl.typeCode[a.hashParams[0]]):"group"===a.hashParams[0]?(c=a.hashParams[1],b=a.hashParams[2]||"zn_catAll",d=zNote.CONSTANTS.hashUrl.typeCode[a.hashParams[0]]):"views"===a.hashParams[0]&&("mynotes"===a.hashParams[1]?(b=a.hashParams[2]||"zn_catAll",d="c"):b=d=zNote.CONSTANTS.hashUrl.folIdCode[a.hashParams[1]],c=zmail.zuid);var e=znNote.validateHashParams({fId:b,groupId:c,type:d});e||(c=zmail.zuid,b="zn_catAll",d="c")}else a&&a.data&&a.data.restore&&a.restoreParams?(c=a.restoreParams.groupId,b=a.restoreParams.folId,d=a.restoreParams.type):(c=zmail.zuid,b="zn_catAll",d="c");return{fId:b,groupId:c,type:d}},notesLoad:function(a){a=a||{},zmsuite.setAppInfo({appname:g.common.appName,appId:h.appid,appIcon:h.appicon,isCacheable:"yes",stateData:{type:"app",data:{}},faqKey:"notes",searchPlaceHolder:g.common.searchNotes,data:{LNodes:"2",CNodes:3,PNodes:2},handler:{create:d.showAdd},router:zNote.RouteHelper}),znNote.loadNoteData().done(function(){"n"===zmApp.selectedApp&&(d.constructCenter(),znNote.handleHashUrl(a))}),$(zmail.win).mousedown(function(){"n"===zmApp.currentApp&&znBox.hideMenu()}),znNote.isSubscribed||($.subscribe("/rename/noteslabel",d.renameLabel),$.subscribe("/delete/noteslabel",d.deleteLabel),$.subscribe("/rename/notescat",d.renameCat),$.subscribe("/delete/notescat",d.deleteCat),$.subscribe("note/updateCount",d.updateCountReact),$.subscribe("group/added",znNote.appendLeftLayer),zmUtil.isNewGroupUser()&&$.subscribe("CONTACT_BOOK_GROUP_CHANGED",d.editGroup),$.subscribe("/apps/tabSwitched",function(a,b){1===znNote.noteView&&b===h.appid&&znNote.listingDiv&&!znNote.listingDiv.find("#nonotes").length&&znNote.setTopLeft(!1,!0,znNote.listingDiv)}),znNote.isSubscribed=!0)},handleHashUrl:function(a){var c=znNote.deduceHashParams(a),e=c.fId,f=c.groupId,g=c.type;znNote.groupId=f;var h="",j='{"fId":"'+e+'","type":"'+g+'","groupId":"'+f+'"}';if(znNote.listingDiv.attr("data-detail",j),d.updateRouter({type:g,folId:e,groupId:f}),"c"===g){var k=f===zmail.zuid?"nviews":d.getGroupLayerName({groupId:f});if("zn_catAll"===e)h=znBox.getGroupName(f),zmsuite.getLeft("zm_notes").selRow(f,k);else{var l=zmsuite.getLeft("zm_notes").getNodes()[0];l.layerArr&&znNote.toggleChild(f,k,"show"),h=zNote.getNamefrmCatObj(e,f),zmsuite.getLeft("zm_notes").selRow(e,k)}}else"l"===g?(h=zmail.labInfo[e].dispName,zmsuite.getLeft("zm_notes").selRow(e,"zmllabelH")):"sharedtome"!==g&&"fav"!==g||(h=i[e],zmsuite.getLeft("zm_notes").selRow(e,"nviews"));znNote.updateHeaderBand({name:h,mode:g,id:e,groupId:f}),b.getNotes(g,e).done(function(){znNote.notesLoaded=!0})},showNotesApp:function(a){znNote.notesLoaded?(d.setChildToggle(),a&&a.data&&a.data.router&&znNote.handleHashUrl(a)):znNote.loadNoteData().done(function(){"n"===zmApp.selectedApp&&(d.constructCenter(),znNote.handleHashUrl(a))})},appendLeftLayer:function(a,b){var c=zmCont.getGroup()[b.groupID];
zNote.groupObj[b.groupID]=c;var e=d.getGroupLayerName({groupId:b.groupID}),f=zmsuite.getAppObj().zm_notes.left.getNodes()[0].getLayer(e),g={};g[b.groupID]=c,g[b.groupID].HC=0,g[b.groupID].E=0,g[b.groupID].zerogroup=!0,f.getChildObject()[b.groupID]={CH:{}},f.getListObject().less?(g[b.groupID].hideNode=f.getListObject().less.hideNode,g[b.groupID].shouldshow=!0,f.insertNodeBefore(g,f.mapObject,"less")):f.appendNode(g,f.mapObject);var h={gid:b.groupID};h.fn=function(a,b){zNote.catCacheObj[b.id]=a,zNote.catIdGen[b.id]=a[0].catId},znBox.getGenCat(h)},updateHeaderBandWithObj:function(a){var b,c=String(a.zid);"byuser"===a.mode?zmail.ContactBook.get({zuid:c}).done(function(b){var c=b[0];d.actIconObj.list.left.leftHTML=_zm.escapeTags(znBox.getGroupName(a.groupId))+'<span class="sum unreadCount SC_folFil"><b>'+g.createdby+"</b>"+c.attrs.fn+'<i id="clrFilter" class="msi-close"></span>'}):"archive"===a.mode&&(d.actIconObj.list.left.leftHTML=_zm.escapeTags(znBox.getGroupName(a.groupId))+'<span class="sum unreadCount SC_folFil">'+g.common.archivedNotes+'<i id="clrFilter" class="msi-close"></span>'),b=zmsuite.getCenter()[0].getNodes()[1],b.push(d.actIconObj.list),b.paint(),b.$el.find("#clrFilter").length&&b.$el.find("#clrFilter").off("click").on("click",function(){znNote.leftSelectedId=zmsuite.getLeft("zm_notes").selId,$("#"+zmsuite.getLeft("zm_notes").selLayerId).find("#"+znNote.leftSelectedId).trigger("click")})},updateHeaderBand:function(a){var c,e,f,h,i=[];if($("#znDisabledGrp").remove(),"c"===a.mode){if(d.actIconObj.list.left.leftHTML='<div class="SCmb"><ul><li class="SCtxt"><b title="'+g.tooltips.changeGroup+'" id="notesGroupChange"><div class="SC_hd"></div><span>'+znBox.getGroupName(znNote.groupId)+' <i class="msi-barrow"></i></span></b></li></ul></div>',"zn_catAll"!==a.id&&(d.actIconObj.list.left.leftHTML+='<span class="SC_ldot">'+_zm.escapeTags(a.name)+"</span>"),a.groupId!==zmail.zuid&&(d.actIconObj.list.left.leftHTML+='<span id="ngroupmembers" class="SC_lnk">'+zNote.groupObj[znNote.groupId].members.length+" members</span>"),znBox.checkForGroupDisabled({groupId:a.groupId})){var j=$('<div class="SC_simg js-spam-trash-band zmWarnMsg" id="znDisabledGrp" ><span>'+zNote.notei18n.msg.disabledGroupMsg+"</span></div>");zmsuite.getCenter("zm_notes")[0].$el.find(".SCmb").after(j)}}else d.actIconObj.list.left.leftHTML=_zm.escapeTags(a.name);c=zmsuite.getCenter()[0].getNodes()[1],c.push(d.actIconObj.list),c.paint();var k=zmsuite.getCenter()[0].getNodes(),l=k[0];"c"!==a.mode?l.hideGroup("filter"):l.showGroup("filter"),e=function(a){a.dialog.remove();var c="byuser";b.getNotes("byuser",a.zid);var d='{"fId":"'+a.zid+'","type":"'+c+'","groupId":"'+znNote.groupId+'"}';znNote.listingDiv.attr("data-detail",d),znNote.updateHeaderBandWithObj({groupId:znNote.groupId,mode:"byuser",zid:a.zid})},h=zmail.ContactBook.get({zuid:zmail.zuid,promise:!1}),zmail.zuid!==a.groupId&&i.push({id:zmail.zuid,name:zNote.notei18n.myNotes,photo:h[0].get("photo")}),_.each(znNote.noteGroupOrderAndCount,function(b){f=b.groupId,zNote.groupObj[f]&&f!==a.groupId&&i.push({name:zNote.groupObj[f].name,id:zNote.groupObj[f].id,photo:zNote.groupObj[f].photo})}),c.$el.find("#notesGroupChange").off("click").on("click",function(){var a=zmUtil.createFLComp("groups",{data:i,search:"name",display:"name",displayAs:"dropdown",onSelect:function(b){znNote.groupId=b.id,a.hide(),d.loadGroup()},showCheckbox:!1,showCreate:!1,parentDOM:$("#notesGroupChange")[0],removehandler:!0,showUnread:!1});$("#notesGroupChange").addClass("SC_ddn"),$.publish("/mail/menuCreated",{menuHandler:function(){$(".SC_ddn").removeClass("SC_ddn")}}),a.show()}),c.$el.find("#ngroupmembers").length&&c.$el.find("#ngroupmembers").off("click").on("click",function(){zmAppLoader.load("streamsGroup").done(function(){zmStreamsApp.GroupApp.showMemberDialog({gid:znNote.groupId,title:g.tooltips.viewNoteByCreator,callback:e})})})},deleteNotesReq:function(a,b){var c={entityId:a.id,mode:"delNote",groupId:a.groupId,streamsView:"Notes",actionType:"delEntity",entityType:zNote.CONSTANTS.entityType},d={id:a.id,mode:"delNote"},e=function(a,d){b&&b(d),$.publish("/note/delete",[c.entityId,c.groupId]),$.publish("note/deleteNote",[{pid:c.entityId,gid:c.groupId}]),$.publish("note/updateCount",c)};zmAjq.XHR({u:zmail.conPath+"/NotesAction.do",t:"POST",fn:e,p:c,ep:d})},znLeftClbk:function(a){var b,c=a.zmsData;"clbk"in a&&(b=a.clbk);var e;e=c.rowInfo.info,"click"===c.type?e&&2===c.colInfo.column&&d.foldView(c,b):"contextmenu"===c.type&&d.FLUtility(c)},loadAndCategoryArray:function(a){var b=$.Deferred();return zNote.loadNoteCategories().done(function(){for(var c=[],d=0;d<zNote.catCacheObj[a].length;d++)c.push({id:zNote.catCacheObj[a][d].catId,display_text:zNote.catCacheObj[a][d].category,name:zNote.catCacheObj[a][d].category});b.resolve(c)}),b.promise()},getCat:b.getCat,getGroupCat:b.getGroupCat,createInlineNotes:d.showAdd,setGrpCat:c.setGrpCat,notei18n:g,getAttSlideArray:d.getAttSlideArray,sendNewCatReq:b.sendNewCatReq,sendNewLabReq:b.sendNewLabReq,getNotes:b.getNotes,updateRouter:d.updateRouter}}(),function(){window.zNote=window.zNote||{},zNote.Models={},zNote.Views={},zNote.Collections={},zNote.noteCollection={},zNote.eventBus=_.extend({},Backbone.Events),zNote.notei18n=zmText.get("notes"),zNote.dialog=void 0,zNote.prev_shortcut_scope=void 0,zNote.unSavedData={},zNote.catIdGen=[],zNote.catCacheObj={},zNote.groupObj={};var a=function(a,b){return!(window.innerHeight<a.top+b.height||window.innerWidth<a.left+b.width)},b=function(b){var c=_.pluck(b,"entityId"),d=_.pluck(b,"groupId"),e={id:c.join(","),groupId:d.join(",")};(c.length||d.length)&&znBox.getNoteListForGivenIds(e).done(function(c){zNote.loadNoteCategories().done(function(){c[1].forEach(function(c){var d=_.findWhere(b,{entityId:c.id});c.showStickyNote="open"===d.state,c.left=d.left,c.top=d.top,c.height=d.height,c.width=d.width,a({top:c.top,left:c.left},{height:c.height,width:c.width})||(c.left=void 0,c.top=void 0),zNote.addAsStickyNote(c,"restore")})})})},c=function(){var c;$.subscribe("stickyNoteMod",function(){var a=zNote.stickyNoteCollection.toJSON().filter(function(a){return"new"!==a.type}),b=a.map(function(a){var b={entityId:a.id,groupId:a.namespaceId};b.state=a.showStickyNote===!0?"open":"minimize";var c={top:a.top,left:a.left},d={width:a.width,height:a.height};return b.top=parseInt(c.top),b.left=parseInt(c.left),b.width=parseInt(d.width),b.height=parseInt(d.height),b}),c=zmAdHocSettings.getNotes().listingType;zmAdHocSettings.setNotes({stickyNotes:b,listingType:c})}),$.subscribe("notes/Notification",function(a,b){zNote.stickyNoteCollection&&zNote.stickyNoteCollection.where({id:b.eid}).length&&(c="string"==typeof b.group||b.group instanceof String?$.parseJSON(b.group).id:b.group.id,znBox.getNoteListForGivenIds({id:b.eid,groupId:c}).done(function(a){a[1].forEach(function(a){$.publish("stickyNotes/EditNotified",[a])})}))}),$.subscribe("zmailReconnect",function(a,b){if(zNote.stickyNoteCollection&&zNote.stickyNoteCollection.length){zmUtil.debugLog("Reconnect called. Updating sticky notes");var c=zNote.stickyNoteCollection.pluck("id"),d=zNote.stickyNoteCollection.pluck("namespaceId");b={id:c.join(","),groupId:d.join(",")},znBox.getNoteListForGivenIds(b).done(function(a){a[1].forEach(function(a){$.publish("stickyNotes/EditNotified",[a])})})}}),$.subscribe("notes/wshandler",function(c,d){if(!zNote.stickyNoteCollection)return void zNote.restoreStickyNotes();for(var e=zmAdHocSettings.getNotes(),f=0;f<e.stickyNotes.length;f++){var g=zNote.stickyNoteCollection.findWhere({id:e.stickyNotes[f].entityId});if(g){var h="open"===e.stickyNotes[f].state;a({top:e.stickyNotes[f].top,left:e.stickyNotes[f].left},{height:e.stickyNotes[f].height,width:e.stickyNotes[f].width})||(e.stickyNotes[f]=void 0,e.stickyNotes[f]=void 0),g.set({left:e.stickyNotes[f].left,top:e.stickyNotes[f].top,type:"restore",width:e.stickyNotes[f].width,height:e.stickyNotes[f].height,showStickyNote:h}),g.set("mod","true"),e.stickyNotes[f].added=!0}else e.stickyNotes[f].added=!1}var i=[];zNote.stickyNoteCollection.each(function(a,b,c){"true"===a.get("mod")?a.unset("mod",{silent:!0}):i.push(a)}),i.length&&(zNote.stickyNoteCollection.remove(i,{silent:!0}),zNote.stickyNoteCollection.trigger("remove"));var j=_.filter(e.stickyNotes,function(a){return a.added===!1});b(j)})};zNote.init=function(){$(zmail.win).mousedown(function(){$("#ngoto").remove()}),c(),zmComponent.notifier.addHandler("streams",function(a,b){b.data.etype===zNote.CONSTANTS.entityType&&"37"===b.data.ntype&&(zmUtil.debugLog("Notification for note edit. Updating stickyNotes"),$.publish("notes/Notification",[b.data]))})},zNote.getStickyNoteCollection=function(){return zNote.stickyNoteCollection instanceof zNote.Collections.Note?zNote.stickyNoteCollection:(zNote.stickyNoteCollection=new zNote.Collections.Note([]),zNote.stickyNoteCollection)};var d=function(){zNote.loadNoteCategories().done(function(){if(zNote.stickyNoteCollection&&zNote.stickyNoteCollection.findWhere({type:"new"})){var a=zNote.stickyNoteCollection.findWhere({type:"new"});zNote.eventBus.trigger("openStickyNote",{namespaceId:a.get("namespaceId"),id:a.get("id")})}else zNote.addAsStickyNote({namespaceId:zmail.zuid,showStickyNote:!0,color:_.random(0,3),desc:"",title:"",ownerZUID:zmail.zuid,id:String((new Date).getTime()),height:40,type:"new"},"new")})};zNote.checkForstickyNote=function(){var a=zNote.stickyNoteCollection.length;return zmsuite.getTabDOM().find(".notes-count").find("span").text(a),_zm._isPrivilegedUser()&&0===zNote.stickyNoteCollection.length?(zmsuite.getTabDOM().find(".notes-count").find("span").html("<i class='msi-add SC_thm' style='font-size: 12px;top: 1px;left: 0px;position: relative;'></i>"),zmsuite.getTabDOM().find("i.msi-stickyNotes").off("click").on("click",d),void zmsuite.getTabDOM().find("#sNoteTab").attr("title",zNote.notei18n.common.addStickyNote)):void(0===zNote.stickyNoteCollection.length&&($("#sNoteTab").remove(),$.publish("BOTTOM_ICONS_LIST_CHANGE"),zNote.dialog&&!zNote.dialog.isRemoved&&zNote.dialog.remove()))},zNote.isStickyNote=function(a){return!!(zNote.stickyNoteCollection instanceof zNote.Collections.Note&&zNote.stickyNoteCollection.findWhere({id:a.id}))};var e=function(){if(!zNote.dialog||zNote.dialog.isRemoved===!0){var a=function(){zNote.dialog.isRemoved||(ReactDOM.unmountComponentAtNode(zNote.dialog.$els.$content[0]),zNote.dialog.isRemoved=!0,zNote.dialog.remove())},b=new zNote.Collections.Note(zNote.stickyNoteCollection.toJSON(),(void 0),{mode:"stickyNote"}),c={title:zNote.notei18n.allStickyNotes,mask:"none",contentWrapperClass:"SC_PU ztb-notesPopover",maskWrapperClass:"SC_Pop",defaultCloseIcon:!1,icons:{right:[[{"class":"msi-popout",callback:function(a,b){zNote.stickyNoteCollection.forEach(function(a){a.showNote(!0,{silent:!0})}),a.$els.$rightHeader.find(".msi-popout").closest("li").addClass("SC_dyn"),a.$els.$rightHeader.find(".msi-popin").closest("li").removeClass("SC_dyn"),$.publish("stickyNoteMod")}},{"class":"msi-popin",callback:function(a,b){zNote.stickyNoteCollection.forEach(function(a){a.showNote(!1,{silent:!0})}),a.$els.$rightHeader.find(".msi-popin").closest("li").addClass("SC_dyn"),a.$els.$rightHeader.find(".msi-popout").closest("li").removeClass("SC_dyn"),$.publish("stickyNoteMod")}}]]},closeAction:function(a){ReactDOM.unmountComponentAtNode(a.$els.$content[0]),a.isRemoved=!0},dialogDidMount:function(a){var c=zmsuite.getTabDOM().find(".msi-stickyNotes").offset().left,d=zmsuite.getTabDOM().find(".msi-stickyNotes").offset().top,e=zmsuite.getTabDOM().find(".msi-stickyNotes").height(),f=d+e;ReactDOM.render(React.createElement(zNote.Views.NoteListCollectionView,{noteList:b}),a.$els.$content[0]),a.$els.$rightHeader.find(".SCmb").addClass("puClose"),zmComponent.tooltip({elm:a.$els.$rightHeader.find(".msi-popout")[0],text:zNote.notei18n.tooltips.openallsticky,arrow:"top"}),zmComponent.tooltip({elm:a.$els.$rightHeader.find(".msi-popin")[0],text:zNote.notei18n.tooltips.minimizeallsticky,arrow:"top"}),a.$els.$rightHeader.find(".msi-add").length&&zmComponent.tooltip({elm:a.$els.$rightHeader.find(".msi-add")[0],text:zNote.notei18n.common.addStickyNote,arrow:"top"}),a.$els.$positionWrapper.css("position","absolute"),a.$els.$positionWrapper.css("right",$("body").width()-c+"px"),a.$els.$positionWrapper.css("bottom",$("body").height()-f+"px"),zNote.stickyNoteCollection&&zNote.stickyNoteCollection.where({showStickyNote:!1}).length?a.$els.$rightHeader.find(".msi-popin").closest("li").addClass("SC_dyn"):a.$els.$rightHeader.find(".msi-popout").closest("li").addClass("SC_dyn")}};$.publish("/mail/menuCreated",{menuHandler:a}),_zm._isPrivilegedUser()&&c.icons.right[0].push({"class":"msi-add",callback:function(a,b){a.remove(),d()}}),zNote.dialog=Dialog["new"](c)}};zNote.addAsStickyNote=function(a,b){var c=a;c.type=b||"add",c.showStickyNote=void 0===c.showStickyNote||c.showStickyNote;var d=function(a,b){zNote.stickyNoteCollectionView=a};if(zNote.stickyNoteCollection instanceof zNote.Collections.Note&&zNote.stickyNoteCollection.findWhere({id:c.id}))return void zNote.eventBus.trigger("openStickyNote",{namespaceId:c.namespaceId,id:c.id});if(zNote.stickyNoteCollection instanceof zNote.Collections.Note)$.publish("/note/addstickynote",c);else{var f=$('<div id="stickyNote"></div>');$("body").append(f),zNote.stickyNoteCollection=new zNote.Collections.Note(c,(void 0),{mode:"stickyNote"});var g={stickyNote:!0};ReactDOM.render(React.createElement(zNote.Views.NoteCollectionReact,{ref:d,extraOptions:g,noteList:zNote.stickyNoteCollection}),f[0]),zNote.stickyNoteCollection.on("remove",zNote.checkForstickyNote),zNote.stickyNoteCollection.on("reset",zNote.checkForstickyNote)}var h=zNote.stickyNoteCollection.length;0===zmsuite.getTabDOM().find(".msi-stickyNotes").length?(zmsuite.getTabDOM().find(".SC_exp ul").prepend("<li title='"+zNote.notei18n.tooltips.stickyNotes+"' id='sNoteTab'><div class='notes-count'><span>"+h+"</span><i class='msi-stickyNotes'></i></div></li>"),zmsuite.getTabDOM().find(".msi-stickyNotes").on("click",e),$.publish("BOTTOM_ICONS_LIST_CHANGE")):(zmsuite.getTabDOM().find(".notes-count").find("span").text(h),zmsuite.getTabDOM().find(".msi-stickyNotes").off("click").on("click",e),zmsuite.getTabDOM().find("#sNoteTab").attr("title",zNote.notei18n.tooltips.stickyNotes))},zNote.handleNoteErrorCallback=function(a){zmUtil.requireStreamsApp().done(function(){var b=zmStreamsApp.util.errorHandling(a),c={appname:zNote.notei18n.common.appName,title:"Notes Error",appId:"1",faqKey:"notes",data:{CNodes:"3"},appIcon:"msi-post",onDelete:function(){return!0}};zmsuite.setWorkSpace(c),zmsuite.renderCenter(),zmsuite.showWorkSpace("1"),zmsuite.getCenter()[0].centerArr[2].$el.append(b)})},zNote.openNoteInTab=function(a,b){var c=[];if(zmsuite.isWorkspaceAvailable(a.id)&&!b)return void zmsuite.showWorkSpace(a.id);var d={},e=a.namespaceId===zmail.zuid?zNote.CONSTANTS.actionType.self:zNote.CONSTANTS.actionType.group;d.onerror=zNote.handleNoteErrorCallback;var f=$('<div class="SC_peCen" id="noteBox"></div>');zNote.getNoteDetails(a,d).done(function(b){if($.publish("zm/closeAllOpenDialog"),0!==b[0]){var d,g,h,i,j,k,l,m=b[1],n=function(){var b=zmsuite.createAppRouter();return b._hashKey="stream",b.initialize({hashKey:"stream",handler:function(){return{updateParams:!1,handled:!1,daultAction:!1}}}),b.setParams(["tab",a.namespaceId,a.id,zNote.CONSTANTS.entityType,e]),b},o=n(),p=new zNote.Models.previewNote(m),q={appname:zNote.notei18n.common.appName,title:p.get("cntnt").title||p.get("cntnt").summary,appId:p.get("notes").id,faqKey:"notes",data:{CNodes:"3"},appIcon:"msi-post",router:o,onDelete:function(){return d(),!0}};d=function(b){zmStreamsApp.util.detachAndRemove($(zmsuite.getCenter(a.id)[1].$el).find(".SC_ScrollY")).always(function(){ReactDOM.unmountComponentAtNode(f[0]),$.unsubscribe("/note/delete",g),$.unsubscribe("/apps/tabSwitched",h)})},g=function(a,b,c){b===p.get("notes").id&&c===p.get("gnrl").group.id&&(ReactDOM.unmountComponentAtNode(f[0]),zmsuite.closeWorkspace(q.appId))},h=function(){if(zmTab.currentTab===a.id&&i){var b=k-($(ReactDOM.findDOMNode(j.refs.notebox)).outerHeight(!0)-$(ReactDOM.findDOMNode(j.refs.desc.refs.content)).height());j.refs.desc.updateHeight({height:b})}},$.subscribe("/note/delete",g),$.subscribe("/apps/tabSwitched",h),zmsuite.isWorkspaceAvailable(a.id)?zmsuite.resetWorkspace(a.id,q):zmsuite.setWorkSpace(q),zmsuite.renderCenter(),c.push("tab"),c.push(a.namespaceId),c.push(a.id),c.push(zNote.CONSTANTS.entityType),c.push(e),o.setParams(c),o.update(),notesRestore.saveTabState({appId:a.id,app:"n",appObj:{appId:a.id,appname:zNote.notei18n.common.appName,data:{},appIcon:"msi-post"},data:{appId:a.id,namespaceId:a.namespaceId,id:a.id}}),zmsuite.showWorkSpace(p.get("notes").id),$(zmsuite.getCenter(a.id)[1].$el).addClass("SC_pe"),$(zmsuite.getCenter(a.id)[1].$el).append(f),zmsuite.getCenter(a.id)[0].getNodes()[0].$el.hide(),zmsuite.getCenter(a.id)[0].getNodes()[0].$el.css("top",0);var r={previewCard:"true",tab:"true",disableShortcuts:"true"};r.componentUpdated=function(a,b){h()},j=ReactDOM.render(React.createElement(zNote.Views.NotePreview,{options:r,note:p}),f[0]);var s=$('<div class=""><div class=""><div class="SC_ScrollY"></div></div></div>');zmUtil.requireStreamsApp().done(function(){zmStreamsApp.PostApp.singlePost({elm:s.find(".SC_ScrollY"),viewPost:!0,fixedComment:!1,isPreview:!1,response:m,hideContent:!0,commentId:a.commentId});var b=$('<li title="'+zNote.notei18n.preview.close+'"><b><i class="msi-close"></i><div class="SC_hd"></div></b></li>');s.find(".SC_ScrollY").find(".SCmb.SC_frt").append(b),b.on("click",function(){zmsuite.closeWorkspace(q.appId)})}),$(zmsuite.getCenter(a.id)[1].$el).addClass("shw SC_w100"),k=$(zmsuite.getCenter(a.id)[1].$el).innerHeight(),l=$(zmsuite.getCenter(a.id)[1].$el).innerWidth(),ReactDOM.findDOMNode(j.refs.notebox).style.left="-4000px";var t=k-($(ReactDOM.findDOMNode(j.refs.notebox)).outerHeight(!0)-$(ReactDOM.findDOMNode(j.refs.desc.refs.content)).height());j.refs.desc.setContentHeight({height:t}),$(".SC_pe").css("max-height",k),$(".SC_pe").css("min-width",l),$(".SC_pe").css("max-width",l),ReactDOM.findDOMNode(j.refs.notebox).style.left="0px",s.find(".SC_ScrollY").css("max-height",k),$(zmsuite.getCenter(a.id)[1].$el).find("#noteBox").append(s),i=!0}})},zNote.getContactDetails=function(a){var b=$.Deferred();return zmail.ContactBook.get({zuid:a.zuid}).done(function(a){b.resolve(a)}).fail(function(){b.reject()}),b.promise()},zNote.invokeNoteSearch=function(a){var b=[];zNote.getContactDetails({zuid:a.zuid}).done(function(c){b.push({className:"added by",value:c[0]}),b.push({className:"in group",value:zmail.ContactBook.getGroups(a.groupId)[0]}),zmail.Search.setContext(zmail.Search.Models.Contexts.noteSearchContext),zmail.Search.newSearch(b)})},zNote.listNotes=function(a,b,c,d){var e;if(b.isnew){var f=new zNote.Collections.Note(a[0].Notes,{page:a[0].page},{mode:b.mode,id:b.id,groupId:b.groupId},c);e=ReactDOM.render(React.createElement(zNote.Views.NoteCollectionReact,{noteList:f}),c[0])}else d.props.noteList.add(a[0].Notes,{silent:!0}),d.props.noteList.options.page=a[0].page,d.forceUpdate(),e=d;return e},zNote.openNoteInPreview=function(a,b){zNote.loadNoteCategories().done(function(){var c,d=zmsuite.getCenter()[1].getNodes();d[1].$el.html(""),d[1].$el.empty();var e="",f=[];f.push({tooltip:zNote.notei18n.tooltips.moreOptions,iconClass:"msi-action",data:"action"}),b.hidePrevNextIcons&&(f.push({tooltip:"prev",iconClass:"msi-prev",data:"prev"}),f.push({tooltip:"next",iconClass:"msi-next",data:"next"})),f.push({tooltip:"close",iconClass:"msi-close",data:"close"});var g={text:e,rIcons:[f]};zmsuite.getCenter()[1].show(),d[0].push(g),zmsuite.getCenter()[1].headerObj.render(),d[0].setListener("click",function(c,e){if("action"===c||"msi-action"===c.action){var f=zmStreamsApp.util.getDropdownMenu(a.noteData.id,zNote.CONSTANTS.entityType);$(e).closest("b").addClass("SC_ddn");var g={par:$(e).closest("b")[0],list:f,dir:"top",align:"pright",spanClass:"SC_dd",defaultclass:!1,clk:function(a,b){a.fn()}};zmsuite.showMenu(g)}else"close"===c||"clsPrev"===c.action?(d[0].$el.find(".noteHeader").length&&ReactDOM.unmountComponentAtNode(d[0].$el.find(".noteHeader")[0]),$.publish(zmStreamsApp.constants.removeNotificationPreview,zmsuite.getCenter()[1].$el),zmStreamsApp.util.closePreview()):"prev"===c||"msi-prev"===c.action?(d[0].$el.find(".noteHeader").length&&ReactDOM.unmountComponentAtNode(d[0].$el.find(".noteHeader")[0]),$.publish(zmStreamsApp.constants.removeNotificationPreview,zmsuite.getCenter()[1].$el),b.prev()):"next"!==c&&"msi-next"!==c.action||(d[0].$el.find(".noteHeader").length&&ReactDOM.unmountComponentAtNode(d[0].$el.find(".noteHeader")[0]),$.publish(zmStreamsApp.constants.removeNotificationPreview,zmsuite.getCenter()[1].$el),b.next())});var h=a.noteData,i=$("<div class='SC_notePreview'></div>"),j=$("<div class='postMsg'></div>"),k=new zNote.Models.previewNote(h),l=function(a){c=a};d[0].$el.append("<div class='noteHeader'></div>");var m={previewCard:"true",disableShortcuts:"true"};ReactDOM.render(React.createElement(zNote.Views.NoteHeaderPreview,{options:m,note:k}),d[0].$el.find(".noteHeader")[0]),d[0].$el.find(".SCS_postDet").prepend('<a href="/zm/#notes/tab/'+a.namespaceId+"/"+a.id+'" class="dateTime">'+k.get("notes").disptime+"</a>"),d[1].$el.off("scroll").on("scroll",function(){znBox.hideMenu()}),zmUtil.requireStreamsApp().done(function(){zmStreamsApp.PostApp.singlePost({elm:i,viewPost:!0,fixedComment:!1,isPreview:!1,response:h,hideContent:!0}),i.find(".SCS_postHead").after(j),d[1].push(i[0]),ReactDOM.render(React.createElement(zNote.Views.NotePreview,{ref:l,options:m,note:k}),j[0]);var a=$(d[1].$el).innerHeight();c.refs.desc.setContentHeight({height:.6*a}),i.find(".SCS_postHead").addClass("SC_dyn"),zmsuite.getCenter()[1].$el.addClass("zn_pv")})})},zNote.listRowNotes=function(a,b,c,d){var e;b.isnew?1===b.noteView?(e=new zNote.Collections.Note(a[0].Notes,{page:a[0].page},{mode:b.mode,id:b.id,groupId:b.groupId},c),ReactDOM.render(React.createElement(zNote.Views.NoteCollectionReact,{noteList:e,ref:d}),c[0])):(e=new zNote.Collections.Note(a[0].Notes,{page:a[0].page},{mode:b.mode,id:b.id,groupId:b.groupId,source:"noteApp"},c),ReactDOM.render(React.createElement(zNote.Views.NoteListCollectionView,{noteList:e,ref:d}),c[0])):(b.currentObj.props.noteList.add(a[0].Notes,{silent:!0}),b.currentObj.props.noteList.options.page=a[0].page,b.currentObj.forceUpdate())},zNote.getNoteList=function(a,b,c,d){zNote.loadNoteCategories().done(function(){var e=new zNote.Collections.Note(a[0].Notes,b.options,b.listInfo);ReactDOM.render(React.createElement(zNote.Views.NoteListCollectionView,{noteList:e,ref:d}),c[0])})},zNote.dropKeyBoardShortcuts=function(){zmComponent.keybindings.dropScope("notepopup"),zmComponent.keybindings.setScope(zNote.prev_shortcut_scope)},zNote.removeNoteFromView=function(a){var b=$.Deferred();ReactDOM.unmountComponentAtNode(a),b.resolve().promise()},zNote.removeNoteFromViewPreviewCard=function(a){a[0].$el.find(".noteHeader").length&&ReactDOM.unmountComponentAtNode(a[0].$el.find(".noteHeader")[0]),a[1].$el.find(".postMsg").length&&ReactDOM.unmountComponentAtNode(a[1].$el.find(".postMsg")[0])},zNote.setKeyBoardShortcuts=function(a){zNote.prev_shortcut_scope=zmComponent.keybindings.getScope();var b={allowDefaultScope:!1,shortcuts:[{uid:"close",keyStr:"esc",actions:[function(){znBox.hideMenu(),a.esc()}]}],scope:"notepopup"};zmComponent.keybindings.registerAll(b),zmComponent.keybindings.setScope("notepopup")},zNote.loadNoteCategories=function(){var a=$.Deferred();return $.isEmptyObject(zNote.catCacheObj)?(zNote.groupObj=zmCont.getGroup(),zNote.groupObj[zmail.zuid]={name:zmText.get("notes").myNotes},znNote.getCat().done(function(b){zNote.catCacheObj[zmail.zuid]=b[1][0].Category,znNote.myNotesCount=b[1][0].noteCount,znNote.isMigrated=b[1][0].isMigratedUser,znNote.getGroupCat().done(function(b){znNote.setGrpCat(b[1]),a.resolve()}).fail(function(){a.resolve()})}).fail(function(){a.reject()}),a.promise()):a.resolve()},zNote.openNote=function(a,b){var c=a.noteData,d=a.previewCard,e=new zNote.Models.previewNote(c);if(d===!0){b&&$(b).find(".postMsg").length&&zNote.removeNoteFromView($(b).find(".postMsg")[0]),b.html("");var f=$("<div class='SC_notePreview'></div>"),g=$("<div class='postMsg'></div>"),h={previewCard:"true",disableShortcuts:"true"};zmUtil.requireStreamsApp().done(function(){zmStreamsApp.PostApp.singlePost({elm:f,viewPost:!0,fixedComment:!1,isPreview:!1,response:c,hideContent:!0}),f.find(".SCS_postHead").after(g),b.append(f),ReactDOM.render(React.createElement(zNote.Views.NotePreview,{options:h,note:e}),g[0])})}else ReactDOM.render(React.createElement(zNote.Views.NotePreview,{note:e}),b[0])},zNote.getNoteDetails=function(a,b){b=b||{};var c={mode:"singlePost",actionType:"viewGroupEntity",groupId:a.namespaceId,entityId:a.id,entityType:zNote.CONSTANTS.entityType,allComments:!0,streamsView:!0};return zmAjq.XHR({u:zmail.conPath+"/stream.do",t:"POST",p:c,onerror:b.onerror})},zNote.printNote=function(a){zNote.getNoteDetails(a).done(function(a){var b=a[1],c=$("<div id=noteBox></div>"),d=new zNote.Models.previewNote(b),e={print:!0};ReactDOM.render(React.createElement(zNote.Views.NotePreview,{options:e,note:d}),c[0]);var f=$("<div class=SCS_prnCmnt></div>"),g=b.act.likedby?_.toArray(b.act.likedby.split(", ")):[],h={by:b.gnrl.by,id:b.notes.id,etype:zNote.CONSTANTS.entityType,groupId:b.gnrl.group.id,showinvite:b.myact.showinvite,like:b.myact.like,invitee:parseInt(b.act.invitees),likes:parseInt(b.act.likes),inviteeList:b.myact.inviteeList,lockInvites:b.gnrl.lockInvites,likeList:g,isPrint:!0};b.gnrl.group.isGroup?h.actionType="viewGroupEntity":h.actionType="viewSelfData",zmUtil.requireStreamsApp().done(function(){f.append(zmStreamsApp.PostActions.init(h))});var i=_.size(b.myact.inviteeList)?b.myact.inviteeList:[],j={comments:b.cmnt,id:b.notes.id,isShare:!1,fixedComment:!1,groupId:b.gnrl.group.id,etype:zNote.CONSTANTS.entityType,owner:b.gnrl.by,inviteeList:i};zmUtil.requireStreamsApp().done(function(){j.mentions=zmStreamsApp.util.getMentionList(b),f.append(zmStreamsApp.CommentModule.init(j))});var k=$("<div id=printnote class=SC_prntNotes></div>");zmUtil.requireStreamsApp().done(function(){var a=zmStreamsApp.PostApp.singlePost({viewPost:!0,fixedComment:!1,isPreview:!1,response:b,hideContent:!0,isPrint:!0});k.append(a),k.append(c),k.append(f);var e=function(){var a=k[0].cloneNode(!0);zmail.Printer.print({title:d.get("cntnt").title,content:a,css:["streams.css","notes.css"]}),setTimeout(function(){ReactDOM.unmountComponentAtNode(c[0]),k.remove()},1e3)};e()})})},zNote.viewNote=function(a){var b,c,d,e,f,g=this;zNote.getNoteDetails(a).done(function(h){if(0===h[0])return void $.publish("zm/framework/dialogClosed");var i=h[1],j="",k=$('<div id="nmask" class="SC_Pop tra SC_cent" style="pointer-events:auto"><div class="SCmb puClose nPuClose"><ul><li id="npopin" title="'+zNote.notei18n.note.openTab+'"class="'+j+'"><b><span class="SC_ttip ttr"><i class="msi-popin"></i></span></b></li><li id="nclose"><b><span class="SC_ttip ttr"><i class="msi-close"></i></span></b></li></ul></div><div class="SC_pe"><div class="SC_peCen" id="noteBox"></div></div></div>'),l=$('<div id="colorMask" style="z-index:101" class="SC_Pop tra">');$("body").append(l),$("body").append(k);var m=$(k).innerHeight()-50,n=$(k).innerWidth()-50,o=function s(){k.remove(),l.remove(),zNote.eventBus.off("removeMask",s,g),zmUtil.hideMenu(),zNote.dropKeyBoardShortcuts()};e=function(a,c){c===d.get("notes").id&&b()},f=function(){var a=m-($(ReactDOM.findDOMNode(c.refs.notebox)).outerHeight(!0)-$(ReactDOM.findDOMNode(c.refs.desc.refs.content)).height());c.refs.desc.updateHeight({height:a})},b=function(){l.removeClass("blk").addClass("tra"),k.find(".SCS_post").hide(),k.find(".zn_popNote").removeClass("zn_popNote"),setTimeout(function(){zmStreamsApp.util.detachAndRemove(k.find(".SC_ScrollY")).always(function(){$.publish("zm/framework/dialogClosed"),ReactDOM.unmountComponentAtNode(k.find("#noteBox")[0]),k.remove(),l.remove(),zNote.dropKeyBoardShortcuts(),zNote.eventBus.off("removeMask",o,g),$.unsubscribe("zm/closeAllOpenDialog",b),$.unsubscribe("/note/delete",e),zmUtil.hideMenu()})})},d=new zNote.Models.previewNote(i);var p={};p.componentUpdated=function(a,b){f()},c=ReactDOM.render(React.createElement(zNote.Views.NotePreview,{removeNotePreview:b,note:d}),k.find("#noteBox")[0]),k.find("#npopin").on("click",function(){b(),$.publish("zm/closeAllOpenDialog"),zNote.openNoteInTab({namespaceId:a.namespaceId,id:a.id})}),k.find("#nclose").on("click",function(){b()}),$.subscribe("zm/closeAllOpenDialog",b),$.subscribe("/note/delete",e),zNote.eventBus.on("removeMask",o,g),ReactDOM.findDOMNode(c.refs.notebox).style.left="-4000px";var q=$('<div class=""><div class=""><div class="SC_ScrollY"></div></div></div>');zmUtil.requireStreamsApp().done(function(){zmStreamsApp.PostApp.singlePost({elm:q.find(".SC_ScrollY"),viewPost:!0,fixedComment:!1,isPreview:!1,response:i,hideContent:!0})});var r=m-($(ReactDOM.findDOMNode(c.refs.notebox)).outerHeight(!0)-$(ReactDOM.findDOMNode(c.refs.desc.refs.content)).height());c.refs.desc.setContentHeight({height:r}),k.find(".SC_pe").css("max-height",m),k.find(".SC_pe").css("min-width",n-200),k.find(".SC_pe").css("max-width",n-200),ReactDOM.findDOMNode(c.refs.notebox).style.left="0px",q.find(".SC_ScrollY").css("max-height",m),k.find("#noteBox").append(q),l.removeClass("tra").addClass("blk"),zNote.setKeyBoardShortcuts({esc:b}),zmHash.setHash("notes",["preview",a.namespaceId,a.id])})},zNote.addNoteAutoSave=function(a){var b,c,d,e=this,f=$('<div id="nmask" class="SC_Pop tra SC_cent" style="pointer-events:auto"><div class="SCmb puClose nPuClose" id="nclose"><ul><li><b><span class="SC_ttip ttr"><i class="msi-close"></i></span></b></li></ul></div><div class="SC_pe"><div class="SC_peCen" id="noteBox"></div></div></div>'),g=$('<div id="colorMask" style="z-index:101" class="SC_Pop tra">');$("body").append(g),$("body").append(f);var h=$(f).innerHeight()-50,i=$(f).innerWidth()-50,j=_.random(0,3);a.notes.color=j;var k=new zNote.Models.previewNote(a),l=function(){c&&(f.find(".SC_pe").animate({"min-width":i-550,"max-width":i-550},{always:function(){c.find(".SC_ScrollY").removeClass("SC_dyn")}}),$(ReactDOM.findDOMNode(d.refs.notebox)).animate({"margin-right":"0%"},{always:function(){f.find(c).remove()}}))},m=function(){var a=h-($(ReactDOM.findDOMNode(d.refs.notebox)).outerHeight(!0)-$(ReactDOM.findDOMNode(d.refs.desc.refs.content)).height());d.refs.desc.updateHeight({height:a})},n=function(a){c=$('<div><div><div class="SC_ScrollY"></div></div></div>'),zmUtil.requireStreamsApp().done(function(){zmStreamsApp.PostApp.singlePost({elm:c.find(".SC_ScrollY"),viewPost:!0,fixedComment:!1,isPreview:!1,response:a,hideContent:!0}),c.find(".SC_ScrollY").css("max-height",h),f.find("#noteBox").append(c),f.find(".SC_pe").animate({"min-width":i-200,"max-width":i-200},{always:function(){c.find(".SC_ScrollY").removeClass("SC_dyn")}}),$(ReactDOM.findDOMNode(d.refs.notebox)).animate({"margin-right":"35%"}),k.hideStream()})},o=function r(){f.remove(),g.remove(),zNote.eventBus.off("removeMask",r,e),zmUtil.hideMenu(),zNote.dropKeyBoardShortcuts(),$.unsubscribe("zm/closeAllOpenDialog",b)},p={};p.componentUpdated=function(a,b){m()},d=ReactDOM.render(React.createElement(zNote.Views.NotePreview,{note:k,options:p,showStreamsBar:n,removeStreamsBar:l}),f.find("#noteBox")[0]),b=function(){g.removeClass("blk").addClass("tra"),f.find(".SCS_post").hide(),f.find(".zn_popNote").removeClass("zn_popNote"),setTimeout(function(){ReactDOM.unmountComponentAtNode($(ReactDOM.findDOMNode(d.refs.notebox)).parent()[0]),f.remove(),g.remove(),zNote.dropKeyBoardShortcuts(),zNote.eventBus.off("removeMask",o,e),zmUtil.hideMenu(),$.unsubscribe("zm/closeAllOpenDialog",b)})},f.find("#nclose").on("click",function(){b()}),$.subscribe("zm/closeAllOpenDialog",b),zNote.eventBus.on("removeMask",o,e),ReactDOM.findDOMNode(d.refs.notebox).style.left="-4000px";var q=h-($(ReactDOM.findDOMNode(d.refs.notebox)).outerHeight(!0)-$(ReactDOM.findDOMNode(d.refs.desc.refs.content)).height());
d.refs.desc.setContentHeight({height:q}),f.find(".SC_pe").css("max-height",h),f.find(".SC_pe").css("min-width",i-550),f.find(".SC_pe").css("max-width",i-550),ReactDOM.findDOMNode(d.refs.notebox).style.left="0px",ReactDOM.findDOMNode(d.refs.notebox).style.marginRight="0px",g.removeClass("tra").addClass("blk"),zNote.setKeyBoardShortcuts({esc:b})},zNote.loadAndOpenNote=function(a,b){zNote.loadNoteCategories().done(function(){b&&"tab"===b.type?zNote.openNoteInTab(a):zNote.viewNote(a)})},zNote.getNewNote=function(a,b){var c=void 0!==a.color?a.color:_.random(0,3);zmCont.isGroup(a.namespaceId)||a.namespaceId===zmail.zuid||(a.namespaceId=zmail.zuid,a.catId=znBox.getGeneralCatId(a.namespaceId));var d=new zNote.Models.addNote({addparams:a.addparams,desc:a.desc,title:a.title,namespaceId:a.namespaceId,catId:a.catId,attEntObj:a.attEntObj,color:c});ReactDOM.render(React.createElement(zNote.Views.addNoteViewReact,{ref:b.ref,options:{commentNote:b.commentNote},addCallback:a.addCallback,cancelCallback:a.cancelCallback,streams:b.streams,noAddCancel:b.noAddCancel,note:d}),b.mountingElem[0])},zNote.addNote=function(a,b){var c,d,e=$.extend(!0,{},a),f=$('<div id="nmask" style="z-index:101" class="SC_Pop fadeIn SC_cent"><div class="SCmb puClose" id="nclose"><ul><li><b><span class="SC_ttip ttr"><i class="msi-close"></i></span></b></li></ul></div><div class="SC_pe"><div class="SC_peCen" id="noteBox"></div></div></div>');$("body").append(f),d=function(a){if(b&&b.add&&b.cancel){f.find(".zn_popNote").removeClass("zn_popNote"),f.find(".SC_PUbtm").addClass("SC_dyn"),f.find(".SC_mkStky").addClass("SC_dyn");var e=$(ReactDOM.findDOMNode(c.refs.notebox)),g=e.offset(),h=e.width();e[0].style.bottom="auto",e[0].style.position="fixed",e[0].style.top=g.top+"px",e[0].style.left=g.left+"px",e[0].style.width=h+"px";var i="add"===a?"add":"cancel",j=b[i].top,k=b[i].left,l=b[i].width,m=b[i].height;$(ReactDOM.findDOMNode(c.refs.notebox)).animate({top:j+"px",left:k+"px",height:m,width:l},{complete:function(){ReactDOM.unmountComponentAtNode(f.find("#noteBox")[0]),$("#nmask").remove()},always:function(){zNote.eventBus.off("removeMask",d),zNote.dropKeyBoardShortcuts()}},{duration:500})}else ReactDOM.unmountComponentAtNode(f.find("#noteBox")[0]),$("#nmask").remove(),zNote.eventBus.off("removeMask",d),zNote.dropKeyBoardShortcuts()},e.addCallback=function(){a.addCallback&&a.addCallback(),d("add")},f.find("#nclose").on("click",function(){c.checkDataAlert(d)});var g=function(a){c=a};window.requestAnimationFrame(function(){f.addClass("blk")},100),zNote.getNewNote(e,{mountingElem:f.find("#noteBox"),ref:g}),zNote.eventBus.on("removeMask",d);var h=$(f).innerHeight(),i=$(f).innerWidth(),j=h-($(ReactDOM.findDOMNode(c.refs.notebox)).outerHeight(!0)-$(ReactDOM.findDOMNode(c.refs.content)).height());c.setContentHeight({height:.75*j}),$(c.refs.notebox).css("margin-right","0%"),f.find(".SC_pe").css("min-height",.5*h),f.find(".SC_pe").css("max-height",h),f.find(".SC_pe").css("min-width",.5*i),f.find(".SC_pe").css("max-width",.5*i),zNote.setKeyBoardShortcuts({esc:c.checkDataAlert.bind(c,d)})},zNote.getSelectedTextWithin=function(a){var b="";if("undefined"!=typeof window.getSelection){var c,d=window.getSelection();if((c=d.rangeCount)>0)for(var e,f=document.createRange(),g=0;g<c;++g)f.selectNodeContents(a),e=d.getRangeAt(g),1===e.compareBoundaryPoints(f.START_TO_END,f)&&e.compareBoundaryPoints(f.END_TO_START,f)===-1&&(1===e.compareBoundaryPoints(f.START_TO_START,f)&&f.setStart(e.startContainer,e.startOffset),e.compareBoundaryPoints(f.END_TO_END,f)===-1&&f.setEnd(e.endContainer,e.endOffset),b+=f.toString())}else if("undefined"!=typeof document.selection&&"Text"===document.selection.type){var h=document.selection.createRange(),i=h.duplicate();i.moveToElementText(a),1===h.compareEndPoints("EndToStart",i)&&h.compareEndPoints("StartToEnd",i)===-1&&(1===h.compareEndPoints("StartToStart",i)&&i.setEndPoint("StartToStart",h),h.compareEndPoints("EndToEnd",i)===-1&&i.setEndPoint("EndToEnd",h),b=i.text)}return b},zNote.loadAddNote=function(a,b){var c=a?a.addparams:void 0,d=a?a:{},e=d.groupId||zmail.zuid,f=d.attEntObj||[];b&&b.richText?znBox.convertImageToInlineImages(d.descHTML).done(function(a){zNote.loadNoteCategories().done(function(){b&&b.mountingElem?zNote.getNewNote({addparams:c,addCallback:d.addCallback,cancelCallback:d.cancelCallback,desc:a,title:d.title,namespaceId:e,attEntObj:f,catId:znBox.getGeneralCatId(e)},{mountingElem:b.mountingElem,commentNote:b.commentNote,noAddCancel:!0,ref:b.doneCallback}):zNote.addNote({addparams:c,desc:a,addCallback:d.addCallback,title:d.title,namespaceId:e,attEntObj:f,catId:znBox.getGeneralCatId(e)})})}):zNote.loadNoteCategories().done(function(){b&&b.mountingElem?zNote.getNewNote({addparams:c,addCallback:d.addCallback,cancelCallback:d.cancelCallback,desc:d.desc,title:d.title,namespaceId:e,attEntObj:f,catId:znBox.getGeneralCatId(e)},{mountingElem:b.mountingElem,noAddCancel:!0,commentNote:b.commentNote,streams:!0,ref:b.doneCallback}):zNote.addNote({addparams:c,desc:d.desc,addCallback:d.addCallback,title:d.title,namespaceId:e,attEntObj:f,catId:znBox.getGeneralCatId(e)})})},zNote.addNoteValidations=function(a,b){var c=b||{};return a.title&&a.title.length>100?(_zm.succErrMsg("e",zNote.notei18n.titexceed),!0):a.desc&&a.desc.length>65e3?(_zm.succErrMsg("e",zNote.notei18n.contexceed),!0):c.allowEmpty||void 0===a.desc||0!==a.desc.trim().length?!c.allowEmpty&&void 0!==a.richTextSummary&&0===znBox.domParser(znBox.getContentEditableTextFromHTML(a.richTextSummary)).trim().length&&(_zm.succErrMsg("e",zNote.notei18n.descempty),!0):(_zm.succErrMsg("e",zNote.notei18n.descempty),!0)},zNote.convertStreamsFormatToNotes=function(a,b,c,d){var e=$.isArray(a[1])?a[1]:[a[1]];return zNote.listNotes(e,b,$(c),d)},zNote.getNoteDataInListFormat=function(a){var b={};b.id=a.notes.id,b.title=a.notes.title,b.cat=a.notes.catid,b.desc=a.notes.notecont,b.namespaceId=a.gnrl.group.id,b.starred=a.notes.starred,b.color=a.notes.color,b.summary=a.notes.desc,b.isRichText=a.notes.isRichText,b.ownerZUID=a.gnrl.by,b.email=$.extend(!0,{},a.notes.email),b.commentCount=a.cmnt.total,b.tagId=a.myact.label.slice(0),b.disptime=a.gnrl.cdate,b.starred=a.myact.starred,b.attachments=[];for(var c=0;c<a.attach.length;c++){var d=a.attach[c],e={};d.inline||(e[d.id]={Id:d.id,s:d.size,fn:d.name,ft:d.ft,p:d.part},b.attachments.push(e))}return b},zNote.streamListNote=function(a,b){try{var c=new zNote.Models.previewNote(a);ReactDOM.render(React.createElement(zNote.Views.NotePreview,{note:c,streamList:!0}),b[0])}catch(d){window.console.log(d)}},zNote.getNoteSearchQuery=function(a){var b={};return b.start=0,b.limit=10,b.search=a.data[0].value,b.streamsView="Notes",b.mode="searchNotes",b.isPrev=!1,b.groupId=zmail.zuid,b.actionType="viewSelfData",b.entityType=2,b},zNote.updateLinks=function(a,b){var c=znBox.saveSelectionNew(a);b||$(a).html(zNote.linkify(znBox.domParser(znBox.getContentEditableText($(a)))).replace(/\n/g,"<br />")),znBox.restoreSelectionNew(a,c)},zNote.disable=function(a){var b=!0;if(a.ctrlKey||a.metaKey)switch(a.keyCode){case 66:case 98:b=!1;break;case 73:case 105:b=!1;break;case 85:case 117:b=!1}return b},zNote.linkify1=function(a){for(var b=/((href|src)=["']|)((?=http|https)[\S]*:\/\/[\S]+)|(www\.[\S]+)/gi,c=a.childNodes,d=0,e=c.length;d<e;d++){var f=c[d];if("A"===f.nodeName)zNote.linkify1(f.nextSibling);else if(f.nodeType===f.TEXT_NODE)for(var g=f.textContent.match(b);g;){var h=f.textContent.indexOf(g[0]),i=f.textContent.substring(0,h),j=document.createTextNode(i),k=document.createElement("a");k.href=g[0],k.innerText=g[0],f.textContent=f.textContent.substring(h+g[0].length),f.parentElement.insertBefore(j,f),f.parentElement.insertBefore(k,f),g=f.textContent.match(b)}else zNote.linkify1(f)}},zNote.linkify=function(a){if(a){var b,c;return c=/((href|src)=["']|)((?=http|https)[\S]*:\/\/[\S]+)|(www\.[\S]+)/gi,b=a.replace(c,function(a,b){return arguments[2]?arguments[0]:arguments[3]?'<a href="'+arguments[0]+'" target="_blank" rel="noopener noreferrer">'+arguments[0]+"</a>":'<a href="http://'+arguments[0]+'" target="_blank" rel="noopener noreferrer">'+arguments[0]+"</a>"})}return""},zNote.checkForPrintableKeys=function(a){return"undefined"==typeof a.which||(!(a.ctrlKey||a.metaKey||a.altKey||8===!a.which||13===!a.which)||void 0)},zNote.restoreStickyNotes=function(){zNote.stickyNoteCollection&&zNote.stickyNoteCollection.reset();var b=zmAdHocSettings.getNotes();if(!b||!b.stickyNotes||!b.stickyNotes.length)return zmsuite.getTabDOM().find(".SC_exp ul").prepend("<li title='"+zNote.notei18n.common.addStickyNote+"' id='sNoteTab'><div class='notes-count'><span><i class='msi-add SC_thm' style='font-size: 12px;top: 1px;left: 0px;position: relative;'></i></span><i class='msi-stickyNotes'></i></div></li>"),void $("#sNoteTab").find(".msi-stickyNotes").off("click").on("click",d);var c=_.pluck(b.stickyNotes,"entityId"),e=_.pluck(b.stickyNotes,"groupId"),f={id:c.join(","),groupId:e.join(",")};(c.length||e.length)&&znBox.getNoteListForGivenIds(f).done(function(c){c=c||[],c[1]=c[1]||[],zNote.loadNoteCategories().done(function(){c[1].forEach(function(c){var d=_.findWhere(b.stickyNotes,{entityId:c.id});c.showStickyNote="open"===d.state,c.left=d.left,c.top=d.top,c.height=d.height,c.width=d.width,a({top:c.top,left:c.left},{height:c.height,width:c.width})||(c.left=void 0,c.top=void 0),zNote.addAsStickyNote(c,"restore")})})})},zNote.getNamefrmCatObj=function(a,b){if(b){for(var c=zNote.catCacheObj[b],d=c?c.length:0,e=0;e<d;e++)if(c[e].catId===a)return c[e].category;return"General"}},zNote.getNamefrmGrpObj=function(a){var b;return $.each(zNote.groupObj,function(c,d){if(a===c)return b=d.name,!1}),b},zNote.getSmartNote=function(a,b,c){var d=$.Deferred(),e={};return zNote.loadNoteCategories().done(function(){var f=c.cmpId?c.cmpId:c.noteView.model.get("id");if(c.noteView&&c.noteView.model instanceof Backbone.Model)c.noteView.setEditor({editor:b}),c.noteView.render(),d.resolve(c.noteView);else{e.id=f,e.groupId=c.noteView&&c.noteView.groupId?c.noteView.groupId:zmail.zuid,e.color=_.random(0,3),e.catId=znBox.getGeneralCatId(e.groupId);var g=new zNote.Models.addSmartNote(e),h=new zNote.Views.addNote({model:g,editor:b,dom:a});d.resolve(h)}}),d.promise()},zNote.init()}(),function(){zNote.getEditorIcons=React.createClass({displayName:"getEditorIcons",componentDidMount:function(){var a=this;$(this.props.editor.doc).on("mouseup",function(){a.updateToolBar()}),$(this.props.editor.doc).on("keydown",function(){a.updateToolBar()})},updateToolBar:function(){var a=this.props.editor.doc;this.bold=this.italic=this.underline=this.strikethrough=!1,a.queryCommandState("bold")&&(this.bold=!0),a.queryCommandState("italic")&&(this.italic=!0),a.queryCommandState("underline")&&(this.underline=!0),a.queryCommandState("strikethrough")&&(this.strikethrough=!0),this.forceUpdate()},makeOrRemoveBold:function(){this.props.editor.doc.queryCommandState("bold")?this.props.editor.squireInstance.removeBold():this.props.editor.squireInstance.bold(),this.updateToolBar()},makeOrRemoveItalic:function(){this.props.editor.doc.queryCommandState("italic")?this.props.editor.squireInstance.removeItalic():this.props.editor.squireInstance.italic(),this.updateToolBar()},makeOrRemoveUnderline:function(){this.props.editor.doc.queryCommandState("underline")?this.props.editor.squireInstance.removeUnderline():this.props.editor.squireInstance.underline(),this.updateToolBar()},makeOrRemoveStrikethrough:function(){this.props.editor.doc.queryCommandState("strikethrough")?this.props.editor.squireInstance.removeStrikethrough():this.props.editor.squireInstance.strikethrough(),this.updateToolBar()},alignTextDirection:function(a){var b=this;a.stopPropagation();var c=$('<li class="nohr"><div><i class="msi-leftAlign"></i></div></li><li class="nohr"><div><i class="msi-rightAlign"></i></div></li><li class="nohr"><div><i class="msi-centerAlign"></i></div></li>');$(a.target).closest("b").addClass("SC_ddnB"),$(c).find(".msi-leftAlign").on("click",function(a){b.props.editor.squireInstance.setTextAlignment("left"),znBox.hideMenu()}),$(c).find(".msi-rightAlign").on("click",function(a){b.props.editor.squireInstance.setTextAlignment("right"),znBox.hideMenu()}),$(c).find(".msi-centerAlign").on("click",function(a){b.props.editor.squireInstance.setTextAlignment("center"),znBox.hideMenu()});var d={par:$(a.target).closest("b")[0],liDom:c,dir:"bottom",align:"pright",spanClass:"SC_dd zn_ddBt",defaultclass:!1};zmsuite.showMenu(d)},removeFormat:function(){this.props.editor.squireInstance.removeAllFormatting()},makeOrRemoveBullets:function(a){var b,c,d=this;c="makeUnorderedList",b="UL",d.props.editor.squireInstance.testPresenceinSelection(c,c,b,/>UL\b/)?d.props.editor.squireInstance.removeList():d.props.editor.squireInstance.makeUnorderedList()},makeOrRemoveList:function(a){var b,c,d=this;a.stopPropagation();var e=$('<li class="nohr"><div><i class="msi-bullets"></i></div></li><li class="nohr"><div><i class="msi-numbering"></i></div></li>');$(a.target).closest("b").addClass("SC_ddnB"),$(e).find(".msi-bullets").on("click",function(a){d.makeOrRemoveBullets(a),znBox.hideMenu()}),$(e).find(".msi-numbering").on("click",function(a){c="makeOrderedList",b="OL",d.props.editor.squireInstance.testPresenceinSelection(c,c,b,/>OL\b/)?d.props.editor.squireInstance.removeList():d.props.editor.squireInstance.makeOrderedList(),znBox.hideMenu()});var f={par:$(a.target).closest("b")[0],liDom:e,dir:"bottom",align:"pright",spanClass:"SC_dd zn_ddBt",defaultclass:!1};zmsuite.showMenu(f)},render:function(){this.props.editor=this.props.editor;var a=this,b={"true":"sel","false":""},c=function(b){b.stopPropagation(),a.props.editor.squireInstance.setTextAlignment("left")},d=function(b){b.stopPropagation(),a.makeOrRemoveBullets(b)};return React.createElement("ul",{className:"zn_editIcons"},React.createElement("li",null,React.createElement("b",{className:"sep"})),React.createElement("li",{onClick:this.makeOrRemoveBold,ref:"bold",title:zNote.notei18n.richText.bold},React.createElement("b",{className:b[this.bold]},React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-bold"})))),React.createElement("li",{onClick:this.makeOrRemoveItalic,ref:"italic",title:zNote.notei18n.richText.italic},React.createElement("b",{className:b[this.italic]},React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-italic"})))),React.createElement("li",{onClick:this.makeOrRemoveUnderline,ref:"underline",title:zNote.notei18n.richText.underline},React.createElement("b",{className:b[this.underline]},React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-underline"})))),React.createElement("li",{onClick:this.makeOrRemoveStrikethrough,ref:"strikethrough",title:zNote.notei18n.richText.strikethrough},React.createElement("b",{className:b[this.strikethrough]},React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-strikeThrough"})))),React.createElement("li",null,React.createElement("b",{className:"sep"})),React.createElement("li",{onClick:c,title:zNote.notei18n.richText.fontstyle},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-leftAlign"}),React.createElement("i",{className:"msi-barrow",onClick:this.alignTextDirection})))),React.createElement("li",{onClick:d,title:zNote.notei18n.richText.list},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-bullets"}),React.createElement("i",{className:"msi-barrow",onClick:this.makeOrRemoveList})))),React.createElement("li",null,React.createElement("b",{className:"sep"})),React.createElement("li",{onClick:this.removeFormat,title:zNote.notei18n.richText.removeFormat},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-rmvFrmt"})))))}})}(),function(){var a=zmsuite.createAppRouter();window.zNote=window.zNote||{},window.zNote.RouteHelper=a;var b=function(a){var b=!0;if("preview"===a[0])zmUtil.loadNotes("openNote",{gId:a[1],e:a[2]}),b=!1;else if("tab"===a[0])zmUtil.loadNotes("openNoteInTab",{gId:a[1],e:a[2]}),b=!1;else{var c={};c.hashParams=a,c.data={router:!0},zmAppLoader.load("notes").done(function(){zmApp.showApp("n",c)})}return b},c=function(a){var c,d=this;return zmail.postJsDeffered.done(function(){c=b.call(d,a)}),{updateParams:c}},d=function(){a.initialize({hashKey:"notes",handler:c}),a.activate()};d()}(),window.notesRestore=function(){var a={};return a.saveState=function(a){var b=zmsuite.getAppObj("zm_notes").obj.stateData.data;b.listing=a,zmState.sendRequestToSaveState()},a.restore=function(a,b){var c={};c.restoreParams=a.data.listing,c.data={restore:!0},zmAppLoader.load("notes").done(function(){zmApp.showApp("n",c)}),b.deferred.resolve()},a.saveTabState=function(a){zmState.saveTabState(a.appId,a)},a.restoreTab=function(a,b){zNote.openNoteInTab(a.data,!0)},a}(),function(){zNote.Models=zNote.Models||{},zNote.Models.Note=Zmail.Model.extend({initialize:function(){zNote.eventBus.on("editNote",this.updateModel,this),this.triggerUpdateModelSubscription=this.triggerUpdateModel.bind(this),this.renameNoteCatSubscription=this.renameNoteCat.bind(this),this.handleEditedStickyNoteSubscription=this.handleEditedStickyNote.bind(this),this.updateAttachmentDataSubscription=this.updateAttachmentData.bind(this),$.subscribe("/rename/notescat",this.renameNoteCatSubscription),$.subscribe("/rename/noteslabel",this.renameNoteCatSubscription),$.subscribe("/delete/noteslabel",this.renameNoteCatSubscription),$.subscribe("zmstreamsapp/addLabel",this.triggerUpdateModelSubscription),$.subscribe("/streams/comment",this.triggerUpdateModelSubscription),$.subscribe("attachment/addLabel",this.updateAttachmentDataSubscription),$.subscribe("attachment/removeLabel",this.updateAttachmentDataSubscription),void 0!==this.get("showStickyNote")&&(zNote.eventBus.on("openStickyNote",this.openStickyNote,this),$.subscribe("stickyNotes/EditNotified",this.handleEditedStickyNoteSubscription))},handleEditedStickyNote:function(a,b){var c=this;b.id===c.get("id")&&c.set(b)},triggerUpdateModel:function(a,b){var c,d={};b.id&&b.id.indexOf("#")!==-1?(d.id=b.id.slice(b.id.indexOf("#")+1,b.id.length),d.id===this.get("id")&&(void 0!==b.starred?(d.starred=b.starred,c={id:b.id,p:d},zNote.eventBus.trigger("editNote",self,{id:d.id,cattribute:"starred",p:d})):b.isAddLabel===!0?(c=b.label,zNote.eventBus.trigger("editNote",self,{id:d.id,cattribute:"addLabel",p:c})):b.isAddLabel===!1&&(c=b.label,zNote.eventBus.trigger("editNote",self,{id:d.id,cattribute:"removeLabel",p:c})))):b.entityId===this.get("id")&&zNote.eventBus.trigger("editNote",self,{id:b.entityId,cattribute:"commentCount",p:{commentCount:b.total}})},updateModel:function(a,b){var c=this;if(b.id===c.get("id"))if("title"===b.cattribute)c.set(b.cattribute,znBox.revSpCharRep(b.p.title));else if("category"===b.cattribute)c.set("cat",b.p.catId);else if("color"===b.cattribute)c.set("color",b.p.color);else if("desc"===b.cattribute)c.set("desc",b.p.desc),c.set("summary",znBox.getTextContentFromHTML(b.p.desc));else if("starred"===b.cattribute)c.set("starred",b.p.starred);else if("addLabel"===b.cattribute)c.set("tagId",b.p);else if("removeLabel"===b.cattribute)c.set("tagId",b.p);else if("commentCount"===b.cattribute)c.set("commentCount",b.p.commentCount);else if("archive"===b.cattribute)c.set("archived",b.p.archived);else if("removeAttachment"===b.cattribute){var d=c.get("attachments").slice();$.each(d,function(a,c){if(c[b.p.attachId])return d.splice(a,1),!1}),c.set("attachments",d),c.trigger("change")}else if("addAttachment"===b.cattribute){var e=c.get("attachments")?c.get("attachments").slice():[],f=e.concat(b.p.attachments);c.set("attachments",f),c.trigger("change")}},updateAttachmentData:function(a,b){this.get("id")===b.attObj.e&&("attachment/removeLabel"===a.type?delete this.get("attachments")[0][b.attObj.Id]:this.get("attachments")[0][b.attObj.Id]=b.attObj)},openStickyNote:function(a){var b=this;a.id===b.get("id")&&(this.get("showStickyNote")===!0?this.trigger("change:addedagain"):this.showNote(!0))},addNote:function(a){var b=this,c={desc:a.desc||this.get("desc"),mode:"addNote",groupId:this.get("namespaceId"),entityType:zNote.CONSTANTS.entityType,streamsView:"Notes",actionType:"addEntity",catId:this.get("cat")||znBox.getGeneralCatId(this.get("namespaceId")),title:a.title||this.get("title"),color:a.color||this.get("color")};return Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:c,success:function(a){var c=b.toJSON(),d=zNote.getNoteDataInListFormat(a[0].data);b.set(d),b.set({type:"",oldId:c.id}),$.publish("/note/add",[d]),$.publish("/note/addNote",[a[0].data]),d.mode="addNote",$.publish("note/updateCount",[d])}})},renameNoteCat:function(a,b){"/rename/noteslabel"!==a.type&&"/delete/noteslabel"!==a.type||this.get("tagId").indexOf(b.labId)!==-1&&("/delete/noteslabel"===a.type&&this.trigger("change:renamenotecat"),"/delete/noteslabel"===a.type&&this.removeTagDone(b.labId)),this.get("cat")===b.catId&&this.trigger("change:renamenotecat")},stopSubscriptions:function(){zNote.eventBus.off("editNote",this.updateModel,this),zNote.eventBus.off("openStickyNote",this.openStickyNote,this),this.off(null,null,this),$.unsubscribe("zmstreamsapp/addLabel",this.triggerUpdateModelSubscription),$.unsubscribe("/streams/comment",this.triggerUpdateModelSubscription),$.unsubscribe("/rename/notescat",this.renameNoteCatSubscription),$.unsubscribe("/rename/noteslabel",this.renameNoteCatSubscription),$.unsubscribe("/delete/noteslabel",this.renameNoteCatSubscription),$.unsubscribe("notes/Notification",this.handleEditedStickyNoteSubscription),$.unsubscribe("zmailReconnect",this.handleEditedStickyNoteSubscription),$.unsubscribe("attachment/addLabel",this.updateAttachmentDataSubscription),$.unsubscribe("attachment/removeLabel",this.updateAttachmentDataSubscription)},deleteNote:function(){var a=this,b={entityId:this.get("id"),mode:"delNote",groupId:this.get("namespaceId"),streamsView:"Notes",actionType:"delEntity",entityType:zNote.CONSTANTS.entityType},c=$.extend(!0,{},b);c.cat=this.get("cat"),Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:b,success:function(){$.publish("/note/delete",[a.get("id"),a.get("namespaceId")]),$.publish("note/deleteNote",[{pid:a.get("id"),gid:a.get("namespaceId")}]),$.publish("note/updateCount",b)}})},saveTitle:function(a){var b=this;if(a=a||"",a!==this.get("title")){if("new"===this.get("type"))return void this.addNote({title:a});a.trim().length||(a=znBox.CONTS.defaultTitle);var c={title:a,entityId:this.get("id"),mode:"editNTitle",groupId:this.get("namespaceId"),streamsView:"Notes",actionType:"changeEntity",entityType:"2"};Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:c,success:function(){zNote.eventBus.trigger("editNote",b,{id:c.entityId,cattribute:"title",p:c})}})}},postAsNew:function(a){var b="color,desc";a.attachments&&(b+=",attachment");var c={toNamespace:a.namespaceId,entityId:this.get("id"),mode:"postAsNew",groupId:this.get("namespaceId"),title:a.title,catId:a.catId,fields:b},d=c;return Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:c,success:function(a){var b=zNote.getNoteDataInListFormat(a[0].data);_zm.succErrMsg("s",zNote.notei18n.msg.noteCopied+" "+znBox.getGroupName(d.toNamespace)),$.publish("/note/add",[b]),$.publish("note/updateCount",[{mode:"addNote",cat:b.cat,namespaceId:b.namespaceId}])}})},changeGroup:function(a){if("new"===this.get("type"))return void this.set("namespaceId",a);var b=this,c={toNamespace:a,entityId:this.get("id"),mode:"changeGroup",groupId:this.get("namespaceId"),streamsView:"Notes",actionType:"addEntity",entityType:zNote.CONSTANTS.entityType,deleteOriginal:!0},d=c;d.cat=b.get("cat"),Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:c,success:function(a){var b=zNote.getNoteDataInListFormat(a[0].data);$.publish("/note/delete",[c.entityId,c.groupId]),$.publish("note/updateCount",d),$.publish("/note/add",[b]),$.publish("note/updateCount",[{mode:"addNote",cat:b.cat,namespaceId:b.namespaceId}])}})},changeBook:function(a){if("new"===this.get("type"))return void this.set("cat",a);var b=this,c=this.get("cat"),d={catId:a,entityId:this.get("id"),mode:"moveNote",groupId:this.get("namespaceId"),streamsView:"Notes",actionType:"changeEntity",entityType:"2"},e=$.extend(!0,{},d);e.pCatId=c,Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:d,success:function(){zNote.eventBus.trigger("editNote",b,{id:d.entityId,cattribute:"category",p:d}),$.publish("note/updateCount",e)}})},archiveOrUnarchiveNote:function(a){var b=this,c=this.get("cat"),d=a.archived?"archive":"unarchive",e={mode:d,entityId:this.get("id"),groupId:this.get("namespaceId")},f=$.extend(!0,{},e);f.pCatId=c,f.archived="archive"===d,Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:e,success:function(){var a="archive"===d?zNote.notei18n.msg.noteArchived:zNote.notei18n.msg.noteUnarchived;_zm.succErrMsg("s",a),zNote.eventBus.trigger("editNote",b,{id:e.entityId,cattribute:"archive",p:f})}})},saveAttachment:function(a){var b,c=this,d=[],e=[],f={mode:"addAttach",entityId:this.get("id"),groupId:this.get("namespaceId"),streamsView:"Notes",actionType:"addEntity",entityType:"2",attType:"attach"};if(a.tempLocation){for(var g=0;g<a.tempLocation.length;g++)d.push(a.tempLocation[g].fP),e.push(a.tempLocation[g].sN);f.attachname=d,f.attachstore=e}a.myAttachment&&(b=JSON.stringify(a.myAttachment),f.attEntObj=b),Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:f,success:function(a){zNote.eventBus.trigger("editNote",c,{id:f.entityId,cattribute:"addAttachment",p:a[0]})}})},addAttachment:function(a){zNote.eventBus.trigger("editNote",self,{id:this.get("id"),cattribute:"addAttachment",p:a[0]})},delAtt:function(a,b){$.publish("attachment/closeSlideshow");var c=this,d={mode:"delAttach",entityId:this.get("id"),groupId:this.get("namespaceId"),attachId:b,streamsView:"Notes",actionType:"delEntity",entityType:"2"};Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:d,success:function(){zNote.eventBus.trigger("editNote",c,{id:d.entityId,cattribute:"removeAttachment",p:d})}})},saveDescription:function(a){var b=this;if(a!==this.get("desc")&&(0!==a.trim().length||a.trim()!==this.get("desc"))){if("new"===this.get("type"))return void this.addNote({desc:a});var c={desc:a,entityId:this.get("id"),mode:"editNContent",groupId:this.get("namespaceId"),streamsView:"Notes",actionType:"changeEntity",entityType:"2"};znBox.isRichTextOpen()&&(c.isRichText="true"),Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",setSessionId:!0,data:c,success:function(){zNote.eventBus.trigger("editNote",b,{id:c.entityId,cattribute:"desc",p:c})}})}},sendAsMail:function(){var a={},b=[];if(a.SUBJECT=this.get("title"),a.CONTENT=this.get("desc").replace(/\n/g,"<br/>"),this.get("attachments")&&this.get("attachments").length){for(var c=this.get("attachments").length,d=0;d<c;d++){var e=this.get("attachments")[d];for(var f in e){var g={gId:this.get("namespaceId"),Id:e[f].Id,e:this.get("id"),et:2,fn:e[f].fn,fs:e[f].fs,p:e[f].p,ft:e[f].ft};b.push(g)}}a.NEWATT=b}zmUtil.compose(a,"",{entityType:"note"})},addTag:function(a){var b=this,c={tagId:a,entityId:this.get("id"),mode:"setTag",groupId:this.get("namespaceId"),streamsView:"Notes",actionType:"addLabel",entityType:"2"};Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:c,success:function(){var d=b.get("tagId").slice();d.push(a),zNote.eventBus.trigger("editNote",b,{id:c.entityId,cattribute:"addLabel",p:d}),$.publish("note/editNote",[{mode:"addLabel",gid:b.get("namespaceId"),pid:c.entityId,labelId:a}])}})},removeTag:function(a){var b=this,c={tagId:a,entityId:this.get("id"),mode:"removeTag",groupId:this.get("namespaceId"),streamsView:"Notes",actionType:"addLabel",entityType:"2"};Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:c,success:function(){b.removeTagDone(a)}})},removeTagDone:function(a){var b=this.get("tagId").slice();b.splice(this.get("tagId").indexOf(a),1),zNote.eventBus.trigger("editNote",this,{id:this.get("id"),cattribute:"removeLabel",p:b}),$.publish("note/editNote",[{mode:"removeLabel",pid:this.get("id"),gid:this.get("namespaceId"),labelId:a}])},saveColor:function(a){var b=this;if("new"===this.get("type"))return void this.set("color",a);var c={color:a,entityId:this.get("id"),mode:"editNColor",groupId:this.get("namespaceId"),streamsView:"Notes",actionType:"changeEntity",entityType:"2"};Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:c,success:function(){zNote.eventBus.trigger("editNote",b,{id:c.entityId,cattribute:"color",p:c})}})},showNote:function(a,b){this.set("showStickyNote",a),b&&b.silent||$.publish("stickyNoteMod")},closeNote:function(){"new"!==!this.get("type")&&$.publish("/note/closeStickyNote",[this.get("id"),this.get("namespaceId")])},saveFavourite:function(){var a=this,b=!this.get("starred"),c=b?"addLabel":"deleteLabel",d={starred:b,entityId:this.get("id"),mode:"editNFav",groupId:this.get("namespaceId"),streamsView:"Notes",actionType:c,entityType:"2"};Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:d,success:function(){zNote.eventBus.trigger("editNote",a,{id:d.entityId,cattribute:"starred",p:d}),$.publish("note/editNote",[{mode:"changeFavourite",pid:d.entityId,gid:a.get("namespaceId"),starred:b}])}})}})}(),function(){zNote.Collections=zNote.Collections||{},zNote.Collections.Note=Zmail.Collection.extend({initialize:function(a,b,c,d){this.options=b,this.listInfo=c,this.mountingElem=d,this.on("change:cat",function(a){"c"===this.listInfo.mode&&this.listInfo.id!==a.get("cat")&&"zn_catAll"!==this.listInfo.id&&this.remove(a)}.bind(this)),this.on("change:archived",function(a){(a.get("archived")&&"c"===this.listInfo.mode||!a.get("archived")&&"archive"===this.listInfo.mode)&&this.remove(a)}.bind(this)),this.on("change:tagId",function(a){"l"===this.listInfo.mode&&a.get("tagId").indexOf(this.listInfo.id)===-1&&this.remove(a)}.bind(this)),this.on("change:starred",function(a){"fav"===this.listInfo.mode&&a.get("starred")===!1&&this.remove(a)}.bind(this)),this.addNoteSubscription=this.addNoteToCollection.bind(this),this.removeNoteSubscription=this.removeNoteFromCollection.bind(this),this.deleteNoteCatSubscription=this.deleteNoteCat.bind(this),$.subscribe("/note/add",this.addNoteSubscription),$.subscribe("/note/copy",this.addNoteSubscription),$.subscribe("/note/delete",this.removeNoteSubscription),$.subscribe("/delete/notescat",this.deleteNoteCatSubscription),this.listInfo&&"stickyNote"===this.listInfo.mode&&($.subscribe("/note/closeStickyNote",this.removeNoteSubscription),$.subscribe("/note/addstickynote",this.addNoteSubscription))},addNoteToCollection:function(a,b){var c=this;"mailassociated"===c.listInfo.id&&c.listInfo.msgid===b.email.msgid&&c.unshift(b),"c"===c.listInfo.mode&&("zn_catAll"===c.listInfo.id&&c.listInfo.groupId===b.namespaceId||c.listInfo.id===b.cat)&&(b.newNote=!0,c.unshift(b)),"stickyNote"===c.listInfo.mode&&void 0!==b.showStickyNote&&c.unshift(b)},removeNoteFromCollection:function(a,b){this.remove(this.get(b))},deleteNoteCat:function(a,b){var c=this.where({cat:b});c.length&&(this.remove(c,{silent:!0}),this.trigger("remove"))},stopSubscriptions:function(){$.unsubscribe("/note/delete",this.removeNoteSubscription),$.unsubscribe("/note/add",this.addNoteSubscription),$.unsubscribe("/delete/notescat",this.deleteNoteCatSubscription),"stickyNote"===this.listInfo.mode&&($.unsubscribe("/note/closeStickyNote",this.removeNoteSubscription),$.unsubscribe("/note/addstickynote",this.addNoteSubscription)),this.unmountCalled=!0},model:zNote.Models.Note
})}(),function(){zNote.Views=zNote.Views||{},zNote.Views.NoteCollectionReact=React.createClass({displayName:"NoteCollectionReact",getInitialState:function(){return this.initializeValue(),{}},componentDidUpdate:function(){(!this.props.noteList.listInfo||this.props.noteList.listInfo&&"stickyNote"!==this.props.noteList.listInfo.mode)&&this.props.noteList.length&&znNote.setTopLeft(!1,!0,this.props.noteList.mountingElem)},componentDidMount:function(){var a=this;this.props.noteList.on("change",function(){(!a.props.noteList.listInfo||a.props.noteList.listInfo&&"stickyNote"!==a.props.noteList.listInfo.mode)&&a.props.noteList.length&&znNote.setTopLeft(!1,!0,this.props.noteList.mountingElem)}.bind(this)),this.props.noteList.on("reset",function(){this.forceUpdate()}.bind(this)),this.props.noteList.on("change:renamenotecat",function(){this.forceUpdate()}.bind(this)),this.props.noteList.on("remove",function(){this.forceUpdate()}.bind(this)),this.props.noteList.on("add",function(){this.forceUpdate()}.bind(this)),setTimeout(function(){(!a.props.noteList.listInfo||a.props.noteList.listInfo&&"stickyNote"!==a.props.noteList.listInfo.mode)&&a.props.noteList.length&&znNote.setTopLeft(!1,!1,a.props.noteList.mountingElem)},100),setTimeout(function(){(!a.props.noteList.listInfo||a.props.noteList.listInfo&&"stickyNote"!==a.props.noteList.listInfo.mode)&&a.props.noteList.length&&znNote.setTopLeft(!1,!1,a.props.noteList.mountingElem)},10)},initializeValue:function(){this.top=this.top||30,this.left=this.left||30,this.maxZIndex=this.maxZIndex||2,this.color=_.random(0,3),this.newNoteModel=new zNote.Models.addNote({color:self.color})},getAvailableTopLeft:function(){var a=this.top,b=this.left;this.incrementTopLeft(),this.top>document.body.clientHeight-400&&(this.top=30),this.left>document.body.clientWidth-400&&(this.left=30);var c=this.maxZIndex;return this.maxZIndex<100&&this.incrementZIndex(),{top:a,left:b,zIndex:c}},getCurrentTopLeft:function(){var a=this.top,b=this.left;return{top:a,left:b}},componentWillUnmount:function(){this.props.noteList.stopSubscriptions()},incrementZIndex:function(){this.maxZIndex=this.maxZIndex+1},incrementTopLeft:function(){this.top=this.top+60,this.left=this.left+30},handleZIndex:function(a){this.maxZIndex>=99&&(this.props.noteList.each(function(a){a.set({zIndex:1})}),this.maxZIndex=2),a.get("zIndex")+1!==this.maxZIndex&&(a.set({zIndex:this.maxZIndex}),this.incrementZIndex())},appendList:function(){this.props.noteList.concat()},setOpenNote:function(a){this.previewId=a},getOpenNote:function(){return this.previewId||""},noteView:function(a,b){this.noteViewList=this.noteViewList||{},this.noteViewList[b.get("id")]=a},noteViewList:function(){return this.noteViewList},getTopLeft:function(a){var b=this.noteViewList[a].top,c=this.noteViewList[a].left;return{top:b,left:c}},getWidthHeight:function(a){var b=this.noteViewList[a].width,c=this.noteViewList[a].getDescriptionHeight();return{width:b,height:c}},getAddNote:function(){var a,b;this.props.noteList.listInfo&&"zn_catAll"!==this.props.noteList.listInfo.id&&"c"===this.props.noteList.listInfo.mode?(a=this.props.noteList.listInfo.id,b=this.props.noteList.listInfo.groupId):"zn_catAll"===this.props.noteList.listInfo.id?(a=znBox.getGeneralCatId(this.props.noteList.listInfo.groupId),b=this.props.noteList.listInfo.groupId):(a=znBox.getGeneralCatId(zmail.zuid),b=zmail.zuid);var c=$(ReactDOM.findDOMNode(this.noteViewList[this.props.noteList.models[0].get("id")])),d=$(ReactDOM.findDOMNode(this.refs.quickAdd)),e={add:{top:c.offset().top,left:c.offset().left,height:c.height(),width:c.width()},cancel:{top:d.offset().top,left:d.offset().left,height:d.height(),width:d.width()}};zNote.addNote({catId:a,color:this.color,namespaceId:b,addparams:{actionSrc:"quickadd"}},e)},render:function(){var a,b,c,d,e=this,f=this.props.extraOptions,g=this.props.noteList.listInfo.mode;b="byuser"===g||"sharedtome"===g||"archive"===g||znBox.checkForGroupDisabled({groupId:this.props.noteList.listInfo.groupId})?{__html:zmText.get("notes","nonotesavailable")}:"search"===g?{__html:zmText.get("notes","nosearchnotes")}:{__html:zmText.get("notes","nonotescreate",{create:"<font onClick={znNote.createInlineNotes()}>"+zNote.notei18n.create+"</font>"})},f&&(c=this.handleZIndex,d=this.getAvailableTopLeft),this.color=_.random(0,3),this.newNoteModel.set({color:e.color});var h=function(a){return function(b){e.noteView(b,a)}};if(this.props.noteList.length)return React.createElement("div",{id:"wrapperNoteDiv",ref:"wrapDiv"},function(){return znBox.checkForQuickAdd(e.props.noteList.listInfo)?React.createElement(zNote.Views.addNoteViewReact,{ref:"quickAdd",note:e.newNoteModel,options:{quickAdd:!0,addCallback:e.getAddNote}}):null}(),this.props.noteList.map(function(b){return a=b.get("oldId")||b.get("id"),React.createElement(zNote.Views.NoteViewReact,{note:b,ref:h(b),extraOptions:f,handleOnOpenNote:e.setOpenNote,openedNote:e.getOpenNote,getAvailableTopLeft:d,handleZIndex:c,key:a,mountingElem:e.props.noteList.mountingElem})}));var i="stickyNote"===g?"SC_nmsg SC_dyn":"SC_nmsg";return React.createElement("div",{id:"wrapperNoteDiv",ref:"wrapDiv"},React.createElement("div",{id:"nonotes",className:i,dangerouslySetInnerHTML:b}))}})}();var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();!function(){zNote.Views=zNote.Views||{},zNote.Views.NoteViewReact=function(m){function n(a,b){_classCallCheck(this,n);var c=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,a,b));return c.handleMouseUp=c.handleMouseUp.bind(c),c.handlePopOutNote=c.handlePopOutNote.bind(c),c.handleOnMinimize=c.handleOnMinimize.bind(c),c.handleOnClose=c.handleOnClose.bind(c),c.viewNote=c.viewNote.bind(c),c.handleOpenNote=c.handleOpenNote.bind(c),c}return _inherits(n,m),_createClass(n,[{key:"componentDidMount",value:function(){var a=this;this.props.note.on("change",function(a){this.forceUpdate()}.bind(this)),this.props.note.on("change:renamenotecat",function(){this.forceUpdate()}.bind(this)),this.props.note.get("newNote")&&(this.props.note.set("newNote",void 0),$(ReactDOM.findDOMNode(a.refs.notebox)).addClass("zn_newNote"),setTimeout(function(){$(ReactDOM.findDOMNode(a.refs.notebox)).removeClass("zn_newNote")},2e3)),this.props.extraOptions&&this.props.extraOptions.stickyNote&&("restore"!==a.props.note.get("type")&&"new"!==a.props.note.get("type")&&$.publish("stickyNoteMod"),setTimeout(function(){$(ReactDOM.findDOMNode(a.refs.notebox)).removeClass("zn_fadeIn")},500),$(ReactDOM.findDOMNode(this.refs.notebox)).draggable({scroll:!1,containment:"window",stop:function(b,c){a.left=c.position.left,a.top=c.position.top,a.props.note.set({left:c.position.left},{silent:!0}),a.props.note.set({top:c.position.top},{silent:!0}),$.publish("stickyNoteMod")},stack:$(ReactDOM.findDOMNode(this.refs.notebox))}),$(ReactDOM.findDOMNode(a.refs.desc)).resizable({containment:"document",handles:{se:".ui-resizable-se",e:".ui-resizable-e",s:".ui-resizable-s"},maxHeight:"500",maxWidth:"400",minHeight:"24",minWidth:"200",start:function(){$(ReactDOM.findDOMNode(a.refs.desc.refs.content)).css("maxHeight","500px")},resize:function(b,c){var d=c.size.width,e=c.size.height;$(ReactDOM.findDOMNode(a.refs.notebox)).css("width",d+"px"),$(ReactDOM.findDOMNode(a.refs.desc.refs.content)).css("height",e+"px"),document.body.clientHeight<$(ReactDOM.findDOMNode(a.refs.notebox)).position().top+$(ReactDOM.findDOMNode(a.refs.notebox)).outerHeight(!0)&&($(ReactDOM.findDOMNode(a.refs.desc.refs.content)).css("height",e-30+"px"),$(ReactDOM.findDOMNode(a.refs.desc)).css("height",e-30+"px"),$(this).resizable("widget").trigger("mouseup"))},stop:function(b,c){a.width=c.size.width,a.height=c.size.height,a.props.note.set({width:c.size.width},{silent:!0}),a.props.note.set({height:c.size.height},{silent:!0}),$.publish("stickyNoteMod")}}),$(ReactDOM.findDOMNode(this.refs.notebox)).mousedown(function(){a.props.handleZIndex(a.props.note)}),this.props.note.on("change:addedagain",function(b){a.props.handleZIndex(a.props.note),$(ReactDOM.findDOMNode(a.refs.notebox)).addClass("zn_selNote"),setTimeout(function(){$(ReactDOM.findDOMNode(a.refs.notebox)).removeClass("zn_selNote")},500)}),$(ReactDOM.findDOMNode(this.refs.notebox)).on("mousedown",function(){document.activeElement.blur()}))}},{key:"componentDidUpdate",value:function(){var a=this;setTimeout(function(){$(ReactDOM.findDOMNode(a.refs.notebox)).removeClass("zn_fadeIn")},100)}},{key:"componentWillUnmount",value:function(){this.props.note.stopSubscriptions()}},{key:"handleOnClose",value:function(){this.props.note.closeNote(),$.publish("stickyNoteMod")}},{key:"setDescriptionHeight",value:function(a){this.height=a}},{key:"getDescriptionHeight",value:function(){return this.height}},{key:"viewNote",value:function(){if(""===this.props.openedNote()){var a,b,c,d,e,f,g=this;this.props.handleOnOpenNote(this.props.note.get("id"));var h=$.extend(!0,{},this),i={};i.clientX=$(ReactDOM.findDOMNode(h.refs.notebox)).offset().left,i.clientY=$(ReactDOM.findDOMNode(h.refs.notebox)).offset().top,zNote.getNoteDetails({namespaceId:this.props.note.get("namespaceId"),id:this.props.note.get("id")}).done(function(j){if(g.props.handleOnOpenNote(""),0!==j[0]){var k=j[1],l="",m=$('<div id="nmask" class="SC_Pop tra SC_cent"style="pointer-events:auto"><div class="SCmb puClose nPuClose" ><ul><li id="npopin" title="'+zNote.notei18n.note.openTab+'" class="'+l+'"><b><span class="SC_ttip ttr"><i class="msi-popin"></i></span></b></li><li id="nclose"><b><span class="SC_ttip ttr"><i class="msi-close"></i></span></b></li></ul></div><div class="SC_pe"><div class="SC_peCen" id="noteBox"></div></div></div>'),n=$('<div id="colorMask" style="z-index:101" class="SC_Pop tra">');$("body").append(n),$("body").append(m);var o=$(m).innerHeight()-50,p=$(m).innerWidth()-50,q=new zNote.Models.previewNote(k),r=function x(){g.props.handleOnOpenNote(""),m.remove(),n.remove(),zNote.eventBus.off("removeMask",x,g),$(ReactDOM.findDOMNode(h.refs.notebox)).show(),zmUtil.hideMenu(),zNote.dropKeyBoardShortcuts()},s=function(f){$.unsubscribe("zm/closeAllOpenDialog",d),a=f?f.top:i.clientY,b=f?f.left:i.clientX,g.props.handleOnOpenNote(""),n.removeClass("blk").addClass("tra"),m.find(".SC_mkStky").addClass("SC_dyn"),m.find(".SCS_post").hide(),m.find(".zn_popNote").removeClass("zn_popNote");var j=$(ReactDOM.findDOMNode(c.refs.notebox)),k=j.offset(),l=j.width();j[0].style.position="fixed",j[0].style.bottom="auto",j[0].style.width=l+"px",j[0].style.top=k.top+"px",j[0].style.left=k.left+"px",$(ReactDOM.findDOMNode(c.refs.notebox)).animate({top:a+"px",left:b+"px",height:"UNMOUNTED"!==h.refs.notebox._lifeCycleState?$(ReactDOM.findDOMNode(h.refs.notebox)).height():0,width:"UNMOUNTED"!==h.refs.notebox._lifeCycleState?$(ReactDOM.findDOMNode(h.refs.notebox)).width():0},{complete:function(){"UNMOUNTED"!==h.refs.notebox._lifeCycleState&&$(ReactDOM.findDOMNode(h.refs.notebox)).show(),zmStreamsApp.util.detachAndRemove(m.find(".SC_ScrollY")).always(function(){ReactDOM.unmountComponentAtNode($(ReactDOM.findDOMNode(c.refs.notebox)).parent()[0]),m.remove(),n.remove(),$.unsubscribe("/note/delete",e)})},always:function(){$.publish("zm/framework/dialogClosed")}}),zNote.dropKeyBoardShortcuts(),zNote.eventBus.off("removeMask",r,g),zmUtil.hideMenu()};m.find("#npopin").on("click",function(){s(),zNote.openNoteInTab({namespaceId:g.props.note.get("namespaceId"),id:g.props.note.get("id")})}),m.find("#nclose").on("click",function(){s()}),d=function(a,b){s(b)},e=function(a,b,c){b===q.get("notes").id&&c===q.get("gnrl").group.id&&s()},f=function(){var a=o-($(ReactDOM.findDOMNode(c.refs.notebox)).outerHeight(!0)-$(ReactDOM.findDOMNode(c.refs.desc.refs.content)).height());c.refs.desc.updateHeight({height:a})},$.subscribe("zm/closeAllOpenDialog",d),$.subscribe("/note/delete",e);var t={};t.componentUpdated=function(a,b){f()},c=ReactDOM.render(React.createElement(zNote.Views.NotePreview,{note:q,options:t,removeNotePreview:s}),m.find("#noteBox")[0]),zNote.eventBus.on("removeMask",r,g),ReactDOM.findDOMNode(c.refs.notebox).style.left="-4000px";var u=$('<div class=""><div class=""><div class="SC_ScrollY"></div></div></div>'),v={by:k.gnrl.by,id:k.notes.id,etype:2,groupId:k.gnrl.group.id,showinvite:k.myact.showinvite,lockInvites:k.gnrl.lockInvites,like:k.myact.like,invitee:parseInt(k.act.invitees),inviteeList:k.myact.inviteeList,likes:parseInt(k.act.likes)};k.gnrl.group.isGroup?v.actionType="viewGroupEntity":v.actionType="viewSelfData",zmUtil.requireStreamsApp().done(function(){zmStreamsApp.PostApp.singlePost({elm:u.find(".SC_ScrollY"),viewPost:!0,fixedComment:!1,isPreview:!1,response:k,hideContent:!0})}),m.find(".SC_pe").css("max-height",o),m.find(".SC_pe").css("min-width",p-200),m.find(".SC_pe").css("max-width",p-200),ReactDOM.findDOMNode(c.refs.notebox).style.left="0px",m[0].style.left=i.clientX+"px",m[0].style.top=i.clientY+"px",u.find(".SC_ScrollY").css("max-height",o),m.find("#noteBox").append(u);var w=o-($(ReactDOM.findDOMNode(c.refs.notebox)).outerHeight(!0)-$(ReactDOM.findDOMNode(c.refs.desc.refs.content)).height());c.refs.desc.setContentHeight({height:w}),n.removeClass("tra").addClass("blk"),m.animate({top:0,left:0},{complete:function(){"UNMOUNTED"!==h.refs.notebox._lifeCycleState&&$(ReactDOM.findDOMNode(h.refs.notebox)).hide(),zNote.setKeyBoardShortcuts({esc:s}),zmHash.setHash("notes",["preview",g.props.note.get("namespaceId"),g.props.note.get("id")])}})}}).fail(function(){g.props.handleOnOpenNote("")})}}},{key:"handleOnMinimize",value:function(){var a=this;this.left=$(ReactDOM.findDOMNode(this.refs.notebox)).offset().left,this.top=$(ReactDOM.findDOMNode(this.refs.notebox)).offset().top;var b=$(".SC_exp").find(".msi-stickyNotes").offset().left,c=$(".SC_exp").find(".msi-stickyNotes").offset().top,d=$(ReactDOM.findDOMNode(this.refs.notebox)).outerHeight(!0),e=$(ReactDOM.findDOMNode(this.refs.notebox)).outerWidth(!0),f=$(ReactDOM.findDOMNode(this.refs.notebox)).width();$(ReactDOM.findDOMNode(this.refs.notebox)).animate({left:b-16,top:c-20,height:0,width:0},{complete:function(){ReactDOM.findDOMNode(a.refs.notebox).style.top=a.top+"px",ReactDOM.findDOMNode(a.refs.notebox).style.left=a.left+"px",$(ReactDOM.findDOMNode(a.refs.notebox)).outerHeight(d),$(ReactDOM.findDOMNode(a.refs.notebox)).outerWidth(e),$(ReactDOM.findDOMNode(a.refs.notebox)).css("height",""),$(ReactDOM.findDOMNode(a.refs.notebox)).width(f),a.props.note.showNote(!1)},duration:700})}},{key:"handleMouseUp",value:function(){this.selection=zNote.getSelectedTextWithin(ReactDOM.findDOMNode(this.refs.notebox))}},{key:"handleOpenNote",value:function(){var a=this,b=_.debounce(function(){a.viewNote(a)},1e3,{leading:!0});this.selection=zNote.getSelectedTextWithin(ReactDOM.findDOMNode(this.refs.notebox)),this.selection.length||this.props.extraOptions&&this.props.extraOptions.stickyNote&&this.props.extraOptions||b()}},{key:"handlePopOutNote",value:function(a){a.stopPropagation();var b=this,c=_.debounce(function(){b.viewNote(b)},1e3,{leading:!0});c()}},{key:"render",value:function(){var m,n,o,p,q=this.props.extraOptions&&this.props.extraOptions.stickyNote?"zn_note zn_stickyNote "+zNote.CONSTANTS.COLORCODE[this.props.note.get("color")]:"zn_note cursorPointer "+zNote.CONSTANTS.COLORCODE[this.props.note.get("color")];this.props.note.get("showStickyNote")===!1&&(q+=" SC_dyn");var r={left:"-1000",width:"276"};return this.props.extraOptions&&this.props.extraOptions.stickyNote&&(p="new"===this.props.note.get("type")?"SC_dyn":"",this.props.note.get("showStickyNote")===!0&&"add"===this.props.note.get("type")&&(q+=" zn_fadeIn"),n=React.createElement("div",{className:"cursorMove",ref:"dragband",title:zNote.notei18n.holdanddrag}),m=React.createElement("div",{className:"SCmb SC_frt"},React.createElement("li",{className:p,onClick:this.handlePopOutNote},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-popout"})))),React.createElement("li",{onClick:this.handleOnMinimize},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-minus"})))),React.createElement("li",{onClick:this.handleOnClose},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-close"}))))),void 0!==this.props.note.get("top")&&(this.top=this.props.note.get("top"),this.props.note.set({top:void 0},{silent:!0})),void 0!==this.props.note.get("left")&&(this.left=this.props.note.get("left"),this.props.note.set({left:void 0},{silent:!0})),void 0!==this.left&&void 0!==this.top&&void 0!==this.props.note.get("zIndex")||(o=this.props.getAvailableTopLeft()),void 0!==this.props.note.get("width")?this.width=this.props.note.get("width"):(this.width=276,this.props.note.set({width:"276"},{silent:!0})),void 0===this.props.note.get("zIndex")&&this.props.note.set({zIndex:o.zIndex},{silent:!0}),this.left=void 0!==this.left?this.left:o.left,this.top=void 0!==this.top?this.top:o.top,this.props.note.set({left:this.left},{silent:!0}),this.props.note.set({top:this.top},{silent:!0}),r.left=this.left,r.top=this.top,r.width=this.width,r.zIndex=this.props.note.get("zIndex")),React.createElement("div",{className:q,onMouseUp:this.handleMouseUp,onClick:this.handleOpenNote,ref:"notebox",style:r},n,React.createElement("div",{className:"zn_dd"},m,React.createElement(a,{note:this.props.note}),React.createElement("span",{className:"zn_date"},this.props.note.get("disptime"))),React.createElement("div",null,React.createElement(j,{note:this.props.note,extraOptions:this.props.extraOptions,parent:this}),React.createElement(i,{note:this.props.note,print:this.props.print,parent:this,viewNote:this.viewNote,extraOptions:this.props.extraOptions,mountingElem:this.props.mountingElem,ref:"desc"})),React.createElement("div",{className:"zn_act zn_clear"},React.createElement("div",{className:"SCmb"},React.createElement("div",{className:"SC_flt"},React.createElement("ul",null,React.createElement(b,{note:this.props.note}),React.createElement(e,{note:this.props.note,parent:this}),React.createElement(c,{note:this.props.note}),React.createElement(k,{ref:"showmore",note:this.props.note,extraOptions:this.props.extraOptions,parent:this}))),React.createElement("div",{className:"SC_frt"},React.createElement("ul",null,React.createElement(g,{note:this.props.note,parent:this}),React.createElement(f,{note:this.props.note,parent:this}))))),React.createElement("div",{id:"grpDiv",className:"zn_folder zn_clear"},function(a){return React.createElement(d,{note:a.props.note,parent:a,ref:"tag"})}(this),React.createElement(h,{note:this.props.note,extraOptions:this.props.extraOptions})),function(a){return React.createElement(l,{ref:"attDiv",note:a.props.note})}(this))}}]),n}(React.Component);var a=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return _inherits(b,a),_createClass(b,[{key:"componentDidMount",value:function(){var a=this;zmail.ContactBook.get({zuid:a.props.note.get("ownerZUID")}).done(function(b){var c=b[0];c&&c.attrs&&c.attrs.fn&&(zmComponent.tooltip({elm:$(ReactDOM.findDOMNode(a.refs.creator))[0],text:c.attrs.fn,arrow:"top"}),$(ReactDOM.findDOMNode(a.refs.creator)).append(c.avatar()))})}},{key:"render",value:function(){return React.createElement("span",{ref:"creator"})}}]),b}(React.Component),b=function(a){function b(a,c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.handleSetFavourite=d.handleSetFavourite.bind(d),d}return _inherits(b,a),_createClass(b,[{key:"componentDidMount",value:function(){zmComponent.tooltip({elm:this.refs.star,text:zNote.notei18n.tooltips.changeFavourite,arrow:"top"})}},{key:"handleSetFavourite",value:function(a){a.stopPropagation(),this.props.note.saveFavourite()}},{key:"render",value:function(){if("new"===this.props.note.get("type"))return null;var a=this.props.note.get("starred")?"SC_fav":"";return React.createElement("li",{id:"znfav",ref:"star",onClick:this.handleSetFavourite,className:a},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-fav"}))))}}]),b}(React.Component),c=function(a){function b(a,c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.handleArchive=d.handleArchive.bind(d),d}return _inherits(b,a),_createClass(b,[{key:"componentDidMount",value:function(){var a=this.props.note.get("archived")?zNote.notei18n.note.unarchive:zNote.notei18n.note.archive;zmComponent.tooltip({elm:this.refs.archive,text:a,arrow:"top"})}},{key:"componentDidUpdate",value:function(){var a=this.props.note.get("archived")?zNote.notei18n.note.unarchive:zNote.notei18n.note.archive;zmComponent.tooltip({elm:this.refs.archive,text:a,arrow:"top"})}},{key:"handleArchive",value:function(a){a.stopPropagation();var b=!this.props.note.get("archived");this.props.note.archiveOrUnarchiveNote({archived:b})}},{key:"render",value:function(){var a=this.props.note.get("archived")?"msi-unarchive":"msi-archive",b=!1;return!znBox.checkForGroupDisabled({groupId:this.props.note.get("namespaceId")})&&(this.props.note.get("ownerZUID")===zmail.zuid||zmCont.getGroup()[this.props.note.get("namespaceId")]&&zmCont.getGroup()[this.props.note.get("namespaceId")].isOwner)&&(b=!0),znBox.isArchiveOpen()&&b&&"new"!==this.props.note.get("type")?React.createElement("li",{id:"znArchive",ref:"archive",onClick:this.handleArchive},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:a})))):null}}]),b}(React.Component),d=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return _inherits(b,a),_createClass(b,[{key:"componentDidMount",value:function(){var a=this.refs.labelicon||this.refs.plus;zmComponent.tooltip({elm:a,text:zNote.notei18n.note.addTag,arrow:"top"})}},{key:"addLabel",value:function(a,b){a.stopPropagation();var c,d=this,e={};e.parentDOM=this.refs.plus?ReactDOM.findDOMNode(this.refs.plus):b,e.displayAs="popup",e.labelState={labelList:this.props.note.get("tagId")},e.showCreate=!0,e.accType="default",e.onHide=function(){$("#zm_dropDown").remove()},e.onCreate=function(a,b){znNote.sendNewLabReq(a,b).done(function(a){a&&1===a[0]&&a[1].labelId&&(c.hide(),d.props.note.addTag(a[1].labelId))})},e.onStateChange=function(a,b){b?d.props.note.addTag(a):d.props.note.removeTag(a)},c=zmUtil.createFLComp("label",e),c.show()}},{key:"render",value:function(){if("new"===this.props.note.get("type"))return null;var a,b={backgroundColor:""},c=this,d=function(b){return function(d){b&&(a=$(ReactDOM.findDOMNode(c.refs.labelicon))[0]),c.addLabel(d,a)}};return c.props.note.get("tagId")&&c.props.note.get("tagId").length>0?React.createElement("div",{className:"zm_lbl"},c.props.note.get("tagId").map(function(a){return!!zmUtil.getTagList("default")[a]&&(b={backgroundColor:zmUtil.getTagList("default")[a].color},React.createElement("p",{"data-mid":"",title:zmUtil.getTagList("default")[a].label,onClick:d(),className:"zmAttLbl"},React.createElement("font",{style:b})))}),React.createElement("i",{className:"msi-plus",ref:"plus",onClick:d()})):React.createElement("div",{className:"zm_lbl"},React.createElement("i",{className:"msi-label",ref:"labelicon",onClick:d(!0)}))}}]),b}(React.Component),e=function(a){function b(a,c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.handleSetColor=d.handleSetColor.bind(d),d.handleSetAttributes=d.handleSetAttributes.bind(d),d}return _inherits(b,a),_createClass(b,[{key:"componentDidMount",value:function(){zmComponent.tooltip({elm:this.refs.palette,text:zNote.notei18n.tooltips.changeColor,arrow:"top"})}},{key:"handleSetColor",value:function(a){a.stopPropagation();var b=this;if("true"===$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-visible")){var c=$('<li><div class="zn_clr"><div class="zn_clr1"></div><div class="zn_clr2"></div><div class="zn_clr3"></div><div class="zn_clr4"></div></div></li>');c.find("."+zNote.CONSTANTS.COLORCODE[this.props.note.get("color")]).append("<i class=msi-tick></i>");var d={par:a.target,showArrow:!0,liDom:c,direction:"bottom",ulClass:"zn_clrSel",spanClass:"minwid"};zmsuite.showMenu(d),$(c[0]).find("div").children("div").off("click").on("click",function(a){a.stopPropagation(),$("#zm_dropDown").remove(),$(ReactDOM.findDOMNode(b.refs.palette)).attr("data-visible","false"),b.props.note.saveColor(zNote.CONSTANTS.COLOR[this.className])})}$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-current","false"),$(ReactDOM.findDOMNode(this.props.parent.refs.notebox)).addClass("sel")}},{key:"handleSetAttributes",value:function(){$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-current","true"),"true"===$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-visible")?$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-visible","false"):$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-visible","true")}},{key:"render",value:function(){var a=!0;(znBox.checkForGroupDisabled({groupId:this.props.note.get("namespaceId")})||this.props.note.get("ownerZUID")!==zmail.zuid)&&(a=!1);var b=a?"":"SC_dyn";return React.createElement("li",{id:"zncolor",className:b,ref:"palette",onMouseDown:this.handleSetAttributes,onClick:this.handleSetColor},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-nclr"}))))}}]),b}(React.Component),f=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return _inherits(b,a),_createClass(b,[{key:"render",value:function(){return this.props.note.get("commentCount")&&0!==this.props.note.get("commentCount")?React.createElement("li",{className:"zn_actVIcon",title:zNote.notei18n.info.commentsavailable},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-lcmnt"}),React.createElement("span",null,this.props.note.get("commentCount"))))):null}}]),b}(React.Component),g=function(a){function b(a,c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.handleViewAssociatedMail=d.handleViewAssociatedMail.bind(d),d}return _inherits(b,a),_createClass(b,[{key:"componentDidMount",value:function(){zmComponent.tooltip({elm:this.refs.mailopen,text:zNote.notei18n.tooltips.openmail,arrow:"top"})}},{key:"handleViewAssociatedMail",value:function(a){a.stopPropagation();var b={};this.props.note.get("email").accid!==zmail.accId&&(b={actionType:"viewGroupMailEntity",entityId:this.props.note.get("email").msgid,entityType:"1",streamsView:"true",streams:!0,groupId:this.props.note.get("ownerZUID"),accId:this.props.note.get("email").accid}),zmList.getMailData({msgId:this.props.note.get("email").msgid,opentype:2,type:"lt",src:"external",eprm:b})}},{key:"render",value:function(){var a=this.props.note.get("email")&&!$.isEmptyObject(this.props.note.get("email"))?"zn_actVIcon":"zn_actVIcon SC_dyn";return React.createElement("li",{id:"znmail",className:a,ref:"mailopen",onClick:this.handleViewAssociatedMail},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-mailopen"}))))}}]),b}(React.Component),h=function(a){function b(a,c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.handleChangeBook=d.handleChangeBook.bind(d),d.handleChangeGroup=d.handleChangeGroup.bind(d),d}return _inherits(b,a),_createClass(b,[{key:"componentDidMount",value:function(){this.props.note.get("ownerZUID")===zmail.zuid&&zmComponent.tooltip({elm:this.refs.book,text:zNote.notei18n.tooltips.moveNote,arrow:"top"})}},{key:"handleChangeGroup",value:function(a){if(this.props.note.get("ownerZUID")===zmail.zuid&&_zm._isPrivilegedUser()&&this.props.extraOptions&&this.props.extraOptions.stickyNote){var b;a.stopPropagation();var c=znBox.getGroupArray(),d=this,e={};e.parentDOM=ReactDOM.findDOMNode(this.refs.group),e.displayAs="popup",e.showCreate=!0,e.onSelect=function(a){d.props.note.changeGroup(a),b.hide()},e.onHide=function(){$("#zm_dropDown").remove()},e.dataCallback=function(){return c},b=zmUtil.createFLComp("group",e),b.show()}}},{key:"handleChangeBook",value:function(a){var b=!0;if((znBox.checkForGroupDisabled({groupId:this.props.note.get("namespaceId")})||this.props.note.get("ownerZUID")!==zmail.zuid)&&(b=!1),b){a.stopPropagation();var c,d=znBox.getCategoryArray(this.props.note.get("namespaceId")),e=this,f={};f.parentDOM=ReactDOM.findDOMNode(this.refs.book),f.displayAs="popup",f.onSelect=function(a){e.props.note.changeBook(a),c.hide()},(this.props.note.get("namespaceId")===zmail.zuid||zmCont.getGroup()[this.props.note.get("namespaceId")]&&zmCont.getGroup()[this.props.note.get("namespaceId")].isOwner)&&(f.onCreate=function(a){znNote.sendNewCatReq(a,{},e.props.note.get("namespaceId")).done(function(a){e.props.note.changeBook(a[1][0].catId),c.hide()})}),f.onHide=function(){$("#zm_dropDown").remove()},f.dataCallback=function(){return d},c=zmUtil.createFLComp("category",f),c.show()}}},{key:"render",value:function(){var a=znBox.getGroupName(this.props.note.get("namespaceId")),b=zNote.getNamefrmCatObj(this.props.note.get("cat"),this.props.note.get("namespaceId")),c=""===a?"zn_cgy SC_dyn":"zn_cgy";return React.createElement("div",{className:c,ref:"cgy",id:"zncat"},React.createElement("font",{id:"zngroup",ref:"group",className:"zn_ngrp",onClick:this.handleChangeGroup},a),React.createElement("i",{className:"msi-rarrow"}),React.createElement("font",{id:"znscat",ref:"book",className:"zn_nbook",onClick:this.handleChangeBook},b))}}]),b}(React.Component),i=function(a){function b(a,c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c)),e=!1;return d.props.note.get("desc")&&d.props.note.get("desc").length>=255&&!d.props.print&&(e=!0),d.ispaste=!1,d.showEditor=znBox.isRichTextOpen(),d.state={height:0,readmore:e},d.handlePaste=d.handlePaste.bind(d),d.handleSaveSelection=d.handleSaveSelection.bind(d),d.handleSetDescription=d.handleSetDescription.bind(d),d.handleSetHeight=d.handleSetHeight.bind(d),d.handleOpenNote=d.handleOpenNote.bind(d),d}return _inherits(b,a),_createClass(b,[{key:"componentDidMount",value:function(){var a,b=$(ReactDOM.findDOMNode(this.refs.content));this.props.extraOptions&&this.props.extraOptions.stickyNote&&(b.css({"max-height":"300px","overflow-y":"auto","overflow-x":"hidden"}),b.on("mousedown",function(a){a.stopPropagation()}),"new"===this.props.note.get("type")&&b.focus()),void 0===this.props.note.get("height")||null===this.props.note.get("height")||isNaN(parseInt(this.props.note.get("height")))?0!==b.height()&&(a=b.height()>200?200:b.height(),this.setState({height:a}),this.props.note.set({height:a},{silent:!0})):(this.setState({height:this.props.note.get("height")}),b.css("height",this.props.note.get("height")+"px"),b.css({"max-height":"500px"})),b.on("click","a",function(a){a.preventDefault()})}},{key:"handleOpenNote",value:function(a){a.stopPropagation();var b=this,c=_.debounce(function(){b.props.viewNote(b.props.parent)},1e3,{leading:!0});c()}},{key:"componentWillReceiveProps",value:function(){this.props.note.get("desc")&&this.props.note.get("desc").length>=255?this.setState({
readmore:!0}):this.setState({readmore:!1})}},{key:"handleSetDescription",value:function(a){var b=this.showEditor;this.ispaste===!1&&(b?this.props.note.saveDescription($(ReactDOM.findDOMNode(this.refs.content)).html()):this.props.note.saveDescription(znBox.domParser(znBox.getContentEditableText($(ReactDOM.findDOMNode(this.refs.content))))))}},{key:"setImage",value:function(a){var b=this.selection;$(ReactDOM.findDOMNode(this.refs.content)).trigger("focus",!0,!0);var c=Object.keys(a[0].inline[0])[0],d=zmail.conPath+"/FileDownload?attachId="+a[0].inline[0][c].Id+"&entityType=2&entityId="+this.props.note.get("id")+"&actionType=viewGroupEntity&groupId="+this.props.note.get("namespaceId")+"&streamsView=Notes&mode=view&app=notes&attachType=inline",e=znBox.restoreSelectionNew(ReactDOM.findDOMNode(this.refs.content),b);e||$(ReactDOM.findDOMNode(this.refs.content)).trigger("focus"),znBox.isIE?znBox.insertHtmlAtCaret("<img id="+a[0].inline[0][c].Id+" src="+d+"></img>"):document.execCommand("insertHTML",!1,"<img id="+a[0].inline[0][c].Id+" src="+d+"></img>")}},{key:"handleSetHeight",value:function(){this.selection=znBox.saveSelectionNew(ReactDOM.findDOMNode(this.refs.content)),this.state.height!==$(ReactDOM.findDOMNode(this.refs.content)).height()&&this.setState({height:$(ReactDOM.findDOMNode(this.refs.content)).height()})}},{key:"handleSaveSelection",value:function(a,b,c){c||(this.selection=znBox.saveSelectionNew(ReactDOM.findDOMNode(this.refs.content)))}},{key:"restoreSelection",value:function(){znBox.restoreSelectionNew(ReactDOM.findDOMNode(this.refs.content),this.selection)}},{key:"handlePaste",value:function(a){var b=this;this.ispaste=!0,znBox.handlePaste(a.target),setTimeout(function(){b.ispaste=!1},200)}},{key:"fillSummary",value:function(){this.setState({readmore:!1})}},{key:"clickHandler",value:function(a){if("IMG"===a.target.nodeName){var b=a.target.src,c=[],d={attObj:{ft:101,fn:" "},src:b};c.push(d),zmUtil.initAttSlideShow(c,0,!0)}else this.saveSelection(a)}},{key:"render",value:function(){var a,b,c="",d=zNote.notei18n.placeholder.writeSome,e=Boolean(this.props.extraOptions&&this.props.extraOptions.stickyNote);"new"===this.props.note.get("type")||!znBox.checkForGroupDisabled({groupId:this.props.note.get("namespaceId")})&&this.props.note.get("ownerZUID")===zmail.zuid||(e=!1);var f=this.showEditor;return b=f?this.props.note.get("desc")?this.props.note.get("desc").replace(/\n/g,"<br />"):"":this.props.note.get("desc")?this.props.note.get("desc").replace(/\n/g,"<br />"):"",c=this.state.readmore&&!e?React.createElement("div",null,React.createElement("div",{className:"zn_cont zn_trunc",ref:"content","data-plhr":d,contentEditable:e,onPaste:this.handlePaste,onFocus:this.handleSaveSelection,onKeyUp:this.handleSetHeight,onBlur:this.handleSetDescription,dangerouslySetInnerHTML:{__html:b}}),React.createElement("div",{className:"SC_lnk",onClick:this.handleOpenNote},"Read More ...")):React.createElement("div",null,React.createElement("div",{className:"zn_cont",ref:"content","data-plhr":d,contentEditable:e,onPaste:this.handlePaste,onFocus:this.handleSaveSelection,onKeyUp:this.handleSetHeight,onBlur:this.handleSetDescription,dangerouslySetInnerHTML:{__html:b}}),React.createElement("div",{className:"SC_lnk SC_dyn"},"Read More ...")),this.props.extraOptions&&this.props.extraOptions.stickyNote&&(a=React.createElement("div",{className:"sticky_resizable",title:zNote.notei18n.tooltips.resize},React.createElement("div",{className:"ui-resizable-handle ui-resizable-e"}),React.createElement("div",{className:"ui-resizable-handle ui-resizable-s"}),React.createElement("div",{className:"ui-resizable-handle ui-resizable-se"}))),React.createElement("div",{className:"zn_base"},c,a)}}]),b}(React.Component),j=function(a){function b(a,c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.handleSetTitle=d.handleSetTitle.bind(d),d.handleKeyDown=d.handleKeyDown.bind(d),d}return _inherits(b,a),_createClass(b,[{key:"componentDidMount",value:function(){this.props.extraOptions&&this.props.extraOptions.stickyNote&&$(ReactDOM.findDOMNode(this.refs.title)).on("mousedown",function(a){a.stopPropagation()})}},{key:"handleSetTitle",value:function(a){a.target.textContent.trim().length||$(ReactDOM.findDOMNode(this.refs.title)).text(""),this.props.note.saveTitle(a.target.textContent)}},{key:"handleKeyDown",value:function(a){13===a.keyCode&&(a.preventDefault(),ReactDOM.findDOMNode(this.props.parent.refs.desc.refs.content).focus())}},{key:"render",value:function(){var a=zNote.notei18n.placeholder.title,b=Boolean(this.props.extraOptions&&this.props.extraOptions.stickyNote);"new"===this.props.note.get("type")||!znBox.checkForGroupDisabled({groupId:this.props.note.get("namespaceId")})&&this.props.note.get("ownerZUID")===zmail.zuid||(b=!1);var c=this.props.note.get("title")&&this.props.note.get("title")!==znBox.CONTS.defaultTitle?znBox.spCharRep(this.props.note.get("title")):"";return React.createElement("div",{className:"zn_tit",contentEditable:b,ref:"title",onBlur:this.handleSetTitle,onKeyDown:this.handleKeyDown,"data-plhr":a},c)}}]),b}(React.Component),k=function(a){function b(a,c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.showMoreOptions=d.showMoreOptions.bind(d),d.setAttributes=d.setAttributes.bind(d),d}return _inherits(b,a),_createClass(b,[{key:"componentDidMount",value:function(){zmComponent.tooltip({elm:this.refs.showmoreicon,text:zNote.notei18n.tooltips.moreOptions,arrow:"top"})}},{key:"popupClick",value:function(a){znBox.hideMenu();var b={},c=this;switch(a.action){case"addAttach":this.addAttachment();break;case"stickyNote":zNote.addAsStickyNote(this.props.note.toJSON());break;case"addTag":this.props.parent.refs.tag.addLabel(ReactDOM.findDOMNode(this.props.parent.refs.showmore));break;case"sendMail":this.props.note.sendAsMail();break;case"delNote":b.onOk=function(){c.props.note.deleteNote(c.props.note.get("id"))},b.stopPropagation=!0,zmsDialog.confirm(zNote.notei18n.confirmMsg.delNote,b);break;case"copyNote":znBox.copyNote({title:this.props.note.get("title"),catId:this.props.note.get("cat"),namespaceId:this.props.note.get("namespaceId"),attachments:!0},this.props.note.postAsNew.bind(this.props.note));break;case"print":zNote.printNote({id:this.props.note.get("id"),namespaceId:this.props.note.get("namespaceId")});break;case"openintab":zNote.openNoteInTab({id:this.props.note.get("id"),namespaceId:this.props.note.get("namespaceId")})}}},{key:"addAttachment",value:function(){var a=this;if(a.attRefObj)a.attRefObj.init();else{var b={componentId:"notes",isNewImp:!0,attachFrom:["desktop","myAttachchment","zDocs","otherCloud"],currentAttachedSize:0,eleId:$(ReactDOM.findDOMNode(a.props.parent.refs.attDiv)),onAllUploadFinish:{handler:function(b){a.props.note.saveAttachment(b)},resetData:!0,removeAttachDOM:!0}};zmUtil.initAttachComponent(b,function(b){a.attRefObj=b})}}},{key:"setAttributes",value:function(){$(ReactDOM.findDOMNode(this.refs.showmoreicon)).attr("data-current","true"),"true"===$(ReactDOM.findDOMNode(this.refs.showmoreicon)).attr("data-visible")?$(ReactDOM.findDOMNode(this.refs.showmoreicon)).attr("data-visible","false"):$(ReactDOM.findDOMNode(this.refs.showmoreicon)).attr("data-visible","true")}},{key:"showMoreOptions",value:function(a){a.stopPropagation();var b=this,c={},d=[];if(c.addAttach={htm:zNote.notei18n.note.addAttach,data:{action:"addAttach"}},c.sendMail={htm:zNote.notei18n.note.sendMail,data:{action:"sendMail"}},c.makeSticky={htm:zNote.notei18n.note.makeSticky,data:{action:"stickyNote"}},c.printNote={htm:zNote.notei18n.note.printNote,data:{action:"print"}},c.openInTab={htm:zNote.notei18n.note.openTab,data:{action:"openintab"}},c.copyNote={htm:zNote.notei18n.note.copyNote,data:{action:"copyNote"}},c.delNote={htm:zNote.notei18n.note.delNote,data:{action:"delNote"}},c.separator={sep:!0},(znBox.checkForGroupDisabled({groupId:this.props.note.get("namespaceId")})||this.props.note.get("ownerZUID")!==zmail.zuid)&&(c.addAttach.state="disabled",c.addAttach.nohover=!0,(znBox.checkForGroupDisabled({groupId:this.props.note.get("namespaceId")})||!zmCont.getGroup()[this.props.note.get("namespaceId")]||zmCont.getGroup()[this.props.note.get("namespaceId")]&&!zmCont.getGroup()[this.props.note.get("namespaceId")].isOwner)&&(c.delNote.state="disabled",c.delNote.nohover=!0)),"disabled"!==c.addAttach.state&&d.push(c.addAttach),d.push(c.sendMail),d.push(c.openInTab),_zm._isPrivilegedUser()&&d.push(c.copyNote),this.props.extraOptions&&this.props.extraOptions.stickyNote||d.push(c.makeSticky),d.push(c.printNote),"disabled"!==c.delNote.state&&(d=d.concat([c.separator,c.delNote])),"true"===$(ReactDOM.findDOMNode(this.refs.showmoreicon)).attr("data-visible")){var e={par:a.target,showArrow:!0,spanClass:"zn_popOver",list:d,direction:"bottom",clk:function(a,c){$(c).hasClass("SC_op3")||b.popupClick(a)}};zmsuite.showMenu(e),$(ReactDOM.findDOMNode(this.refs.showmoreicon)).attr("data-current","false"),$(ReactDOM.findDOMNode(this.props.parent.refs.notebox)).addClass("sel")}}},{key:"render",value:function(){var a=this;if("new"===this.props.note.get("type"))return null;var b=function(){return function(b){a.showMoreOptions(b)}},c=function(){return function(b){a.setAttributes(b)}};return React.createElement("li",{id:"znopt",ref:"showmoreicon",onClick:b(),onMouseDown:c()},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-nmore"}))))}}]),b}(React.Component),l=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return _inherits(b,a),_createClass(b,[{key:"viewImage",value:function(a,b,c){c.stopPropagation();var d=this,e=znNote.getAttSlideArray(this.props.note.get("attachments"),this.props.note.get("id"),this.props.note.get("namespaceId")),f={},g={},h=[];g.trash={"class":"msi-trash",title:zNote.notei18n.tooltips.deleteAttach,after:".msi-download",events:[{name:"click",listener:function(a,b,c){d.props.note.delAtt(b.e,b.Id,c)}}]},h.push("#etyIcon"),f.extraIcons=g,f.hideOptions=h,zmUtil.initAttSlideShow(e,b,!1,f)}},{key:"render",value:function(){var a,b,c=this;if(!this.props.note.get("attachments")||!this.props.note.get("attachments").length)return React.createElement("div",{ref:"attach",className:"zn_clear zn_attach SC_dyn"},React.createElement("div",{className:"icn"},React.createElement("i",{className:"msi-attachpin"})));var d=function(a,b){return function(d){c.viewImage(a,b,d)}};return React.createElement("div",{className:"zn_folder zn_clear zn_attach"},React.createElement("div",{className:"icn"},React.createElement("i",{className:"msi-attachpin"})),this.props.note.get("attachments").map(function(e,f){var g=e[Object.keys(e)[0]],h=zmUtil.fileTyp(g.fn);if("msi-attimg"===h[1])a=c.props.note.get("namespaceId")===zmail.zuid?zmail.conPath+"/FileDownload?attachId="+g.Id+"&entityType=2&entityId="+c.props.note.get("id")+"&groupId="+c.props.note.get("namespaceId")+"&mode=thb&app=notes":zmail.conPath+"/FileDownload?attachId="+g.Id+"&entityType=2&entityId="+c.props.note.get("id")+"&groupId="+c.props.note.get("namespaceId")+"&streamsView=Notes&actionType=viewGroupEntity&mode=thb&app=notes",b=React.createElement("img",{src:a});else{var i=h[1]+" sc_big";b=React.createElement("i",{className:i})}return React.createElement("div",{className:"zmL zmAch",key:g.Id,title:g.fn,onClick:d(g,f)},React.createElement("div",{className:"zmLst"},React.createElement("div",{className:"zmDtl"},React.createElement("div",{className:"zmImg"},b))))}))}}]),b}(React.Component)}(),function(){zNote.Models=zNote.Models||{},zNote.Models.previewNote=Zmail.Model.extend({initialize:function(){zNote.eventBus.on("editNote",this.customEvent,this),this.debounceAddNote=_.debounce(this.addNote,1e3)},customEvent:function(a,b){var c,d,e,f,g,h,i,j=this;if(b.id===this.get("notes").id)if("title"===b.cattribute)c=j.get("cntnt"),c.title=znBox.revSpCharRep(b.p.title),j.set("cntnt",c),j.trigger("change");else if("category"===b.cattribute)c=j.get("notes"),c.catid=b.p.catId,j.set("notes",c),j.trigger("change");else if("color"===b.cattribute)c=j.get("notes"),c.color=b.p.color,j.set("notes",c),j.trigger("change");else if("desc"===b.cattribute)c=j.get("notes"),c.notecont=b.p.desc,j.set("notes",c),j.trigger("change");else if("archive"===b.cattribute)c=j.get("notes"),c.archived=b.p.archived,j.set("notes",c),j.trigger("change");else if("starred"===b.cattribute)c=j.get("myact"),c.starred=b.p.starred,j.set("myact",c),j.trigger("change");else if("addLabel"===b.cattribute)c=j.get("myact"),c.label=b.p,j.set("myact",c),j.trigger("change");else if("removeLabel"===b.cattribute)c=j.get("myact"),c.label=b.p,j.set("myact",c),j.trigger("change");else if("removeAttachment"===b.cattribute)d=j.get("attach").slice(),$.each(d,function(a,c){if(c.id===b.p.attachId)return d.splice(a,1),!1}),j.set("attach",d),j.trigger("change");else if("addAttachment"===b.cattribute){i=[],f=j.get("attach")?j.get("attach").slice():[];var k;_.each(b.p.attachments,function(a){k=_.keys(a)[0],g=a[k],e={id:g.Id,size:g.fs,name:g.fn,ft:g.ft,part:g.p},i.push(e)}),h=f.concat(i),j.set("attach",h),j.trigger("change")}},deleteNote:function(){var a=this,b={entityId:this.get("notes").id,mode:"delNote",groupId:this.get("namespaceId"),streamsView:"Notes",actionType:"delEntity",entityType:zNote.CONSTANTS.entityType},c=$.extend(!0,{},b);c.cat=this.get("cat"),Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:b,success:function(){$.publish("/note/delete",[a.get("id"),a.get("namespaceId")]),$.publish("note/updateCount",b)}})},saveTitle:function(a){var b,c,d=this;if(a=a||"",this.get("notes").id)this.get("notes").title!==a&&(0===a.trim().length&&(a=znBox.CONTS.defaultTitle),b={title:a,entityId:this.get("notes").id,mode:"editNTitle",groupId:this.get("gnrl").group.id,streamsView:"Notes",actionType:"changeEntity",entityType:"2"},Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:b,success:function(){zNote.eventBus.trigger("editNote",d,{id:b.entityId,cattribute:"title",p:b})}}));else{if(0===a.trim().length)return;b={title:a,color:0},c=this.get("cntnt"),c.title=a,this.set("cntnt",c),this.debounceAddNote(b)}},changeBook:function(a){var b=this,c=this.get("notes").catid,d={catId:a,entityId:this.get("notes").id,mode:"moveNote",groupId:this.get("gnrl").group.id,streamsView:"Notes",actionType:"changeEntity",entityType:"2"},e=$.extend(!0,{},d);if(e.pCatId=c,this.get("notes").id)Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:d,success:function(){zNote.eventBus.trigger("editNote",b,{id:d.entityId,cattribute:"category",p:d}),$.publish("note/updateCount",e)}});else{var f=this.get("notes");f.catid=a,this.set("notes",f),this.trigger("change")}},changeGroup:function(a){var b=this,c={toNamespace:a,entityId:this.get("notes").id,mode:"changeGroup",groupId:this.get("gnrl").group.id,streamsView:"Notes",actionType:"addEntity",entityType:zNote.CONSTANTS.entityType,deleteOriginal:!0},d=c;if(d.cat=b.get("notes").catid,this.get("notes").id)Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:c,success:function(a){var e=zNote.getNoteDataInListFormat(a[0].data);b.set(a[0].data),b.set("showstream",!0),$.publish("/note/delete",[c.entityId,c.groupId]),$.publish("note/updateCount",d),$.publish("/note/add",[e]),$.publish("note/updateCount",[{mode:"addNote",cat:e.cat,namespaceId:e.namespaceId}])}});else{var e=this.get("gnrl");e.group.id=a,this.set("gnrl",e);var f=znBox.getGeneralCatId(a),g=this.get("notes");g.catid=f,this.set("notes",g),this.trigger("change")}},archiveOrUnarchiveNote:function(a){var b=this,c=this.get("notes").catid,d=a.archived?"archive":"unarchive",e={mode:d,entityId:this.get("notes").id,groupId:this.get("gnrl").group.id},f=$.extend(!0,{},e);f.pCatId=c,f.archived="archive"===d,Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:e,success:function(){var a="archive"===d?zNote.notei18n.msg.noteArchived:zNote.notei18n.msg.noteUnarchived;_zm.succErrMsg("s",a),zNote.eventBus.trigger("editNote",b,{id:e.entityId,cattribute:"archive",p:f})}})},sendAsMail:function(){var a={},b=[],c=this;if(a.SUBJECT=this.get("notes").title,a.CONTENT=this.get("notes").notecont&&this.get("notes").notecont.replace(/\n/g,"<br/>")||this.get("cntnt").summary&&this.get("cntnt").summary.replace(/\n/g,"<br/>"),this.get("attach")&&this.get("attach").length){for(var d=this.get("attach").length,e=0;e<d;e++){var f=this.get("attach")[e];if(!f.inline){var g={gId:this.get("gnrl").group.id,Id:f.id,e:c.get("notes").id,et:2,fn:f.name,fs:f.size,p:f.part,ft:f.ft};b.push(g)}}a.NEWATT=b}zmUtil.compose(a,"",{entityType:"note"})},saveAttachment:function(a){var b,c=this,d=[],e=[],f={mode:"addAttach",entityId:this.get("notes").id,groupId:this.get("gnrl").group.id,attachname:d,attachstore:e,streamsView:"Notes",actionType:"addEntity",entityType:"2",attType:"attach"};if(a.tempLocation){for(var g=0;g<a.tempLocation.length;g++)d.push(a.tempLocation[g].fP),e.push(a.tempLocation[g].sN);f.attachname=d,f.attachstore=e}a.myAttachment&&(b=JSON.stringify(a.myAttachment),f.attEntObj=b),Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:f,success:function(a){zNote.eventBus.trigger("editNote",c,{id:f.entityId,cattribute:"addAttachment",p:a[0]})}})},addAttachment:function(a){zNote.eventBus.trigger("editNote",self,{id:this.get("notes").id,cattribute:"addAttachment",p:a[0]})},delAtt:function(a,b){$.publish("attachment/closeSlideshow");var c=this,d={mode:"delAttach",entityId:this.get("notes").id,groupId:this.get("gnrl").group.id,attachId:b,streamsView:"Notes",actionType:"delEntity",entityType:"2"};Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:d,success:function(){zNote.eventBus.trigger("editNote",c,{id:d.entityId,cattribute:"removeAttachment",p:d})}})},hideStream:function(){this.set("showstream",!1)},addNote:function(a){var b=this,c={desc:a.desc||this.get("notes").notecont,mode:"addNote",groupId:this.get("gnrl").group.id,entityType:zNote.CONSTANTS.entityType,streamsView:"Notes",actionType:"addEntity",catId:this.get("notes").catid,title:a.title||this.get("cntnt").title,color:a.color||this.get("notes").color};return Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:c,success:function(a){b.set(a[0].data),b.set("showstream",!0);var c=zNote.getNoteDataInListFormat(a[0].data);$.publish("/note/add",[c]),$.publish("/note/addNote",[a[0].data]),c.mode="addNote",$.publish("note/updateCount",[c])}})},saveDescription:function(a){var b,c,d=this;if(this.get("notes").id){if(this.get("notes").notecont!==a){if(0===a.trim().length)return void _zm.succErrMsg("e",zNote.notei18n.descempty);b={desc:a,entityId:this.get("notes").id,mode:"editNContent",groupId:this.get("gnrl").group.id,streamsView:"Notes",actionType:"changeEntity",entityType:"2"},znBox.isRichTextOpen()&&(b.isRichText="true"),Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:b,setSessionId:!0,success:function(){zNote.eventBus.trigger("editNote",d,{id:b.entityId,cattribute:"desc",p:b})}})}}else{if(0===a.trim().length)return;b={desc:a,color:0},c=this.get("notes"),c.notecont=a,this.set("notes",c),this.debounceAddNote(b)}},addTag:function(a){var b=this,c={tagId:a,entityId:this.get("notes").id,mode:"setTag",groupId:this.get("gnrl").group.id,streamsView:"Notes",actionType:"addLabel",entityType:"2"};Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:c,success:function(){var d=b.get("myact").label.slice();d.push(a),zNote.eventBus.trigger("editNote",b,{id:c.entityId,cattribute:"addLabel",p:d}),$.publish("note/editNote",[{mode:"addLabel",gid:b.get("gnrl").group.id,pid:c.entityId,labelId:a}])}})},removeTag:function(a){var b=this,c={tagId:a,entityId:this.get("notes").id,mode:"removeTag",groupId:this.get("gnrl").group.id,streamsView:"Notes",actionType:"addLabel",entityType:"2"};Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:c,success:function(){var d=b.get("myact").label.slice();d.splice(b.get("myact").label.indexOf(a),1),zNote.eventBus.trigger("editNote",b,{id:c.entityId,cattribute:"removeLabel",p:d}),$.publish("note/editNote",[{mode:"removeLabel",pid:c.entityId,gid:b.get("gnrl").group.id,labelId:a}])}})},saveColor:function(a){var b=this;if(this.get("notes").id){var c={color:a,entityId:this.get("notes").id,mode:"editNColor",groupId:this.get("gnrl").group.id,streamsView:"Notes",actionType:"changeEntity",entityType:"2"};Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:c,success:function(){zNote.eventBus.trigger("editNote",b,{id:c.entityId,cattribute:"color",p:c})}})}else{var d=this.get("notes");d.color=a,this.set("notes",d),this.trigger("change")}},saveFavourite:function(){var a=this,b=!this.get("myact").starred,c=b?"addLabel":"deleteLabel",d={starred:b,entityId:this.get("notes").id,mode:"editNFav",groupId:this.get("gnrl").group.id,streamsView:"Notes",actionType:c,entityType:"2"};Backbone.ajax({dataType:"json",url:zmail.conPath+"/NotesAction.do",data:d,success:function(){zNote.eventBus.trigger("editNote",a,{id:d.entityId,cattribute:"starred",p:d}),$.publish("note/editNote",[{mode:"changeFavourite",pid:d.entityId,gid:a.get("gnrl").group.id,starred:b}])}})}})}();var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();!function(){zNote.Views=zNote.Views||{},zNote.Views.NotePreview=function(j){function o(a,b){_classCallCheck(this,o);var c=_possibleConstructorReturn(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,a,b));return c.setEditorFocus=c.setEditorFocus.bind(c),c}return _inherits(o,j),_createClass(o,[{key:"componentDidMount",value:function(){this.props.note.on("change",function(){this.props.note.hasChanged("showstream")&&this.props.note.get("showstream")===!0&&this.props.removeStreamsBar(),this.forceUpdate()}.bind(this)),this.triggerRemoveNoteSubscription=this.triggerRemoveNote.bind(this),this.props.streamList!==!0&&(!this.props.options||this.props.options&&this.props.options.print!==!0)&&this.refs.attachment.setAttachmentConfig()}},{key:"triggerRemoveNote",value:function(a,b){this.props.note.get("notes").id===b&&this.removeNote()}},{key:"componentWillUnmount",value:function(){this.refs.editorBar&&ReactDOM.unmountComponentAtNode(this.refs.editorBar),zNote.eventBus.off("editNote",this.props.note.customEvent,this.props.note)}},{key:"removeNote",value:function(){var a={id:this.props.note.get("notes").id,namespaceId:this.props.note.get("gnrl").group.id};ReactDOM.unmountComponentAtNode($(ReactDOM.findDOMNode(this.refs.notebox)).parent()[0]),zNote.eventBus.trigger("removeMask",[a])}},{key:"stopEvents",value:function(a){zmUtil.stopEvents(a,!0)}},{key:"setEditorFocus",value:function(){znBox.isRichTextOpen()&&this.refs.desc.editor.squireInstance.focus()}},{key:"render",value:function(){var j=String("zn_note zn_popNote "+zNote.CONSTANTS.COLORCODE[this.props.note.get("notes").color]);return this.props.streamList?React.createElement("div",{className:j,ref:"notebox",id:this.props.note.get("notes").id},React.createElement("div",null,React.createElement(l,{note:this.props.note,streamList:this.props.streamList}),React.createElement(k,{note:this.props.note,ref:"desc",streamList:this.props.streamList}))):React.createElement("div",{className:j,ref:"notebox",id:this.props.note.get("notes").id},React.createElement(h,{note:this.props.note,showStreamsBar:this.props.showStreamsBar}),React.createElement(a,{note:this.props.note,options:this.props.options,removeNotePreview:this.props.removeNotePreview}),React.createElement("div",null,React.createElement(l,{note:this.props.note,options:this.props.options,setEditorFocus:this.setEditorFocus,ref:"title",parent:this}),React.createElement(k,{note:this.props.note,parent:this,options:this.props.options,ref:"desc"})),React.createElement("div",{className:"zn_act zn_clear"},React.createElement("div",{className:"SCmb"},React.createElement("div",{className:"SC_flt",ref:"iconBar"},React.createElement("ul",null,React.createElement(zNote.Views.NotePreview.FavouritePreview,{note:this.props.note,options:this.props.options}),React.createElement(g,{note:this.props.note,parent:this}),React.createElement(d,{note:this.props.note,options:this.props.options,ref:"attachment",parent:this}),React.createElement(b,{note:this.props.note,parent:this}),React.createElement(e,{note:this.props.note,removeNote:this.removeNote}),React.createElement(f,{note:this.props.note,options:this.props.options}),React.createElement(m,{note:this.props.note,options:this.props.options})),React.createElement("span",{ref:"editorBar"})),React.createElement("div",{className:"SC_frt"},React.createElement("ul",null,React.createElement(c,{note:this.props.note,removeNote:this.removeNote}))))),React.createElement(i,{note:this.props.note,removeNote:this.removeNote,options:this.props.options}),function(a){if(a.props.note.get("attach"))return React.createElement(n,{ref:"attDiv",note:a.props.note,options:a.props.options})}(this))}}]),o}(React.Component),zNote.Views.NotePreview.FavouritePreview=function(a){function b(a,c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.handleSetFavourite=d.handleSetFavourite.bind(d),d}return _inherits(b,a),_createClass(b,[{key:"componentDidMount",value:function(){zmComponent.tooltip({elm:this.refs.star,text:zNote.notei18n.tooltips.changeFavourite,arrow:"top"})}},{key:"handleSetFavourite",value:function(){this.props.note.saveFavourite()}},{key:"render",value:function(){var a=this.props.note.get("myact").starred?"SC_fav":"";return this.props.header?this.props.header?(a=this.props.note.get("myact").starred?"msi-fav SC_fav":"msi-fav",React.createElement("i",{className:a,ref:"star",onClick:this.handleSetFavourite})):React.createElement("li",{id:"znfav",ref:"star",onClick:this.handleSetFavourite,className:a},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-fav"})))):null}}]),b}(React.Component),zNote.Views.NotePreview.NoteCreatorPreview=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return _inherits(b,a),_createClass(b,[{key:"componentDidMount",value:function(){var a=this;zmail.ContactBook.get({zuid:this.props.note.get("gnrl").by,type:"org"}).done(function(b){var c=b[0];c&&c.attrs&&c.attrs.fn&&($(ReactDOM.findDOMNode(a.refs.creator)).prepend(c.avatar()),$(ReactDOM.findDOMNode(a.refs.creator)).find(".zm_susr").text(c.attrs.fn),zmComponent.tooltip({elm:$(a.refs.creator).find(".SC_avtr")[0],text:c.attrs.fn,arrow:"top"}))})}},{key:"render",value:function(){return this.props.header?React.createElement("div",{ref:"creator"},React.createElement("div",{className:"SCS_postTitle"},React.createElement("strong",{className:"zm_susr"})," ",zNote.notei18n.preview.createdNote," ",znBox.getGroupName(this.props.note.get("gnrl").group.id))):React.createElement("span",{ref:"creator"})}}]),b}(React.Component);var a=function(a){function b(a,c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c)),e=zNote.isStickyNote(d.props.note.toJSON());return d.state={sticky:e},d.handleMakeSticky=d.handleMakeSticky.bind(d),d}return _inherits(b,a),_createClass(b,[{key:"componentDidMount",value:function(){this.showToolTips()}},{key:"componentDidUpdate",value:function(){this.showToolTips()}},{key:"showToolTips",value:function(){this.state.sticky===!0?zmComponent.tooltip({elm:this.refs.stickyNote,text:zNote.notei18n.note.removeSticky,arrow:"top"}):zmComponent.tooltip({elm:this.refs.stickyNote,text:zNote.notei18n.note.makeSticky,arrow:"top"})}},{key:"stickyOrUnSticky",value:function(){var a=this;this.state.sticky===!1?(zNote.addAsStickyNote(zNote.getNoteDataInListFormat(this.props.note.toJSON())),setTimeout(function(){var b=zNote.stickyNoteCollectionView.getTopLeft(a.props.note.get("notes").id);$.publish("zm/closeAllOpenDialog",b)}),this.setState({sticky:!0})):(this.setState({sticky:!1}),$.publish("/note/closeStickyNote",[a.props.note.get("notes").id,a.props.note.get("gnrl").group.id]))}},{key:"handleMakeSticky",value:function(){var a=this;a.props.note.get("notes").id?a.stickyOrUnSticky():a.props.note.addNote({}).done(function(){a.stickyOrUnSticky()})}},{key:"render",value:function(){var a=this.state.sticky?"SC_mkStky active":"SC_mkStky";a+=this.props.options&&this.props.options.previewCard?" SC_dyn":"";var b=this.state.sticky?"msi-stiPNotes":"msi-stiNotes";return React.createElement("div",{className:a,ref:"stickyNote",onClick:this.handleMakeSticky},React.createElement("i",{className:b}))}}]),b}(React.Component),b=function(a){function b(a,c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.handleInsertImg=d.handleInsertImg.bind(d),d}return _inherits(b,a),_createClass(b,[{key:"componentDidMount",value:function(){zmComponent.tooltip({elm:this.refs.insertImgIcon,text:zNote.notei18n.tooltips.insertImg,arrow:"top"})}},{key:"handleInsertImg",value:function(){var a,b=this;a=this.props.note.get("notes").id?{componentId:"notes",attachFrom:["insertImage"],insertImage:{type:".png,.jpg,.jpeg,.gif",maxSize:3145728,uploadAPI:zmail.conPath+"/NotesAction.do?mode=addAttach",requireParamToUpload:{groupId:b.props.note.get("gnrl").group.id,mode:"addAttach",entityId:b.props.note.get("notes").id,actionType:"addEntity",streamsView:"Notes",entityType:2,attType:"inline"},onUpload:function(a){b.props.parent.refs.desc.setImage(a[1])}}}:{componentId:"notes",attachFrom:["insertImage"],insertImage:{type:".png,.jpg,.jpeg,.gif",maxSize:3145728,uploadAPI:"/zm/attach.do?mode=temp",requireParamToUpload:{type:"f",accId:zmail.accId,tSize:0},onUpload:function(a){b.props.parent.refs.desc.setImage1(a)}}},this.attRefObj?(b.attRefObj.updateConfig(a),this.attRefObj.init()):zmUtil.initAttachComponent(a,function(a){b.attRefObj=a})}},{key:"render",value:function(){var a=!0;(znBox.checkForGroupDisabled({groupId:this.props.note.get("gnrl").group.id})||this.props.note.get("gnrl").by!==zmail.zuid)&&(a=!1);var b=a?"":"SC_dyn";return React.createElement("li",{id:"znImg",ref:"insertImgIcon",className:b,onClick:this.handleInsertImg},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-image"}))))}}]),b}(React.Component),c=function(a){function b(a,c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.handleViewAssociatedMail=d.handleViewAssociatedMail.bind(d),d}return _inherits(b,a),_createClass(b,[{key:"componentDidMount",value:function(){zmComponent.tooltip({elm:this.refs.mailopen,text:zNote.notei18n.tooltips.openmail,arrow:"top"})}},{key:"handleViewAssociatedMail",value:function(){$.publish("zm/closeAllOpenDialog");var a={};this.props.note.get("notes").email.accid!==zmail.accId&&(a={actionType:"viewGroupMailEntity",entityId:this.props.note.get("notes").email.msgid,entityType:"1",streamsView:"true",streams:!0,groupId:this.props.note.get("gnrl").by,accId:this.props.note.get("notes").email.accid}),zmList.getMailData({msgId:this.props.note.get("notes").email.msgid,opentype:2,type:"lt",src:"external",eprm:a})}},{key:"render",value:function(){var a=this.props.note.get("notes").email&&!$.isEmptyObject(this.props.note.get("notes").email)?"zn_actVIcon":"zn_actVIcon SC_dyn";return React.createElement("li",{id:"znmail",className:a,ref:"mailopen",onClick:this.handleViewAssociatedMail
},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-mailopen"}))))}}]),b}(React.Component),d=function(a){function b(a,c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.handleAddAttachment=d.handleAddAttachment.bind(d),d}return _inherits(b,a),_createClass(b,[{key:"componentDidMount",value:function(){zmComponent.tooltip({elm:this.refs.attachIcon,text:zNote.notei18n.tooltips.addAttach,arrow:"top"})}},{key:"setAttachmentConfig",value:function(){var a,b=this;a={componentId:"notes",isNewImp:!0,attachFrom:["desktop","myAttachchment","zDocs","otherCloud"],currentAttachedSize:0,eleId:$(ReactDOM.findDOMNode(b.props.parent.refs.attDiv)),autoLaunch:!1,onAllUploadFinish:{handler:function(a){b.props.note.saveAttachment(a)},resetData:!0,removeAttachDOM:!0},$dropCenter:$(ReactDOM.findDOMNode(this.props.parent.refs.notebox))},b.props.note.get("notes").id?a.beforeAttach=!1:a.beforeAttach=function(a){b.props.note.addNote({}).done(function(){b.attRefObj.updateConfig({}),a()})},zmUtil.initAttachComponent(a,function(a){b.attRefObj=a})}},{key:"handleAddAttachment",value:function(){var a=this,b=a.attRefObj.configJSON;a.props.note.get("notes").id?b.beforeAttach=!1:b.beforeAttach=function(b){a.props.note.addNote({}).done(function(){a.attRefObj.updateConfig({}),b()})},a.attRefObj.updateConfig(b),a.attRefObj.init()}},{key:"render",value:function(){var a=!0;(znBox.checkForGroupDisabled({groupId:this.props.note.get("gnrl").group.id})||this.props.note.get("gnrl").by!==zmail.zuid)&&(a=!1);var b=a?"":"SC_dyn";return React.createElement("li",{id:"znattach",ref:"attachIcon",className:b,onClick:this.handleAddAttachment},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-attachment"}))))}}]),b}(React.Component),e=function(a){function b(a,c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.handleSendMail=d.handleSendMail.bind(d),d}return _inherits(b,a),_createClass(b,[{key:"componentDidMount",value:function(){zmComponent.tooltip({elm:this.refs.sendmail,text:zNote.notei18n.tooltips.sendMail,arrow:"top"})}},{key:"handleSendMail",value:function(){$.publish("zm/closeAllOpenDialog"),this.props.note.sendAsMail()}},{key:"render",value:function(){var a=this.props.note.get("notes").id?"":"SC_dyn";return React.createElement("li",{id:"znsend",ref:"sendmail",className:a,onClick:this.handleSendMail},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-send"}))))}}]),b}(React.Component),f=function(a){function b(a,c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c)),e=zNote.isStickyNote(d.props.note.toJSON());return d.state={sticky:e},d.handleMakeSticky=d.handleMakeSticky.bind(d),d.updateSticky=d.updateSticky.bind(d),d}return _inherits(b,a),_createClass(b,[{key:"componentDidMount",value:function(){this.showToolTips(),$.subscribe("stickyNoteMod",this.updateSticky)}},{key:"componentDidUpdate",value:function(){this.showToolTips()}},{key:"updateSticky",value:function(){var a=zNote.isStickyNote(this.props.note.toJSON());this.setState({sticky:a})}},{key:"componentWillUnmount",value:function(){$.unsubscribe("stickyNoteMod",this.updateSticky)}},{key:"showToolTips",value:function(){this.state.sticky===!0?zmComponent.tooltip({elm:this.refs.stickyNote,text:zNote.notei18n.note.removeSticky,arrow:"top"}):zmComponent.tooltip({elm:this.refs.stickyNote,text:zNote.notei18n.note.makeSticky,arrow:"top"})}},{key:"stickyOrUnSticky",value:function(){var a=this;this.state.sticky===!1?(zNote.addAsStickyNote(zNote.getNoteDataInListFormat(this.props.note.toJSON())),setTimeout(function(){var b=zNote.stickyNoteCollectionView.getTopLeft(a.props.note.get("notes").id);$.publish("zm/closeAllOpenDialog",b)}),this.setState({sticky:!0})):(this.setState({sticky:!1}),$.publish("/note/closeStickyNote",[a.props.note.get("notes").id,a.props.note.get("gnrl").group.id]))}},{key:"handleMakeSticky",value:function(){var a=this;a.props.note.get("notes").id?("true"===a.props.options.tab&&zmsuite.isWorkspaceAvailable(a.props.note.get("notes").id)&&zmsuite.closeWorkspace(a.props.note.get("notes").id),a.stickyOrUnSticky()):a.props.note.addNote({}).done(function(){a.stickyOrUnSticky()})}},{key:"render",value:function(){if(!this.props.options||!this.props.options.previewCard)return null;var a=this.state.sticky?"msi-stiPNotes":"msi-stiNotes";return React.createElement("li",{id:"znsticky",ref:"stickyNote",onClick:this.handleMakeSticky},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:a}))))}}]),b}(React.Component);zNote.Views.NotePreview.TagsPreview=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return _inherits(b,a),_createClass(b,[{key:"addLabel",value:function(a,b){var c,d=this,e={};e.parentDOM=this.refs.plus?ReactDOM.findDOMNode(this.refs.plus):ReactDOM.findDOMNode(this.refs.label),e.displayAs="popup",e.labelState={labelList:this.props.note.get("myact").label},e.showCreate=!0,e.accType="default",e.onCreate=function(a,b){znNote.sendNewLabReq(a,b).done(function(a){a&&1===a[0]&&a[1].labelId&&(c.hide(),d.props.note.addTag(a[1].labelId))})},e.onStateChange=function(a,b,c){b?d.props.note.addTag(a):d.props.note.removeTag(a)},c=zmUtil.createFLComp("label",e),c.show()}},{key:"render",value:function(){var a={backgroundColor:""},b=this;if(!this.props.header)return null;var c=function(a){return function(c){b.addLabel(c,a)}};return b.props.note.get("myact").label&&b.props.note.get("myact").label.length>0?React.createElement("div",{className:"zm_lbl"},b.props.note.get("myact").label.map(function(b){return zmUtil.getTagList("default")[b]?(a={backgroundColor:zmUtil.getTagList("default")[b].color},React.createElement("p",{"data-mid":"",title:zmUtil.getTagList("default")[b].label,onClick:c(),className:"zmAttLbl"},React.createElement("font",{style:a}))):null}),React.createElement("i",{className:"msi-plus",ref:"plus",onClick:c()})):React.createElement("div",{className:"zm_lbl",ref:"label",onClick:c()},React.createElement("i",{className:"msi-label",ref:"label"}))}}]),b}(React.Component);var g=function(a){function b(a,c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.handleSetAttributes=d.handleSetAttributes.bind(d),d.handleSetColor=d.handleSetColor.bind(d),d}return _inherits(b,a),_createClass(b,[{key:"componentDidMount",value:function(){zmComponent.tooltip({elm:this.refs.palette,text:zNote.notei18n.tooltips.changeColor,arrow:"top"})}},{key:"handleSetColor",value:function(a){var b=this;if("true"===$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-visible")){var c=$('<li><div class="zn_clr"><div class="zn_clr1"></div><div class="zn_clr2"></div><div class="zn_clr3"></div><div class="zn_clr4"></div></div></li>');c.find("."+zNote.CONSTANTS.COLORCODE[this.props.note.get("notes").color]).append("<i class=msi-tick></i>");var d={par:a.target,showArrow:!0,liDom:c,direction:"bottom",ulClass:"zn_clrSel",spanClass:"minwid"};zmsuite.showMenu(d),$(c[0]).find("div").children("div").off("click").on("click",function(a){a.stopPropagation(),$("#zm_dropDown").remove(),$(ReactDOM.findDOMNode(b.refs.palette)).attr("data-visible","false"),b.props.note.saveColor(zNote.CONSTANTS.COLOR[this.className])})}$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-current","false"),$(ReactDOM.findDOMNode(this.props.parent.refs.notebox)).addClass("sel")}},{key:"handleSetAttributes",value:function(){$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-current","true"),"true"===$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-visible")?$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-visible","false"):$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-visible","true")}},{key:"render",value:function(){var a=!0;(znBox.checkForGroupDisabled({groupId:this.props.note.get("gnrl").group.id})||this.props.note.get("gnrl").by!==zmail.zuid)&&(a=!1);var b=a?"":"SC_dyn";return React.createElement("li",{id:"zncolor",className:b,ref:"palette",onMouseDown:this.handleSetAttributes,onClick:this.handleSetColor},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-nclr"}))))}}]),b}(React.Component),h=function(a){function b(a,c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.handleShowStreamsBar=d.handleShowStreamsBar.bind(d),d}return _inherits(b,a),_createClass(b,[{key:"handleShowStreamsBar",value:function(){this.props.showStreamsBar(this.props.note.toJSON())}},{key:"render",value:function(){var a;return a=this.props.note.get("showstream")&&this.props.note.get("notes").id?"zn_commentsOpen":"zn_commentsOpen SC_dyn",React.createElement("span",{className:a,ref:"showstream",onClick:this.handleShowStreamsBar},React.createElement("i",{className:"msi-nextH"}))}}]),b}(React.Component),i=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return _inherits(b,a),_createClass(b,[{key:"render",value:function(){return!this.props.note.get("gnrl").group.isGroup&&this.props.note.get("gnrl").group.id!==zmail.zuid&&this.props.options&&this.props.options.print?React.createElement("div",{id:"grpDiv",className:"zn_folder zn_clear SC_dyn"}):React.createElement("div",{id:"grpDiv",className:"zn_folder zn_clear"},function(a){return React.createElement(zNote.Views.NotePreview.TagsPreview,{note:a.props.note,options:a.props.options,parent:a,ref:"tag"})}(this),React.createElement(j,{note:this.props.note,removeNote:this.props.removeNote}))}}]),b}(React.Component),j=function(a){function b(a,c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.handleChangeBook=d.handleChangeBook.bind(d),d.handleChangeGroup=d.handleChangeGroup.bind(d),d}return _inherits(b,a),_createClass(b,[{key:"componentDidMount",value:function(){(this.props.note.get("gnrl").group.id===zmail.zuid||zmCont.getGroup()[this.props.note.get("gnrl").group.id]&&zmCont.getGroup()[this.props.note.get("gnrl").group.id].isOwner)&&zmComponent.tooltip({elm:this.refs.book,text:zNote.notei18n.tooltips.moveNote,arrow:"top"})}},{key:"handleChangeBook",value:function(){var a,b=!0;if((znBox.checkForGroupDisabled({groupId:this.props.note.get("gnrl").group.id})||this.props.note.get("gnrl").by!==zmail.zuid)&&(b=!1),b){var c=znBox.getCategoryArray(this.props.note.get("gnrl").group.id),d=this,e={};e.parentDOM=ReactDOM.findDOMNode(this.refs.book),e.displayAs="popup",e.onSelect=function(b){d.props.note.changeBook(b),a.hide()},(this.props.note.get("gnrl").group.id===zmail.zuid||zmCont.getGroup()[this.props.note.get("gnrl").group.id]&&zmCont.getGroup()[this.props.note.get("gnrl").group.id].isOwner)&&(e.onCreate=function(b){znNote.sendNewCatReq(b,{},d.props.note.get("gnrl").group.id).done(function(b){d.props.note.changeBook(b[1][0].catId),a.hide()})}),e.onHide=function(){$("#zm_dropDown").remove()},e.dataCallback=function(){return c},a=zmUtil.createFLComp("category",e),a.show()}}},{key:"handleChangeGroup",value:function(){if(this.props.note.get("gnrl").by===zmail.zuid&&zmail.showFeature){var a,b=znBox.getGroupArray(),c=this,d={};d.parentDOM=ReactDOM.findDOMNode(this.refs.group),d.displayAs="popup",d.showCreate=!0,d.onSelect=function(b){c.props.note.changeGroup(b),a.hide()},d.onHide=function(){$("#zm_dropDown").remove()},d.dataCallback=function(){return b},a=zmUtil.createFLComp("group",d),a.show()}}},{key:"render",value:function(){var a=znBox.getGroupName(this.props.note.get("gnrl").group.id),b=zNote.getNamefrmCatObj(this.props.note.get("notes").catid,this.props.note.get("gnrl").group.id),c=""===a?"zn_cgy SC_dyn":"zn_cgy";return React.createElement("div",{className:c,ref:"cgy",id:"zncat"},React.createElement("font",{id:"zngroup",className:"zn_ngrp",ref:"group",onClick:this.handleChangeGroup},a),React.createElement("i",{className:"msi-rarrow"}),React.createElement("font",{id:"znscat",ref:"book",className:"zn_nbook",onClick:this.handleChangeBook},b))}}]),b}(React.Component),k=function(a){function b(a,c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));d.ispaste=!1;var e=d.props.note.get("notes").id?2e4:5e3;d.checkSaveDesc=_.debounce(d.setDescription,e);var f=!1;return d.props.note.get("notes").notecont&&d.props.note.get("notes").notecont.length>=255&&(f=!0),d.showEditor=znBox.isRichTextOpen()&&!d.props.streamList,d.state={height:0,readmore:f,istagCheck:!1},d.handleKeyDown=d.handleKeyDown.bind(d),d.handlePaste=d.handlePaste.bind(d),d.handleClickHandler=d.handleClickHandler.bind(d),d.handleSetHeight=d.handleSetHeight.bind(d),d.handleSaveSelection=d.handleSaveSelection.bind(d),d.fillSummary=d.fillSummary.bind(d),d}return _inherits(b,a),_createClass(b,[{key:"shouldComponentUpdate",value:function(a,b){return a.note.get("notes").notecont!==this.descOnView}},{key:"setDescription",value:function(a,b){b||this.ispaste===!1&&this.state.istagCheck===!1&&(this.showEditor?(this.descOnView=this.editor.getContent(),this.props.note.saveDescription(this.editor.getContent())):(this.descOnView=znBox.domParser(znBox.getContentEditableText($(ReactDOM.findDOMNode(this.refs.content)))),this.props.note.saveDescription(znBox.domParser(znBox.getContentEditableText($(ReactDOM.findDOMNode(this.refs.content)))))))}},{key:"componentWillUnmount",value:function(){$(ReactDOM.findDOMNode(this.refs.content)).off("mousedown","a"),$(ReactDOM.findDOMNode(this.refs.content)).off("click","a"),$(ReactDOM.findDOMNode(this.refs.content)).off("focus"),this.checkSaveDesc({},!0)}},{key:"componentDidMount",value:function(){this.setState({height:$(ReactDOM.findDOMNode(this.refs.content)).height()});var a=this,b=function(b){a.props.note.addTag(b.id)},c=function(){a.setState({istagCheck:!0})},d=function(){a.setState({istagCheck:!1})},e={compare:["hashname"],LType:"2",OType:"4",callback:b,initialCallback:c,finallyCallback:d};if(e.getContentArray=function(){return znBox.getLabelArray(a.props.note.get("myact").label)},this.showEditor){var f={id:this.editorId,editorType:"smartCompose",editorheight:"200px",defaultfontsize:"14px",defaultfontfamily:"Verdana,Arial",microParaToolbar:!1,microInsertToolbar:!1,avoidMoreOption:!0,removeStyleProps:["backgroundColor","fontSize","fontFamily","color"],generalToolbar:!1,content:this.content,notes:!0};this.editor=ZE.create(f);var g=Boolean(this.props.options&&"true"===this.props.options.disableShortcuts);this.editor.afterEditorLoad(function(){var b=$(a.editor.doc.body);b.css("line-height","1.4em");var c=$(a.editor.iframe);g||zmComponent.keybindings.listener.add(a.editor.doc),b.attr("data-enableshortcuts","true"),a.setHeight?(a.setHeight+=c.height(),c.css("height",a.setHeight),c.css("max-height",a.setHeight)):c.css("height","auto"),c[0].style.overflow="hidden",c[0].style.overflowY="auto",b.on("keydown",function(b){a.handleKeyDown(b)}),b.on("mousedown",function(a){znBox.hideMenu()}),b.on("click",function(b){a.handleClickHandler(b)}),b.on("keyup",function(b){a.handleSetHeight(b)}),b.on("blur",function(b,c){a.setDescription(b,c),a.checkSaveDesc({},!0)}),a.props.note.on("change",function(){a.showEditor&&a.props.note.get("notes").notecont!==a.descOnView&&a.editor.setContent(a.props.note.get("notes").notecont)}),ReactDOM.render(React.createElement(zNote.getEditorIcons,{editor:a.editor}),a.props.parent.refs.editorBar)})}var h=function(a){a.stopPropagation(),$("#ngoto").remove();var b=a.target.getBoundingClientRect().left,c=a.target.getBoundingClientRect().top+(a.target.getBoundingClientRect().bottom-a.target.getBoundingClientRect().top),d=$('<span id="ngoto" class="zn_lnkBar" style="left: '+b+"px; top: "+c+'px; right: auto;z-index:1001"><a id=nlink  rel="noreferrer noopener" target="_blank">'+zNote.notei18n.golink+"</a></span>");d.find("#nlink").attr("href",this.href),$("body").append(d),$("#ngoto").on("mousedown",function(a){a.stopPropagation()}),$("#ngoto").on("click",function(){$("#ngoto").remove()}),$("#nlink").on("click",function(a){a.stopPropagation(),$("#ngoto").remove()})};this.showEditor||this.props.streamList===!0||($(ReactDOM.findDOMNode(this.refs.content)).on("focus",a.handleSaveSelection),$(ReactDOM.findDOMNode(this.refs.content)).on("mousedown","a",h),$(ReactDOM.findDOMNode(this.refs.content)).on("click","a",function(a){a.preventDefault(),a.stopPropagation()}))}},{key:"setImage1",value:function(a){var b=this.selection,c=this.showEditor?$(this.editor.doc.body):$(ReactDOM.findDOMNode(this.refs.content)),d=zmail.conPath+"/FileDownload?mode=tmpview&entityType=1&accId="+zmail.accId+"&fpath="+a.fP+"&fstorename="+a.sN;if(this.showEditor)this.editor.insertImage(d,{size:"bestfit"});else{$(ReactDOM.findDOMNode(this.refs.content)).trigger("focus",!0,!0);var e=znBox.restoreSelectionNew(c[0],b);e||$(ReactDOM.findDOMNode(this.refs.content)).trigger("focus"),znBox.isIE?znBox.insertHtmlAtCaret("<img src="+d+"></img>"):document.execCommand("insertHTML",!1,"<img src="+d+"></img>")}}},{key:"setImage",value:function(a){var b=this.selection,c=this.showEditor?$(this.editor.doc.body):$(ReactDOM.findDOMNode(this.refs.content)),d=Object.keys(a[0].inline[0])[0],e=zmail.conPath+"/FileDownload?attachId="+a[0].inline[0][d].Id+"&entityType=2&entityId="+this.props.note.get("notes").id+"&actionType=viewGroupEntity&groupId="+this.props.note.get("gnrl").group.id+"&streamsView=Notes&mode=view&app=notes&attachType=inline";if(this.showEditor)this.editor.insertImage(e,{size:"bestfit"});else{var f=znBox.restoreSelectionNew(c[0],b);f||$(ReactDOM.findDOMNode(this.refs.content)).trigger("focus"),znBox.isIE?znBox.insertHtmlAtCaret("<img id="+a[0].inline[0][d].Id+" src="+e+"></img>"):document.execCommand("insertHTML",!1,"<img id="+a[0].inline[0][d].Id+" src="+e+"></img>")}}},{key:"handleSetHeight",value:function(a){var b=this.props.note.get("notes").isRichText,c=this.showEditor?$(this.editor.doc.body):$(ReactDOM.findDOMNode(this.refs.content));this.selection=znBox.saveSelectionNew(c[0]),this.state.height!==c.height()&&this.setState({height:c.height()}),32!==a.keyCode||this.showEditor||zNote.updateLinks(c[0],b),this.checkSaveDesc()}},{key:"handleSaveSelection",value:function(a,b,c){if(!c){var d=this.showEditor?$(this.editor.doc.body):$(ReactDOM.findDOMNode(this.refs.content));this.selection=znBox.saveSelectionNew(d[0])}}},{key:"restoreSelection",value:function(){znBox.restoreSelectionNew(ReactDOM.findDOMNode(this.refs.content),this.selection)}},{key:"handlePaste",value:function(a){var b=this;this.ispaste=!0,znBox.handlePaste(a.target),setTimeout(function(){b.ispaste=!1},200)}},{key:"handleKeyDown",value:function(a){zNote.disable(a)||this.showEditor?27!==a.keyCode&&27!==a.which||this.setDescription():a.preventDefault()}},{key:"fillSummary",value:function(){this.setState({readmore:!1})}},{key:"setContentHeight",value:function(a){var b;this.showEditor?this.setHeight=a.height:(b=ReactDOM.findDOMNode(this.refs.content),$(b).css("height",a.height),$(b).css("max-height",a.height),b.style.overflow="hidden",b.style.overflowY="auto")}},{key:"updateHeight",value:function(a){var b;this.showEditor?(b=this.editor.iframe,this.setHeight=a.height+$(b).height(),$(b).css("height",this.setHeight),$(b).css("max-height",this.setHeight)):(b=ReactDOM.findDOMNode(this.refs.content),$(b).css("height",a.height),$(b).css("max-height",a.height)),b.style.overflow="hidden",b.style.overflowY="auto"}},{key:"handleClickHandler",value:function(a){if("IMG"===a.target.nodeName){var b=a.target.src,c=[],d={ft:101,fn:" ",src:b};c.push(d),zmUtil.initAttSlideShow(c,0,!0)}else this.handleSaveSelection(a)}},{key:"render",value:function(){var a=this,b="true";(znBox.checkForGroupDisabled({groupId:this.props.note.get("gnrl").group.id})||this.props.streamList||this.props.note.get("gnrl").by!==zmail.zuid||this.props.options&&this.props.options.print===!0)&&(b="false",this.showEditor=!1);var c=this.props.note.get("notes").isRichText;this.content=c||znBox.isRichTextOpen()?this.props.note.get("notes").notecont.replace(/\n/g,"<br />"):zNote.linkify(this.props.note.get("notes").notecont).replace(/\n/g,"<br />");var d=this.props.options&&"true"===this.props.options.disableShortcuts?"false":"true",e=zNote.notei18n.placeholder.writeSome,f=this.state.readmore?"zn_cont zn_trunc":"zn_cont";this.editorId=(new Date).getTime();var g=function(){return function(b){a.setDescription(b),a.checkSaveDesc({},!0)}};return"false"===b&&this.props.streamList?React.createElement("div",{className:"zn_base"},React.createElement("div",{className:f,"data-enableshortcuts":d,"data-plhr":e,ref:"content",onKeyDown:this.handleKeyDown,onPaste:this.handlePaste,onClick:this.handleClickHandler,onKeyUp:this.handleSetHeight,onBlur:g(),contentEditable:b,dangerouslySetInnerHTML:{__html:this.content}}),function(){if(a.state.readmore)return React.createElement("div",{className:"SC_lnk",onClick:a.fillSummary},"Read More ...")}()):React.createElement("div",{className:"zn_base",id:this.editorId},function(){return a.showEditor?null:React.createElement("div",{className:"zn_cont","data-enableshortcuts":d,"data-plhr":e,ref:"content",onKeyDown:a.handleKeyDown,onPaste:a.handlePaste,onClick:a.handleClickHandler,onKeyUp:a.handleSetHeight,onBlur:g(),contentEditable:b,dangerouslySetInnerHTML:{__html:a.content}})}())}}]),b}(React.Component),l=function(a){function b(a,c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c)),e=d.props.note.get("notes").id?2e4:5e3;return d.checkSaveTitle=_.debounce(d.setTitle,e),d.handlePasteForTitle=d.handlePasteForTitle.bind(d),d.handleSetMaxCharacter=d.handleSetMaxCharacter.bind(d),d.handleKeyUp=d.handleKeyUp.bind(d),d.handleKeyDown=d.handleKeyDown.bind(d),d}return _inherits(b,a),_createClass(b,[{key:"componentWillUnmount",value:function(){zmail.showFeature&&this.checkSaveTitle({},!0)}},{key:"shouldComponentUpdate",value:function(a,b){return a.note.get("notes").title!==this.titleOnView}},{key:"handleKeyDown",value:function(a){13===a.keyCode?(a.preventDefault(),znBox.isRichTextOpen()?this.props.setEditorFocus():ReactDOM.findDOMNode(this.props.parent.refs.desc.refs.content).focus()):27===a.keyCode||27===a.which?this.setTitle():zNote.disable(a)||this.showEditor||a.preventDefault()}},{key:"setTitle",value:function(a,b){b||($(ReactDOM.findDOMNode(this.refs.title)).text().trim().length||$(ReactDOM.findDOMNode(this.refs.title)).text(""),this.titleOnView=znBox.domParser(znBox.getContentEditableText($(ReactDOM.findDOMNode(this.refs.title)))),this.props.note.saveTitle($(ReactDOM.findDOMNode(this.refs.title)).text()))}},{key:"handlePasteForTitle",value:function(a){var b=zNote.CONSTANTS.MAXCHARACTER.TITLE-ReactDOM.findDOMNode(this.refs.title).textContent.length;this.handleSetMaxCharacter(a)&&(this.ispaste=!0,znBox.handlePaste(a.target,void 0,b),this.ispaste=!1)}},{key:"handleKeyUp",value:function(){zmail.showFeature&&this.checkSaveTitle()}},{key:"handleSetMaxCharacter",value:function(a){var b=zNote.CONSTANTS.MAXCHARACTER.TITLE-ReactDOM.findDOMNode(this.refs.title).textContent.length;return!(b<=0)||(a.preventDefault(),_zm.succErrMsg("e",zNote.notei18n.titexceed),!1)}},{key:"render",value:function(){var a=this,b=zNote.notei18n.placeholder.title,c="true";(znBox.checkForGroupDisabled({groupId:this.props.note.get("gnrl").group.id})||this.props.streamList||this.props.note.get("gnrl").by!==zmail.zuid||this.props.options&&this.props.options.print===!0)&&(c="false");var d=this.props.note.get("cntnt").title&&this.props.note.get("cntnt").title!==znBox.CONTS.defaultTitle?znBox.spCharRep(this.props.note.get("cntnt").title):"",e=this.props.options&&"true"===this.props.options.disableShortcuts?"false":"true",f=function(){return function(){a.setTitle(),zmail.showFeature&&a.checkSaveTitle({},!0)}};return React.createElement("div",{className:"zn_tit","data-enableshortcuts":e,onPaste:this.handlePasteForTitle,onKeyPress:this.handleSetMaxCharacter,onKeyUp:this.handleKeyUp,onKeyDown:this.handleKeyDown,ref:"title",contentEditable:c,onBlur:f(),"data-plhr":b},d)}}]),b}(React.Component),m=function(a){function b(a,c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.handleArchive=d.handleArchive.bind(d),d}return _inherits(b,a),_createClass(b,[{key:"componentDidMount",value:function(){var a=this.props.note.get("notes").archived?zNote.notei18n.note.unarchive:zNote.notei18n.note.archive;zmComponent.tooltip({elm:this.refs.archive,text:a,arrow:"top"})}},{key:"componentDidUpdate",value:function(){var a=this.props.note.get("notes").archived?zNote.notei18n.note.unarchive:zNote.notei18n.note.archive;zmComponent.tooltip({elm:this.refs.archive,text:a,arrow:"top"})}},{key:"handleArchive",value:function(a){a.stopPropagation();var b=!this.props.note.get("notes").archived;this.props.note.archiveOrUnarchiveNote({archived:b})}},{key:"render",value:function(){var a=this.props.note.get("notes").archived?"msi-unarchive":"msi-archive",b=!1;return!znBox.checkForGroupDisabled({groupId:this.props.note.get("gnrl").group.id})&&(this.props.note.get("gnrl").by===zmail.zuid||zmCont.getGroup()[this.props.note.get("gnrl").group.id]&&zmCont.getGroup()[this.props.note.get("gnrl").group.id].isOwner)&&(b=!0),znBox.isArchiveOpen()&&b?React.createElement("li",{id:"znArchive",ref:"archive",onClick:this.handleArchive},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:a})))):null}}]),b}(React.Component),n=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return _inherits(b,a),_createClass(b,[{key:"componentDidUpdate",value:function(){this.props.options&&this.props.options.componentUpdated&&this.props.options.componentUpdated({type:"attachment"})}},{key:"viewImage",value:function(a,b){for(var c=this,d=[],e=this.props.note.get("attach"),f=0,g=e.length;f<g;f++)e[f].inline||d.push({Id:e[f].id,e:this.props.note.get("notes").id,et:2,ft:e[f].ft,fs:e[f].size,fn:e[f].name,p:e[f].part,tn:!1,gId:this.props.note.get("gnrl").group.id,u:""});var h={},i={},j=[];i.trash={"class":"msi-trash",title:zNote.notei18n.tooltips.deleteAttach,after:".msi-download",events:[{name:"click",listener:function(a,b,d){c.props.note.delAtt(b.e,b.Id,d)}}]},j.push(".msi-fav"),j.push("#etyIcon"),h.extraIcons=i,h.hideOptions=j,zmUtil.initAttSlideShow(d,b,!1,h)}},{key:"render",value:function(){var a,b,c=this,d=this.props.note.get("attach")&&_.filter(this.props.note.get("attach"),function(a){return!a.inline}),e=function(a,b){return function(){c.viewImage(a,b)}};return d&&d.length?React.createElement("div",{className:"zn_folder zn_clear zn_attach"},React.createElement("div",{className:"icn"},React.createElement("i",{className:"msi-attachpin"})),d.map(function(d,f){var g=d,h=zmUtil.fileTyp(g.name);if("msi-attimg"===h[1])b=c.props.note.get("notes").id===zmail.zuid?zmail.conPath+"/FileDownload?attachId="+g.id+"&entityType=2&entityId="+c.props.note.get("notes").id+"&groupId="+c.props.note.get("gnrl").group.id+"&mode=thb&app=notes":zmail.conPath+"/FileDownload?attachId="+g.id+"&entityType=2&entityId="+c.props.note.get("notes").id+"&groupId="+c.props.note.get("gnrl").group.id+"&streamsView=Notes&actionType=viewGroupEntity&mode=thb&app=notes",a=React.createElement("img",{src:b});else{var i=h[1]+" sc_big";a=React.createElement("i",{className:i})}return React.createElement("div",{className:"zmL zmAch",key:g.id,title:g.name,onClick:e(g,f)},React.createElement("div",{className:"zmLst"},React.createElement("div",{className:"zmDtl"},React.createElement("div",{className:"zmImg"},a))))})):React.createElement("div",{className:"zn_folder zn_clear SC_dyn zn_attach"},React.createElement("div",{className:"icn"},React.createElement("i",{className:"msi-attachpin"})))}}]),b}(React.Component)}(),function(){zNote.Views=zNote.Views||{},zNote.Views.NoteHeaderPreview=React.createClass({displayName:"NoteHeaderPreview",componentDidMount:function(){this.props.note.on("change",function(){this.forceUpdate()}.bind(this))},componentWillUnmount:function(){zNote.eventBus.off("editNote",this.props.note.customEvent,this.props.note)},render:function(){return React.createElement("div",{className:"SCS_postHead"},React.createElement(zNote.Views.NotePreview.NoteCreatorPreview,{note:this.props.note,header:"true"}),React.createElement("div",{className:"SCS_postDet"},React.createElement("div",{className:"SC_SDot"}),React.createElement("i",{className:"msi-notes strmunrd"}),React.createElement("div",{className:"SC_SLine"}),function(a){return React.createElement(zNote.Views.NotePreview.TagsPreview,{note:a.props.note,header:"true",options:a.props.options,parent:a,ref:"tag"})}(this),React.createElement("div",{className:"SC_SLine"}),React.createElement(zNote.Views.NotePreview.FavouritePreview,{note:this.props.note,header:"true",options:this.props.options})))}})}(),function(){zNote.Models=zNote.Models||{},zNote.Models.addNote=Zmail.Model.extend({initialize:function(){},save:function(a,b){var c=b||{},d=function(a){var b=zNote.getNoteDataInListFormat(a[0].data);$.publish("/note/add",[b]),$.publish("/note/addNote",[a[0].data]),c.cat=b.cat,c.namespaceId=b.namespaceId,$.publish("note/updateCount",[c]),c.callback&&c.callback(),c.sticky&&zNote.addAsStickyNote(b)};return a.catId?zmAjq.XHR({u:zmail.conPath+"/NotesAction.do",t:"POST",fn:d,p:a,ep:c}):void znBox.getGenCat({gid:a.groupId}).done(function(){return a.catId=znBox.getGeneralCatId(a.groupId),zmAjq.XHR({u:zmail.conPath+"/NotesAction.do",t:"POST",fn:d,p:a,ep:c})})}})}();var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();!function(){zNote.Views=zNote.Views||{},zNote.Views.addNoteViewReact=function(b){function c(a,b){_classCallCheck(this,c);var d=_possibleConstructorReturn(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,a,b));d.ispaste=!1,d.title=d.props.note.get("title")||zNote.unSavedData.title||"",d.desc=d.props.note.get("desc")||zNote.unSavedData.desc||"",d.showEditor=znBox.isRichTextOpen()&&!(d.props.streams||d.props.options&&d.props.options.quickAdd),d.props.options&&d.props.options.quickAdd&&(d.title="",d.desc=""),d.props.note.get("attEntObj")?d.attArray=d.props.note.get("attEntObj").slice():d.attArray=[];var e=Boolean(d.title.trim().length||d.desc.trim().length);return d.state={namespaceId:d.props.note.get("namespaceId"),starred:d.props.note.get("starred"),color:d.props.note.get("color"),catId:d.props.note.get("catId"),addparams:d.props.note.get("addparams"),attachpath:[],attachstore:[],attachname:[],attEntObj:d.props.note.get("attEntObj")||[],adding:!1,stickyEnabled:e},d.handleSetDescription=d.handleSetDescription.bind(d),d.handleSetTitle=d.handleSetTitle.bind(d),d.handleSetHeight=d.handleSetHeight.bind(d),d.handleSaveSelection=d.handleSaveSelection.bind(d),d.handleQuickAddKeyDown=d.handleQuickAddKeyDown.bind(d),d.handleQuickAddClick=d.handleQuickAddClick.bind(d),d.handleSetMaxCharacter=d.handleSetMaxCharacter.bind(d),d.handleChangeBook=d.handleChangeBook.bind(d),d.handleChangeGroup=d.handleChangeGroup.bind(d),d.handleSetColor=d.handleSetColor.bind(d),d.handleCancel=d.handleCancel.bind(d),
d.handleOnRemoveAttachment=d.handleOnRemoveAttachment.bind(d),d.triggerFileInputClickEvent=d.triggerFileInputClickEvent.bind(d),d.triggerAttachComponent=d.triggerAttachComponent.bind(d),d.removeMyAttachment=d.removeMyAttachment.bind(d),d.handlePaste=d.handlePaste.bind(d),d.handleKeyDown=d.handleKeyDown.bind(d),d.handleKeyPress=d.handleKeyPress.bind(d),d.handlePasteForTitle=d.handlePasteForTitle.bind(d),d.handleStickyNote=d.handleStickyNote.bind(d),d.save=d.save.bind(d),d}return _inherits(c,b),_createClass(c,[{key:"componentDidMount",value:function(){var a=this,b=this.props.options&&this.props.options.quickAdd;if(this.sticky=!1,this.setState({height:$(ReactDOM.findDOMNode(this.refs.content)).height()}),this.height=$(ReactDOM.findDOMNode(this.refs.content)).height(),this.showEditor){var c={id:this.editorId,editorType:"smartCompose",editorheight:"200px",defaultfontsize:"14px",defaultfontfamily:"Verdana,Arial",microParaToolbar:!1,microInsertToolbar:!1,avoidMoreOption:!0,needEditorFocus:!0,removeStyleProps:["background-color","font-size","font-family","color"],generalToolbar:!1,content:this.content,notes:!0};this.editor=ZE.create(c);var d=Boolean(this.props.options&&"true"===this.props.options.disableShortcuts);this.editor.afterEditorLoad(function(){var b=$(a.editor.doc.body),c=$(a.editor.iframe);b.css("line-height","1.4em"),d||zmComponent.keybindings.listener.add(a.editor.doc),b.attr("data-enableshortcuts","true"),a.setHeight?(a.setHeight+=c.height(),c.css("height",a.setHeight),c.css("max-height",a.setHeight)):c.css("height","auto"),c[0].style.overflow="hidden",c[0].style.overflowY="auto",a.desc.trim().length&&a.editor.setContent(a.desc),b.on("mousedown",function(a){znBox.hideMenu()}),b.on("focus",function(b){a.handleSaveSelection(b)}),b.on("paste",function(b){a.handlePaste(b)}),b.on("click",function(b){a.handleSaveSelection(b)}),b.on("keyup",function(b){a.handleSetHeight(b)}),b.on("blur",function(b,c){a.handleSetDescription(b,c)}),b.on("keypress",function(b,c){a.handleKeyPress(b,c)}),ReactDOM.render(React.createElement(zNote.getEditorIcons,{editor:a.editor}),a.refs.editorBar)})}return b?($(ReactDOM.findDOMNode(this.refs.content)).css("min-height","50px"),this.props.note.on("change",function(b){void 0!==b.changed.color&&a.setState({color:b.changed.color})}),void(this.props.options.list&&zmComponent.tooltip({elm:this.refs.addIcon,text:zNote.notei18n.common.addNote,arrow:"top"}))):(setTimeout(function(){$(ReactDOM.findDOMNode(a.refs.content)).focus()},100),$(ReactDOM.findDOMNode(this.refs.content)).on("mousedown","a",function(a){a.stopPropagation(),$("#ngoto").remove();var b=a.target.getBoundingClientRect().left,c=a.target.getBoundingClientRect().top+(a.target.getBoundingClientRect().bottom-a.target.getBoundingClientRect().top);$("body").append('<span id="ngoto" class="zn_lnkBar" style="left: '+b+"px; top: "+c+'px; right: auto;z-index:1001"><a id=nlink href='+this.href+' target="_blank" rel="noreferrer noopener">'+zNote.notei18n.golink+"</a></span>"),$("#ngoto").on("mousedown",function(a){a.stopPropagation()}),$("#ngoto").on("click",function(){$("#ngoto").remove()}),$("#nlink").on("click",function(a){a.stopPropagation(),$("#ngoto").remove()})}),$(ReactDOM.findDOMNode(this.refs.content)).on("click","a",function(a){a.stopPropagation()}),this.setAttachmentConfig(),this.showToolTips(),void(this.debouncedAddNote=_.debounce(this.save,1e3,{leading:!0})))}},{key:"componentWillUnmount",value:function(){this.refs.editorBar&&ReactDOM.unmountComponentAtNode(this.refs.editorBar),$(ReactDOM.findDOMNode(this.refs.content)).off("mousedown","a"),$(ReactDOM.findDOMNode(this.refs.content)).off("click","a")}},{key:"componentDidUpdate",value:function(){this.state.stickyEnabled===!1?zmComponent.tooltip({elm:this.refs.stickyNote,text:zNote.notei18n.info.makeStickyDisabled,arrow:"top"}):this.sticky===!0?zmComponent.tooltip({elm:this.refs.stickyNote,text:zNote.notei18n.note.removeSticky,arrow:"top"}):zmComponent.tooltip({elm:this.refs.stickyNote,text:zNote.notei18n.note.makeSticky,arrow:"top"})}},{key:"setContentHeight",value:function(a){var b;this.showEditor?this.setHeight=a.height:(b=ReactDOM.findDOMNode(this.refs.content),$(b).css("height",a.height),$(b).css("max-height",a.height),b.style.overflow="hidden",b.style.overflowY="auto")}},{key:"handleQuickAddKeyDown",value:function(a){13===a.keyCode&&(a.preventDefault(),this.desc=znBox.domParser(znBox.getContentEditableText($(ReactDOM.findDOMNode(this.refs.contentList)))),this.desc.trim().length&&this.quickAddList())}},{key:"handleQuickAddClick",value:function(){this.desc=znBox.domParser(znBox.getContentEditableText($(ReactDOM.findDOMNode(this.refs.contentList)))),this.desc.trim().length?this.quickAddList():$(ReactDOM.findDOMNode(this.refs.contentList)).focus()}},{key:"showToolTips",value:function(){this.state.stickyEnabled===!1?zmComponent.tooltip({elm:this.refs.stickyNote,text:zNote.notei18n.info.makeStickyDisabled,arrow:"top"}):this.sticky===!0?zmComponent.tooltip({elm:this.refs.stickyNote,text:zNote.notei18n.note.removeSticky,arrow:"top"}):zmComponent.tooltip({elm:this.refs.stickyNote,text:zNote.notei18n.note.makeSticky,arrow:"top"}),this.refs.insertImgIcon&&zmComponent.tooltip({elm:this.refs.insertImgIcon,text:zNote.notei18n.tooltips.insertImg,arrow:"top"}),this.refs.attachIcon&&zmComponent.tooltip({elm:this.refs.attachIcon,text:zNote.notei18n.tooltips.addAttach,arrow:"top"}),this.refs.palette&&zmComponent.tooltip({elm:this.refs.palette,text:zNote.notei18n.tooltips.changeColor,arrow:"top"}),this.refs.cgy&&zmComponent.tooltip({elm:this.refs.cgy,text:zNote.notei18n.tooltips.moveNote,arrow:"top"}),this.refs.group&&zmComponent.tooltip({elm:this.refs.group,text:zNote.notei18n.tooltips.changeGroup,arrow:"top"})}},{key:"handleSetTitle",value:function(){this.ispaste===!1&&($(ReactDOM.findDOMNode(this.refs.title)).text().trim().length?this.title=$(ReactDOM.findDOMNode(this.refs.title)).text().trim():($(ReactDOM.findDOMNode(this.refs.title)).text(""),this.title=""),this.forceUpdate())}},{key:"handleSetDescription",value:function(){if(this.ispaste===!1){var a=this.showEditor?this.editor.getContent():znBox.domParser(znBox.getContentEditableText($(ReactDOM.findDOMNode(this.refs.content))));this.desc=a}}},{key:"setFavourite",value:function(){var a=!this.state.starred;this.setState({starred:a})}},{key:"clearValues",value:function(){this.title="",this.desc="",this.setState({color:_.random(0,3)}),this.forceUpdate()}},{key:"setBook",value:function(a){this.setState({catId:a})}},{key:"setGroup",value:function(a){this.setState({namespaceId:a}),this.setState({catId:znBox.getGeneralCatId(a)})}},{key:"handleChangeGroup",value:function(){var a,b=znBox.getGroupArray(),c=this,d={};d.parentDOM=ReactDOM.findDOMNode(this.refs.group),d.displayAs="popup",d.showCreate=!0,d.onSelect=function(b){c.setGroup(b),a.hide()},d.onHide=function(){$("#zm_dropDown").remove()},d.dataCallback=function(){return b},a=zmUtil.createFLComp("group",d),a.show()}},{key:"handleChangeBook",value:function(){var a,b=znBox.getCategoryArray(this.state.namespaceId),c=this,d={};d.parentDOM=ReactDOM.findDOMNode(this.refs.cgy),d.displayAs="popup",d.showCreate=!0,d.onSelect=function(b){c.setBook(b),a.hide()},d.onHide=function(){$("#zm_dropDown").remove()},d.onCreate=function(b){znNote.sendNewCatReq(b,{},c.state.namespaceId).done(function(b){c.setBook(b[1][0].catId),a.hide()})},d.dataCallback=function(){return b},a=zmUtil.createFLComp("category",d),a.show()}},{key:"handleSetColor",value:function(a){var b=this,c=this.props.options&&this.props.options.quickAdd;if(!c){var d=$('<li><div class="zn_clr"><div class="zn_clr1"></div><div class="zn_clr2"></div><div class="zn_clr3"></div><div class="zn_clr4"></div></div></li>');d.find("."+zNote.CONSTANTS.COLORCODE[this.state.color]).append("<i class=msi-tick></i>");var e={par:a.target,showArrow:!0,liDom:d,direction:"bottom",ulClass:"zn_clrSel",spanClass:"minwid"};zmsuite.showMenu(e),$(d[0]).find("div").children("div").off("click").on("click",function(){a.stopPropagation(),$("#zm_dropDown").remove(),b.setState({color:zNote.CONSTANTS.COLOR[this.className]})}),$(ReactDOM.findDOMNode(this.refs.notebox)).addClass("sel")}}},{key:"save",value:function(){var a=this,b=[];zNote.unSavedData.desc="",zNote.unSavedData.title="",this.handleSetTitle(),this.handleSetDescription();var c={color:this.state.color,catId:this.state.catId,title:this.title,mode:"addNote",groupId:this.state.namespaceId,streamsView:"Notes",actionType:"addEntity",entityType:"2",attachstore:this.state.attachstore,attachname:this.state.attachpath},d={desc:this.desc,mode:"addNote",title:this.title,tagId:[],color:this.state.color,cat:this.state.catId,sticky:this.sticky,namespaceId:this.state.namespaceId};this.showEditor?c.richTextSummary=this.desc:c.desc=this.desc,this.state.attEntObj.length&&(_.each(this.state.attEntObj,function(a){b.push(zmAttachComponent.utility.filterMyAttachmentKey(a))}),c.attEntObj=JSON.stringify(b)),this.state.addparams&&(c=$.extend(c,this.state.addparams),d=$.extend(d,this.state.addparams));var e={allowEmpty:this.sticky};zNote.addNoteValidations(c,e)||(d.callback=this.props.addCallback,this.setState({adding:!0}),this.props.note.save(c,d).always(function(b){a.setState({adding:!1})}))}},{key:"quickAddList",value:function(){var a=this,b=$.Deferred(),c={desc:this.desc,color:this.state.color,catId:this.state.catId,title:this.title,mode:"addNote",groupId:this.state.namespaceId,streamsView:"Notes",actionType:"addEntity",entityType:"2"},d={desc:this.desc,mode:"addNote",title:this.title,tagId:[],color:this.state.color,cat:this.state.catId,sticky:this.sticky,namespaceId:this.state.namespaceId};return this.state.addparams&&(c=$.extend(c,this.state.addparams),d=$.extend(d,this.state.addparams)),!a.refs.contentList&&zNote.addNoteValidations(c)?b.reject():(this.props.note.save(c,d).done(function(c){$(ReactDOM.findDOMNode(a.refs.contentList)).text(""),b.resolve()}),b.promise())}},{key:"streamsAdd",value:function(a,b){var c=this,d=$.Deferred();this.handleSetTitle(),this.handleSetDescription();var e=znBox.getGeneralCatId(a.groupId||this.state.namespaceId);this.setState({catId:e});var f={desc:this.desc,color:this.state.color,catId:e,title:this.title,mode:"addNote",groupId:a.groupId||this.state.namespaceId,streamsView:"Notes",actionType:"addEntity",lockinvites:a.lockinvites,entityType:"2"},g={desc:this.desc,mode:"addNote",title:this.title,tagId:[],color:this.state.color,cat:e,namespaceId:a.groupId||this.state.namespaceId};return zNote.addNoteValidations(f)?d.resolve().promise():(g.callback=function(){c.clearValues(),b&&b()},this.props.note.save(f,g).always(function(){d.resolve()}),d.promise())}},{key:"handleCancel",value:function(){var a=this,b=function(){zNote.eventBus.trigger("removeMask",a)};this.checkDataAlert(b),this.props.cancelCallback&&this.props.cancelCallback()}},{key:"checkDataAlert",value:function(a){var b=this,c=a.bind(null,this),d={okButtonName:zNote.notei18n.save,cancelButtonName:zNote.notei18n.discard,$content:zNote.notei18n.confirmMsg.addNote},e=function(){zNote.unSavedData.desc=b.getNoteDetails().desc,zNote.unSavedData.title=b.getNoteDetails().title,c()};ZE.getText(this.getNoteDetails().desc).trim().length?Dialog.confirm(void 0,this.save,e,d):e()}},{key:"handleOnRemoveAttachment",value:function(a,b){var c=this.state.attachpath.slice(),d=c.indexOf(b.attachpath);c.splice(d,1),this.setState({attachpath:c});var e=this.state.attachstore.slice();e.splice(d,1),this.setState({attachstore:e});var f=this.state.attachname.slice();f.splice(d,1),this.setState({attachname:f});var g=_.filter(this.attArray,function(a){if(a.fP!==b.attachpath)return a});this.attArray=g}},{key:"triggerFileInputClickEvent",value:function(){var a=this;if(this.insertRefObj)this.insertRefObj.init();else{var b={componentId:"notes",attachFrom:["insertImage"]};this.showEditor?b.insertImage={type:".png,.jpg,.jpeg,.gif",maxSize:3145728,uploadAPI:"/zm/zeUploadImage.do",ignoreFileNameParam:!0,imgFileParamName:"img_file",requireParamToUpload:{mode:"composeSet",frm:"c",context:"zm",uploadMode:"drop",aId:zmail.accId},onUpload:function(b){a.setImage1(b)}}:b.insertImage={type:".png,.jpg,.jpeg,.gif",maxSize:3145728,uploadAPI:"/zm/attach.do?mode=temp",requireParamToUpload:{type:"f",accId:zmail.accId,tSize:0},onUpload:function(b){a.setImage(b)}},zmUtil.initAttachComponent(b,function(b){a.insertRefObj=b})}}},{key:"setAttachmentConfig",value:function(){var a=this;if(!this.attRefObj){var b={componentId:"notes",isNewImp:!0,attachFrom:["desktop","myAttachchment","zDocs","otherCloud"],currentAttachedSize:0,eleId:$(ReactDOM.findDOMNode(a.refs.attDiv)),autoLaunch:!1,onAddAttachment:function(b,c,d){if(c.remove(),"myAttachment"===d){var e=a.state.attEntObj.slice();e.push(b),a.attArray.push(b),a.setState({attEntObj:e})}else a.attArray.push(b),a.saveAttachment(b)},$dropCenter:$(ReactDOM.findDOMNode(this.refs.notebox))};zmUtil.initAttachComponent(b,function(b){a.attRefObj=b})}}},{key:"triggerAttachComponent",value:function(){this.attRefObj.init()}},{key:"removeMyAttachment",value:function(a){var b=this.state.attEntObj.slice(),c=_.filter(b,function(b){if(b.uniqueId!==a.uniqueId)return b}),d=_.filter(this.attArray,function(b){if(b.uniqueId!==a.uniqueId)return b});this.attArray=d,this.setState({attEntObj:c})}},{key:"setImage",value:function(a){var b=this.selection;$(ReactDOM.findDOMNode(this.refs.content)).trigger("focus",!0,!0);var c=zmail.conPath+"/FileDownload?mode=tmpview&entityType=1&accId="+zmail.accId+"&fpath="+a.fP+"&fstorename="+a.sN,d=znBox.restoreSelectionNew($(ReactDOM.findDOMNode(this.refs.content))[0],b);d||$(ReactDOM.findDOMNode(this.refs.content)).trigger("focus"),znBox.isIE?znBox.insertHtmlAtCaret("<img src="+c+"></img>"):document.execCommand("insertHTML",!1,"<img src="+c+"></img>")}},{key:"setImage1",value:function(a){var b="/mail/ImageSignature?fileName="+zmUtil.getDummyFilename(a.fileName)+"&accountId="+zmail.accId+"&storeName="+a.storeName+"&frm=c";this.editor.insertImage(b,{size:"bestfit"})}},{key:"onHeightChange",value:function(a,b){$(ReactDOM.findDOMNode(this.refs.content)).css("maxHeight",a),this.triggerOnHeightChange=b}},{key:"handleSetHeight",value:function(a){this.showEditor||(this.selection=znBox.saveSelectionNew(ReactDOM.findDOMNode(this.refs.content))),this.height!==$(ReactDOM.findDOMNode(this.refs.content)).height()&&(this.height=$(ReactDOM.findDOMNode(this.refs.content)).height(),this.triggerOnHeightChange&&this.triggerOnHeightChange())}},{key:"handleSaveSelection",value:function(a,b,c){c||this.showEditor||(this.selection=znBox.saveSelectionNew(ReactDOM.findDOMNode(this.refs.content)))}},{key:"saveAttachment",value:function(a){var b=this.state.attachpath.slice(),c=this.state.attachname.slice(),d=this.state.attachstore.slice();c.push(a.name),b.push(a.fP),d.push(a.sN),this.setState({attachname:c}),this.setState({attachpath:b}),this.setState({attachstore:d})}},{key:"getNoteValues",value:function(){var a=_zm.unescapeTags(this.desc),b={title:this.title,desc:this.desc,textContent:a,catId:this.state.catId,groupId:this.state.namespaceId,color:this.state.color};return b}},{key:"getNoteDetails",value:function(){this.handleSetTitle(),this.handleSetDescription();var a=_zm.unescapeTags(this.desc),b={title:this.title,desc:this.desc,textContent:a,catId:this.state.catId,groupId:this.state.namespaceId,color:this.state.color};return b}},{key:"handlePaste",value:function(a){var b=this;this.ispaste=!0,znBox.handlePaste(a.target),setTimeout(function(){b.ispaste=!1,b.handleSetDescription(),b.handleKeyPress(a)},200)}},{key:"handleKeyDown",value:function(a){13===a.keyCode&&(a.preventDefault(),this.showEditor?this.editor.squireInstance.focus():ReactDOM.findDOMNode(this.refs.content).focus())}},{key:"handleKeyPress",value:function(a){!this.state.stickyEnabled&&zNote.checkForPrintableKeys(a)&&this.setState({stickyEnabled:!0})}},{key:"handleTitleFocused",value:function(){$(ReactDOM.findDOMNode(this.refs.title)).text()===znBox.CONTS.defaultTitle&&$(ReactDOM.findDOMNode(this.refs.title)).text("").attr("data-plhr",!1)}},{key:"handlePasteForTitle",value:function(a){var b=zNote.CONSTANTS.MAXCHARACTER.TITLE-ReactDOM.findDOMNode(this.refs.title).textContent.length;this.handleKeyPress(a),this.handleSetMaxCharacter(a)&&(this.ispaste=!0,znBox.handlePaste(a.target,void 0,b),this.ispaste=!1)}},{key:"handleSetMaxCharacter",value:function(a){var b=zNote.CONSTANTS.MAXCHARACTER.TITLE-ReactDOM.findDOMNode(this.refs.title).textContent.length;return this.handleKeyPress(a),!(b<=0)||(a.preventDefault(),_zm.succErrMsg("e",zNote.notei18n.titexceed),!1)}},{key:"handleStickyNote",value:function(){this.state.stickyEnabled&&(this.sticky=!0,this.save())}},{key:"render",value:function(){var b=this,c=!0,d="true",e={};e.display="none",e.position="absolute",e.top="13px";var f=zNote.notei18n.placeholder.title,g=zNote.notei18n.placeholder.writeSome,h=this.props.options&&this.props.options.quickAdd,i=this.props.options&&this.props.options.commentNote;(this.props.streams||h)&&(c=!1),h&&(d="false"),this.showEditor&&(this.editorId=(new Date).getTime());var j=h?"zn_note cursorPointer zn_quickAdd half "+zNote.CONSTANTS.COLORCODE[this.state.color]:"zn_note zn_popNote "+zNote.CONSTANTS.COLORCODE[this.state.color],k=znBox.getGroupName(this.state.namespaceId),l=zNote.getNamefrmCatObj(this.state.catId,this.state.namespaceId),m=this.state.stickyEnabled?"":"SC_disIco",n=this.sticky?m+" SC_mkStky active":m+" SC_mkStky",o=this.sticky?"msi-stiPNotes":"msi-stiNotes",p=this.desc.replace(/\n/g,"<br />");if(i)return e={},e.maxHeight="200px",e.overflowY="auto",j="zmCmntNote "+zNote.CONSTANTS.COLORCODE[this.state.color],React.createElement("div",{className:j,ref:"notebox"},React.createElement("div",{ref:"content",className:"zn_cont","data-plhr":g,"data-enableshortcuts":c,onPaste:this.handlePaste,onFocus:this.handleSaveSelection,onClick:this.handleSaveSelection,onKeyUp:this.handleSetHeight,onBlur:this.handleSetDescription,style:e,dangerouslySetInnerHTML:{__html:p},contentEditable:d}));if(h&&this.props.options.list){var q="zmImg SC_link "+zNote.CONSTANTS.COLORCODE[this.state.color];return React.createElement("div",{id:"quickAddNotes",className:"zmL SC_mlst zt_quickAdd","data-ty":"lt"},React.createElement("div",{className:"zmLst"},React.createElement("div",{className:"zmFlt"}),React.createElement("div",{className:"zmDtl"},React.createElement("div",{ref:"addIcon",className:q,onClick:this.handleQuickAddClick},React.createElement("i",{className:"msi-add"})),React.createElement("div",{className:"zmFrm",ref:"contentList",contentEditable:"true",placeholder:zNote.notei18n.addNote.quickAddPlaceholder,onPaste:this.handlePaste,onKeyDown:this.handleQuickAddKeyDown})),React.createElement("div",{className:"zmFrt"},React.createElement("span",{className:"js-loading loadRound",style:e}))))}return this.props.streams?React.createElement("div",{className:zNote.CONSTANTS.COLORCODE[this.state.color],ref:"notebox"},React.createElement("div",{className:"zn_tit","data-enableshortcuts":c,ref:"title",onPaste:b.handlePasteForTitle,onKeyPress:this.handleSetMaxCharacter,onKeyDown:this.handleKeyDown,onBlur:this.handleSetTitle,contentEditable:d,"data-plhr":f},this.title),React.createElement("div",{className:"zn_base"},React.createElement("div",null,React.createElement("div",{ref:"content",className:"zn_cont","data-plhr":g,"data-enableshortcuts":c,onPaste:this.handlePaste,onFocus:this.handleSaveSelection,onClick:this.handleSaveSelection,onKeyUp:this.handleSetHeight,onBlur:this.handleSetDescription,dangerouslySetInnerHTML:{__html:p},contentEditable:d}),React.createElement("div",{className:"SC_lnk SC_dyn"},"Read More ...")))):h?React.createElement("div",{className:j,ref:"notebox",onClick:this.props.options.addCallback},React.createElement("div",{className:"zn_qAdd"},React.createElement("i",{className:"msi-add"}),React.createElement("span",null,zNote.notei18n.common.newNote)),React.createElement("div",{className:"zn_dd"},React.createElement("div",{className:"zn_date"})),React.createElement("div",null,React.createElement("div",{className:"zn_tit","data-enableshortcuts":c,ref:"title",contentEditable:"false","data-plhr":f},this.title),React.createElement("div",{className:"zn_base"},React.createElement("div",null,React.createElement("div",{ref:"content",className:"zn_cont","data-plhr":g,dangerouslySetInnerHTML:{__html:p},contentEditable:"false"}),React.createElement("div",{className:"SC_lnk SC_dyn"},"Read More ...")))),React.createElement("div",{className:"zn_act zn_clear"},React.createElement("div",{className:"SCmb"},React.createElement("div",{className:"SC_flt",id:"noteL"},React.createElement("ul",null,React.createElement("li",{id:"zncolor",ref:"palette",onClick:b.handleSetColor},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-nclr"})))))))),React.createElement("div",{id:"grpDiv",className:"zn_folder zn_clear"},React.createElement("div",{className:"zn_cgy",id:"zncat"},React.createElement("font",{id:"zngroup",ref:"group",className:"zn_ngrp cursorPointer"},zNote.notei18n.note.selectGroup)))):React.createElement("div",{className:j,ref:"notebox"},React.createElement("div",{className:n,ref:"stickyNote",onClick:b.handleStickyNote},React.createElement("i",{className:o})),React.createElement("div",{className:"zn_dd"},React.createElement("div",{className:"zn_date"})),React.createElement("div",null,React.createElement("div",{className:"zn_tit","data-enableshortcuts":c,ref:"title",onPaste:b.handlePasteForTitle,onKeyPress:this.handleSetMaxCharacter,onKeyDown:this.handleKeyDown,onBlur:this.handleSetTitle,contentEditable:"true","data-plhr":f},this.title),React.createElement("div",{className:"zn_base",id:this.editorId},function(){return b.showEditor?null:React.createElement("div",{ref:"content",className:"zn_cont","data-plhr":g,"data-enableshortcuts":c,onPaste:b.handlePaste,onFocus:b.handleSaveSelection,onClick:b.handleSaveSelection,onKeyUp:b.handleSetHeight,onBlur:b.handleSetDescription,onKeyPress:b.handleKeyPress,dangerouslySetInnerHTML:{__html:p},contentEditable:"true"})}())),React.createElement("div",{className:"zn_act zn_clear"},React.createElement("div",{className:"SCmb"},React.createElement("div",{className:"SC_flt",id:"noteL"},React.createElement("ul",null,React.createElement("li",{id:"zncolor",ref:"palette",onClick:b.handleSetColor},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-nclr"})))),React.createElement("li",{id:"znImage",ref:"insertImgIcon",onClick:b.triggerFileInputClickEvent},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-image"})))),React.createElement("li",{id:"znAttach",ref:"attachIcon",onClick:b.triggerAttachComponent},React.createElement("b",null,React.createElement("div",{className:"SC_hd"}),React.createElement("span",null,React.createElement("i",{className:"msi-attachment"}))))),React.createElement("span",{ref:"editorBar"})))),React.createElement("div",{id:"grpDiv",className:"zn_folder zn_clear"},React.createElement("div",{className:"zn_cgy",id:"zncat"},React.createElement("font",{id:"zngroup",ref:"group",className:"zn_ngrp cursorPointer",onClick:b.handleChangeGroup},k),React.createElement("i",{className:"msi-rarrow"}),React.createElement("font",{id:"znscat",ref:"cgy",className:"zn_nbook",onClick:b.handleChangeBook},l))),React.createElement(a,{ref:"attDiv",onRemoveAttachment:this.handleOnRemoveAttachment,onRemoveMyAttachment:this.removeMyAttachment,attachname:this.state.attachname,attachpath:this.state.attachpath,attachstore:this.state.attachstore,attEntObj:this.state.attEntObj,attArray:this.attArray}),function(){if(!b.props.noAddCancel&&!h){var a=b.state.adding?zNote.notei18n.adding:zNote.notei18n.add;return React.createElement("div",{className:"zn_clear",ref:"addCancel"},React.createElement("div",{className:"SC_PUbtm"},React.createElement("span",{onClick:b.debouncedAddNote},a),React.createElement("span",{"data-val":"Cancel",onClick:b.handleCancel},zNote.notei18n.cancel)))}}(),React.createElement("div",{className:"zn_clear zn_lbl SC_dyn"}))}}]),c}(React.Component);var a=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return _inherits(b,a),_createClass(b,[{key:"getInitialState",value:function(){return{attachpath:[],attachstore:[],attachname:[]}}},{key:"deleteAttachment",value:function(a,b){a.stopPropagation();var c={aId:zmail.accId,sN:b.attachstore,fP:b.attachpath,mode:"d"},d={attachstore:b.attachstore,attachpath:b.attachpath},e={u:"/zm/attach.do",t:"POST",csr:"s",fn:this.props.onRemoveAttachment,p:c,ep:d};zmAjq.XHR(e)}},{key:"viewMyAttachment",value:function(a){var b={};b.startIndex=a,b.attObjList=this.props.attArray.slice(),b.hideAllOptions=!0,zmUtil.initAttSlideShow(b)}},{key:"render",value:function(){function a(a,h){e=zmUtil.fileTyp(a.name),d=zmUtil.getSrcForTempAtt({name:a.name,fP:a.fP,sN:a.sN}),"msi-attimg"===e[1]?(c=zmail.conPath+"/FileDownload?mode=tmpview&entityType=1&accountId="+zmail.accId+"&fpath="+a.fP+"&fstorename="+a.sN,b=React.createElement("img",{src:c})):(f=e[1]+" sc_big",b=React.createElement("i",{className:f})),g.push(React.createElement("div",{className:"zmL zmAch",title:a.name,onClick:i(h)},React.createElement("div",{className:"zmLst"},React.createElement("div",{className:"zmDtl"},React.createElement("div",{className:"zmImg"},b),React.createElement("div",{className:"SC_icn",onClick:j({attachname:a.name,attachstore:a.sN,attachpath:a.fP})},React.createElement("i",{className:"msi-close"}))))))}var b,c,d,e,f,g=[],h=this;if(!this.props.attArray.length)return React.createElement("div",{ref:"attach",className:"zn_clear zn_attach SC_dyn"},React.createElement("div",{className:"icn"},React.createElement("i",{className:"msi-attachpin"})));for(var i=function(a){return function(){h.viewMyAttachment(a)}},j=function(a){return function(b){h.deleteAttachment(b,a)}},k=function(a){return function(b){b.stopPropagation(),h.props.onRemoveMyAttachment(a)}},l=function(a,h){e=zmUtil.fileTyp(a.fn),d=a.thn,d?(c=d,b=React.createElement("img",{src:c})):(f=e[1]+" sc_big",b=React.createElement("i",{className:f})),g.push(React.createElement("div",{className:"zmL zmAch",title:a.fn,onClick:i(h)},React.createElement("div",{className:"zmLst"},React.createElement("div",{className:"zmDtl"},React.createElement("div",{className:"zmImg"},b),React.createElement("div",{className:"SC_icn"},React.createElement("i",{className:"msi-close",onClick:k(a)}))))))},m=0;m<this.props.attArray.length;m++)this.props.attArray[m].Id?l(this.props.attArray[m],m):a(this.props.attArray[m],m);return React.createElement("div",{className:"zn_folder zn_clear zn_attach"},React.createElement("div",{className:"icn"},React.createElement("i",{className:"msi-attachpin"})),g)}}]),b}(React.Component)}(),function(){zNote.Views=zNote.Views||{},zNote.Views.NoteListView=React.createClass({displayName:"NoteListView",getInitialState:function(){return{select:""}},handleViewNote:function(){"stickyNote"===this.props.note.collection.listInfo.mode?zNote.eventBus.trigger("openStickyNote",{namespaceId:this.props.note.get("namespaceId"),id:this.props.note.get("id")}):"noteApp"===this.props.note.collection.listInfo.source?(this.props.openNoteInPreviewCard({namespaceId:this.props.note.get("namespaceId"),id:this.props.note.get("id")}),$(ReactDOM.findDOMNode(this.refs.notelist)).addClass("zmSLst")):zNote.loadAndOpenNote({namespaceId:this.props.note.get("namespaceId"),id:this.props.note.get("id")},{type:"popup"})},componentDidMount:function(){var a=this;this.props.note.on("change",function(){this.forceUpdate()}.bind(this)),this.props.note.get("newNote")&&(this.props.note.set("newNote",void 0),$(ReactDOM.findDOMNode(a.refs.notelist)).addClass("highlightClass"),setTimeout(function(){$(ReactDOM.findDOMNode(a.refs.notelist)).removeClass("highlightClass")},3e3))},componentWillUnmount:function(){this.props.note.stopSubscriptions()},render:function(){var a="zmImg SC_link "+zNote.CONSTANTS.COLORCODE[this.props.note.get("color")],b=this.props.note.get("summary")&&this.props.note.get("summary").length?this.props.note.get("summary").trim().slice(0,1):"",c=this.props.note.get("title")&&this.props.note.get("title").length?this.props.note.get("title").slice(0,1):b;return React.createElement("div",{className:"zmL zm_urd",ref:"notelist",onClick:this.handleViewNote},React.createElement("div",{className:"zmLst"},React.createElement(zNote.Views.NoteListView.Favourite,{extraOptions:this.props.extraOptions,note:this.props.note}),React.createElement("div",{className:"zmDtl"},React.createElement("div",{className:"zmDate"},React.createElement("span",null,this.props.note.get("disptime"))),React.createElement("div",{className:a},c),React.createElement(zNote.Views.NoteListView.Creator,{extraOptions:this.props.extraOptions,note:this.props.note}),React.createElement("div",{className:"zmFrm"},React.createElement("span",{placeholder:zNote.notei18n.placeholder.title},znBox.spCharRep(this.props.note.get("title"))),React.createElement(zNote.Views.NoteListView.Description,{extraOptions:this.props.extraOptions,note:this.props.note}),React.createElement(zNote.Views.NoteListView.CommentIndicator,{extraOptions:this.props.extraOptions,note:this.props.note})),React.createElement("div",{className:"zmSub"},React.createElement(zNote.Views.NoteListView.AttachIndicator,{extraOptions:this.props.extraOptions,note:this.props.note}),React.createElement(zNote.Views.NoteListView.Book,{extraOptions:this.props.extraOptions,note:this.props.note})),React.createElement("div",{className:"zmFdr"},React.createElement("span",null,React.createElement(zNote.Views.NoteListView.Color,{extraOptions:this.props.extraOptions,note:this.props.note,parent:this}),React.createElement(zNote.Views.NoteListView.Sticky,{extraOptions:this.props.extraOptions,note:this.props.note}),React.createElement(zNote.Views.NoteListView.ArchiveUnArchive,{extraOptions:this.props.extraOptions,note:this.props.note}),React.createElement(zNote.Views.NoteListView.ShowMore,{extraOptions:this.props.extraOptions,note:this.props.note,parent:this}))),React.createElement("div",{className:"SC_icn"},React.createElement(zNote.Views.NoteListView.Delete,{extraOptions:this.props.extraOptions,note:this.props.note}),React.createElement(zNote.Views.NoteListView.AssociatedMail,{extraOptions:this.props.extraOptions,note:this.props.note})),React.createElement(zNote.Views.NoteListView.Tags,{extraOptions:this.props.extraOptions,note:this.props.note})),React.createElement(zNote.Views.NoteListView.Right,{extraOptions:this.props.extraOptions,note:this.props.note})))}}),zNote.Views.NoteListView.Description=React.createClass({displayName:"Description",getSummary:function(){return this.props.note.get("summary")&&this.props.note.get("summary").length?this.props.note.get("summary"):""},render:function(){return React.createElement("span",{className:"sum"}," - ",znBox.spCharRep(this.getSummary()))}}),zNote.Views.NoteListView.Title=React.createClass({displayName:"Title",render:function(){var a=znBox.spCharRep(znBox.getTextContentFromHTML(this.props.note.get("desc")));return React.createElement("span",{className:"sum"}," - ",a)}}),zNote.Views.NoteListView.Delete=React.createClass({displayName:"Delete",componentDidMount:function(){zmComponent.tooltip({elm:this.refs.deleteIcon,text:zNote.notei18n.tooltips.deleteNote,arrow:"top"})},handleDeleteNote:function(a){var b=this,c={};a.stopPropagation(),c.onOk=function(){b.props.note.deleteNote(b.props.note.get("id"))},c.stopPropagation=!0,zmsDialog.confirm(zNote.notei18n.confirmMsg.delNote,c)},render:function(){return this.props.note.get("ownerZUID")!==zmail.zuid||"mailassociated"===this.props.extraOptions.id||znBox.checkForGroupDisabled({groupId:this.props.note.get("namespaceId")})||"stickyNote"===this.props.extraOptions.mode?null:React.createElement("i",{
className:"msi-trash",ref:"deleteIcon",onClick:this.handleDeleteNote})}}),zNote.Views.NoteListView.AssociatedMail=React.createClass({displayName:"AssociatedMail",componentDidMount:function(){zmComponent.tooltip({elm:this.refs.mailopen,text:zNote.notei18n.tooltips.openmail,arrow:"top"})},handleViewAssociatedMail:function(a){var b={};a.stopPropagation(),this.props.note.get("email").accid!==zmail.accId&&(b={actionType:"viewGroupMailEntity",entityId:this.props.note.get("notes").email.msgid,entityType:"1",streamsView:"true",streams:!0,groupId:this.props.note.get("namespaceId"),accId:this.props.note.get("email").accid}),zmList.getMailData({msgId:this.props.note.get("email").msgid,opentype:2,type:"lt",src:"external",eprm:b})},render:function(){return!this.props.note.get("email")||$.isEmptyObject(this.props.note.get("email"))||"mailassociated"===this.props.extraOptions.id||"stickyNote"===this.props.extraOptions.mode?null:React.createElement("i",{className:"msi-mailopen",ref:"mailopen",onClick:this.handleViewAssociatedMail})}}),zNote.Views.NoteListView.ArchiveUnArchive=React.createClass({displayName:"ArchiveUnArchive",componentDidMount:function(){var a=this.props.note.get("archived")?zNote.notei18n.note.unarchive:zNote.notei18n.note.archive;zmComponent.tooltip({elm:this.refs.archive,text:a,arrow:"top"})},componentDidUpdate:function(){var a=this.props.note.get("archived")?zNote.notei18n.note.unarchive:zNote.notei18n.note.archive;zmComponent.tooltip({elm:this.refs.archive,text:a,arrow:"top"})},handleArchive:function(a){a.stopPropagation();var b=!this.props.note.get("archived");this.props.note.archiveOrUnarchiveNote({archived:b})},render:function(){var a=this.props.note.get("archived")?"msi-unarchive":"msi-archive",b=!1;return!znBox.checkForGroupDisabled({groupId:this.props.note.get("namespaceId")})&&(this.props.note.get("ownerZUID")===zmail.zuid||zmCont.getGroup()[this.props.note.get("namespaceId")]&&zmCont.getGroup()[this.props.note.get("namespaceId")].isOwner)&&(b=!0),znBox.isArchiveOpen()&&b&&"mailassociated"!==this.props.extraOptions.id&&"stickyNote"!==this.props.extraOptions.mode?React.createElement("i",{ref:"archive",className:a,onClick:this.handleArchive}):null}}),zNote.Views.NoteListView.CommentIndicator=React.createClass({displayName:"CommentIndicator",componentDidMount:function(){zmComponent.tooltip({elm:this.refs.star,text:zNote.notei18n.tooltips.changeFavourite,arrow:"top"})},handleSetFavourite:function(a){a.stopPropagation(),this.props.note.saveFavourite()},render:function(){return"mailassociated"!==this.props.extraOptions.id&&"stickyNote"!==this.props.extraOptions.mode&&this.props.note.get("commentCount")&&0!==this.props.note.get("commentCount")?React.createElement("div",{className:"SC_dft",title:zNote.notei18n.info.commentsavailable},React.createElement("i",{className:"msi-lcmnt"}),React.createElement("span",null,this.props.note.get("commentCount"))):null}}),zNote.Views.NoteListView.AttachIndicator=React.createClass({displayName:"AttachIndicator",handleShowAttachments:function(a){var b=this;a.stopPropagation();var c=this.props.note.get("attachments").map(function(a){var c=a[Object.keys(a)[0]];return c.e=b.props.note.get("id"),c.et=zNote.CONSTANTS.entityType,c.gId=b.props.note.get("namespaceId"),c}),d={app:"compose",attList:c,supportDrag:!0},e='<div><div class="SC_PUtt"><div class="SCmb"><ul><li><b><div class="SC_hd"></div><span class="SC_ttip ttr" data-tooltip="Close"><i class="msi-close" data-msg="close"></i></span></b></li></ul></div></div></div>',f='<div class="SC_tp10"> '+zmText.applyArgs("{{count}} Attachments",{count:c.length})+"</div>",g=$(e);g.append(zmAttach.build(d)),g.find(".zmPAtt").prepend(f);var h={par:ReactDOM.findDOMNode(this.refs.attachicon),showArrow:!0,liDom:g,spanClass:"zm_attPop minwid zmAtt_mulMail",clk:function(a,b){}};zmsuite.showMenu(h),g.find(".msi-close").click(function(){$("#zm_dropDown").remove()})},render:function(){return this.props.note.get("attachments")&&this.props.note.get("attachments").length&&"mailassociated"!==this.props.extraOptions.id&&"stickyNote"!==this.props.extraOptions.mode?React.createElement("i",{className:"msi-attachicon",ref:"attachicon",onMouseDown:this.handleSetAttributes,onClick:this.handleShowAttachments}):null}}),zNote.Views.NoteListView.Book=React.createClass({displayName:"Book",componentDidMount:function(){this.props.note.get("ownerZUID")===zmail.zuid&&zmComponent.tooltip({elm:this.refs.book,text:zNote.notei18n.tooltips.moveNote,arrow:"top"})},changeGroup:function(a){if(this.props.note.get("ownerZUID")===zmail.zuid){var b;a.stopPropagation();var c=znBox.getGroupArray(),d=this,e={};e.parentDOM=ReactDOM.findDOMNode(this.refs.group),e.displayAs="popup",e.showCreate=!0,e.onSelect=function(a){d.props.note.changeGroup(a),b.hide()},e.onHide=function(){$("#zm_dropDown").remove()},e.dataCallback=function(){return c},b=zmUtil.createFLComp("group",e),b.show()}},handleChangeBook:function(a){if((!this.props.extraOptions||"stickyNote"!==this.props.extraOptions.mode)&&this.props.note.get("ownerZUID")===zmail.zuid){a.stopPropagation();var b,c=znBox.getCategoryArray(this.props.note.get("namespaceId")),d=this,e={};e.parentDOM=ReactDOM.findDOMNode(this.refs.book),e.displayAs="popup",e.onSelect=function(a){d.props.note.changeBook(a),b.hide()},(this.props.note.get("namespaceId")===zmail.zuid||zmCont.getGroup()[this.props.note.get("namespaceId")]&&zmCont.getGroup()[this.props.note.get("namespaceId")].isOwner)&&(e.onCreate=function(a){znNote.sendNewCatReq(a,{},d.props.note.get("namespaceId")).done(function(a){d.props.note.changeBook(a[1][0].catId),b.hide()})}),e.onHide=function(){$("#zm_dropDown").remove()},e.dataCallback=function(){return c},b=zmUtil.createFLComp("category",e),b.show()}},render:function(){var a=znBox.getGroupName(this.props.note.get("namespaceId")),b=zNote.getNamefrmCatObj(this.props.note.get("cat"),this.props.note.get("namespaceId"));return""===a?null:React.createElement("span",{className:"zn_cat"},React.createElement("font",{id:"zngroup",ref:"group",className:"zn_ngrp"},a),React.createElement("i",{className:"msi-rarrow"}),React.createElement("font",{id:"znscat",ref:"book",className:"zn_nbook",onClick:this.handleChangeBook},b))}}),zNote.Views.NoteListView.Favourite=React.createClass({displayName:"Favourite",componentDidMount:function(){zmComponent.tooltip({elm:this.refs.star,text:zNote.notei18n.tooltips.changeFavourite,arrow:"top"})},handleSetFavourite:function(a){a.stopPropagation(),this.props.note.saveFavourite()},render:function(){var a=this.props.note.get("starred")?"msi-fav SC_fav":"msi-fav";return"mailassociated"===this.props.extraOptions.id||"stickyNote"===this.props.extraOptions.mode?null:React.createElement("div",{className:"zmFlt",onClick:this.handleSetFavourite},React.createElement("i",{className:a,ref:"star"}))}}),zNote.Views.NoteListView.Sticky=React.createClass({displayName:"Sticky",componentDidMount:function(){zmComponent.tooltip({elm:this.refs.sticky,text:zNote.notei18n.note.makeSticky,arrow:"top"})},handleMakeSticky:function(a){a.stopPropagation(),zNote.addAsStickyNote(this.props.note.toJSON())},handleSetAttributes:function(){$(ReactDOM.findDOMNode(this.refs.sticky)).attr("data-current","true"),"true"===$(ReactDOM.findDOMNode(this.refs.sticky)).attr("data-visible")?$(ReactDOM.findDOMNode(this.refs.sticky)).attr("data-visible","false"):$(ReactDOM.findDOMNode(this.refs.sticky)).attr("data-visible","true")},render:function(){return"mailassociated"===this.props.extraOptions.id||"stickyNote"===this.props.extraOptions.mode?null:React.createElement("i",{className:"msi-stiNotes",ref:"sticky",onMouseDown:this.handleSetAttributes,onClick:this.handleMakeSticky})}}),zNote.Views.NoteListView.Creator=React.createClass({displayName:"Creator",componentDidMount:function(){var a=this;zmail.ContactBook.get({zuid:a.props.note.get("ownerZUID")}).done(function(b){var c=b[0];c&&c.attrs&&c.attrs.fn&&(zmComponent.tooltip({elm:a.refs.creator,text:c.attrs.fn,arrow:"top"}),$(ReactDOM.findDOMNode(a.refs.creatorname)).text(c.attrs.fn))})},render:function(){var a="zmOwn";return"mailassociated"===this.props.extraOptions.id||"stickyNote"===this.props.extraOptions.mode||"c"===this.props.extraOptions.mode&&this.props.extraOptions.groupId===zmail.zuid?null:React.createElement("div",{className:a,ref:"creator"},React.createElement("span",{className:"SC_thm",ref:"creatorname"}))}}),zNote.Views.NoteListView.Color=React.createClass({displayName:"Color",componentDidMount:function(){zmComponent.tooltip({elm:this.refs.palette,text:zNote.notei18n.tooltips.changeColor,arrow:"top"})},handleSetColor:function(a){a.stopPropagation();var b=this;if("true"===$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-visible")){var c=$('<li><div class="zn_clr"><div class="zn_clr1"></div><div class="zn_clr2"></div><div class="zn_clr3"></div><div class="zn_clr4"></div></div></li>');c.find("."+zNote.CONSTANTS.COLORCODE[this.props.note.get("color")]).append("<i class=msi-tick></i>");var d={par:a.target,showArrow:!0,liDom:c,direction:"bottom",ulClass:"zn_clrSel",spanClass:"minwid"};zmsuite.showMenu(d),$(c[0]).find("div").children("div").off("click").on("click",function(a){a.stopPropagation(),$("#zm_dropDown").remove(),$(ReactDOM.findDOMNode(b.refs.palette)).attr("data-visible","false"),b.props.note.saveColor(zNote.CONSTANTS.COLOR[this.className]),$(ReactDOM.findDOMNode(b.props.parent.refs.notelist)).addClass("sel")})}$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-current","false"),$(ReactDOM.findDOMNode(this.props.parent.refs.notelist)).addClass("sel"),$(ReactDOM.findDOMNode(this.refs.palette)).addClass("active")},handleSetAttributes:function(){$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-current","true"),"true"===$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-visible")?$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-visible","false"):$(ReactDOM.findDOMNode(this.refs.palette)).attr("data-visible","true")},render:function(){return"mailassociated"===this.props.extraOptions.id||"stickyNote"===this.props.extraOptions.mode||this.props.note.get("ownerZUID")!==zmail.zuid||znBox.checkForGroupDisabled({groupId:this.props.note.get("namespaceId")})?null:React.createElement("i",{className:"msi-nclr",ref:"palette",onMouseDown:this.handleSetAttributes,onClick:this.handleSetColor})}}),zNote.Views.NoteListView.ShowMore=React.createClass({displayName:"ShowMore",componentDidMount:function(){zmComponent.tooltip({elm:this.refs.showmoreicon,text:zNote.notei18n.tooltips.moreOptions,arrow:"top"})},popupClick:function(a){switch(znBox.hideMenu(),a.action){case"addTag":this.props.parent.refs.tag.addLabel(ReactDOM.findDOMNode(this.props.parent.refs.showmore));break;case"sendMail":this.props.note.sendAsMail();break;case"delNote":this.props.note.deleteNote(this.props.note.get("id"));break;case"print":zNote.printNote({id:this.props.note.get("id"),namespaceId:this.props.note.get("namespaceId")});break;case"openintab":zNote.openNoteInTab({id:this.props.note.get("id"),namespaceId:this.props.note.get("namespaceId")});break;case"copyNote":znBox.copyNote({title:this.props.note.get("title"),catId:this.props.note.get("cat"),namespaceId:this.props.note.get("namespaceId"),attachments:!0},this.props.note.postAsNew.bind(this.props.note))}},addAttachment:function(){var a=this;if(a.attRefObj)a.attRefObj.init();else{var b={componentId:"notes",isNewImp:!0,attachFrom:["desktop","myAttachchment","zDocs","otherCloud"],currentAttachedSize:0,eleId:$(ReactDOM.findDOMNode(a.props.parent.refs.attDiv)),onAllUploadFinish:{handler:function(b){a.props.note.saveAttachment(b)},resetData:!0,removeAttachDOM:!0}};zmUtil.initAttachComponent(b,function(b){a.attRefObj=b})}},setAttributes:function(){$(ReactDOM.findDOMNode(this.refs.showmoreicon)).attr("data-current","true"),"true"===$(ReactDOM.findDOMNode(this.refs.showmoreicon)).attr("data-visible")?$(ReactDOM.findDOMNode(this.refs.showmoreicon)).attr("data-visible","false"):$(ReactDOM.findDOMNode(this.refs.showmoreicon)).attr("data-visible","true")},showMoreOptions:function(a){a.stopPropagation();var b=this,c={};c.sendMail={htm:zNote.notei18n.note.sendMail,data:{action:"sendMail"}},c.printNote={htm:zNote.notei18n.note.printNote,data:{action:"print"}},c.copyNote={htm:zNote.notei18n.note.copyNote,data:{action:"copyNote"}},c.openInTab={htm:zNote.notei18n.note.openTab,data:{action:"openintab"}};var d=[c.sendMail,c.printNote];if(d.push(c.openInTab),_zm._isPrivilegedUser()&&d.push(c.copyNote),"true"===$(ReactDOM.findDOMNode(this.refs.showmoreicon)).attr("data-visible")){var e={par:a.target,showArrow:!0,list:d,direction:"bottom",clk:function(a,c){$(c).hasClass("SC_op3")||b.popupClick(a)}};zmsuite.showMenu(e),$(ReactDOM.findDOMNode(this.refs.showmoreicon)).attr("data-current","false"),$(ReactDOM.findDOMNode(this.props.parent.refs.notelist)).addClass("sel")}},render:function(){var a=this;if("mailassociated"===this.props.extraOptions.id||"stickyNote"===this.props.extraOptions.mode)return null;var b=function(){return function(b){a.showMoreOptions(b)}},c=function(){return function(b){a.setAttributes(b)}};return React.createElement("i",{className:"msi-nmore",ref:"showmoreicon",onClick:b(),onMouseDown:c()})}}),zNote.Views.NoteListView.Tags=React.createClass({displayName:"Tags",componentDidMount:function(){var a=this.refs.labelicon||this.refs.plus;zmComponent.tooltip({elm:a,text:zNote.notei18n.note.addTag,arrow:"top"})},addLabel:function(a,b){a.stopPropagation();var c,d=this,e={};e.parentDOM=this.refs.plus?ReactDOM.findDOMNode(this.refs.plus):b,e.displayAs="popup",e.labelState={labelList:this.props.note.get("tagId")},e.showCreate=!0,e.accType="default",e.onHide=function(){$("#zm_dropDown").remove()},e.onCreate=function(a,b){znNote.sendNewLabReq(a,b).done(function(a){a&&1===a[0]&&a[1].labelId&&(c.hide(),d.props.note.addTag(a[1].labelId))})},e.onStateChange=function(a,b){b?d.props.note.addTag(a):d.props.note.removeTag(a)},c=zmUtil.createFLComp("label",e),c.show()},render:function(){var a={backgroundColor:""},b=this;if(!this.props.note.get("tagId")||!this.props.note.get("tagId").length||"mailassociated"===this.props.extraOptions.id||"stickyNote"===this.props.extraOptions.mode)return null;var c=function(a){return function(c){b.addLabel(c,a)}};return b.props.note.get("tagId")&&b.props.note.get("tagId").length>0?React.createElement("div",{className:"zm_lbl"},b.props.note.get("tagId").map(function(b){return!!zmUtil.getTagList("default")[b]&&(a={backgroundColor:zmUtil.getTagList("default")[b].color},React.createElement("p",{"data-mid":"",title:zmUtil.getTagList("default")[b].label,onClick:c(),className:"zmAttLbl"},React.createElement("font",{style:a})))}),React.createElement("i",{className:"msi-plus",ref:"plus",onClick:c()})):void 0}}),zNote.Views.NoteListView.Right=React.createClass({displayName:"Right",render:function(){return"mailassociated"===this.props.extraOptions.id||"stickyNote"===this.props.extraOptions.mode?null:React.createElement("div",{className:"zmFrt"})}})}(),function(){zNote.Views=zNote.Views||{},zNote.Views.NoteListCollectionView=React.createClass({displayName:"NoteListCollectionView",getInitialState:function(){return this.initializeValue(),{}},initializeValue:function(){this.color=_.random(0,3);var a,b;this.props.noteList.listInfo&&"zn_catAll"!==this.props.noteList.listInfo.id&&"c"===this.props.noteList.listInfo.mode?(a=this.props.noteList.listInfo.id,b=this.props.noteList.listInfo.groupId):"zn_catAll"===this.props.noteList.listInfo.id?(a=znBox.getGeneralCatId(this.props.noteList.listInfo.groupId),b=this.props.noteList.listInfo.groupId):(a=znBox.getGeneralCatId(zmail.zuid),b=zmail.zuid),this.newNoteModel=new zNote.Models.addNote({namespaceId:b,catId:a,color:this.color})},componentDidMount:function(){this.props.noteList.on("add",function(){this.forceUpdate()}.bind(this)),this.props.noteList.on("remove",function(){this.forceUpdate()}.bind(this)),zNote.eventBus.on("removeMask",this.checkAndClosePreview,this),this.newNoteModel.on("change",function(a){void 0!==a.changed.color&&this.forceUpdate()}.bind(this)),$.subscribe("/note/delete",this.noteOnDelete)},componentWillUnmount:function(){zNote.eventBus.off("removeMask",this.checkAndClosePreview,this),this.closePreview(),$.unsubscribe("/note/delete",this.noteOnDelete),this.props.noteList.stopSubscriptions()},checkAndClosePreview:function(a){this.openPreviewNoteData&&a&&a[0]&&this.openPreviewNoteData.id===a[0].id&&this.openPreviewNoteData.namespaceId===a[0].namespaceId&&this.closePreview()},closePreview:function(){if("noteApp"===this.props.noteList.listInfo.source){var a=zmsuite.getCenter("zm_notes"),b=a[0].getNodes(),c=a[1].getNodes();c[1].$el.find(".postMsg").length&&ReactDOM.unmountComponentAtNode(c[1].$el.find(".postMsg")[0]),c[0].$el.find(".noteHeader").length&&ReactDOM.unmountComponentAtNode(c[0].$el.find(".noteHeader")[0]),b[2].$el.find(".zmSLst").removeClass("zmSLst"),zmsuite.getCenter("zm_notes")[1].close(),this.openPreviewNoteData={}}},noteOnDelete:function(a,b,c){this.openPreviewNoteData&&this.openPreviewNoteData.id===b&&this.openPreviewNoteData.namespaceId===c&&this.closePreview()},noteView:function(a,b){this.noteViewList=this.noteViewList||{},this.noteViewList[b.get("id")]=a},getHeaderIcons:function(){var a="",b=[];zmail.isOrg&&zmUtil.isChatletEnabled()&&b.push({tooltip:zmText.get("topMenus").menus.chatlet,html:[["I",{attrs:{"class":"msi-cliqColor"},child:[["I",{attrs:{"class":"path1"}}],["I",{attrs:{"class":"path2"}}]]}]],data:"chatlet"}),b.push({tooltip:zNote.notei18n.tooltips.moreOptions,iconClass:"msi-action",data:"action"}),b.push({tooltip:zNote.notei18n.preview.previous,iconClass:"msi-prev",data:"prev"}),b.push({tooltip:zNote.notei18n.preview.next,iconClass:"msi-next",data:"next"}),b.push({tooltip:zNote.notei18n.preview.close,iconClass:"msi-close",data:"close"});var c={text:a,rIcons:[b]};return c},handleAddNote:function(){zNote.loadAddNote({addparams:{msgid:this.props.noteList.listInfo.msgid,senderid:this.props.noteList.listInfo.senderid,accid:this.props.noteList.listInfo.accid}})},handleOpenNoteInPreviewcard:function(a){var b,c,d,e,f,g,h,i=this,j=zmsuite.getCenter("zm_notes"),k=j[1].getNodes(),l=j[0].getNodes();l[2].$el.find(".zmSLst").removeClass("zmSLst"),k[1].$el.find(".postMsg").length&&ReactDOM.unmountComponentAtNode(k[1].$el.find(".postMsg")[0]),k[0].$el.find(".noteHeader").length&&ReactDOM.unmountComponentAtNode(k[0].$el.find(".noteHeader")[0]),k[1].$el.html(""),k[1].$el.empty(),this.openPreviewNoteData=a,d=i.props.noteList.where({id:i.openPreviewNoteData.id,namespaceId:i.openPreviewNoteData.namespaceId})[0],e=i.props.noteList.indexOf(d);var m=this.getHeaderIcons();k[0].push(m),k[0].setListener("click",function(b,c){if("action"===b||"msi-action"===b.action){var d=zmStreamsApp.util.getDropdownMenu(a.namespaceId+"#"+a.id,zNote.CONSTANTS.entityType);$(c).closest("b").addClass("SC_ddn");var g={par:$(c).closest("b")[0],list:d,dir:"top",align:"pright",spanClass:"SC_dd",defaultclass:!1,clk:function(a,b){a.fn()}};zmsuite.showMenu(g)}else if("close"===b||"clsPrev"===b.action)l[2].$el.find(".zmSLst").removeClass("zmSLst"),i.closePreview();else if("prev"===b||"msi-prev"===b.action)f=i.props.noteList.at(e-1),i.noteViewList[f.get("id")].handleViewNote(),$(ReactDOM.findDOMNode(i.noteViewList[f.get("id")].refs.notelist))[0].scrollIntoView(!1);else if("next"===b||"msi-next"===b.action)f=i.props.noteList.at(e+1),i.noteViewList[f.get("id")].handleViewNote(),$(ReactDOM.findDOMNode(i.noteViewList[f.get("id")].refs.notelist))[0].scrollIntoView(!1);else if("chatlet"===b||"chatlet"===b.action){var j=h&&h.get("gnrl")?h.get("gnrl").by:"";znBox.invokeChatlet(c,{id:a.id,namespaceId:a.namespaceId,ownerZUID:j})}}),j[1].show(),j[1].$el.addClass("zn_pv"),0===e&&k[0].$el.find(".msi-prev").closest("li").addClass("SC_opy3 SC_nopntr"),e===i.props.noteList.length-1&&k[0].$el.find(".msi-next").closest("li").addClass("SC_opy3 SC_nopntr");var n=zmComponent.loadingBand({container:k[1].$el[0],type:"pagination"});zNote.getNoteDetails(a).done(function(d){if(0!==d[0]){b=d[1];var e=$("<div class='SC_notePreview'></div>");c=$("<div class='postMsg'></div>"),h=new zNote.Models.previewNote(b);var f=function(a){g=a};k[0].$el.append("<div class='noteHeader'></div>");var i={previewCard:"true",disableShortcuts:"true"};ReactDOM.render(React.createElement(zNote.Views.NoteHeaderPreview,{options:i,note:h}),k[0].$el.find(".noteHeader")[0]),k[0].$el.find(".SCS_postDet").prepend('<a href="/zm/#notes/tab/'+a.namespaceId+"/"+a.id+'" class="dateTime">'+h.get("notes").disptime+"</a>"),k[1].$el.off("scroll").on("scroll",function(){znBox.hideMenu()}),zmUtil.requireStreamsApp().done(function(){n(),zmStreamsApp.PostApp.singlePost({elm:e,viewPost:!0,fixedComment:!1,isPreview:!1,response:b,hideContent:!0}),k[1].push(e[0]),e.find(".SCS_postHead").after(c),ReactDOM.render(React.createElement(zNote.Views.NotePreview,{ref:f,options:i,note:h}),c[0]);var a=$(k[1].$el).innerHeight();g.refs.desc.setContentHeight({height:.6*a}),e.find(".SCS_postHead").addClass("SC_dyn")})}})},render:function(){var a,b=this;this.color=_.random(0,3),this.newNoteModel.set({color:this.color});var c,d={id:this.props.noteList.listInfo.id,groupId:this.props.noteList.listInfo.groupId,mode:this.props.noteList.listInfo.mode},e=function(a){return function(c){b.noteView(c,a)}};return c="byuser"===d.mode||"sharedtome"===d.mode||"archive"===d.mode||znBox.checkForGroupDisabled({groupId:this.props.noteList.listInfo.groupId})?{__html:zmText.get("notes","nonotesavailable")}:"search"===d.mode?{__html:zmText.get("notes","nosearchnotes")}:{__html:zmText.get("notes","nonotescreate",{create:"<font onClick={znNote.createInlineNotes()}>"+zNote.notei18n.create+"</font>"})},"noteApp"===this.props.noteList.listInfo.source?this.props.noteList.length?React.createElement("div",{id:"wrapperNoteDiv",ref:"wrapDiv"},function(){return znBox.checkForQuickAdd(b.props.noteList.listInfo)?React.createElement(zNote.Views.addNoteViewReact,{ref:"quickAdd",note:b.newNoteModel,options:{quickAdd:!0,list:!0}}):null}(),this.props.noteList.map(function(a){return React.createElement(zNote.Views.NoteListView,{ref:e(a),openNoteInPreviewCard:b.handleOpenNoteInPreviewcard,extraOptions:d,note:a,key:a.get("id")})})):React.createElement("div",{id:"wrapperNoteDiv",ref:"wrapDiv"},React.createElement("div",{id:"nonotes",className:"SC_nmsg",dangerouslySetInnerHTML:c})):this.props.noteList.length?(a=this.props.noteList.options&&this.props.noteList.options.showHeader?"multiAppHead":"multiAppHead SC_dyn",React.createElement("div",{className:"multiAppData"},React.createElement("div",{className:"multiAppInfo SC_notes SC_cmptNotes"},React.createElement("div",{className:a}," ",React.createElement("span",null,"Notes"),React.createElement("div",{className:"SCmb SC_frt"},React.createElement("ul",null,React.createElement("li",{className:"SCtxt"},React.createElement("b",null,React.createElement("span",{onClick:this.handleAddNote},"Add Note")))))),this.props.noteList.map(function(a){return React.createElement(zNote.Views.NoteListView,{extraOptions:d,ref:e(a),note:a,key:a.get("id")})})))):(a=this.props.noteList.options&&this.props.noteList.options.showHeader?"multiAppHead":"multiAppHead SC_dyn",React.createElement("div",{className:"multiAppData"},React.createElement("div",{className:"multiAppInfo SC_notes SC_cmptNotes"},React.createElement("div",{className:a}," ",React.createElement("span",null,"Notes"),React.createElement("div",{className:"SCmb SC_frt"},React.createElement("ul",null,React.createElement("li",{className:"SCtxt"},React.createElement("b",null,React.createElement("span",{onClick:this.handleAddNote},"Add Note")))))),React.createElement("div",{id:"wrapperNoteDiv",ref:"wrapDiv"},React.createElement("div",{id:"nonotes",className:"SC_nmsg",dangerouslySetInnerHTML:c})))))}})}();