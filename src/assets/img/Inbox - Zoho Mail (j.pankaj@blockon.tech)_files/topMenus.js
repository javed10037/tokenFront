!function(){"use strict";var a,b,c,d,e,f,g,h,i,j=zmail.Core.Namespaces.create("zmTopMenus"),k=zmText.get("topMenus"),l={},m=function(a){"string"==typeof a&&(a=[a]),a.forEach(function(a){f.find("."+a).closest("li").hide()})},n=function(a){"string"==typeof a&&(a=[a]),a.forEach(function(a){f.find("."+a).closest("li").show()})},o={};o.lRmenus=[{groupId:"conversation",actionArr:[{iconList:["msi-thread"],tooltip:k.menus.swithOffConv,hideIcon:!0,customClass:"SC_prm"},{iconList:["msi-conversation"],tooltip:k.menus.switchOnConv,hideIcon:!0,customClass:"SC_prm"}]},{groupId:"LViewType",actionArr:[{iconList:["msi-classic"],dropAction:!0,tooltip:k.menus.chgview}]},{groupId:"searchClose",actionArr:[{iconList:["msi-close"],tooltip:k.menus.close,hideIcon:!0}]}],o.lLmenus=[{groupId:"selection",actionArr:[{iconList:["msi-uncheck","msi-barrow"],dropAction:!0,hideIcon:!0}]},{groupId:"filter",actionArr:[{iconList:["msi-filter"],dropAction:!0,tooltip:k.menus.views,hideIcon:!0}]},{groupId:"attachFilter",actionArr:[{iconList:["msi-attsearch"],dropAction:!0,tooltip:k.menus.attachFilter,hideIcon:!0}]},{groupId:"sortCustom",actionArr:[{iconList:["msi-sortdatedn"],tooltip:k.menus.sortDescend,hideIcon:!0},{iconList:["msi-sortdateup"],tooltip:k.menus.sortAscend,hideIcon:!0}]},{groupId:"newTemplate",actionArr:[{iconList:["msi-plus"],tooltip:"Create Template",separator:!0}],hideGroup:!0}],o.fmenus=[{groupId:"move",actionArr:[{iconList:["msi-folder"],dropAction:!0,iconClass:"msi-folder",data:"msi-folder",tooltip:k.menus.move,hideIcon:!0}]},{groupId:"label",actionArr:[{iconList:["msi-label"],dropAction:!0,tooltip:k.menus.addtag,iconClass:"msi-label",data:"msi-label",hideIcon:!0}]},{groupId:"trash",actionArr:[{iconList:["msi-trash"],tooltip:k.menus["delete"],iconClass:"msi-trash",data:"msi-trash",separator:!0,hideIcon:!0}]},{groupId:"spam",actionArr:[{iconList:["msi-spam"],tooltip:k.menus.markspam,iconClass:"msi-spam",data:"msi-spam",hideIcon:!0},{iconList:["msi-notspam"],tooltip:k.menus.marknotspam,iconClass:"msi-notspam",data:"msi-notspam",hideIcon:!0}]},{groupId:"archive",actionArr:[{iconList:["msi-archive"],tooltip:k.menus.archive,iconClass:"msi-archive",data:"msi-archive",separator:!0,hideIcon:!0},{iconList:["msi-unarchive"],tooltip:k.menus.unarchive,separator:!0,iconClass:"msi-unarchive",data:"msi-unarchive",hideIcon:!0}]}],o.lOutmenus=[{groupId:"outboxSend",actionArr:[{iconList:["msi-send",{txt:k.menus.sendnow+"&nbsp;"}],tooltip:k.menus.sendnow,iconClass:"msi-send",data:"msi-send"}],hideGroup:!0}],o.cmenus=[{groupId:"action",actionArr:[{iconList:["msi-action"],dropAction:!0,tooltip:k.menus.moreact,separator:!0,iconClass:"msi-action",data:"msi-action",hideIcon:!0}]}],l.get=function(a){var b;return"all"===a||"search"===a?(b={},b.left="all"===a?o.lLmenus.concat(o.lOutmenus):o.lLmenus,b.left=b.left.concat(o.fmenus),b.left=b.left.concat(o.cmenus),b.right=o.lRmenus):"functional"===a&&(b=o.fmenus.concat(o.cmenus)),b};var p=function(){return!!("zm_Container"===i&&Object.keys(b).length&&"archive"===b.view||zmail.mailObj[d]&&zmail.mailObj[d].AR)},q={};q.groups={},q.groups.move={expose:function(b){b||a===e.spId||a===e.dId||zmUtil.isSharedFolder(a)||a===e.teId||a===e.oId?m("msi-folder"):n("msi-folder")}},q.groups.label={expose:function(b){b||a===e.spId||a===e.dId||zmUtil.isSharedFolder(a)||a===e.oId?m("msi-label"):n("msi-label")}},q.groups.spam={expose:function(b){var c=["msi-spam","msi-notspam"];return b||p()||zmUtil.isSharedFolder(a)?void m(c):(n(c),void(a!==e.spId?(m(c[1]),n(c[0]),a!==e.sId&&a!==e.oId&&a!==e.teId&&a!==e.dId||m(c[0])):(m(c[0]),n(c[1]))))}},q.groups.trash={expose:function(b){b||zmUtil.isSharedFolder(a)?m(["msi-trash"]):n(["msi-trash"])}},q.groups.archive={expose:function(b){var c=["msi-archive","msi-unarchive"];return b||zmUtil.isSharedFolder(a)?void m(c):(n(c),void(p()?(n(c[1]),m(c[0])):(m(c[1]),n(c[0]),a!==e.spId&&a!==e.teId&&a!==e.dId&&a!==e.tId&&a!==e.oId||m(c[0]))))}},q.groups.outboxSend={expose:function(b){b||a!==e.oId?c.hideGroup("outboxSend"):c.showGroup("outboxSend")}};var r={};r.groups={},r.groups.selection={expose:function(){zmUtil.isSharedFolder(a,"R")?m(["msi-uncheck","msi-barrow"]):n(["msi-uncheck","msi-barrow"])}},r.groups.sortCustom={expose:function(){var b=zmUtil.getMLConversionValue(a);g||0!==b||a===e.dId||a===e.oId||a===e.teId?c.hideGroup("sortCustom"):c.showGroup("sortCustom")}},r.groups.filter={expose:function(){!g&&b.fId&&a!==e.dId&&a!==e.oId&&(!zmUtil.isSharedFolder(a)||92!==zmail.shrTree[0][a].RT)||b.flag?n("msi-filter"):m("msi-filter")}},r.groups.attachFilter={expose:function(){!g&&b.fId&&a!==e.dId&&a!==e.oId&&a!==e.teId?n("msi-attsearch"):m("msi-attsearch")}},r.groups.newTemplate={expose:function(){a===e.teId&&_zm._isPrivilegedUser()?c.showGroup("newTemplate"):c.hideGroup("newTemplate")}};var s={};s.groups={},s.groups.conversation={expose:function(){var b=["msi-thread","msi-conversation"];if(m(b),!g){var c;zmUtil.hasFolSpecConversation(a)&&(n(b),c=zmfolAction.getFolCV(a),void 0!==c&&(c?(n(b[0]),m(b[1])):(n(b[1]),m(b[0]))))}}},s.groups.LViewType={expose:function(){c.showGroup("LViewType")}},s.groups.searchClose={expose:function(){g&&zmSearchUtil.isNewSearch()&&n("msi-close")}};var t={};t.groups={},t.groups.action={expose:function(b,c){b||"listing"===c&&(g||h||!zmUtil.isFolderId(a)||a===e.sId||a===e.dId||a===e.oId||a===e.teId||zmail.folCount[a]&&!Number(zmail.folCount[a].c))||"functional"===c&&(a===e.oId||a===e.teId||a===e.dId)?m("msi-action"):n("msi-action")}};var u=function(a){var b=a.$el;a.hideGroup("outboxSend"),b.find(".msi-notspam").closest("li").hide(),b.find(".msi-unarchive").closest("li").hide()},v=function(a){var b=["move","label","trash","spam","archive","action"];b.forEach(function(b){a.hideGroup(b)})},w={set:function(a,b){this[a]=b},get:function(a){return this[a]},flush:function(a){delete this[a]}};return $.subscribe("mailsuite/appClosed",function(a,b){var c=b.appID;c.indexOf("zm_tab")&&"zm_Container"!==c&&"zm_srch1"!==c||w.flush(c)}),l.hide=function(a){if(i=a.tabId||zmTab.currentTab,g="zm_srch1"===i,!(!a.isForceHide&&zmPrev.prevDetails(i).msgId||zmList.getSelectedRowCount())){c=zmsuite.getCenter(i)[0].getNodes()[0],f=c.$el;var b,d,e=Object.keys(q.groups);for(b in e)d=e[b],q.groups[d].expose(!0);t.groups.action.expose(!1,"listing"),w.set(i,{})}},l.show=function(j){e=zmail.folId,g=j.isSearchView||!1;var k=zmUtil.isChildWindow(),l=j.type;if(i=!k&&(j.tabId||zmTab.currentTab)||void 0,d=j.msgId||void 0,b=k&&{}||g&&{fId:zmSearchUtil.getSearchedFolders()[0]}||j.view||zmail.listDetails||{},a=d&&zmail.mailObj[d].FD||j.fId||b.fId||void 0,!j.elem){var m=i.indexOf("zm_tab")?0:1;j.elem=zmsuite.getCenter(i)[m].getNodes()[0]}if(c=j.elem,f=c.$el,h=!k&&"zm_Container"===i&&("zmlviewH"===zmail.mailLeft.selLayerId||"zmllabelH"===zmail.mailLeft.selLayerId)||!1,!l||!(g||k||h||a&&Object.keys(b).length))return void u(c);var n=function(a){var b,c,d=Object.keys(a);for(b in d)c=d[b],a[c].expose(!1,l)};if("functional"===l){if(a&&zmUtil.isSharedFolder(a,"R"))return void((i&&!i.indexOf("zm_tab")||k)&&v(c));var o={fId:a,isArchive:p(),isSearchView:g},x=w.get(i)||{};_.isEqual(x,o)||(n(q.groups),n(t.groups),w.set(i,o))}else"listing"===l&&(n(r.groups),n(t.groups),n(s.groups))},j.util=l,j.hideMenus=_.debounce(function(){$("#zm_dropDown,#zm_flpopup,#zmCntxtMenu,#moreAttachMenu,#zm_dropaddto,#zm_addtomenu,#zm_dropsmartfilter,#zm_dropflag,zm_dropflag,#moreoptions").remove(),$(".SC_ddn").removeClass("SC_ddn")},500,!0),j}();