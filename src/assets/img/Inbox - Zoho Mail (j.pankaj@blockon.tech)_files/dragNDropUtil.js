"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();!function(){var a=zmail.Core.Namespaces,b=a.create("zmail.dndComp"),c=function(){function a(){_classCallCheck(this,a);var b=this;b.element=null,b.active=!1,b.draggedClassName="",b.onDragStart=null,b.onDragEnd=null}return _createClass(a,[{key:"init",value:function(a,b){var c=this;c.element=a,c.draggedClassName=b.draggedClassName||"dragged",c.onDragStart=b.onDragStart,c.onDragEnd=b.onDragEnd,c.enable()}},{key:"enable",value:function(){var a=this;return!a.element.hasAttribute("draggable")&&(a.bindEvents(),void(a.active=!0))}},{key:"bindEvents",value:function(){var a=this;a.element.setAttribute("draggable","true"),a.element.addEventListener("dragstart",a.handleDragStart.bind(a),!1),a.element.addEventListener("dragend",a.handleDragEnd.bind(a),!1)}},{key:"unbindEvents",value:function(){var a=this,b=a.element;b.removeEventListener("dragstart",a.handleDragStart,!1),b.removeEventListener("dragend",a.handleDragEnd,!1)}},{key:"handleDragStart",value:function(a){var b=this;if(a.dataTransfer.dropEffect="move",b.onDragStart){var c,d,e,f=b.onDragStart(b.element);if(!f.allowDrag)return!1;b.elem=document.createElement("div"),f.text?$(b.elem).text(f.text):f.dom?$(b.elem).append(f.dom):f.html?$(b.elem).html(f.html):$(b.elem).text("Element Dragging");var g={type:f.type,id:f.id};if(e=JSON.stringify(g),a.dataTransfer.setDragImage){var h=b.elem.firstChild;b.elem.style.position="absolute",b.elem.style.left="-9999px",document.body.appendChild(b.elem),zmail.dndComp.dragId={dragRef:g};var i=h.getBoundingClientRect();d=i.height,c="left"===f.cursorPosition?i.width:0,a.dataTransfer.setData("dragAttrs",e),b.elem.id="ghostImage",a.dataTransfer.setDragImage(b.elem,c,d),a.dataTransfer.effectAllowed="move"}else zmail.dndComp.dragAttrs=e}}},{key:"handleDragEnd",value:function(){var a=this;setTimeout(function(){$(a.element).removeClass(a.draggedClassName),$("#ghostImage").remove(),$("#dragedNode").remove(),a.onDragEnd(a.element),zmail.dndComp.dragId&&zmail.dndComp.dragId.dragRef.hasOwnProperty("sibling")&&(a.destroy(),delete zmail.dndComp.dragId),zmail.dndComp.dragAttrs&&delete zmail.dndComp.dragAttrs},0)}},{key:"disable",value:function(){var a=this;a.unbindEvents(),a.active=!1}},{key:"isSupport",value:function(){return"draggable"in document.createElement("span")}},{key:"destroy",value:function(){var a=this;a.disable(),a.element=null,a.draggedClassName="",a.onDragStart=null}}]),a}();b.Drag=c}();var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();!function(){var a=zmail.Core.Namespaces,b=a.get("zmail.dndComp"),c=b,d=function(){function a(){_classCallCheck(this,a);var b=this;b.active=!1,b.element=null,b.dropAreaAnimation=null,b.onDragOver=null,b.onDrop=null,b.onDragOverDetails=null}return _createClass(a,[{key:"init",value:function(a,b){var c=this;c.element=a,c.dropAreaAnimation=b.dropAreaAnimation,c.onDragOver=b.onDragOver,c.onDrop=b.onDrop,c.onDragOverDetails=b.onDragOverDetails,c.enable()}},{key:"setPositions",value:function(a,b){var c=a.target,d=c.getBoundingClientRect();b.style.position="absolute",b.style.width=d.width+"px",b.style.height=d.height+"px",b.style.left=d.left+"px",b.style.top=d.top+"px"}},{key:"enable",value:function(){var a=this;a.active=!0,this.bindEvents(this.element)}},{key:"disable",value:function(){var a=this;this.unbindEvents(),a.active=!1}},{key:"destroy",value:function(){var a=this;a.disable(),a.element=null,a.dropAreaAnimation=null,a.onDragOver=null,a.onDrop=null}},{key:"mouseOut",value:function(){var a=$(document).find(".dndAnim");a&&($(a).remove(),$(a).off("mouseleave"))}},{key:"bindEvents",value:function(a){var b=this;a.addEventListener("dragenter",b.handleDragOver.bind(b),!1),a.addEventListener("dragover",b.handleDragOver.bind(b),!1),a.addEventListener("drop",b.handleDrop.bind(b),!1)}},{key:"unbindEvents",value:function(){var a=this,b=a.element;b.removeEventListener("dragenter",a.handleDragEnter,!1),b.removeEventListener("dragover",a.handleDragOver,!1),b.removeEventListener("drop",a.handleDrop,!1)}},{key:"handleDragOver",value:function(a){var b=this,d=b.onDragOver(a.target);if(d.allowDragOver){var e=c.Drag.dragId,f={};f={clientY:a.clientY,clientX:a.clientX,target:a.toElement},b.onDragOverDetails&&b.onDragOverDetails(e,f),a.stopPropagation(),a.preventDefault()}}},{key:"handleDragEnter",value:function(a){a.stopPropagation()}},{key:"handleDrop",value:function(a){var b=this,c={target:a.target,ev:a};zmail.dndComp.dragAttrs?(c.dragObj=JSON.parse(zmail.dndComp.dragAttrs),delete zmail.dndComp.dragAttrs):c.dragObj=JSON.parse(a.dataTransfer.getData("dragAttrs")),b.onDrop(c)}}]),a}();b.Drop=d}();var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();!function(){var a=zmail.Core.Namespaces,b=a.get("zmail.dndComp"),c=function(){function a(){_classCallCheck(this,a);var b=this;b.element=null,b.active=!1,b.onDragStart=null,b.setDragInstance=null,b.onDragEnd=null}return _createClass(a,[{key:"init",value:function(a,b){var c=this;c.element=a,c.onDragStart=b.onDragStart,c.onDragEnd=b.onDragEnd,c.setDragInstance=b.setDragInstance,c.enable()}},{key:"enable",value:function(){var a=this;a.bindEvents(),a.active=!0}},{key:"bindEvents",value:function(){var a=this;a.element.addEventListener("mousedown",a.handleMousedown.bind(a),!1)}},{key:"isSupport",value:function(){return"draggable"in document.createElement("span")}},{key:"handleMousedown",value:function(a){var b=this,c=a.target;if("function"==typeof b.onDragStart){var d={};d={node:b.element,target:c};var e=b.setDragInstance(d);if(e.setDrag){var f=new zmail.dndComp.Drag;f.init(e.element,{draggedClassName:e.draggedClassName,onDragStart:b.onDragStart,onDragEnd:b.onDragEnd})}}}}]),a}();b.dragSourceSibling=c}();