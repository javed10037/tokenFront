"use strict";define(["zmText"],function(a,b){var c=a("zmText"),d=a("zmUtil"),e=a("zmsuite"),f=a("_zm"),g=a("zmAdHocSettings"),h=a("zmComponent"),i=a("zmAjq"),j=a("zmAppLoader"),k=a("LazyLoad"),l=c.get("commonUtils"),m=function(a){var b=e.getLeft(),c=b.getNodes(),d=c[0].getLayer(a);return d},n=function(b){if(!d.isChildWindow()){var c=a("zmInit"),e=c.getListingDetObj().fId,f=!1;switch(b){case"drafts":e===zmail.folId.dId&&(f=!0);break;case"templates":e===zmail.folId.teId&&(f=!0);break;case"outbox":e===zmail.folId.oId&&(f=!0)}f&&$.publish("/mail/listMails",{fId:e})}},o=function(){var b=a("zmmailAct");b.updateCount({fId:zmail.folId.oId,mode:"dec"})},p=function(){var a=$("#zmnotify span");if(a){var b=parseInt(a.html())+1;a.html(b)}},q=function(b,c,e,f){d.stopEvents(f);var g=a("znNote"),h=a("zmfolAction"),i=a("zmInit");"c"===e&&(c=$(c).parent().parent());var j=$(c).offset(),k=j.left,m=j.top-5,n=void 0,o=$("#zm_tAction").height();if("zn_actLst"===b&&(n=c.parentNode.parentNode.className,"zn_dd"===n?($("#"+b).html("<ul><li>"+l.common.attachFile+"</li><li>"+l.common.insertImg+"</li><li><div id='znActionAddlabel'>"+l.common.addTags+"</div></li></ul>"),d.setEditable({ele:$("#znActionAddlabel"),target:g.addTags,callback:h.sendNewFolderReq,onenter:h.isValidFolder,parentdiv:$("#zn_actLst")})):($("#"+b).html("<ul><li>"+l.common.importNotes+"</li><li>"+l.common.exportNotes+"</li><li><div id='znActionNewfolder'>"+l.common.newCat+"</div></li><li><div id='znActionNewlabel'>"+l.common.newTags+"</div></li></ul>"),d.setEditable({ele:$("#znActionNewfolder"),target:null,callback:h.sendNewFolderReq,onenter:h.isValidFolder,parentdiv:$("#zn_actLst")}),d.setEditable({ele:$("#znActionNewlabel"),target:null,callback:h.sendNewFolderReq,onenter:h.isValidFolder,parentdiv:$("#zn_actLst")}))),"r"===e){var p=$(c).width();k=i.cliWid-(k+p);var q=$(c).children("ul")[0];$(q).addClass("SC_ddr"),$("#"+b).css({right:k+"px",top:m+o+"px"}).show()}else n=c.parentNode.parentNode.className,"zn_dd"===n&&(m-=10),$("#"+b).css({left:k+"px",top:m+o+"px"}).show();$(c).find("b").addClass("SC_ddn")},r=function(){var a=arguments[0],b=arguments.length;if(void 0!==a)for(var c=1;c<b;c++)a=a.replace("{"+(c-1)+"}",arguments[c]);return a},s=function(a){zmail.folCount[a.folId]||(zmail.folCount[a.folId]={},zmail.folCount[a.folId].c="0",a.pfolId?zmail.folCount[a.folId].p=a.pfolId:a.prefolId&&(zmail.folCount[a.folId].p=zmail.folCount[a.prefolId].p))},t=function(){var a=void 0;$("#zm_overlay").length?$("#zm_overlay").show():(a=$("<div/>"),a[0].id="zm_overlay",a.addClass("SC_AtMk"),$(document.body).append(a))},u=function(b,c){var e=a("zmInit"),f="zmCntxtMenu";if(b){var g=b.length;if(g){var h=$("<div/>");f?($("#"+f).remove(),h[0].id=f):h[0].id="zmCntxtMenu",h[0].className="SC_PU",h[0].style.display="block",h.mousedown(function(a){d.stopEvents(a,!0)});var i=$("<div/>");i[0].className="SC_PUcen",h.append(i);var j=$("<ul/>");j[0].className="SC_Phr",j[0].style.display="block",i.append(j);for(var k=function(a,c){return b[a].eventName},l=0;l<g;l++){var m=$("<li/>"),n=Boolean(b[l].cEdit),o=b[l].id?b[l].id:"";if(b[l].htm)if(n){var p=$("<div/>");p[0].innerHTML=b[l].htm,p[0].id=o,m.append(p)}else m[0].innerHTML=b[l].htm,m[0].id=o;else b[l].sep&&(m[0].className="SC_lne",m[0].id=o);b[l].clk&&m.click(k(l,"clk")),b[l].mouseovr&&m.mouseover(k(l,"mouseovr")),b[l].mouseot&&m.mouseout(k(l,"mouseot")),j.append(m)}var q=e.nn6?c.clientY:c.clientY+10,r=e.nn6?c.clientX:c.clientX+10;$("body").append(h);var s=$("#"+f).height()+q,t=$("#"+f).height(),u=e.cliHgt;if(h)if(s>u&&q-t>=0){var v=u-q;h.css({bottom:v,left:r})}else h.css({top:q,left:r})}}},v=function(){return g&&"function"==typeof g.getHelperBlockVisibility&&"1"===g.getHelperBlockVisibility()},w=function(a){var b=/((?=http|https)[\S]*:\/\/[\S]*.+)|([\S]*(?:\w{2}\.\w+\.\w+)[\S]*)/gi;return b.test(a)},x=function(){var b=function(a){d.loadNotes("popup",{descHTML:a.html,desc:a.text,groupId:a.groupId||zmail.zuid,richText:!0})},c=function(a){d.loadTask({action:"addCTask",groupId:a.groupId||zmail.zuid,tasks:{SUMMARY:a.text}})},f=function(b){var c=a("zmApp");c.loadCalendar("/calendar/event",{SUM:b.text})},g=function(a){d.loadNewPostDialog(a.text)},h=function(a){var b={mode:"create",groupId:zmail.zuid,catid:""},c=d.parseURLS(a.text,{httpOnly:!0});if(c.length){var e=c[0];b.link=e.url,a.text!==e.url&&(b.summary=a.text)}else b.summary=a.text;d.loadLink(b)},i=function(a,e){switch(d.hideMenu(),a){case"CreateNote":b(e);break;case"CreateTask":c(e);break;case"CreateEvent":f(e);break;case"CreatePost":g(e);break;case"CreateLink":h(e)}},j=function(){var a=0,b=0,c=0,d=0;if(window.getSelection&&document.createRange&&"undefined"!=typeof document.createRange().getBoundingClientRect){var e=window.getSelection();if(e.rangeCount>0){var f=e.getRangeAt(0).getBoundingClientRect();a=f.left,b=f.top,c=f.width,d=f.height}}else if(document.selection&&"Control"!==document.selection.type){var g=document.selection.createRange();a=g.boundingLeft,b=g.boundingTop,c=g.boundingWidth,d=g.boundingHeight}return{x:a,y:b,width:c,height:d}},k=function(){return document.getSelection?document.getSelection().toString():document.selection?document.selection.createRange().text:""},m=function(){var a=void 0;if(document.selection&&document.selection.createRange)return a=document.selection.createRange(),a.htmlText;if(window.getSelection){var b=window.getSelection();if(b.rangeCount>0){a=b.getRangeAt(0);var c=a.cloneContents(),d=document.createElement("div");return d.appendChild(c),d.innerHTML}return""}return""},n=function(a,b){d.isSmartMenuOptionEnabled()&&(a.ignoreSelector=a.ignoreSelector?a.ignoreSelector:[],$(a.applyDOM).find(a.ignoreSelector.join()).on("mouseup",function(a){a.stopPropagation()}),$(a.applyDOM).not(a.ignoreSelector.join()).off("mouseup.addSelectMenu").on("mouseup.addSelectMenu",function(a){setTimeout(function(){var a=k(),c=m(),f=void 0;if(b=b||{},b.text=a,b.html=c,f=j(),a&&a.trim().length){var g=$("<li><span><i data-action='CreatePost'  class=msi-status title='"+l.create.post+"'></i></span><span><i data-action='CreateNote'  class=msi-notes title='"+l.create.note+"'></i></span><span><i data-action='CreateTask' class=msi-task title='"+l.create.task+"'></i></span><span><i data-action='CreateEvent' class=msi-calendar title='"+l.create.event+"'></i></span></li>");d.parseURLS(a,{httpOnly:!0}).length&&g.append("<span><i data-action='CreateLink'  class=msi-links title='"+l.create.link+"'></i></span>"),$(g[0]).find("span").off("click").on("click",function(a){a.stopPropagation();var c=$(this).find("i").attr("data-action");i(c,b)});var h={};h.clientX=f.x+f.width/2,h.clientX>window.innerWidth&&(h.clientX=(window.innerWidth-f.x)/2+f.x),h.clientY=f.y<0?f.y+f.height-12:f.y-12;var n={left:h.clientX,top:h.clientY,showArrow:!0,liDom:g,ulClass:"selectMenu",spanClass:"minwid"};f.y>0?n.direction="bottom":n.direction="top",e.showMenu(n)}},0)}),zmail.isInternalOrgUser&&d.addAnchorTagHover(a),zmail.showFeature&&d.addTaskOnListHover(a))};return{addSelectMenu:n}}(),y=function(){var a,b,c='<i id="taskquickadd" title="Add to task"style="display:none; position: absolute"class="msi-task"></i>',e=function(){if(!(b instanceof $&&b.length)){b=$(c),$("body").append(b),b.off("mouseover").on("mouseover",function(a){a.stopPropagation()});var e=function(){b instanceof $&&b.length&&setTimeout(function(){b.hide()},500)};b.off("click").on("click",function(b){var c=a.find("li").map(function(){return $(this).text()}).get(),f={};if(c.length>0){f.TITLE=c[0],f.subtask=[];for(var g=1;g<c.length;g++)f.subtask.push({TITLE:c[g]})}d.loadTask({action:"addCTask",groupId:zmail.zuid,tasks:f}),e()})}},f=function(c,d){if(!d.relatedTarget||"I"!==d.relatedTarget.nodeName){e(),a=$(c);var f=$(c).first().offset();b.show().css({top:f.top,left:f.left})}},g=function(a){"I"!==a.relatedTarget.nodeName&&b.hide()};return function(a){var b=$(a.applyDOM[0]);if(b.hasClass("zmPCon")&&(b.find("ul").length>0||b.find("ol").length>0)){var c=b.find("ul").toArray(),d=b.find("ol").toArray(),e=c.concat(d);$.each(e,function(a,b){$(b).off("mouseover").on("mouseover",f.bind(null,b)),$(b).off("mouseout").on("mouseout",g)})}}}(),z=function(a,b,c){if(a&&b){var d={accId:a};switch(b){case"inc":d.mode="inc";break;case"upd":d.mode="update",void 0!==c?d.count=c:d.count=0}$.publish("/acc/unreadCountChange",d)}},A=function(b,c,f){var h=a("zmApp");if(b){var i=a("zmPrev"),j=a("zmTopMenus"),k=a("zmInit");g.fetchFromObject(b.adhocUserSettings,b.adhocAccountSettings),i.clsPreview("zm_Container"),d.closeMailTabs(),k.reInitListing(),zmail.accId=c.accId,zmail.folId=b.folId,zmail.folCount=b.folCount,zmail.folTree=b.folTree,zmail.mailList=b.mailList,b.cmpData&&"string"==typeof b.cmpData&&(zmail.updatecmp=!0,zmail.cmpdata=$.parseJSON(b.cmpData)),"m"===h.currentApp?e.showWorkSpace("zm_Container"):h.showApp("m"),zmail.savedSearchList=b.savedSearchList||{},"string"==typeof b.labInfo?zmail.labInfo=$.parseJSON(b.labInfo):zmail.labInfo=b.labInfo,zmail.accId===zmail.defAccId&&(zmail.zohoAccLabInfo=$.extend({},zmail.labInfo)),b.DEFFRM_ADDR&&(zmail.fromAddr=b.DEFFRM_ADDR),zmail.useCache=!1,zmail.applyState=!1,zmail.saveState=!1,zmail.loadCompleted=!1,zmail.accId===d.getZohoAccId()?zmail.shrTree=b.shrTree||[]:zmail.shrTree=[],k.constructView(),k.initMailList(),k.listingBand.SpamTrashBand.setBand(),k.updateCountTitle(),j.util.show({type:"listing",view:zmail.listDetails,tabId:"zm_Container"}),k.toggleSortingIcons(),zmail.loadCompleted=!0;var l=k.getUnreadViewCount();d.updateCountForAcc(zmail.accId,"upd",l),k.getSuppressedFolders(),$.publish("/mail/accountSwitch",{status:"success",accountID:c.accId}),f&&f.resolve()}else $.publish("/mail/accountSwitch",{status:"failed",accountID:c.accId}),f&&f.reject()},B=function(a){var b=$.Deferred(),c=void 0;$.publish("/mail/switchAccount",[a]);var e=function(a,c){A(a,c,b)};return c=h.loadingMasks({maskText:l.switchAccount}),i.XHR({u:zmail.conPath+"/swAcc.do",t:"POST",fn:e,onerror:function(){b.reject()},csr:"s",p:{accId:a,mode:"json"},ep:{accId:a}}),b.always(function(){c.remove()}).done(function(){d.succErrMsg("s",l.accSwitchSuccess)}).fail(function(){d.succErrMsg("e",l.accSwitchFail,{noHide:!0})}),b.promise()},C=function(){var b=function(b){var c=a("zmfolAction"),e=a("zmlab"),f={},g=zmail.labInfo,i={},j={};return f.type="label",f.search="name",f.display="display_text",f.liAttr={},f.showTooltip=!0,f.emptyMsg=b.emptyMsg||"",f.showCreate="function"==typeof b.onCreate,f.showCheckbox="function"==typeof b.onStateChange,"default"===b.accType&&(g=d.getTagList("default")),f.showCheckbox&&(b.labelState.selectedMails?i=e.labelSelectionInfo({type:"selected"}):b.labelState.mailList?i=e.labelSelectionInfo({type:"list",list:b.labelState.mailList}):b.labelState.labelList?b.labelState.labelList.forEach(function(a){i[a]="check"}):"function"==typeof b.labelState.dataCallback&&(i=b.labelState.dataCallback())),b.excludeList&&b.excludeList.forEach(function(a){j[a]=!0}),i=i||{},f.data=[],Object.keys(g).forEach(function(a){j[a]||f.data.push({id:a,name:g[a].label,display_text:c.getShortFolderPath(g[a].dispName,{maxLength:20}),color:g[a].color,type:i[a]||"uncheck",tooltip:g[a].dispName})}),b.newLabels&&b.newLabels.forEach(function(a,b){f.data.push({id:void 0,name:a,display_text:c.getShortFolderPath(a,{maxLength:20}),color:e.DEFAULT_COLOR,type:i[a]||"uncheck",tooltip:a})}),b.showAllItem&&f.data.unshift({id:"all",name:l.common.all,display_text:l.common.all,color:e.DEFAULT_COLOR,type:"uncheck",tooltip:l.common.all}),f.showCheckbox?f.onSelect=function(a){var c=void 0,d=a.type;"uncheck"===a.type||"partial"===a.type?(a.chkboxState(a,"check"),c=!0):(a.chkboxState(a,"uncheck"),c=!1),b.onStateChange(a.id,c,function(){a.chkboxState(d)},a.name)}:f.onSelect=function(a){"function"==typeof b.onSelect&&b.onSelect(a.id)},f.showCreate&&(f.addNew=function(a,c,d){b.onCreate(c,(d||{}).clrCode)}),h.folderLabel(f)},c=function(a){var b={},c=void 0;return b.type="folder",b.search="name",b.display="display_text",b.liAttr={},b.showTooltip=!0,b.onTab=a.onTab||"",b.emptyMsg=a.emptyMsg||"",b.showCreate="function"==typeof a.onCreate,c=a.showAllItemText||l.common.all,b.data=[],"function"==typeof a.dataCallback&&(b.data=a.dataCallback()),a.showAllItem&&b.data.unshift({id:"all",name:c,display_text:c,tooltip:c}),b.onSelect=function(b){"function"==typeof a.onSelect&&a.onSelect(b.id,b)},b.showCreate&&(b.addNew=function(b,c){a.onCreate(c)}),h.folderLabel(b)},e=function(a){var b={},c=void 0;return b.type="sub-folder",b.search="tooltip",b.display="name",b.liAttr={},b.showTooltip=!0,b.onTab=a.onTab||"",b.emptyMsg=a.emptyMsg||"",b.showCreate="function"==typeof a.onCreate,c=a.showAllItemText||l.common.all,b.data=[],"function"==typeof a.dataCallback&&(b.data=a.dataCallback()),a.showAllItem&&b.data.unshift({id:"all",name:c,display_text:c,tooltip:c}),b.onSelect=function(b){"function"==typeof a.onSelect&&a.onSelect(b.id,b)},b.showCreate&&(b.addNew=function(b,c,d){a.onCreate(c,(d||{}).parentId)}),h.folderLabel(b)},f=function(a){var b={},c=void 0;return b.type="folder-path",b.search="tooltip",b.display="name",b.liAttr={},b.showTooltip=!0,b.onTab=a.onTab||"",b.emptyMsg=a.emptyMsg||"",b.showCreate="function"==typeof a.onCreate,c=a.showAllItemText||l.common.all,b.data=[],"function"==typeof a.dataCallback&&(b.data=a.dataCallback()),a.showAllItem&&b.data.unshift({id:"all",name:c,display_text:c,tooltip:c}),b.onSelect=function(b){"function"==typeof a.onSelect&&a.onSelect(b.id,b)},b.showCreate&&(b.addNew=function(b,c){a.onCreate(c)}),h.folderLabel(b)},g=function(b){var c=a("zmfolAction");return!!c.isDeletedFolder(b)},i=function(b){var c=a("zmfolAction"),d={},e={},f={},h=[];return b.excludeList&&b.excludeList.forEach(function(a){e[a]=!0}),d.data=[],h=c.getMailFolderPaths()||[],h.forEach(function(a){e[a.id]||b.excludeChild&&e[a.parentID]||(f={id:a.id,name:a.name,display_text:c.getShortFolderPath(a.path,{maxLength:20}),tooltip:a.path},b.isFilterConfig&&(f.disableAddBtn=g(a.id)),b.removeDeletedFolder?(f.isDeletedFolder=g(a.id),f.isDeletedFolder||d.data.push(f)):d.data.push(f))}),b.dataCallback=function(){return d.data},b},j=function(a){return f(i(a))},k=function(a){return c(i(a))},m=function(a){return e(i(a))},n=function(a){return a=a||{},a.type="label",a.ui={search:!1,label:{color:!1}},h.folderLabel(a)},o=function(a){return a=a||{},a.type="groups",a.ui={search:!0,label:{color:!1},showUnreadCount:a.showUnread},h.folderLabel(a)},p=function(e,f){var g="zm_flpopup",h=void 0,i=$(f.parentDOM),l=$(f.viewDOM||document.body),p=void 0,q=void 0,r=void 0,s=void 0,t=void 0,u=void 0,v=void 0,w=void 0,x="pleft",y="",z=void 0,A=void 0,B=a("zmDropDownMenu");y=f.direction||"",h="folder"===e?k(f):"label"===e?b(f):"genericWithCheckBox"===e?n(f):"groups"===e?o(f):"folder-path"===e?j(f):"sub-folder"===e?m(f):c(f),h=$(h),h.attr("id",f.domID||g),z=h.find(".scrlldiv"),A=z[0].getBoundingClientRect();var C={height:A.height+"px","max-height":"200px"};"label"===e&&(C.width="210px"),z.css(C),h.on("mousedown",function(a){d.stopEvents(a,!0)}),q=i[0].getBoundingClientRect(),r=h[0].getBoundingClientRect(),s=l[0].getBoundingClientRect(),t=q.left+r.width+20<s.right?q.left:q.left-(r.width-q.width),"dropdown"===f.displayAs?(u=q.bottom,f.offsets&&(t+=f.offsets.left||0,u+=f.offsets.top||0),u+h[0].offsetHeight>document.body.offsetHeight&&(u=q.top-h[0].offsetHeight),h.css("top",u+"px"),h.css("left",t+"px"),f.parWidth&&q.width&&(h.css("width",q.width+"px"),z.css({width:"auto"}))):"popup"===f.displayAs&&(w=$("<li/>").append(h),!y&&s.bottom<q.bottom+r.height&&(y="bottom"),v={par:i,showArrow:!0,liDom:[w[0]],ulClass:"noclass",align:x,spanClass:"SC_ddFil",direction:y},f.divId&&(v.divId=f.divId),p=new B,p.setDropObj(v));var D=function(){h&&(f.hltPar&&(f.hltDOM?$(f.hltDOM).removeClass("SC_ddn"):i.find("b").removeClass("SC_ddn")),h.removeClass("shw"),h.css("display","none"),$(h).remove(),h=void 0,p&&p.remove(),p=void 0,f.onHide&&f.onHide(),w=void 0)},E=function(){f.hltPar&&(f.hltDOM?$(f.hltDOM).addClass("SC_ddn"):i.find("b").addClass("SC_ddn")),h.addClass("shw"),h.css("display",""),p&&p.paint(),$.publish("/mail/menuCreated",{menuHandler:D})};return{elem:h,show:E,hide:D}};return{create:p}}(),D={createFolder:function(b){var c=a("zmfolAction"),d=$.Deferred();return c.isValidName(b,void 0,{opType:"new"})?(c.sendNewFolderReq(b,{reqDoneClbk:function(a,b){a?d.resolve({folderID:b}):d.reject()}}),d.promise()):(d.reject(),d.promise())},createTag:function(b){var c=a("zmlab"),d=$.Deferred();return c.isValidName(b)?(c.labelCreate(b,"",{reqDoneClbk:function(a,b){a?d.resolve({tagID:b}):d.reject()}}),d.promise()):(d.reject(),d.promise())}},E=function(){var a=void 0,b=void 0,c={},e=void 0,f=500,g={bookmarkActionBox:'<i id="zmquickbookmark" title="'+l.common.addbookmark+'"style="display:none; position: absolute"class="msi-links zmIB"></i>'},h=function(a,b){return a instanceof b},i=function(){h(a,$)&&a.length&&(a.remove(),a=void 0)},j=function(){var a=b.attr("href");i(),d.loadLink({mode:"create",link:a,groupId:c.groupId})},k=function(){i()},m=function(a){a.stopPropagation(),window.clearTimeout(e)},n=function(){a.off("click").on("click",j),a.off("mouseleave").on("mouseleave",k),a.off("mouseover").on("mouseover",m)},o=function(){h(a,$)&&a.length||(a=$(g.bookmarkActionBox),$("body").append(a),n())},p=function(a){return a.offset()},q=function(a){var b=a.attr("href");return d.isURL(b)},r=function(){$.publish("/mail/menuCreated",{menuHandler:function(){window.setTimeout(i,200)}})},s=function(b){var c;q(b)&&(o(),r(),c=p(b),a.show().css({top:c.top-5,left:c.left+b.outerWidth()+5}))},t=function(a){b.off("mouseleave.addAnchorTagHover"),e=window.setTimeout(function(){i()},f)},u=function(){b.off("mouseleave.addAnchorTagHover").on("mouseleave.addAnchorTagHover",t)},v=function(a,d,f){var g,h=f.target||f.srcElement;if("A"!==h.nodeName){if(g=$(h).closest("a").not(d.ignoreSelector.join()),!g.length)return;h=g[0]}else if(!$(h).not(d.ignoreSelector.join()).length)return;b=$(h),window.clearTimeout(e),c=a||{},u(),s(b)};return function(a,b){d.isSmartMenuOptionEnabled()&&(b=b||{groupId:zmail.zuid},$(a.applyDOM).not(a.ignoreSelector.join()).off("mouseover.addAnchorTagHover").on("mouseover.addAnchorTagHover",v.bind(null,b,a)))}}(),F=function(){return j.load("links")},G=function(){return j.load("crminteg")},H=function(){return j.load("mailCollaboration").done(function(){d.debugLog("mailCollab JSLoad complete callback",arguments)})},I={},J=function(a){""===a&&(a="mail listing"),I.searchKey=a,zmail.supportWidget&&zmail.supportWidget.updateSearchKey(0,a)},K=function(a){I.emailId=a,zmail.supportWidget&&zmail.supportWidget.updateTicketDetails({supportId:a})},L=function(a){return I[a]},M=function(b){j.load("zmsitetour").done(function(){var c=a("zmTour");c.initAppTour(b)})},N=function(b){j.load("mailTour").done(function(){var c=a("zmTour");c.apps.mail.init({type:b})})},O=function(b,c,e){var f=a("zmTour"),g=e&&e.version?e.version:"all";b?f.callAppSpecificTour(b,c):"all"===g&&d.createTour()},P=function(a){for(var b=0,c="",d=["B","KB","MB","GB"];a>1023;)a/=1024,b++;return 0===b?c=Math.ceil(a/1024)+" KB":(a=Math.ceil(a),c=a+" "+d[b]),c},Q=function(a){if(!isNaN(a)){var b=[" bytes"," KB"," MB"," GB"," TB"," PB"," EB"," ZB"," YB"],c=Math.floor(Math.log(Number(a))/Math.log(2));c<1&&(c=0);var d=Math.floor(c/10);return a=Number(a)/Math.pow(2,10*d),a.toString().length>a.toFixed(1).toString().length&&(a=a.toFixed(1)),a+b[d]}},R=function(a,b){return a instanceof b},S=function(a,b){try{a||(a=window.event),a.stopPropagation?(b||a.preventDefault(),a.stopPropagation()):(a.cancelBubble=!0,a.returnValue=!1)}catch(c){}},T=function(a,b){var c="`~!@#$%^&*()+=[]\\';,./{}|\":<>?",d=void 0;"labelName"===b||"folderName"===b?c="`~#%^&*\\;,/|:<>?":"dispName"===b&&(c="`~!#%^&*+=\\';,/{}\"<>?"),d=c.length;for(var e=0;e<d;e++)if(a.indexOf(c.charAt(e))!==-1)return!0;return!1},U=function(){var a=/[{}[\]()\/'"=<>]+/gim;return function(b){a.lastIndex=0,b=b||"";var c=b.match(a);return!(!c||!c.length)}}(),V=function(){var a="";return function(b){var c=b.ele,e=b.target,f=b.callback,g=b.maxLength||50,h=b.parentdiv,i=b.initialize,j=!1,k=!0,l=void 0;b.allowCondition&&(k=b.allowCondition()),k&&(l=h.find("[contentEditable='true']"),l.length>0?c[0].id!==l[0].id&&(l[0].contentEditable="false",l.html(a),j=!0):j=!0,j&&(a=c.text(),c[0].contentEditable="true",i?(c.html(e.children("span").text()),c.focus(),document.execCommand("selectAll",!1,!1)):(c.html("&nbsp;"),c.focus()),c.off("keypress").on("keypress",function(a){var b=a.keyCode?a.keyCode:a.which;13===b&&d.stopEvents(a)}),c.off("keydown").on("keydown",function(a){return function(b){var e=b.keyCode?b.keyCode:b.which,h=b.ctrlKey,i=String.fromCharCode(e).toLowerCase();13===e?f():27===e?(c[0].contentEditable="false",c.html(a),d.stopEvents(b)):!(8===e||46===e||e>=33&&e<=40)&&c.text().length>g-1?d.stopEvents(b):!h||"b"!==i&&"i"!==i&&"u"!==i||d.stopEvents(b)}}(a))))}}(),W=function(a,b){return a="u"===b?a.replace(/#34/gi,'"').replace(/&#39;/gi,"'"):a.replace(/"/gi,"#34")},X=function(a){return a=a.replace(/&#39;/gi,"'").replace(/&quot;/gi,'"').replace(/&lt;/gi,"<").replace(/&gt;/gi,">")},Y=function(){for(var a in zmail.aInfo)if("1"===zmail.aInfo[a].accountType)return a},Z=function(a,b,c){var d=parseInt(b*screen.width/100),e=parseInt(c*screen.height/100),f=(screen.width-d)/2,g=(screen.height-e)/2;return window.open(a,(new Date).getTime(),"height="+e+", width="+d+",status=yes,toolbar=no,top="+g+", left="+f+",scrollbars=yes,resizable=yes")},_=function(){var b=a("WebMessanger"),c=a("WMSSessionConfig"),d=!1;try{zmail.isRebranded&&b.useSameDomain(),zmail.isFuji&&b.setRebrand("fuji"),b.enableTokenPairAuth(),b.setNoDomainChange()}catch(e){}b.setLocale(zmail.user.lang,zmail.user.countrycode);var f=c.CHAT|c.CHAT_PRESENCE|c.PRESENCE_ORG|c.PRESENCE_PERSONAL|c.MULTI_DISPATCH|c.CROSS_PRD;b.setConfig(f),b.setZIndex("auto"),("false"===zmail.showTop||zmail.fromOtherService)&&(d=!0),b.register("VO",zmail.zuid,d),zmail.fromOtherService||b.enableGlobalSearch()},aa=function(){$.when(j.loadFiles("extjs",zmail.wms.wmsjs),j.loadFiles("extcss",zmail.wms.wmscss)).done(function(){j.load("wmsInteg").done(function(){_()})})},ba=function(){document.selection?document.selection.clear():window.getSelection().removeAllRanges()},ca=function(a){var b=function(a){var b=void 0,c=void 0,d=void 0,e=void 0;b=a.target||a.srcElement,d=$(b),e=d.attr("id"),c=e&&!e.indexOf("zmW")?d.closest(".SC_pvn"):d.closest(".SC_pv"),d.scrollTop()?c.hasClass("SC_scroll")||c.addClass("SC_scroll"):c.removeClass("SC_scroll")};b({target:a[0]}),a.off("scroll",b),a.on("scroll",b)},da=function(a){return!!zmail.folCount[a]},ea=function(a,b){if(a&&zmail.shrTree.length){var c=zmail.shrTree[0][a];return b&&c&&91===c.RT?"R"===b?"11"===c.ROLE:"W"===b?"12"===c.ROLE:"WD"===b?"13"===c.ROLE:"RW"===b?"11"===c.ROLE||"12"===c.ROLE:"isWritable"===b&&("12"===c.ROLE||"13"===c.ROLE):!(!c||"-1"===c.SHID)}return!1},fa=function(a){return"zm_unread"===a||"zm_all"===a||"zm_flag"===a},ga=function(a){return!!zmail.labInfo[a]},ha=function(a){var b=zmail.labInfo[a];return!(!b||"1"!==b.system)},ia=function(a){var b=zmail.shrTree[0][a];return b&&"-1"!==b.SHID?b.SHID:""},ja=function(a){var b="";for(var c in zmail.shrTree[0])zmail.shrTree[0][c].SHID===a&&(b=c);return b},ka=function(a){return a=a||"",a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"$&")},la=function(a){var b=!1;return a===d.getZohoAccId()&&(b=!0),b},ma=function(b){var c=a("zmDropDownMenu"),d=void 0;return d=new c,d.setDropObj(b),d.paint(),d},na=function(a,b){return a.indexOf(b)!==-1&&(a=a.substring(b.length,a.length)),a},oa=function(a){j.load("crminteg").done(function(){zmail.crmInteg.init.getModel(a)})},pa=function(a){j.load("projectsinteg").done(function(){a()})},qa=function(b){var c;b&&"popup"===b.type&&(c=h.loadingBand({container:document.body,type:"pagination"})),j.load("smartcompose").done(function(){var d=a("zmSCompose");c&&c(),b?d.init(b):d.init({eType:"6",type:"tab"})})},ra=function(b){j.load("attachmentUtility").done(function(){var c=a("zmAttachUtility");c.addEventsToCal(b)})},sa=function(a){try{var b=[],c=[];"undefined"==typeof ZDDialog?(zmail.staticUrls&&zmail.staticUrls.docsJS||(zmail.staticUrls=zmail.staticUrls||{},zmail.staticUrls.docsJS="//"+zmail.jstatic+"/personal/"+zmail.docsStaticVersion+"/docscomponents/js/docscomponent_mail.js",zmail.staticUrls.docsCSS="//"+zmail.jstatic+"/personal/"+zmail.docsStaticVersion+"/docscomponents/css/lightgrey/docscomponent_mail.css"),b.push(zmail.staticUrls.docsJS),c.push(zmail.staticUrls.docsCSS),k.css(c,function(){}),k.js(b,function(){a&&a()})):a&&a()}catch(e){d.debugLog("DEBUG",e)}},ta=function(){return!("function"!=typeof window.ActiveXObject||!document.documentMode)},ua=function(a,b,c,d,e){var f=void 0,g=void 0;e?(f=b,g=c):(f=a.find("#"+b),g=a.find("#"+c));var h=a.scrollTop(),i=f.offset().top,j=g.offset().top,k=a.height()/2,l=void 0,m=void 0;"prev"===d?(m=j-i,a.scrollTop(h-m)):"next"===d&&(m=i-j,a.scrollTop(h+m)),i<0?(l=k-i,a.scrollTop(h-l)):i>a.height()&&(l=i-k,a.scrollTop(h+l))},va=function(){var b=a("zmSearchUtil"),c=e.getAppObj(),d=void 0;for(d in c)d.indexOf("zm_tab")===-1&&"attView"!==d||e.closeWorkspace(d),d.indexOf("zm_srch")===-1||"m"!==b.getSearchAppType()||b.isNewSearch()||e.closeWorkspace(d)},wa=function(a){try{a=encodeURIComponent(a)}catch(b){}return a},xa=function(a){var b="<div/>",c=$(b).text(a||"");return c.html()},ya=function(a,b){var c=b?"<textarea/>":"<div/>",d=$(c).html(a||"");return b?d[0].value:d.text()},za=function(){var a=/(&#?[^\s&#;]+;)/gim,b=document.createElement("div"),c={};return function(d){return d?(a.lastIndex=0,d=d.replace(a,function(){var a,d=arguments[1];return d?c[d]?c[d]:(b.innerHTML=d,a=b.textContent||b.innerText,c[d]=a,a):""})):""}}(),Aa=function(){var a=f("#","wmstoolbar"),b=a?a.getBoundingClientRect().height:0;return b},Ba=function(a){var b=!1;return Object.keys(zmail.folId).forEach(function(c){a===zmail.folId[c]&&(b=!0)}),b},Ca=function(a,b){var c="",e="",f="",g=/\d{1,2}/g,h=/\d{1,3}/g,i=d.reverseString;if("undefined"!=typeof a)return a<0&&(f="-"),a=String(a),a.indexOf(".")!==-1&&(c="."+a.substr(a.lastIndexOf(".")+1),a=a.substring(0,a.lastIndexOf("."))),a.length<4?f+a+c:b?f+i(i(a).match(h).join(","))+c:(e=","+a.substr(a.length-3),a=a.substr(0,a.length-3),f+i(i(a).match(g).join(","))+e+c)},Da=function(a){var b="",c=void 0;for(a=a||"",c=a.length;c>=0;c--)b+=a.charAt(c);return b},Ea=function(a){a&&$(a).length&&$(a).closest(".SC_rgtClk").removeClass("SC_rgtClk")},Fa=function(a,b,c){c=c||Object.keys(b);var d=c.length,e=void 0,f=void 0;for(f=0;f<d;f++)e=c[f],a[e]=b[e]},Ga=function(a,b,c){var d=a.indexOf(b),e=a.indexOf(c);return d<e?a.slice(d,e+1):a.slice(e,d+1)},Ha=function(a){var b={},c=a.input,d=a.textElem||a.input,e=a.checkInterval||200,f=a.idleTime||500,g=a.checkContent||!1,h=void 0,i=void 0,j=void 0,k=void 0,l=function(){var b=j||"",c="";c="TEXTAREA"===d.tagName||"INPUT"===d.tagName?d.value:$(d).text(),c=c||"",j=c,b.length!==c.length&&a.callback()},m=function(){var b=Date.now(),c=b-i;c>=f&&(g?l():k||(a.callback(),k=!0))},n=function(){i=Date.now(),k=!1},o=function(){n(),l(),h=setInterval(m,e)},p=function(){n(),l(),clearInterval(h)};if(c)return $(c).on("focus",o),$(c).on("blur",p),$(c).on("keyup",n),$(c).on("paste",l),$(c).on("cut",l),b.unbind=function(){$(c).off("focus",o),$(c).off("blur",p),$(c).off("keyup",n),$(c).off("paste",l),$(c).off("cut",l)},b},Ia=function(){var a=/((?=http|https)[\S]*:\/\/[\S]+)|([\S]*(?:\w{2}\.\w+\.\w+)[\S]*)/gi,b=/((?=http|https)[\S]*:\/\/[^\s"]+)/gi;return function(c,d){var e=[];d=d||{};var f=d.httpOnly||!1,g=null,h=!1,i=void 0;for(i=a,f&&(i=b),i.lastIndex=0;!h;)if(g=i.exec(c),null===g)h=!0;else{g.index===i.lastIndex&&i.lastIndex++;var j=g[0]||"";j.indexOf("@")!==-1&&j.indexOf("/")===-1||e.push({url:j,startIndex:g.index,endIndex:g.index+j.length})}return e}}(),Ja=function(a){var b=document.createElement("img"),c=void 0,d=!1;return b.onload=function(){d=!0,c&&c(b)},b.onerror=function(){d=!0,c&&c()},b.src=a||"",{then:function(a){"function"==typeof a&&(c=a),d&&c&&c(b)}}},Ka=function(){var a=zmail.labInfo,b=void 0,c=[];for(b in a)"1"===a[b].system&&c.push(b);return c},La=function(){var a=document.createElement("a");return function(b){return(b=b||"")?(a.href=b,a.hostname||""):""}}(),Ma=function(a){return"default"===a?zmail.zohoAccLabInfo:zmail.labInfo},Na=function(){var a=Array.prototype.slice.apply(arguments);a.unshift("ZM_DEBUG : ("+new Date+") > "),zmail.debug===!0&&window.console.log.apply(window.console,a)},Oa=function(b){b.appId&&b.app&&b.appObj&&b.category&&a("zmState").saveTabState(b.appId,b)},Pa=function(a,b){$(a).length&&$(b).length&&$(b).animate({scrollTop:$(b).scrollTop()+$(a).offset().top-$(b).offset().top})},Qa=function(a,b){if(e.isWorkspaceAvailable(a)){var c=e.getCenter(a)[1].getNodes()[0].$el,d=c.find(".msi-prev").parents("b"),f=c.find(".msi-next").parents("b");"prev"===b?d.unbind("click").addClass("SC_opy3"):"next"===b?f.unbind("click").addClass("SC_opy3"):(d.unbind("click").addClass("SC_opy3"),f.unbind("click").addClass("SC_opy3"))}},Ra=function(a,b){if(e.isWorkspaceAvailable(a)){var c=e.getCenter(a)[1].getNodes()[0].$el,d=c.find(".msi-prev").parents("b"),f=c.find(".msi-next").parents("b");"prev"===b?d.removeClass("SC_opy3"):"next"===b?f.removeClass("SC_opy3"):(d.removeClass("SC_opy3"),f.removeClass("SC_opy3"))}},Sa=function(){return zmail.windowVisibility},Ta=function(){var a=-1;if("Notification"in window){var b=Notification&&f.getProperty(Notification,"permission");switch(b){case"default":case 1:a=1;break;case"granted":case 0:a=0;break;case"denied":case 2:a=2}}return a},Ua=function(){var a=void 0,b=zmail.aInfo||{};for(var c in b)if(c=String(c),a=b[c],"1"===String(a.accountType))return c},Va=function(a){try{var b="",e=$(a).text(),f=zmail.Utils.TextUtil.calculateReadTime(e)/1e3/60,g=Math.floor(f),h=100*Math.round(.6*(f-g));return 0!==g?(h>30&&(g+=1),b=g>60?c.applyArgs(l.readTime.hrRead,{time:"> 1"}):c.applyArgs(l.readTime.minRead,{time:g})):h>59?(g+=1,b=c.applyArgs(l.readTime.minRead,{time:g})):b=c.applyArgs(l.readTime.minRead,{time:"< 1"}),b}catch(i){return d.debugLog(i),""}},Wa=function(a){var b="https://www.facebook.com/sharer/sharer.php?sdk=joey&u="+encodeURIComponent(a)+"&display=popup&ref=plugin&src=share_button";d.openWindow(b,500,600)},Xa=function(a){var b="https://twitter.com/intent/tweet?text="+encodeURIComponent(a);d.openWindow(b,500,600)},Ya=function(){return!0},Za=function(){return zmail.isOrg},$a=function(){return f._isPrivilegedUser()||"4106870"===zmail.zuid},_a=function(b){if(b&&"B"!==!$(b)[0].tagName&&(b=$(b).parents("b")),!$(b).hasClass("zm_snd")){var c,d=a("zmPrev"),e=a("_"),g=d.prevDetails().msgId,h=zmail.mailObj[g];$(b).addClass("zm_snd"),g&&i.XHR({u:zmail.conPath+"/mailCollab.do",p:{mailID:g,useConversation:Boolean(h.T),zohoID:zmail.zuid,accountID:zmail.defAccId,requiredData:"recipientList",mode:"getMailShareData",streamsView:!0},t:"POST"}).done(function(a){if(a=a[1]){var d=a.recipientList;c=d[0].orgUsers}var i=h.T||g,k={id:i,groupId:zmail.zuid,elm:b,title:h.SB};if($.isEmptyObject(c)||(k.zuids=c),h.HC>0){var l=zmail.prevMails[i];if(l){var m=f.getProperty(l,"data.mdata.CALOBJ.attendee");if(m){var n=e.pluck(m,"zuid");k.zuids=k.zuids||[],k.zuids=k.zuids.concat(n)}}}j.load("chatlet").done(function(){zmail.Components.Chatlet.core.init(k)})})}},ab=function(){$.subscribe("contacts/openingCard",function(a,b){var c=[];b=b||{},!d.isChildWindow()&&zmail.isCRMServiceUser&&"mail"===b.source&&(c.push({htm:l.common.viewcrminfo,clk:function(a){d.hideMenu(),d.loadCrm(a.eid)},id:"crminfo"}),b.insertItems(c))})};ab();var bb={addSelectMenu:x.addSelectMenu,switchAccount:B,createFLComp:C.create,FLCompCreateAPI:D,requireLinkModule:F,requireCrmInteg:G,updateFaqKey:J,updateSupportId:K,getfaqDetails:L,taskDeferred:void 0,loadAppTour:M,loadMailTour:N,tourVersions:O,isSmartMenuOptionEnabled:v,isURL:w,addAnchorTagHover:E,sizeConv:P,sizeValueUnround:Q,checktype:R,stopEvents:S,hasSpecialChars:T,hasXSSChars:U,setEditable:V,succErrMsg:f.succErrMsg,quotUnEscape:W,replaceHtmlInSubject:X,getZohoAccId:Y,openWindow:Z,consContext:u,loadWms:aa,removeDocSelection:ba,
setScrollShadow:ca,isFolderId:da,isSharedFolder:ea,isViewId:fa,isLabelId:ga,isSystemLabel:ha,getShareId:ia,getFolderIdwithShId:ja,regExpEscape:ka,isZohoAccount:la,showMenu:ma,zmsubStr:na,loadCrm:oa,loadProjects:pa,loadSmartCompose:qa,addEventsToCal:ra,loadZDocs:sa,isIE:ta,initScroll:ua,closeMailTabs:va,encodeFileName:wa,encodeHTMLEntities:xa,decodeHTMLEntities:ya,replaceHTMLEntities:za,wmsBarHeight:Aa,isSystemFolder:Ba,commaSeparateNum:Ca,reverseString:Da,removeRightClickSelection:Ea,mixin:Fa,arrayExtractor:Ga,bindInputTextChange:Ha,parseURLS:Ia,loadImage:Ja,getSystemLabels:Ka,requireMailCollab:H,getHostName:La,getTagList:Ma,debugLog:Na,saveTabState:Oa,setPreviewScroll:Pa,disableNavigation:Qa,enableNavigation:Ra,updateCountForAcc:z,getWindowVisibilityStatus:Sa,getDesktopNotificationPermission:Ta,getDefaultAccountID:Ua,textReadTime:Va,isCRMIntegrationsEnabled:Ya,addTaskOnListHover:y,shareonFacebook:Wa,tweet:Xa,taskloaded:!1,dropDown:q,msgbean:r,addToFolderCountObj:s,showOverlay:t,getNotify:p,outboxCnt:o,getLayerObj:m,updateListingAfterCompose:n,createContexualChat:_a,isChatletEnabled:Za,isSelectedShareEnabled:$a};return $.extend(!0,d,bb)}),define([],function(a,b){var c=a("zmUtil"),d=function(){$(".SC_ddnB").removeClass("SC_ddnB"),$(".SC_ddn").removeClass("SC_ddn"),$(".SC_bsel").removeClass("SC_bsel")},e={removeHighlight:d};return $.extend(!0,c,e)}),define([],function(a,b){var c=a("zmUtil"),d=a("_zm"),e=function(a,b){var c=void 0,d=void 0;return a=$(a),d=a.offset(),c=$("<div id='zm_dpHolder' class='SC_calpick'><div style='white-space:nowrap'></div></div>"),b||(b={left:a.outerWidth()+d.left,top:d.top}),c.css({left:b.left,top:b.top}),$("#zm_dpHolder").remove(),$(document.body).append(c),$.publish("/mail/menuCreated",[{element:c[0]}]),c},f=function(b,d){var f=a("ZEVENTS"),g=void 0,h=void 0,i=void 0;g=$(b),h={mode:"inline",today:zmail.userDateVal,dform:zmail.userDateFormat.toUpperCase()},i=e(g),f(i.children("div")[0]).picker("date",h).on("dateclick",function(){var a=void 0;a=this.getDate(),d(a),c.hideMenu()}).bind()},g=function(b,f){var g=a("ZEVENTS"),h=void 0,i=void 0,j=void 0;h=$(b),i=e(h),i.mousedown(function(a){d.stopEvents(a,!0)}),j=c.getDateObjFromDate(),g(i.children("div")[0]).picker("range",{wkst:0,dform:zmail.userDateFormat,range:["",c.getDateFromDateObj(j)]}).on("select",function(){f(this.getDateRange.from,this.getDateRange.to),c.hideMenu()}).bind();var k=$(i.children("div")[0]),l=k[0].getBoundingClientRect(),m=document.body.getBoundingClientRect();l.width+l.left>m.width&&(i[0].style.left="auto",i[0].style.right=m.width-h[0].getBoundingClientRect().left+"px")},h=function(a){var b=void 0,c=void 0,d=void 0,e=void 0;return a&&(b=a.getDate(),c=a.getMonth()+1,d=a.getFullYear()),"dd/mm/yyyy"===zmail.userDateFormat.toLowerCase()?e=b+"/"+c+"/"+d:"mm/dd/yyyy"===zmail.userDateFormat.toLowerCase()&&(e=c+"/"+b+"/"+d),e},i=function(a){var b="",c=void 0,d=void 0,e=void 0,f=void 0,g=void 0,h=void 0;b=a&&a.dateFormat||zmail.userDateFormat,c=a&&a.dateValue||zmail.userDateVal;try{e=c.split("/"),"MM/dd/yyyy"===String(b)?(f=e[0],g=e[1]):"dd/MM/yyyy"===String(b)&&(f=e[1],g=e[0]),h=e[2],d=new Date(h,f-1,g)}catch(i){b="MM/dd/yyyy",d=new Date}return d},j=function(a){var b=new Date,c=a||zmail.timeZoneOffset,d=b.getTime()+6e4*b.getTimezoneOffset(),e=new Date(d+c);return e},k={showDatePicker:f,showDateRangePicker:g,getDateFromDateObj:h,getDateObjFromDate:i,getCurrentDateObj:j};return $.extend(!0,c,k)}),define([],function(a,b){var c=a("zmUtil"),d=a("zmText"),e=a("zmAppLoader"),f=a("zmAjq"),g=a("_zm"),h=a("LazyLoad"),i=d.get("commonUtils"),j=function(a){h.css(zmail.postcss.jplayer,function(){}),h.js(zmail.postjs.attwithutil,a)},k=function(a){e.load("attachmentUtility").done(function(){c.loadZDocs(a)})},l=function(b,c){e.load("attachmentUtility").done(function(){var d=a("zmAttachUtility");c?c(d.initAttachListing(b)):d.initAttachListing(b)})},m=function(b,c){e.load("attachmentUtility").done(function(){var d=a("zmAttachUtility");c?c(d.listingComp.init(b)):d.listingComp.init(b)})},n=function(){return!zmail.isRebranded||"false"!==zmail.isCloudServiceEnabled&&!zmail.isBaihui},o=function(a){var b=void 0,c={entityType:1,accId:a.accId||zmail.accId,fpath:a.fP,fstorename:a.sN};a.name&&(c.fN=encodeURIComponent(a.name)),b=zmail.conPath+"/FileDownload?mode=tmpdwn",f.formSubmit(c,b)},p=function(a){var b=a.e,d="",e={},g=a.n||a.fn,h=void 0;if(e={attachId:a.Id,entityType:a.et,entityId:a.e},a.sid?(e.groupId=a.sid,e.streamsView=!0,a.gId===zmail.zuid?e.actionType="viewSelfData":e.actionType="viewGroupEntity"):a.type?(2===a.et?e.streamsView="Notes":e.streamsView=!0,e.actionType=a.type,e.groupId=a.gId):(e.groupId=zmail.zuid,1===a.et&&(e.accId=zmail.accId,e.partId=a.p)),zmail.mailObj&&zmail.mailObj[b]&&c.isSharedFolder(zmail.mailObj[b].FD)){var i=c.getShareId(zmail.mailObj[b].FD);e.shId=i,delete e.groupId}h=g.lastIndexOf("."),g=g.replace(/;/gi,""),h!==-1?(g=g.substring(0,h),g=c.encodeFileName(g+"."+c.fileTyp(a.fn)[2])):g=c.encodeFileName(g),d+=zmail.conPath+"/FileDownload?mode=dwn",f.formSubmit(e,d)},q=function(a,b){a=a||[],b=b||{};for(var d=[],e=void 0,g=void 0,h=void 0,i=0,j=a.length;i<j;i++)g=a[i],h=g.e,e={n:a[i].fn,et:g.et,ft:a[i].ft,e:h,Id:g.Id},g.sid?(e.groupId=g.sid,e.streamsView=!0):g.type?(2===g.et?e.streamsView="Notes":e.streamsView=!0,e.groupId=g.gId):e.groupId=zmail.zuid,zmail.mailObj&&zmail.mailObj[h]&&c.isSharedFolder(zmail.mailObj[h].FD)&&(e.shId=c.getShareId(zmail.mailObj[h].FD),delete e.groupId),d.push(e);var k={accId:zmail.accId,attEntObj:JSON.stringify(d)};b.fName&&(k.fName=b.fName);var l=zmail.conPath+"/FileDownload?mode=seldwn";f.formSubmit(k,l)},r=function(a,b){var c=new zmail.dndComp.dragSourceSibling;return c.init(a[0],{onDragStart:function(c){var d=!1,e=void 0,f=void 0,h="",j=b.getAttachments();if($(c).hasClass("SC_check"))$(a).find(".SC_check").addClass("zm_drag"),d=!0,e=j.selectedAttachment,f=j.selectedAttachment.length;else{var k=$(c).data("atid");$(c).addClass("zm_drag"),k&&(d=!0,e=[j.attDet[k]],f=1)}h=1===f?i.attachment.attachment:i.attachment.attachments;var l=['<div ref = "wrapper" class="zm_dragger"><div ref = "count" class="zm_dragCount dragtheme"></div><div ref = "text" class="zm_dragTxt"></div></div>'].join(""),m=g.getDOMReferenceMap($(l),!0);$(m.count).text(f),$(m.text).text(h);var n={allowDrag:d,type:{attObj:e},dom:m.wrapper,id:"attachView",element:c,cursorPosition:"left"};return $.publish("mail/draggingStarted",{text:i.attachment.dropMsg}),n},setDragInstance:function(a){var b=!1,c=$(a.target).parents(".zmL.zmAch");c.length&&(b=!0);var d={setDrag:b,element:c[0]};return d},onDragEnd:function(){$(a).find(".zm_drag").removeClass("zm_drag"),$.publish("mail/draggingEnded",{})},callback:function(){b.onDragEnd&&b.onDragEnd()}}),c},s=function(a){var b=c.fileTyp(a),d={txt:!0,js:!0,java:!0,css:!0,jsp:!0,jspf:!0,c:!0,cpp:!0,html:!0,htm:!0,xml:!0,go:!0,eml:!0,sh:!0,bat:!0,log:!0},e={xml:!0,js:!0,css:!0},f={mp3:!0,mp4:!0,py:!0,python:!0,properties:!0,conf:!0,text:!0},g=!1,h=void 0;return"msi-attimg"===b[1]||f[b[2]]?(g=!0,h="FileDownload"):"msi-attdoc"!==b[1]&&"msi-attppt"!==b[1]&&"msi-attsheet"!==b[1]||d[b[2]]?("msi-attpdf"===b[1]||"msi-attdoc"===b[1]&&d[b[2]]||"msi-atthtml"===b[1]&&d[b[2]]||"msi-attothers"===b[1]&&d[b[2]])&&(g=!0,h="FileDownload",(window.ActiveXObject||"ActiveXObject"in window)&&e[b[2]]&&(g=!1)):(g=!0,h="OpenDocument"),{isPrev:g,apiName:h}},t=function(a){a=a||" ";var b="",c="",d=[],e=a,f=a.length,g=a.lastIndexOf("."),h=void 0;if(g!==-1){b=a.substring(g+1,f).toLowerCase(),f>20&&16!==g&&(h=a.substring(g-1,g),e=a.substring(0,16)+"..."+h+"."+b);var i={doc:!0,docx:!0,sxw:!0,odt:!0,rtf:!0,txt:!0,js:!0,java:!0,css:!0,jsp:!0,jspf:!0,c:!0,cpp:!0,xml:!0,go:!0,sh:!0,bat:!0,log:!0},j={pps:!0,ppt:!0,pptx:!0,odp:!0,sxi:!0},k={xls:!0,xlsx:!0,sxc:!0,ods:!0,csv:!0,tsv:!0},l={mp3:!0,mpa:!0,wma:!0,wav:!0,ra:!0,m3u:!0,m4a:!0},m={avi:!0,flv:!0,mp4:!0,mpg:!0,wmv:!0,vob:!0,swf:!0,mov:!0,"3gp":!0,rm:!0},n={jpg:!0,jpeg:!0,gif:!0,png:!0,bmp:!0},o={eml:!0,msg:!0},p={ics:!0},q={html:!0,htm:!0};c=i[b]?"msi-attdoc":j[b]?"msi-attppt":k[b]?"msi-attsheet":l[b]?"msi-attaudio":m[b]?"msi-attvideo":"pdf"===b?"msi-attpdf":"zip"===b||"rar"===b?"msi-attzip":n[b]?"msi-attimg":o[b]?"msi-atteml":p[b]?"msi-attics zmDoubleIcon":q[b]?"msi-atthtml":"msi-attothers"}else c="msi-attothers";return d.push(e),d.push(c),d.push(b),d},u=function(a,b){e.load("attachComponent").done(function(){b.attachFrom&&b.attachFrom.indexOf("zDocs")>=0?c.loadZDocs(a):a()})},v=function(b,c){var d=function(){var d=a("zmAttachComponent");c&&"function"==typeof c?c(d.init(b)):d.init(b)};u(d,b)},w=function(a,b){var c=a.result;"success"===c?g.succErrMsg("s",i.common.succUpload):g.succErrMsg("e",i.error.errUpload)},x=function(b,d,e,f){c.loadAttachUtilFiles(function(){a("zmAttachUtility").cloudUpload(b,d,e,f)})},y=function(){c.loadAttachUtilFiles(function(){a("zmAttachUtility").addToCloudClose()})},z=function(b){function d(){a("zmAttachUtility").addToCloud(b)}c.loadAttachUtilFiles(d)},A=function(b,c,d,f,g){e.load("slideshowComp").done(function(){var e=a("zmAttachUtility"),h={};b instanceof Array?(h.startIndex=c||0,h.attObjList=b,h.hideAllOptions=d,f&&(h.hideIcons=f.hideOptions,h.addIcons=f.extraIcons),h.targetEle=g):h=b,e.initSlideshow(h)})},B=function(b,c){zmail.newSearch?(zmail.Search.setContext(zmail.Search.Models.Contexts.attachmentSearchContext),e.load("newAttachmentSearch").done(function(){a("zmAttachment").search.core.newSearch(b)})):e.load("attachmentSearch").done(function(){"s"===b.type||"sender"===b.type?(c=c||{dn:b.srchStr},a("zmAttachmentSearch").core.searchAttachment("sender",c,3)):"filetype"===b.type&&(c=c||{fn:b.srchStr},a("zmAttachmentSearch").core.searchAttachment("filetype",c,4))})},C=function(){var a=new Image;return $(a).on("load error",function(){$(this).remove()}),a},D=function(a){for(var b=void 0,d=void 0,e=void 0,f=0,g=a.length;f<g;f++)e=a[f],101===e.ft&&(d=c.getTheSrc("FileDownload",e),d+="&height=640&width=640",b=C(),$(b).attr("src",d).hide(),$("body").append(b))},E=function(a,b){b=b||"";var d=b.lastIndexOf(".");return d>a?b=b.substring(0,a-2)+"..."+c.fileTyp(b)[2]:d===-1&&b.length>a&&(b=b.substring(0,a-2)+"..."),b},F=function(a){a=a||" ";var b=a.substring(0,a.lastIndexOf("."));return b=b.replace(/[`~!@#$%^&*()|+\-=?;:'",.<>{}[\]\\/]/gi,""),encodeURIComponent(b+"."+c.fileTyp(a)[2])},G=function(a,b,d){var e="",f=void 0,g=void 0;return void 0===d&&(d="view"),"FileDownload"===a?e=b.isEmlView?zmail.conPath+"/FileDownload?mode=mvAttachView&internalAttachId="+b.IId+"&":zmail.conPath+"/FileDownload?mode="+d+"&":"OpenDocument"===a&&(e=b.isEmlView?zmail.conPath+"/OpenDocument?internalAttachId="+b.IId+"&":zmail.conPath+"/OpenDocument?"),e+="attachId="+b.Id+"&entityType="+b.et+"&entityId="+b.e,1!==b.et||void 0!==b.gId&&b.gId!==zmail.zuid||(e+="&partId="+b.p,void 0===b.sid&&(e+="&accId="+zmail.accId)),b.sid?(f=b.sid,g=b.gId===zmail.zuid?"viewSelfData":"viewGroupEntity",e+="&streamsView=true&actionType="+g+"&groupId="+f):b.type?(f=b.gId,g=b.type,e+="&streamsView=true&actionType="+g+"&groupId="+f):b.gId&&b.gId!==zmail.zuid&&(f=b.gId,g="viewGroupData",e+="&streamsView=true&actionType="+g+"&groupId="+f),b.shId?e+="&shId="+b.shId:zmail.mailObj&&zmail.mailObj[b.e]&&c.isSharedFolder(zmail.mailObj[b.e].FD)&&(e+="&shId="+c.getShareId(zmail.mailObj[b.e].FD)),e},H=function(a,b){var d=c.isPreviewAvailable(a.name),e=void 0;return d.isPrev&&(b=b||zmail.accId,e=zmail.conPath+"/"+d.apiName,e+="?mode=tmpview&entityType=1&accId="+b+"&fpath="+encodeURIComponent(a.fP)+"&fstorename="+a.sN),e},I=function(){return zmail.isNettyUploadEnabled},J=function(){return zmail.ishugeAttachmentEnabled},K=function(){var a,b=document.getElementById("zmhgupldserver");a=zmail.urls.uploadurl+"/home",b&&b.parentElement.removeChild(b),b=document.createElement("iframe"),b.id="zmhgupldserver",b.style.display="none",b.src=zmail.urls.accURL+"/login?client_auth=true&servicename=ZMUploadDownload&serviceurl="+location.protocol+"//"+a,$("body").append(b)},L=function(){var a,b=document.getElementById("zmhgdwnldserver");a=zmail.urls.downloadurl+"/home",b&&b.parentElement.removeChild(b),b=document.createElement("iframe"),b.id="zmhgdwnldserver",b.style.display="none",b.src=zmail.urls.accURL+"/login?client_auth=true&servicename=ZMUploadDownload&serviceurl="+location.protocol+"//"+a,$("body").append(b)};(I()||J())&&K(),J()&&L();var M={initAttachListing:l,createAttachListingWorkspace:m,isPreviewAvailable:s,fileTyp:t,downloadTempAttachment:o,downloadAttachment:p,isAddToCloudAllowed:n,initAttachComponent:v,cloudCallBack:w,cloudUpload:x,cloudClose:y,cloudUploader:z,loadAttachUtilFiles:k,initAttSlideShow:A,listAttachmentInAttSearchView:B,cacheImageForPreview:D,getSubString:E,getDummyFilename:F,getTheSrc:G,getSrcForTempAtt:H,isNettyUploadEnabled:I,isHugeAttachmentUploadEnabled:J,setHugeUploadCookie:K,downloadSelected:q,setDragAndDrop:r,loadAttachmentViewFiles:j};return $.extend(!0,c,M)}),define([],function(a,b){var c=a("zmUtil"),d=a("zmAppLoader"),e=function(){return d.load("notes")},f=function(){return!0},g=function(a){$("body").append('<div id="nmask" class="whtmsk"></div>'),$("#nmask").append(a[0]),a[0].style.position="absolute",a[0].style.left="40%",a[0].style.top="20%";var b=$(a).find("Div.zn_cont");b.attr("contentEditable","true").focus().click(),$.publish("/mail/menuCreated",[{hideChildMenuFirst:!0,menuHandler:function(){$("#nmask")&&$("#nmask").length&&!$(".SC_Pop.wht").length&&($("#zn_foltagpopup").remove(),$("#nmask").children(".zn_note").find("div.zn_cont").blur(),$("#nmask").children(".zn_note").find("div.zn_tit").blur(),$("#nmask").remove())}}])},h=function(b,d,e){c.requireNotesModule().done(function(){var c=a("zNote");if("popup"===b){var f={};d&&d.richText&&(f.richText=!0,d.richText=void 0),c.loadAddNote(d,f)}else"openNote"===b?c.loadAndOpenNote({namespaceId:d.gId,id:d.e},{type:"popup"}):"openNoteInTab"===b?c.loadAndOpenNote({namespaceId:d.gId,id:d.e},{type:"tab"}):"addNote"===b?c.loadAddNote(d,{mountingElem:e.ele,doneCallback:e.callback}):"viewNote"===b?c.streamListNote(d,e.ele):"commentNote"===b&&c.loadAddNote(d,{mountingElem:e.ele,commentNote:!0,doneCallback:e.callback})}).fail(function(){c.debugLog("zmUtil.loadNotes - REQUIRE module failed to load files")})},i={requireNotesModule:e,loadNotes:h,isNoteReactUser:f,notePopUp:g};return $.extend(!0,c,i)}),define([],function(a,b){var c=a("zmUtil"),d=a("zmAppLoader"),e=a("zmText"),f=a("zmAjq"),g=a("zmsuite"),h=a("_zm"),i=e.get("commonUtils"),j=function(){return d.load("task")},k=function(b){var d=a("zmTask"),f=e.get("task"),h={appname:f.common.app_name,appId:"zm_task_add",appIcon:"msi-task",data:{CNodes:"2"}};g.setWorkSpace(h);var i=g.getCenter(),j=i[0].getNodes(),k=i[1].getNodes();j[0].push([]),k[0].push(d.template.addtaskHeader),k[0].setListener("click",function(a){"msi-close"===a&&g.closeWorkspace("zm_task_add")}),k[1].push(b.$el),j[1].$el.remove(),g.renderCenter(),i[1].show(),g.showWorkSpace("zm_task_add"),i[1].$el.addClass("SC_w100");var l=function m(a,b,d){c.succErrMsg("s",f.common.taskAddSuccess),g.closeWorkspace("zm_task_add"),$.unsubscribe("/zm/task/addTask",m)};$.subscribe("/zm/task/addTask",l),b.$el.find("#ZT_prvSave").off("click").on("click",function(){b.addTask()})},l=function(b){var d={title:i.taskApp.viewTask,mask:!0,style:{width:"2000px"},customClass:"noanim",closeaction:c.hideMenu},e=b.$el,f=a("zmtCom"),g=a("zmsDialog");$("#viewtask").length||$("body").append('<div id="viewtask"></div>'),$("#viewtask").html(e),b.setHeightforEle(),g.create("viewtask",d),$("#zmsdialog_viewtask").mousedown(function(a){c.stopEvents(a,!0),f.addRemoveMenu("remove"),$(".zcal_cn").remove(),$("#zm_dropDown").remove()}),$("#zmsdialogcont_viewtask").mousedown(function(a){f.addRemoveMenu("remove"),$(".zcal_cn").remove(),$("#zm_dropDown").remove()}),$.publish("/mail/menuCreated",[{menuHandler:function(){g.remove()}}])},m=function(b,d){var e=a("zmtCom"),f=a("zmsDialog"),g=void 0;if("addSTask"===b.action)g=e.createTaskSubtask(b),d(g);else if("viewSTask"===b.action)g=e.showTasksubTask(b),d(g);else if("addCTask"===b.action||"addPopupTask"===b.action){var h=b.action;b.action="addCTask",g=e.createTaskSubtask(b);var j=$(".zm_compose"),k=j.offset(),m=k.top+"px",n=k.left+j.width()+"px",o=!1,p={title:i.taskApp.addTask,mask:!0,style:{width:"2000px"},heightPercent:80,customClass:"noanim",buttons:[{txt:i.buttonText.save,callback:function(a){var b=$(a.target||a.srcElement);o||(b.text(i.buttonText.saving),o=g.addTask(c.hideMenu))}},{isCancel:!0,txt:i.buttonText.cancel,callback:function(){c.hideMenu()}}],closeaction:c.hideMenu,afterDisplay:function(){$(".SC_Pop").on("mousedown",function(a){c.stopEvents(a,!0),$(".zcal_tilst").remove()})}};"addCTask"===h?p.posParent={top:m,left:n}:c.isZohoAccount(zmail.accId)||g.$el.find("#zt_ws input").attr("disabled","disabled");var q=g.$el;$("#addtask").length||$("body").append('<div id="addtask"></div>'),$("#addtask").html(q),f.create("addtask",p),g.setHeightforEle(),$("#zmsdialog_addtask").mousedown(function(a){c.stopEvents(a,!0),e.addRemoveMenu("remove"),$(".zcal_cn").remove(),$("#zm_dropDown").remove(),$(".zcal_tilst").remove()}),$("#zmsdialogcont_addtask").mousedown(function(a){e.addRemoveMenu("remove"),$(".zcal_cn").remove(),$("#zm_dropDown").remove(),$(".zcal_tilst").remove()}),$.publish("/mail/menuCreated",[{menuHandler:function(){f.remove()}}])}else"viewCTask"===b.action?e.openTask(b,"",l):"addAsTask"===b.action&&(b.action="addCTask",g=e.createTaskSubtask(b),d(g))},n=function(){c.taskDeferred=c.taskDeferred?c.taskDeferred:zmail.Utils.DeferredCollection.create();var b=a("zmtCom"),d=c.taskDeferred.has("taskProject"),e=c.taskDeferred.get("taskProject");return d||b.getProjects().done(function(){e.resolve()}),e.promise()},o=function(b,d){c.requireTaskModule().done(function(){var c=a("zmTask");"taskapp"===b.load?d&&(c.loadGroup(),d()):n().done(function(){m(b,d)})})},p=function(a,b){var d=$("#postNewTask"),g={};g.title=d.find("#taskTitle").val(),g.groupId=d.find("#groupId select").val(),g.frmGroupId=b,g.entityId=a,g.streamsView="true",g.actionType="addEntity",g.entityType="3",d.find(".ZMN_checkbox i").each(function(){var a=Boolean($(this).hasClass("msi-check"));g[$(this).data("val")]=a}),g.taction="addTaskasNew";var h=function(a,b){c.succErrMsg("s",e.get("task").common.taskAddSuccess),$.publish("/zm/task/addTask",[a,b])};f.XHR({u:zmail.conPath+"/taskAction.do",t:"POST",fn:h,p:g,ep:g})},q=function(b){var d=a("zmsDialog"),e=a("zmCont"),f=$('<div id="postNewTask"><table><tbody><tr><td><div>'+i.taskApp.taskTitle+'</div></td><td><input type="text" id="taskTitle" class="SC_tiput"></td></tr><tr><td>'+i.taskApp.group+'</td><td id="groupId"></td></tr><tr><td valign="top">'+i.taskApp.include+'</td><td><div class="ZMN_checkbox"><span><i class="msi-check" data-val="setSummary"></i>'+i.taskApp.description+'</span></div><div class="ZMN_checkbox"><span><i class="msi-check" data-val="setAssignee"></i>'+i.taskApp.assignee+'</span></div><div class="ZMN_checkbox"><span><i class="msi-check" data-val="setSubTask"></i>'+i.taskApp.subtask+'</span></div><div class="ZMN_checkbox"><span><i class="msi-check" data-val="setAttachment"></i>'+i.taskApp.attachments+'</span></div><div class="ZMN_checkbox"><span><i class="msi-check" data-val="setStatus"></i>'+i.taskApp.status+"</span></div></td></tr></table></div>");f.off("click").on("click",".ZMN_checkbox span",function(){var a=$(this).find("i"),b=a.hasClass("msi-check")?"msi-uncheck":"msi-check";a.attr("class",b)}),f.find("#taskTitle").val(b.title);for(var g="<div class='SC_select'><select><option value='"+zmail.zuid+"'>"+i.taskApp.myTask+"</option>",h="",j=e.getGroupOrder(),k=e.getGroup(),l=0,m=j.length;l<m;l++)c.isNewGroupUser()&&e.getGroup(j[l])&&e.getGroup(j[l]).disabled||(h="",g+="<option value='"+j[l]+"'",b.groupId===j[l]&&(h=" selected='selected'"),g+=h+">"+k[j[l]].name+"</option>");g+="</select></div>",f.find("#groupId").html(g);var n={title:i.taskApp.postAsNew,buttons:[{txt:i.buttonText.ok,selected:!0,callback:function(){p(b.taskId,b.groupId),d.remove()}},{txt:i.buttonText.cancel,isCancel:!0,callback:function(){return d.remove(),!1}}],mask:!0,hideclose:!1,pos:"center"},o=$("#postNewTask");o.length&&o.remove(),$("body").append(f),d.create("postNewTask",n)},r=function(){h.registerLeftClickHandlers({tagName:"a",attrName:"href",attrVal:".*/zm/#task/.*",callback:function(b){c.requireTaskModule().done(function(){var c=a("zmTask"),d=a("zmHash").decode(b.href);if("task"===d.key){var e=d.params;c.tasklinkClickHandler(e)}})}})},s={requireTaskModule:j,loadTask:o,postAsNewTask:q,addClickHandlerForTasks:r,taskTab:k};return $.extend(!0,c,s)}),define([],function(a,b){var c=a("zmUtil"),d=a("zmAppLoader"),e=function(b,c){var d=a("zmLink.Component"),e=void 0;"create"===b.mode?(e=d.addLinkView(b,c),"function"==typeof c&&e&&c(e)):"viewSLink"===b.mode&&(e=d.constructLinkBox({data:b.linkapp,groupId:b.groupId,bindClick:!0,from:"streams"}),c(e))},f=function(b,d){c.bookmark.loadBookMarkComp().done(function(){var c=a("zmLink.Util");c.isProjLoaded().done(function(){e(b,d)})})},g={loadBookMark:function(a){d.load("links").done(function(){zmail.ContactBook.fetchProcess.done(a)})},loadBookMarkComp:function(){var a=$.Deferred();return d.load("bookmarkComp").done(function(){zmail.ContactBook.fetchProcess.done(a.resolve)}),a.promise()},deleteLink:function(b){this.loadBookMarkComp().done(function(){var c=a("zmLink.Util");c.deleteBookmark(b)})}},h=function(b,d){var e=void 0,f=[{entity:"stream",regex:".*/zm/#stream/.*"},{entity:"mail",regex:".*/zm/#mail/tab/.*"},{entity:"task",regex:".*/zm/#task/tab/.*"}],g=f.length,h=function(){for(var a=0;a<g;a++){var d=c.regExpEscape(f[a].regex),e=new RegExp("^"+d+"$");if(e.test(b))return f[a]}return!1};if(e=h()){var i=a("zmList"),j=a("zmTask"),k=a("zmHash"),l=k.decode(b),m=l.params;if("mail"===e.entity)i.getMailData({msgId:m[1],type:"lt",opentype:2,src:"external"});else if("stream"===e.entity){"tab"===m[0]&&m.splice(0,1);var n={pid:m[1],gid:m[0],etype:m[2],actionType:m[3]};m[4]&&(n.commentId=m[4],n.allComments=!0),c.loadStreamsInTab(n)}else"task"===e.entity&&j.tasklinkClickHandler(m)}else{var o=["h tt p ://","h tt ps ://"];b.indexOf(o[0].replace(/ /g,""))===-1&&b.indexOf(o[1].replace(/ /g,""))===-1&&(b=o[0].replace(/ /g,"")+b),d=d||{};var p=window.open(b,"_blank");d.opener||(p.opener=null)}},i={loadLink:f,openLink:h,bookmark:g};return $.extend(!0,c,i)});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};define([],function(a,b){var c=a("zmUtil"),d=a("_zm"),e=a("zmText"),f=a("zmAppLoader"),g=a("zmComponent"),h=function(a){c.cmpWindow(a)},i=function(){$("#zm_afill").hide(),$("#zm_fLst").hide(),$("#zm_SigLst").remove(),$("#zm_TmpLst").hide(),$("#zm_EncLst").remove()},j=function(b){var d=a("zmmailAct"),e=a("zmPreviewTemplate"),f=a("zmInit");if(c.isChildWindow()){if("sdraft"===b.action){var g=b.msgId,h=b.draftObj,i=b.draftDataObj;e.postSaveDraftAction(g,h,i)}}else{var j=b.action,k=b.msgId,l=b.draftObj,m=b.draftDataObj,n=b.draftId,o=b.schedule,p=b.mode,q=f.getListingDetObj(),r=q.fId,s="";if("sdraft"!==j&&"stemplate"!==j?r!==zmail.folId.oId||!o&&"outbox"!==p?r!==zmail.folId.oId&&o?(s="",d.updateCount({fId:zmail.folId.oId,mode:"inc"})):r===zmail.folId.dId&&n&&!o&&c.deleteMsg(n):s=zmail.folId.oId:"sdraft"===j?s=zmail.folId.dId:"stemplate"===j&&(s=zmail.folId.teId),"sdraft"===j&&l&&l.TH&&e.postSaveDraftAction(k,l,m),s&&r===s){var t={};if(q.fId){var u=q.view,v=q.label||q.flag;t={fId:r,view:u,viewId:v}}else t={fId:"zm_"+q.view};t.retainPreview=!0,k===a("zmPrev").prevDetails("zm_Container").msgId&&(t.retainPreview=!1),$.publish("/mail/listMails",t)}}},k=function(){var a=$.Deferred();return $.when(f.load("zmcompose"),ZE_Init.editorCoreLoaded).done(function(){a.resolve()}),a.promise()},l=function(){var a={0:"w",1:"t",2:"p"};return c.isChildWindow()&&1===zmail.mailOpt.compTab&&(a[1]="p"),a[parseInt(zmail.mailOpt.compTab)]},m=function(a){if(a&&a.mode){var b,d=a.msgId,e=a.draftId,f=a.mode,g=a.draftCont,h=a.prevElem||[],i=a.disableScroll||!1,j=a.loadType,k=a.reopen,l=a.cmpId,m=a.cdata,n=a.loadMode||"",o=c.isInlineCompose();b=c.getCmpViewType(),b.type=c.getComposeType(),a.recipientList&&(b.recipientList=a.recipientList),d&&(b.msgId=d),m&&(b.cdata=m),n&&(b.loadMode=n),b.mode=f,o&&(b.draftId=e,b.data=g,h.length&&(e?b.prevDOM=h.find("#zmCon"+b.elemPrefix+e):b.prevDOM=h.find("#zmCon"+b.elemPrefix+d)),j&&(b.loadType=j),k&&(b.reopen=k),l&&(b.cmpId=l),i?b.disableScroll=i:b.disableScroll=!1),a.actionSrc&&(b.actionSrc=a.actionSrc),c.cmpReply(b)}},n=function(){var a=!1;return"p"===c.getComposeType()&&(a=!0),a},o=function(a){return!!c.isInlineCompose()&&Boolean(zmail.mailObj[a].DMID)},p=function(){var a=!1;return"w"===c.getComposeType()&&(a=!0),a},q=function(b,e){c.requireComposeModule().done(function(){var c=a("zmComp");c.cmpDialog(b)}),d.stopEvents(e)},r={cId:1,appData:{}},s=function(a,b){c.cmpObj.appData[a]=b},t=function(){c.cmpObj.cId+=1},u=function(){return"Cmp"+c.cmpObj.cId},v=function(a){a.appId&&(a.appId=c.getCmpAppId()),a.appObj.appId&&(a.appObj.appId=c.getCmpAppId()),s(a.appId,a.data),c.addCmpAppId()},w=function(){var a=window.addEventListener?"addEventListener":"attachEvent",b=window[a],d="attachEvent"===a?"onmessage":"message";b(d,function(a){c.debugLog(a)},!1)},x=function(a){c.cmpClose();var b=a.mode,d=zmail.conPath+"/comp.do?accId="+zmail.accId;d+="&originalMode="+b;var e,f,g=a.msgId,h=a.type;if(g&&(e=c.getFolIdByMsg(g),d+="&msgId="+g),"fwdme"===b){var i=c.getFwdArr(g,h);i.mId&&(d+="&fwdMsgIds="+i.mId),i.tId&&(d+="&fwdtId="+i.tId),i.folderId&&(e=i.folderId)}e&&(d+="&folId="+e),e&&c.isSharedFolder(e)&&(f=c.getShareId(e)),f&&(d+="&shareId="+f),c.openWindow(d,60,80)},y=function(){var b=$.Deferred();return c.requireComposeModule().done(function(){var c=a("zmComp"),d=c.getCmpData();b.resolve(d)}),b.promise()},z=function(b,e,f){var g=a("zmsuite"),h=void 0,i=void 0;g.isMaxLimitReached()||(i=b?function(){h.compose(b,f)}:function(){h.compose()},c.requireComposeModule().done(function(){h=a("zmComp"),i()})),d.stopEvents(e)},A=function(a,b,d){if(0!==zmail.mailOpt.compTab||a)z(a,b,d);else{var e={};e.mode="compose",c.cmpWindow(e)}},B=function(b,d){var f=a("zmComp"),g=a("Dialog"),h=a("zmInit"),i=[],j=[],k=void 0,l={};if(b)i=[b];else if("r"===d){var m=h.rclkId;m.indexOf("t")!==-1&&(m=f.zmsubStr(m,"t")),i=[m]}else{var n=c.getSelectedMails();n[0].length&&(i=n[0]),n[1].length&&(j=n[1])}if(j.length){var o=j.length;if(o>10){var p=e.get("zmcompose").message_fwdmul;return p=e.applyArgs(p,{NUMBER:o}),g.alert(p),!1}}if(i.length){var q=i.length;if(q>100){var r=e.get("zmcompose").conversation_fwdmul;return r=e.applyArgs(r,{NUMBER:q}),g.alert(r),!1}}return i.length&&(k=1===i.length?c.getFolIdByMsg(i[0]):c.getFolId()),i.length&&(l.mId=i),j.length&&(l.tId=j),k&&(l.folderId=k),l},C=function(a,b){a?b.show():b.hide()},D=function(a){var b=a.draftId||"",c=a.msgId||"",d=a.prevDOM;if(c&&d.length){d=d.closest(".SC_Twpr");var e=d.find(".SC_pct").find("[data-mid='"+c+"']"),f=d.find(".SC_Drft").find("[data-mid='"+b+"']");f.length||(f=d.find(".SC_Drft").find("[data-mid='"+c+"']")),c=f.attr("id"),c?(c=c.substring(6),$.publish("/mail/msgDiscarded",{draftId:b,msgId:c,actionType:a.actionType})):$.publish("/mail/msgDiscarded",{draftId:b,actionType:a.actionType});var g=e.closest(".SC_pct").find(".zm_ry");C(!0,g)}},E=function(b,c){var d=a("zmPreviewTemplate");if(c&&c.prevDOM&&c.prevDOM.length){var e=c.actionType;"discard_draft"===e?D(c):"replace_draft"===e&&d.showDraftedBand(c)}},F=function(b){var d=a("zmComp"),e=a("zmPreviewTemplate");if(c.isInlineCompose()&&"template"!==b.mode){var f=b.msgId,g=zmail.mailObj[f],h=void 0,i=void 0,j=void 0,k=void 0,l=void 0;g&&"p"===b.type&&"draft"!==b.mode&&"eanew"!==b.mode&&!g.DMID&&"outbox"!==b.mode&&(k=b.prevDOM.closest(".SC_Twpr"),l=b.viewType+f+"New",i="zmCon"+l,j=k.find("#"+i),j.length?e.addFocusOnclick(j,k):(C(!1,b.prevDOM.find(".zm_ry")),b.prevDOM.length&&(h=c.getCmpContainerTemplate(l,f),$(h).insertAfter(b.prevDOM.closest(".SC_pct")),b.prevDOM=$(h).find("#"+i))))}d.cmpReply(b)},G=function(a){a=a||{},c.requireComposeModule().done(function(){F(a)})},H=function(a){var b=a.type,d=!1,e=!1;a.msgId&&(d=c.isSharedFolder(c.getFolIdByMsg(a.msgId))),"w"!==b||d||(e=!0),c.isChildWindow()&&"eanew"===a.mode&&(e=!0),e?c.cmpWindow(a):G(a)},I=function(b,d){var e=a("zmsuite");d=d||{};var f=void 0;f=b.data.obj?b.data.obj:b.data,d["new"]&&(c.modifyComposeObj(b),e.setWorkSpace(b.appObj)),c.requireComposeModule().done(function(){var c=a("zmComp"),d={};d.mode=f.mode,d.msgId=f.msgId,d.restore=!0,d.restoreAppId=b.appId,c.cmpReply(d)})},J=function(a,b){var c=["DIV",{attrs:{"class":"SC_pct SC_Drft"},child:[["DIV",{attrs:{id:"zmHdr"+a,"class":"zmPHdr","data-mid":b}}],["DIV",{attrs:{id:"zmCon"+a}}]]}];return d.getDOM(c)},K=function(a){c.compose({NEWATT:a})},L=function(b,c){var d=a("zmComp");"object"===("undefined"==typeof d?"undefined":_typeof(d))&&"function"==typeof d.modeChange&&d.modeChange(b,c)},M=function(){function a(a,b){var c=a.split(b);return c[0]&&c[1]?c:null}var b=/\?|(?:&amp;)|&/,c={mailto:"TO",to:"TO",cc:"CC",bcc:"BCC",subject:"SUBJECT",body:"CONTENT",content:"CONTENT"};return function(d){var e=d.split(b),f={},g=e.length,h=[],i=void 0;if(e.length){for(h=a(e[0],":"),h.length>1&&(f[c[h[0].toLowerCase()]]=decodeURIComponent(h[1])),i=1;i<g;i++)h=a(e[i],"="),h.length>1&&(f[c[h[0].toLowerCase()]]=decodeURIComponent(h[1]));return f}}}(),N=function(b){var d={},e=void 0,f=void 0;return c.isChildWindow()?(e="W",f="W"):(b=b||a("zmTab").currentTab,"zm_Container"===b?(e="P",f="P"):b.indexOf("zm_srch")?b.indexOf("zm_tab")||(e="T",f="T"):(e="S",f="S")),d.viewType=e,d.elemPrefix=f,d},O=function(){d.registerLeftClickHandlers({tagName:"a",attrName:"href",attrVal:"mailto:(.+)",callback:function(a){var b=a.getAttribute("href");c.compose(M(b))}})},P=function(b){if(!c.isChildWindow())if(b)g.keybindings.setScope("inlineCmp");else{var d=g.keybindings.getScope();"inlineCmp"===d&&g.keybindings.setScope(a("zmTab").currentTab)}},Q={loadComments:function(){if(zmail.isOrg&&c.isZohoAccount(zmail.accId)&&"2"===zmail.collabVersion){var a=arguments[0]||{},b=$.Deferred();return $.publish("/draft/openedincompose",{draftID:a.draftID,appendCallback:a.appendCallback,onResize:a.onResize,containerDOM:a.parentElem,deferred:b,context:a.context}),b.promise()}},notifyUpdate:function(){if(zmail.isOrg&&c.isZohoAccount(zmail.accId)&&"2"===zmail.collabVersion){var a=arguments[0]||{},b=$.Deferred();return $.publish("/draft/sharing/notifyupdates",{draftID:a.draftID,zohoID:a.zuid||zmail.zuid,accountID:a.accId||zmail.accId,deferred:b}),b.promise()}}},R={requireComposeModule:k,cmpHideMenu:i,postMailActionsOnSend:j,getComposeType:l,isInlineCompose:n,isComposeWindow:p,cmpDialog:q,modifyComposeObj:v,addCmpAppId:t,getCmpAppId:u,cmpObj:r,cmpWindow:x,getCmpData:y,cmpClose:w,compose:A,invokeComposer:m,getFwdArr:B,cmpReply:H,cmpRestore:I,getCmpContainerTemplate:J,openComposeWithAtt:K,modeChange:L,addClickHandlerForMailTo:O,getCmpViewType:N,setInlineCmpScope:P,removeComposer:E,hasInlineDraft:o,DraftShare:Q,composeWindow:h};return $.extend(!0,c,R)}),define([],function(a,b){var c=a("zmUtil"),d=a("zmsuite"),e=a("zmText"),f=a("zmContentCache"),g=a("zmAppLoader"),h=e.get("commonUtils"),i=function(){var a=c.getSelectedMails();return!!(a[0].length+a[1].length)},j=function(){var b=a("zmList"),c=[],d=[],e=void 0,f=b.getElemObj().mainElem.find(".SC_mclst").find(".SC_check");return f.each(function(a,b){b=$(b),e=b[0].id,"t"===e.charAt(0)?d.push(e.substr(1,e.length-1)):("lt"===b.attr("data-ty")||"th"===b.attr("data-ty")&&!b.parent().prev().hasClass("SC_check"))&&c.push(e)}),[c,d]},k=function(){var a=c.getCheckedMailList();return a[0].length+c.getTotalMailCountInThreads(a[1])},l=function(b){var e=a("zmList"),f=a("zmPrev"),g=a("zmInit"),h=[],i=[],j=void 0,k=void 0,l=void 0,m=void 0,n=void 0,o=void 0,p=void 0,q=void 0,r=void 0,s=void 0,t={};if(c.isChildWindow()){var u=a("zmWindow"),v="";
return s=u.getListingDetObj(),v=$("#zmWindowWrapper .SC_pct").not(".SC_pct.SC_Drft").length>1?$("#zmWindowWrapper .SC_Tfcs").children().eq(0).attr("data-mid"):$("#zmWindowWrapper .SC_pct").children().eq(0).attr("data-mid"),h.push(v),[h,i]}for(b=b||a("zmTab").currentTab,s=g.getListingDetObj(),t=e.getElemObj(b),"zm_Container"===b||b.indexOf("zm_srch")!==-1?(j=t.mainElem.find("div.SC_check"),j.length||$(t.prevElem).find(".SC_Tfcs .zmPHdr").length||(j=t.mainElem.find(".zmSLst")),j.length?j.each(function(){q=this.id||$(this).attr("data-detail"),q.indexOf("t")||(q=q.substring(1,q.length)),zmail.mailObj[q]&&zmail.mailObj[q].TH&&"lt"===$(this).data("ty")?i.push(q):h.push(q)}):""!==$(t.prevElem).attr("data-mid")&&(j=$(t.prevElem).find(".SC_Tfcs .zmPHdr").attr("data-mid"),j?h.push(j):(q=f.prevDetails(b).msgId,q&&h.push(q)))):b.indexOf("zm_tab")!==-1?(j=b.indexOf("zm_tabt")?b.substring(6,b.length):$(".SC_show").find("div.SC_Tfcs").find("div.zmPHdr").attr("data-mid"),j&&h.push(j)):"zmStreamsApp"===b?h.push(d.getCenter(b)[1].$el.attr("data-mid")):"zmncenter"===b&&(q=f.prevDetails(b).msgId,q&&h.push(q)),n=i.length,k=0;k<n;k++)if(r=zmail.mailObj[i[k]].T,zmail.listObj[r])for(o=zmail.listObj[r].MO,p=o.length,l=0;l<p;l++)m=$.inArray(o[l],h),m!==-1&&h.splice(m,1);return 0!==c.getMLConversionValue()&&"zm_srch1"!==b&&("zm_Container"!==b||s.fId!==zmail.folId.tId&&s.fId!==zmail.folId.sId)||(h=h.concat(i),i=[]),[h,i]},m=function(a){var b=[],c=void 0,d=void 0;for(d=a.length,c=0;c<d;c++)b.push(zmail.mailObj[a[c]].T);return b},n=function(a,b){var c=zmail.mailContainer,d=c.getObject(a);d?c.rememberAsRecent(d.id):c.addObject({id:a,data:b})},o=function(b,e){var f=a("zmPrev"),g=a("zmPreviewTemplate"),h=a("zmCache"),i=e.thId,j=void 0,k=void 0,l=[];if(b.tdata&&i){if(zmail.listObj[i]=h.dolistObj(i,b.tdata),c.isInlineCompose()&&c.mapDraftId(i),f.prevDetails("zm_Container").msgId){var m=f.prevDetails("zm_Container").msgId;zmail.mailObj[m].T===i&&(j=!0,l=g.getMissingMailList(i,"P"))}d.isWorkspaceAvailable("zm_tabt"+i)&&(k=!0,l=g.getMissingMailList(i,"T")),j&&$.publish("/mail/updatemailview",[{list:l,opentype:0,mode:"sdraft"}]),k&&$.publish("/mail/updatemailview",[{list:l,opentype:2,mode:"sdraft"}])}},p=function(a){if(a&&zmail.listObj[a]){var b=zmail.listObj[a].MO,c=b.length,d=0,e="";for(d=0;d<c;d++)zmail.mailObj[b[d]].FD===zmail.folId.dId&&(e=zmail.mailObj[b[d]].PA,e&&zmail.mailObj[e]&&!zmail.mailObj[e].DMID&&(zmail.mailObj[e].DMID=b[d]),b.splice(d,1),c--,d--,e="");zmail.listObj[a].MO=b}},q=function(b){var d=a("zmList"),e=a("zmmailAct"),f=a("zmInit"),g=zmail.mailObj[b];if(g&&g.PA){var h=g.PA,i=zmail.mailObj[h];if(i&&i.DMID&&delete i.DMID,!c.isChildWindow()){if(0!==c.getMLConversionValue()){var j=d.getViewBasedMsgList(g.T,f.getListingDetObj(),!0);if(j.length>0){var k=c.excludeDraftSentMails(j);h=k.length?k[0]:j[0]}}i=zmail.mailObj[h]||{},i.DC&&i.DC>0&&(i.DC-=1),e.updateDraftCountInUI(h,"discard_draft",i.DC,"zm_Container")}}},r=function(a){return!(!zmail.mailObj[a]||zmail.mailObj[a].FD!==zmail.folId.dId)},s=function(b){var e=a("zmCache"),f=a("zmmailAct"),g=a("zmInit");if(b.error){var i=b.accId||b.AID;if(zmail.accId===i){var j=g.getListingDetObj();if(d.isWorkspaceAvailable("zm_Container")&&zmail.folId.oId===j.fId?($(zmail.mailCenter.listElem).html(""),e.clearListObj(),g.setListingDetObj({}),g.foldView({folId:zmail.folId.oId})):f.updateCount({fId:zmail.folId.oId,mode:"dec"}),"true"===b.error){var k=h.error.outboxErr;c.succErrMsg("e",k)}}}},t=function(a,b){var c=$("#"+b);a?c.addClass("SC_redtxt"):c.removeClass("SC_redtxt")},u=function(b,c){var d=a("zmList"),e=void 0;b[c].email.accid!==zmail.accId&&(e={actionType:"viewGroupMailEntity",entityId:b[c].email.msgid,entityType:"1",streamsView:"true",streams:!0,groupId:b.gnrl.by,accId:b[c].email.accid}),d.getMailData({msgId:b[c].email.msgid,opentype:2,type:"lt",src:"external",eprm:e})},v=function(a){var b=null;return zmail.mailObj[a]&&zmail.mailObj[a].FD&&(b=zmail.mailObj[a].FD),b},w=function(b){var d=a("zmInit"),e={},f=void 0;if(b)e=b;else if(c.isChildWindow()){var g=a("zmWindow");e=g.getListingDetObj()}else e=d.getListingDetObj();return f=e.fId||e.label||e.view||e.flag,"-1"!==f&&"1"!==f&&"2"!==f&&"3"!==f||(f="flag"),f},x=function(a){var b=[zmail.folId.dId,zmail.folId.teId,zmail.folId.sId,zmail.folId.tId,zmail.folId.oId];return!(c.isChildWindow()||!c.isFolderId(a)||b.indexOf(a)!==-1)},y=function(b){var d=a("zmfolAction"),e=zmail.folTree;if(!b&&!a("zmTab").currentTab.indexOf("zm_srch"))return 0;if(b||(b=c.getFolId()),c.hasFolSpecConversation(b)){var f=d.getParentFolderId(b);return f?e[1][f].CH[b].CV:e[0][b].CV}return zmail.folviewThread},z=function(){var b=a("zmPreviewTemplate");return 1===b.currentWorkSpace},A=function(){var a=c.getSelectedMails(),b=a[0],d=a[1],e=zmail.mailObj,f=void 0,g=void 0,h=void 0;for(h=0,g=b.length;h<g;)f=e[b[h]].TAG,f&&f.length?h++:(b.splice(h,1),g--);for(h=0,g=d.length;h<g;)f=e[d[h]].TAG,f&&f.length?h++:(d.splice(h,1),g--);return[b,d]},B=function(a){var b=0;return a=a||[],a.forEach(function(a){b+=zmail.mailObj[a]&&zmail.mailObj[a].TC||0}),b},C=function(a,b){var c={},d=void 0,e=void 0,f=void 0;if(b)c=zmail.shrTree[0];else{var g=zmail.folTree[1],h={},i=void 0;for(i in g)$.extend(!0,h,g[i].CH);$.extend(!0,c,zmail.folTree[0],h)}for(d in c)if(f=c[d],e=b?f.SHID:f.SH,e===a)return d},D=function(b,c,e){var f=a("zmPrev"),g=void 0,h=void 0,i=void 0,j="",k=void 0,l=void 0,m=void 0;if(b&&0===b.indexOf("t")&&(b=b.substring(1)),i=zmail.mailObj[b],c)switch(c){case"preview":if(e)switch(e){case"zm_Container":k=!0;break;case"zm_srch1":l=!0}else k=!0,l=!0;break;case"tab":m=!0}else k=!0,l=!0,m=!0;if(k&&d.isWorkspaceAvailable("zm_Container")){if(g=f.prevDetails("zm_Container"),("lt"===g.type||"th"===g.type)&&g.msgId===b)return!0;if(i&&zmail.mailObj[g.msgId]&&i.T&&i.T===zmail.mailObj[g.msgId].T)return!0}if(l&&d.isWorkspaceAvailable("zm_srch1")&&(h=f.prevDetails("zm_srch1"),("lt"===h.type||"th"===h.type)&&h.msgId===b))return!0;if(m){if(j="zm_tab"+b,d.isWorkspaceAvailable(j))return!0;if(i&&i.TH&&(j="zm_tabt"+i.T,d.isWorkspaceAvailable(j)))return!0}return!1},E=function(a,b){var d=c.isMailContentInUse(a,"preview",b);return d},F=function(a){var b=zmail.folTree[0]||[],c=zmail.folTree[1]||[],d={},e=void 0,f=void 0,g=void 0;for(e in b)d[e]=b[e];for(e in c){g=c[e].CH||{};for(f in g)d[f]=g[f]}return d[a]},G=function(b){var d=a("zmList"),e=b.fId,f=b.viewId,g=[],h=void 0;if(zmail.listObj[e]?g=zmail.listObj[e].MO:zmail.listObj[f]&&(g=zmail.listObj[f].MO),h=g.length,g.length>0){var i=void 0,j=void 0,k={},l={},m=[],n=void 0;for(i=0;i<h;i++)if(l=zmail.mailObj[g[i]],l&&l.TH)for(k={fId:e},m=d.getMailSummaryList(k,l.T),n=m.length,j=0;j<n;j++)c.discardMsg({draftId:m[j],actionType:"discard_draft"})}},H=function(b,d){var e=a("zmList"),f=e.getViewBasedMsgList(b,d,!0);return d.fId===zmail.folId.sId?f[0]:(f=c.excludeDraftSentMails(f),f[0])},I=function(a){var b=[],c=0,d=a.length,e=void 0;for(c=0;c<d;c++)e=zmail.mailObj[a[c]],e.FD!==zmail.folId.sId&&e.FD!==zmail.folId.dId&&b.push(a[c]);return b},J=function(a){return Boolean(zmail.mailObj[a])},K=function(a,b){b=b||{};var d=$.Deferred(),e=b.reload||!1,g=b.nocache||!1,h=b.params||{};if(a)if(!e&&f.isCached(a))d.resolve(f.get(a));else{var i={accId:zmail.accId,split:!0,summary:!0},j={};i.msgId=j.msgId=a;for(var k in h)i[k]=h[k];!e&&g||(j.forceFetch=!0),c.sendMailDataReq(i,j,function(b,c){if(c=c||{},b=b||{}){var e=Object.keys(b).length;0===e||1===e&&b.MSGID?d.reject():d.resolve(f.get(a))}else d.reject()},function(a){d.reject()})}else d.reject();return d.promise()},L=function(b){var d=a("zmmailAct"),e=zmail.mailObj[b];if(e&&c.getFolId()===e.FD){var f={action:"delete"};e.TH&&e.FD!==zmail.folId.dId&&e.FD!==zmail.folId.tId&&!e.AR?(f.mailId=[],f.tmailId=[b]):(f.mailId=[b],f.tmailId=[]),d.rdoAction({result:"success"},f)}},M=function(b){var d=a("zmPreviewTemplate"),e=b.draftId,f=b.msgId;if("discard_draft"===b.actionType){var g=zmail.mailObj[e],h=void 0,i=0,j=void 0;g&&g.TH&&(h=g.T,j=zmail.listObj[h],j&&(i=j.MO.indexOf(e),i!==-1&&j.MO.splice(i,1),d.discardMsgPreview(e)),g.FD===zmail.folId.dId&&c.removeDraftMapping(e)),f&&c.isInlineCompose()&&d.discardMsgPreview(f)}},N=function(a,b,c,d){var e=void 0;b=b||{},"tIcon"!==b.from&&(a.comments=!0,e=zmail.mailObj[a.msgId]||{},a.entityId=a.entityId||e.T||a.msgId,a.groupId=a.groupId||zmail.zuid,a.entityType=1);var g={u:zmail.conPath+"/md.do",t:"POST",fn:c,p:a,ep:b};"function"==typeof d&&(g.efn=d),f.fetch(g)},O=function(b){var c=a("zmInit");c.foldView({folId:b,reInitialize:!0}),zmail.mailLeft.selRow(b,"zmlTreeH",!0),c.updateHeaderBand()},P=function(a){return a=$(a),1===a.length&&a.hasClass("SC_simg")&&(a.children().removeClass("SC_ldot"),a.children().each(function(a,b){"none"!==$(b).css("display")&&$(b).addClass("SC_ldot")})),a},Q=function(a){return zmail.labInfo[a]?zmail.labInfo[a].dispName:""},R=function(a){var b=e.get("mail"),c=b.listing.flagmenu,d={1:c.infoflag,2:c.important,3:c.followup};return d[a]||""},S=function(b,c){g.load("mail").done(function(){var d=a("zmRestore");d.restoreMailApp(b.data,c)})},T=function(b){g.load("mail").done(function(){var c=a("zmRestore");c.restoreTabs(b)})},U=function(a,b){var c={};if(b=b||{},a.length)return a=a.join(),c.SearchStr=encodeURIComponent(a),c.view="search",b.fId?c.viewfolId=b.fId:(b.flag&&(c.flag=1),b.label&&"-1"!==b.label&&(c.label=b.label),"unread"===b.view&&(c.unreadStatus=1)),c},V=function(){try{var b=zmPrev.prevDetails(),d=f.get(b.msgId)||{};zmail.isRHSEnabled&&!$.isEmptyObject(d)&&a("zmWidgets").publishToWidget("onmailpreview",zmWidgets.getCurrentMailDetails())}catch(e){c.debugLog(e)}},W=function(){V()},X=function(a){var b=zmail.mailObj[a]&&zmail.mailObj[a].FD;return!(!b||!c.isSharedFolder(b,"R"))},Y={getCheckedMailList:j,getCheckedMailCount:k,getSelectedMails:l,getThreadIdArr:m,prevCache:n,cacheThreadList:o,mapDraftId:p,removeDraftMapping:q,isDraftMail:r,updOutbox:s,updSendErrorStatus:t,viewAssociatedMail:u,getFolIdByMsg:v,getFolId:w,hasFolSpecConversation:x,getMLConversionValue:y,isChildWindow:z,getSelectedMailsWithLabels:A,getTotalMailCountInThreads:B,getFolderForShID:C,isMailContentInUse:D,isMailOpenInPreview:E,getFolderObject:F,discardFromThread:G,getFirstMsgId:H,excludeDraftSentMails:I,isMetaDataAvailable:J,getMailContent:K,deleteMsg:L,discardMsg:M,sendMailDataReq:N,selectFolderInLHS:O,applyLBDots:P,findTagName:Q,findFlagName:R,restoreLeftState:S,restoreTabs:T,createSearchParams:U,publishMailEvents:W,publishMPreviewEvent:V,isReadOnlyMail:X,checkSelectedMails:i};return $.extend(!0,c,Y)}),define([],function(a,b){var c=a("_"),d=a("_zm"),e=a("zmUtil"),f=a("zmAppLoader"),g=a("zmCont"),h=a("zmText"),i="CONTACT_BOOK_GROUP_CHANGED",j={},k=".*/zm/#stream/.*";return j.isNewGroupUser=function(){return zmail.isOrg},j.requireStreamsApp=function(){var a="streamsApp";return f.load(a)},j.requireStreamsComments=function(){return f.load("streamsComments")},j.loadStreams=function(){return j.requireStreamsApp()},j.changeUnread=function(a,b,d){var e,f=zmail.ContactBook.groups.me.attrs||{},g=c.pluck(zmail.ContactBook.getGroups(),"attrs"),h={};for(e=0;e<g.length;e++)h[g[e].id]=g[e];if(a&&h[a]||zmail.zuid===a){var j,k;k=zmail.zuid===a?f:h[a],j=void 0!==d?parseInt(d):parseInt(k.scount),b?j++:j--,$.publish(i,{props:{scount:j},id:a}),$.publish("group/unread",{groupId:a,count:j,incFlag:b})}},j.isGroup=function(a){if(a){a=String(a);var b=zmail.ContactBook.getGroups(),d=c.pluck(b,"attrs"),e=c.pluck(d,"id");return e.indexOf(a)!==-1}return!1},j.getGroupOrder=function(){var a=zmail.ContactBook.getGroups(),b=c.pluck(a,"attrs"),d=c.pluck(b,"id");return d.length||(d=[]),d},j.getEmailEnabledGroup=function(a){var b={},d=zmail.ContactBook.getGroups(),f=zmail.ContactBook.groups.me.attrs||{};if(b[f.id]=$.extend({},f),b[f.id].name=h.get("zmContacts","common.label.streamsSelfGroup"),b[f.id].order=1,d.length){var g=c.pluck(d,"attrs"),i={},k=!1,l=0,m=j.getGroupOrder(),n=m.length,o=2,p=0;for(l=0;l<g.length;l++)g[l].disabled||g[l].hidden?g[l].disabled&&(k=!0):i[g[l].id]=g[l];for(l=0;l<n;l++)c.size(i[m[l]])&&(b[m[l]]=$.extend({},i[m[l]]),b[m[l]].order=o,o++,a||(o=3===p?o+1:o,p>3&&(b[m[l]].hideNode=!0)),p++);p>4&&(b.more={name:h.get("commonUtils","streams.more"),id:"more",order:6,txtNodeClass:"SC_thm",hideNode:Boolean(a),rowTitle:h.get("commonUtils","streams.moreTitle")},k&&j.isNewGroupUser()&&(b.disabledGrp={name:h.get("commonUtils","streams.disGrp"),id:"disGrp",order:o++,hideNode:!a,txtNodeClass:"SC_thm",rowTitle:h.get("commonUtils","streams.stDisGrp")}),b.less={name:h.get("commonUtils","streams.less"),id:"less",order:o++,hideNode:!a,txtNodeClass:"SC_thm",rowTitle:h.get("commonUtils","streams.lessTitle")})}else if(e.isNewGroupUser()){var q=["SC_onBoardImgD","SC_onBoardImgL"],r=c.random(0,1),s=q[r],t=[["SPAN",{attrs:{"class":"SC_onBoardImg "+s}}],["DIV",{child:[["SPAN",{child:[["text",h.get("commonUtils","streams.onboardContent")]]}],["SPAN",{attrs:{"class":"SC_link"},child:[["text",h.get("commonUtils","streams.colloborate")]]}]]}]];b.createGrp={id:"createGrp",name:"",count:"",customNode:!0,order:2,customNodeHtmlTemplate:t}}return b},j.updateStreamUnread=function(){var b=a("zmComponent"),c=function(b,c){c=c.data||{},"string"==typeof c.group&&(c.group=$.parseJSON(c.group)),"string"==typeof c.shgroup&&(c.shgroup=$.parseJSON(c.shgroup));var d=c.shgroup||c.group,f=c.ntype,h="30"===f||"4"===f||"41"===f||"46"===f||"25"===f||"44"===f||"79"===f||"61"===f||"112"===f&&c.group.id!==zmail.zuid;if(h&&c.nby!==zmail.zuid){var i=g.isGroup(d.id)?d.id:zmail.zuid;j.changeUnread(i,!0)}var k="31"===f||"45"===f||"38"===f;k&&c.nby!==zmail.zuid&&e.streamUpdate({groupId:d.id,newcomment:!0,reflist:c.refList}),"50"!==f&&"75"!==f&&"51"!==f||c.memberzuid!==zmail.zuid||$.when(j.requireStreamsApp()).done(function(){var b=a("zmStreamsApp");b.GroupApp.requestGroupId=d.id,b.GroupApp.updateGroupListing(!g.isGroup(d.id))})};b.notifier.addHandler("streams",c)},j.addClickHandlerForStreams=function(){d.registerLeftClickHandlers({tagName:"a",attrName:"href",attrVal:k,callback:j.openStreamsUrl})},j.publishCloseNotif=function(){$.publish("/streams/closePopOut")},j.openStreamsUrl=function(b){c.isElement(b)&&$(b).hasClass("dateTime")&&j.publishCloseNotif();var d=a("zmHash"),f=c.isElement(b)?b.href:b,g=d.decode(f);if("stream"===g.key){var h=g.params;"tab"===h[0]&&h.splice(0,1);var i={pid:h[1],gid:h[0],etype:h[2],actionType:h[3]};h[4]&&(i.commentId=h[4],i.allComments=!0),e.loadStreamsInTab(i)}},j.isValidStreamsUrl=function(a){if(!a)return!1;var b=new RegExp(k);return b.test(a)},j.streamUpdate=function(a){var b={},d=a.groupId;if(b=zmail.mailLeft.getNodes()[0].getLayer("zmStreamTree"),b.listObject[d])if(a.newcomment){var e=c.size(a.reflist)?a.reflist.split(","):[],f=c.find(e,function(a){if(a===zmail.zuid)return!0});f||b.addClassAtStart(d,"msi-lcmnt")}else{var g=void 0!==a.incFlag&&a.incFlag;b.updateCount(d,"upd",a.count,g,!1),g||b.clearNew(d)}},j.loadStreamsInTab=function(b){$.when(e.loadStreams(2)).done(function(){a("zmStreamsApp").events.openPostInTab(b)})},j.loadNewPostDialog=function(b,c,d){void 0===c&&(c=[]),j.requireStreamsApp().done(function(){a("zmStreamsApp").updateBox({content:b,attachment:c,mentions:d},!0)})},zmail.ContactBook&&zmail.ContactBook.groupsFetched.done(function(){j.constructStreamLHS=function(a){zmail.mailLeft.getNodes()[0].getLayer("zmStreamTree").setListObject(e.getEmailEnabledGroup(a)),zmail.mailLeft.rerender("zmStreamTree","list")}}),j.cmpDraft=function(b,c){var d=function(){a("zmComp").getAppDOM(b,c)};e.requireComposeModule().done(function(){d()})},$.extend(!0,e,j)}),define([],function(a,b){var c=a("$"),d=a("zmail.Core.Namespaces"),e=d.create("zmail.Utils.TextAreaResizer"),f={TextDIVWithWrapper:['<div id="text-area-resizer-wrapper">','<div id="resize-duplicate"></div>',"</div>"].join("\n")},g={TextDIVWrapper:{opacity:"0",position:"fixed",left:"0",top:"0",padding:"0",margin:"0",overflow:"hidden",display:"block","pointer-events":"none",border:"none",outline:"none"},TextDIV:{opacity:"0",height:"auto","max-height":"auto","min-height":"auto",overflow:"hidden",display:"block",position:"static","pointer-events":"none"}},h={heightResize:50,scrollAdjust:50},i=function(){var a;return function(b){if(b=b||{},!a){var d=c(f.TextDIVWithWrapper);d.css(g.TextDIVWrapper),a=c("#resize-duplicate",d),a.css(g.TextDIV),d.appendTo(document.body)}return a}}(),j=function(a){a=c(a)[0];var b,d={};return a&&"function"==typeof window.getComputedStyle?(b=window.getComputedStyle(a),Array.prototype.forEach.apply(b,[function(a){d[a]=b[a]}]),d):d},k=function(a){a=a||{};var b,c,d,e,f,g;e=a.scrollParent,f=a.scrollTopBeforeResize,g=a.scrollAdjustDuration,d=e.scrollTop(),c=Math.round(document.body.clientHeight/10),b=d-f,0!==b&&(b<0&&(c=-c),e.animate({scrollTop:e.scrollTop()+c},{duration:g,queue:!1,easing:"linear"}))},l=function(a,b){if(b=b||{},a){var d,e,f,l,m,n,o,p,q,r,s,t,u,v;if(u=h.heightResize,v=h.scrollAdjust,d=a.value||"",d=d.replace(/\n/gim,"\n_"),e=j(a),b.minHeight&&window.isFinite(b.minHeight)?f=b.minHeight:(f=e["min-height"],f=window.parseInt(f),window.isFinite(f)||(f=e["line-height"],f=window.parseInt(f),window.isFinite(f)||(f=0),f*=2)),f=f||0,e=c.extend(e,g.TextDIV),l=i(),m=l[0],l.css(e),l.text(d),n=m.offsetHeight+(b.heightPadding||0),n<f&&(n=f),o=a.offsetHeight,p=n-o,0!==p){t="hidden",b.maxHeight?(s="function"==typeof b.maxHeight?b.maxHeight():b.maxHeight,s<=0?s=n:n>=s&&(t="auto",u=0,v=0)):s=n,q=c(a).scrollParent(),r=q.scrollTop();var w=function(){"function"==typeof b.onResize&&b.onResize({element:c(a)[0],height:n,maxHeight:s,overflow:t,change:p}),k({scrollParent:q,scrollTopBeforeResize:r,scrollAdjustDuration:v})};c(a).css({"max-height":s+"px","overflow-y":t}),c(a).animate({height:n+"px"},{duration:u,easing:"linear",queue:!1,complete:w})}}};return e.resize=l,e}),define([],function(a,b){var c=a("$"),d=a("zmail.Core.Namespaces"),e=d.create("zmail.Utils.TextArea"),f=function(a){a=c(a)[0];var b,d={};return a&&"function"==typeof window.getComputedStyle?(b=window.getComputedStyle(a),Array.prototype.forEach.apply(b,[function(a){d[a]=b[a]}]),d):d},g=function(a){return a.selectionEnd||a.selectionStart||0},h=function(a,b){b=b||{};var d=a.getBoundingClientRect(),e=d.width+"px",g=d.height+"px";b.autoWidth&&(e="auto");var h=c("<div>")[0],i=f(a);return i=c.extend(i,{position:"absolute",top:"0",left:"0",width:e,height:g,opacity:"0",margin:"0","pointer-events":"none"}),c(h).css(i),c(document.body).append(h),h},i=function(a,b){var c=a.value||"";c=c.substr(0,b);var d=/(?:(?=\s*)([\S]+[^\S\n]*)$)/i,e=d.exec(c),f=e?e[1]:" ";return f},j=function(a,b){if(b=b||{},a=c(a)[0],!a)return null;var d=h(a,b),e=a.value||"",f=g(a),j=i(a,f);e=e.substring(0,f),e=e.substr(0,e.length-j.length);var k=document.createElement("span");k.setAttribute("class","content-span"),k.appendChild(document.createTextNode(e));var l=document.createElement("span");l.setAttribute("class","content-span-last-word"),l.appendChild(document.createTextNode(j)),d.appendChild(k),d.appendChild(l);var m=l.getBoundingClientRect();return c(d).remove(),d=null,m},k=function(a,b){b=b||{};var d=c(h(a,b)),e=c("<span></span>");e.text(a.value),d.append(e);var f=d[0].getBoundingClientRect();d.remove(),d=null,e=null,b.suppressResize||c(a).css({width:f.width+"px"});var g=f.width,i=f.height;return b.minWidth&&(g=Math.max(g,b.minWidth)),{width:g,height:i}};return e.findCurrentTypingWord=i,e.findCursorPosition=j,e.fitInputWidth=k,e}),define([],function(a,b){var c=a("zmUtil"),d=a("_zm"),e=[],f=function(a){e.push(a)},g=function(a){var b,c,d=e.length-1;for(c=d;c>=0;c--)if(b=e[c].element){if(document.body.contains(b))break;e.splice(c,1)}e.length&&(e[c].activeMenu=a)},h=function(a,b,c,e){var f=a.element,g=a.activeMenu||{},h=a.waitForActiveMenuHandler,i=!0;return f?(document.body.contains(f)&&(b&&!h||!g.activeMenuHandler||(i=g.activeMenuHandler.apply(a,g.activeMenuArgsArray)),i=i?!c:i,"undefined"!=typeof e&&$(e.target).closest(".zmcDrpDwnOpn").length>0?($(e.target).closest(".SC_ddn").removeClass("SC_ddn"),$(e.target).closest(".sel").removeClass("sel")):$(".zmcDrpDwnOpn").removeClass("zmcDrpDwnOpn"),i&&(d.blindRemoveElement(f),a.menuHandler&&a.menuHandler.apply(a,a.menuArgsArray))),i):(a.menuHandler&&a.menuHandler.apply(a,a.menuArgsArray),!0)},i=function(a,b,c){var d,e,f=a.length-1;for(e=f;e>=1;e--){if(d=a[e],!h(d,b,c))return!1;a.pop()}return!0};return c.hideMenu=function(a,b,c){var d,f=e.length,g=!0;if(f){if(d=e[0],f>1&&(g=!!i(e,a,b)&&!d.hideChildMenuFirst),!g||!h(d,a,b,c))return!1;e.pop()}return!0},function(){$.subscribe("/mail/menuCreated",function(a,b){f(b)}),$.subscribe("/mail/activeMenu",function(a,b){g(b)})}(),c}),define([],function(a,b){var c=a("zmail.Core.Namespaces"),d=c.create("zmail.Utils.TextUtil"),e=function(a,b){a=a||"",b=b||{};var c,d=1e3,e=0,f=0,g=0;return b.breakPeriods===!0&&(a=a.replace(/\./g," ")),a=a.replace(/\s+/g," "),(a.split(" ")||[]).forEach(function(a){a=a||"",a.length>=7?g++:a.length>3?f++:e++}),c=Math.round(e/6)+Math.round(f/3)+Math.round(g/1),c=1e3*c+d};return d.calculateReadTime=e,d}),define([],function(a,b){var c=a("zmail.Core.Namespaces"),d=a("zmail.Utils.EmailValidator"),e=c.create("zmail.Utils.EmailParser"),f=function(a,b){return"function"==typeof String.prototype.repeat?a.repeat(b):new Array((++b)).join(a)},g=function(a){var b;return b=a,b=b.replace(/\\"/gim,"__"),b=b.replace(/("[^"]*")/gim,function(a){return f("_",a.length)})},h=function(a){var b,c,d=/(?:([^;,]+)[;,]?)/gim,e=[];for(c=g(a),b=d.exec(c);null!==b;)e.push({index:b.index,length:b[1].length}),b=d.exec(c);return e},i=function(a){var b,c,d,e,f,h=/(?:([^ ]*)( +)([^@ ]+)(@)([^@ ]+))/gim,i=/(?:(.*)(<)([^@ ]+)(@)([^@ ]+)(>))/gim,j=0;return b=g(a),c=i.exec(b),null===c&&(c=h.exec(b)),c?(d=a.substr(j,c[1].length),d=d.trim(),j+=c[1].length+c[2].length,e=a.substr(j,c[3].length),e=e.trim(),j+=c[3].length+c[4].length,f=a.substr(j,c[5].length),f=f.trim(),'"'===d.charAt(0)&&'"'===d.charAt(d.length-1)&&(d=d.substr(1,d.length-2)),"<"===e.charAt(0)&&(e=e.substr(1)),">"===f.charAt(f.length-1)&&(f=f.substr(0,f.length-1)),{name:d,local:e,domain:f}):null},j=function(a){var b,c,e,f={},g=!1;return a=a.trim(),e=i(a),e?(g=!0,b=e.local+"@"+e.domain):b=a,c=d.validate(b),g?f.name=e.name:(f.name=a.substr(0,a.lastIndexOf("@")),f.name=f.name.replace(/[^a-z0-9\- _]*/gim,"")),f.email=b,f.valid=c.status,c.status||(f.errorCode=c.errorCode,f.errorMessage=c.errorMessage),f},k=function(a,b){var c=[],d=[];return b=b||{},a=a||"",c=h(a),c.forEach(function(b){var c=a.substr(b.index,b.length),e=j(c);d.push(e)}),d};return e.parse=k,e}),define([],function(a,b){var c=a("zmail.Core.Namespaces"),d=a("zmail.Utils.DeferredCollection"),e=c.create("zmail.Utils.Image"),f=d.create({keepDeferreds:!1}),g=function(a,b,c){c=c||{};var d=$("<img />")[0],e=function(){d.onload=void 0,d.onerror=void 0,d=void 0,e=void 0};d.onload=b.resolve,d.onerror=b.reject,d.src=a,d.complete&&b.resolve(),b.always(e)},h=function(a,b){a=(a||"").trim(),b=b||{};var c=this._deferreds||f;if(!a)return $.Deferred().reject().promise();b.forceRequest===!0&&c.clear(a);var d=c.has(a),e=c.get(a);return d||g(a,e,b),e.promise()},i=function(a){a=a||{};var b={_deferreds:d.create({keepDeferreds:a.storeRequests===!0})};return b.load=h,b},j=function(a){a=a||{};var b=i(a);b.queue=[],b.maxRequests=a.maxRequests||6,b.currentRequests=0;var c,d;return d=function(){if(b.currentRequests-=1,b.queue.length>0)for(var a=b.maxRequests-b.currentRequests;a>0&&b.queue.length>0;){var d=b.queue.shift();c(d.imagePath,d.loadOpts).done(d.deferred.resolve).fail(d.deferred.reject),a--}},c=function(a,c){var e=null;if(b.currentRequests<b.maxRequests)e=h.apply(b,[a,c]).always(d),b.currentRequests+=1;else{var f=$.Deferred();b.queue.push({imagePath:a,loadOpts:c,deferred:f}),e=f.promise()}return e},b.load=c,b};return e.load=h,e.createLoader=i,e.createThrottledLoader=j,e}),define([],function(a,b){var c=a("zmail.Core.Namespaces"),d=c.create("zmail.Utils.Image"),e=d.load,f=function(a,b,c){c=c||{};var d,e=$("<img />"),f=$("<canvas />"),g=function(){try{f.css({height:e.outerHeight()+"px",width:e.outerWidth()+"px"}),d=f[0].getContext("2d"),d.drawImage(e[0],0,0),b.resolve(f[0].toDataURL())}catch(a){b.reject()}},h=function(){e.remove(),e=void 0,f.remove(),f=void 0,d=void 0,g=void 0,h=void 0},i={opacity:"0",position:"fixed",top:"0",left:"0",height:"auto",width:"auto",zIndex:"-100",overflow:"hidden"};e.css(i),f.css(i),e.appendTo(document.body),f.appendTo(document.body),e.on("load",function(){g()}),e.on("error",b.reject),e.attr({src:a}),e[0].complete&&g(),b.always(h)},g=function(a,b){b=b||{};var c=$.Deferred();return(a=a||"")?("string"!=typeof a&&(a=a.src),a=a.trim(),e(a).done(function(){f(a,c,b)}).fail(c.reject),c.promise()):c.reject().promise()};return d.getDataURL=g,d}),define([],function(a,b){var c=a("zmComponent"),d=a("zmText"),e=a("_zm"),f={},g=document,h=d.get("commonUtils").clipBoard,i=function(a){var b,c=window;g.selection?(b=g.body.createTextRange(),b.moveToElementText(a),b.select()):c.getSelection&&(b=g.createRange(),b.selectNode(a),c.getSelection().removeAllRanges(),c.getSelection().addRange(b))};return f.setData=function(a,b){b=b||{};var c=g.createElement("DIV");"html"===b.type?c.appendChild(a):c.innerText=a,c.style.opacity="0",g.body.appendChild(c),c.style.opacity="",i(c),g.execCommand("copy"),b.hasOwnProperty("onSuccess")&&"function"==typeof b.onSuccess?b.onSuccess():(b.hasOwnProperty("showSuccessMessage")||"undefined"==typeof b.showSuccessMessage)&&e.succErrMsg("s",h.success,{hide:""}),c.parentElement.removeChild(c)},f.isSupported=function(){return!!g.queryCommandSupported("copy")},Object.keys(c).length>0?c.clipBoardAPI=f:window.clipBoardAPI=f,c}),define([],function(a,b){var c=a("zmComponent"),d={},e=document;return d.download=function(a,b){var c,d,f,g,h,i,j=b||{};if(c=a,f=j.contentType,g=j.fileType,h=j.fileName,f=f?"data:application/'"+f+"';charset=utf-8,":"data:application/text;charset=utf-8,",g&&"exe"===g?g="txt":g&&""!==g||(g="txt"),i=e.createElement("a"),d=f+encodeURIComponent(c),h=h?h+"."+g:"tempFile."+g,/chrome/.test(navigator.userAgent.toLowerCase())){var k=[new Blob([c],{type:g}),new Uint16Array([33])],l=new File(k,h,{lastModified:new Date(0),type:"overide/mimetype"}),m=new FileReader;return m.onload=function(a){e.body.appendChild(i),i.download=h,i.href=URL.createObjectURL(l),i.click(),i.parentNode.removeChild(i)},m.readAsText(l),!0}if(window.navigator.msSaveBlob){var n=new Blob([a],{type:"text/plain;charset=utf-8;"});window.navigator.msSaveOrOpenBlob(n,h)}else e.body.appendChild(i),i.download=h,i.href=d,i.click(),i.parentNode.removeChild(i)},d.isSupported=function(){var a=window.navigator.userAgent;if(a.indexOf("MSIE")>0||a.indexOf("rv:11")>0)return!!window.navigator.msSaveBlob;var b=e.createElement("a");return"string"==typeof b.download},Object.keys(c).length>0?c.downloadAsFile=d:window.downloadAsFile=d,c}),function(a){var b,c,d,e,f,g,h=document,i=20,j=200,k={},l=function(a,b){"class"===b?this.mainContent=h.getElementsByClassName(a)[0]:"id"===b?this.mainContent=h.getElementById(a):this.mainContent=a,this.scrollContainer=h.createElement("div"),this.scroller=h.createElement("div")};l.prototype.scrollDecider=function(a){a.preventDefault();var b=this;e=b.scrollContainer.clientHeight;var c=b.scroller.offsetTop;b.scroller.style.position="relative";var d=function(d){var f=d.pageY-a.pageY,g=b.mainContent.scrollHeight,h=Math.min(e-b.scroller.clientHeight,Math.max(0,c+f));b.scroller.style.top=h+"px";var i=g*parseInt(b.scroller.style.top)/b.scrollContainer.clientHeight;b.mainContent.scrollTop=i};h.addEventListener("mousemove",d,!1),h.addEventListener("mouseup",function(){h.removeEventListener("mousemove",d,!1)},!1),a.preventDefault()},l.prototype.mousePadScroll=function(a){var b=this;a.wheelDelta>0||a.detail<0?b.scrollUp(null,a.deltaY,b):(a.wheelDelta<0||a.detail>0)&&(b.scrollContainer.getBoundingClientRect().bottom>b.scroller.getBoundingClientRect().bottom?b.scrollDown(null,a.deltaY,b):setTimeout(function(){b.windowResize(b)},1e3))},l.prototype.scrollUp=function(a,b){var f=this;e=f.scrollContainer.offsetHeight,"keyEvent"===a?f.mainContent.scrollTop-=j:void 0!==b?f.mainContent.scrollTop+=b:f.mainContent.scrollTop-=i,f.scroller.style.position="relative",f.scroller.getBoundingClientRect().top>f.scrollContainer.getBoundingClientRect().top?(f.scroller.style.top=f.mainContent.scrollTop*e/f.mainContent.scrollHeight+"px",c=f.scroller.getBoundingClientRect().top,c<d&&window.clearInterval(g)):window.clearInterval(g)},l.prototype.scrollDown=function(a,b,f){e=f.scrollContainer.offsetHeight,"keyEvent"===a?f.mainContent.scrollTop+=j:void 0!==b?f.mainContent.scrollTop+=b:f.mainContent.scrollTop+=i,f.scroller.style.position="relative",f.scroller.getBoundingClientRect().bottom<f.scrollContainer.getBoundingClientRect().bottom?(f.scroller.style.top=f.mainContent.scrollTop*e/f.mainContent.scrollHeight+"px",c=f.scroller.getBoundingClientRect().bottom,c>d&&(setTimeout(function(){f.windowResize(f)},1e3),window.clearInterval(g))):window.clearInterval(g)};var m=function(a,b){var c=null;return function(){c&&clearTimeout(c);var d=arguments;c=setTimeout(function(){b.apply(null,d)},a)}};l.prototype.monitor=function(a){var b=this,c=m(30,function(){f(b)}),d=new MutationObserver(function(a){a.forEach(function(a){c()})}),e={attributes:!0,childList:!0,subtree:!0},g=a;d.observe(g,e)},l.prototype.scrollListener=function(a){var b=this,e=function(a){return"zmScrolThumb"===a.target.className?void b.scrollDecider(a):(c=b.scroller.getBoundingClientRect().top,d=a.clientY,void(a.clientY>c?g=window.setInterval(b.scrollDown,50):a.clientY<c&&(g=window.setInterval(b.scrollUp,50))))},f=function(){window.clearInterval(g)};this.scrollContainer.addEventListener("mousedown",e,!1),this.scrollContainer.addEventListener("mouseup",f,!1),this.mainContent.addEventListener("mousewheel",b.mousePadScroll.bind(b),!1),this.mainContent.addEventListener("DOMMouseScroll",b.mousePadScroll.bind(b),!1),window.addEventListener("resize",b.windowResize.bind(a,b),!1)},l.prototype.windowResize=f=function(a){if(e=a.scrollContainer.offsetHeight,a.scrollContainer.style.height=a.mainContent.offsetHeight-3+"px",b=a.mainContent.offsetHeight*e/a.mainContent.scrollHeight,b>50&&(a.scroller.style.height=b+"px"),"zm_lftree"!==a.mainContent.id){var c=a.mainContent.getBoundingClientRect();a.scrollContainer.style.left=c.right-12+"px"}},l.prototype.create=function(){var a,c=this,d=c.mainContent,e=c.scroller,f=c.scrollContainer;f.className="zmScrollTrail shw",e.className="zmScrolThumb";var g=f.style;return a=d.getBoundingClientRect(),g.left=a.right-12+"px",g.height=d.offsetHeight+"px",g.top=a.top+"px",d.appendChild(f),d.style.overflow="hidden",g=e.style,b=d.offsetHeight*f.offsetHeight/d.scrollHeight,g.height=b+"px",f.appendChild(e),f.offsetHeight===b?($(c.scrollContainer).removeClass("shw"),!1):void(d.style.paddingRight="12px")},k.init=function(a,b){var c=new l(a,b);return c.create(),c.scrollListener(),c.monitor(c.mainContent),c},l.prototype.setZIndex=function(a){var b=this;b.scrollContainer.style.zIndex=a},l.prototype.resize=function(){var a=this;if(a.scrollContainer.style.height=a.mainContent.offsetHeight-3+"px",e=a.scrollContainer.offsetHeight,0===e&&(e=parseInt(a.scrollContainer.style.height)),b=a.mainContent.offsetHeight*e/a.mainContent.scrollHeight,b>50&&(a.scroller.style.height=b+"px"),e===b)return $(a.scrollContainer).removeClass("shw"),!1;var c=a.mainContent.scrollHeight;$(a.scrollContainer).addClass("shw"),a.scroller.style.top=a.mainContent.scrollTop*a.scrollContainer.offsetHeight/c+"px"},l.prototype.scrollView=function(){var a=this;e=a.scrollContainer.offsetHeight,a.scroller.style.position="relative",a.scroller.style.top=a.mainContent.scrollTop*e/a.mainContent.scrollHeight+"px"},a.customScrollBar=k.init}(window.zmComponent||{}),define([],function(a){var b=a("zmUtil"),c={zohoMail:"Zoho Mail"},d=function(a){var d=a.title||c.zohoMail,e=a.tag||"default",f=a.msg||"",g=a.imgUrl||zmail.imgPath+"logo.png",h=b.getWindowVisibilityStatus(),i=b.getDesktopNotificationPermission(),j="function"==typeof a.callback?a.callback:void 0;if(h=Boolean(h>-1&&!h),1===zmail.mailOpt.dtNotify&&i>-1&&0===i&&h){
var k=window.Notification;if("Notification"in window){var l=new k(d,{icon:g,tag:e,body:f});"function"==typeof j&&(l.onclick=function(){window.focus(),j(a)}),setTimeout(l.close.bind(l),a.hideAfter||3e3)}}},e=window._zm;return e.pushDesktopNotification=d,e});